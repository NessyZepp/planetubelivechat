var ai=Object.freeze,At=Object.defineProperty,Lo=Object.defineProperties,wo=Object.getOwnPropertyDescriptor,Ro=Object.getOwnPropertyDescriptors;var li=Object.getOwnPropertySymbols;var So=Object.prototype.hasOwnProperty,ko=Object.prototype.propertyIsEnumerable;var ci=(r,t,e)=>t in r?At(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,G=(r,t)=>{for(var e in t||(t={}))So.call(t,e)&&ci(r,e,t[e]);if(li)for(var e of li(t))ko.call(t,e)&&ci(r,e,t[e]);return r},je=(r,t)=>Lo(r,Ro(t));var xo=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var f=(r,t,e,i)=>{for(var n=i>1?void 0:i?wo(t,e):t,o=r.length-1,s;o>=0;o--)(s=r[o])&&(n=(i?s(t,e,n):s(n))||n);return i&&n&&At(t,e,n),n};var d=(r,t)=>ai(At(r,"raw",{value:ai(t||r.slice())}));var xr=xo((eu,kr)=>{kr.exports=function(r){var t={};function e(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return r[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=r,e.c=t,e.d=function(i,n,o){e.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:o})},e.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},e.t=function(i,n){if(1&n&&(i=e(i)),8&n||4&n&&typeof i=="object"&&i&&i.__esModule)return i;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:i}),2&n&&typeof i!="string")for(var s in i)e.d(o,s,(function(a){return i[a]}).bind(null,s));return o},e.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(n,"a",n),n},e.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},e.p="",e(e.s=0)}([function(r,t,e){"use strict";e.r(t),e.d(t,"validateHTMLColorName",function(){return s}),e.d(t,"validateHTMLColorSpecialName",function(){return a}),e.d(t,"validateHTMLColorHex",function(){return l}),e.d(t,"validateHTMLColorRgb",function(){return R}),e.d(t,"validateHTMLColorHsl",function(){return S}),e.d(t,"validateHTMLColorHwb",function(){return x}),e.d(t,"validateHTMLColorLab",function(){return P}),e.d(t,"validateHTMLColorLch",function(){return U}),e.d(t,"validateHTMLColor",function(){return I});let i=_=>_&&typeof _=="string",n=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenrod","DarkGray","DarkGrey","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","Goldenrod","Gray","Grey","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenrodYellow","LightGray","LightGrey","LightGreen","LightPink","LightSalmon","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquamarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenrod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","RebeccaPurple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"],o=["currentColor","inherit","transparent"],s=_=>{let A=!1;return i(_)&&n.map(N=>(_.toLowerCase()===N.toLowerCase()&&(A=!0),null)),A},a=_=>{let A=!1;return i(_)&&o.map(N=>(_.toLowerCase()===N.toLowerCase()&&(A=!0),null)),A},l=_=>i(_)?_&&/^#([\da-f]{3}){1,2}$|^#([\da-f]{4}){1,2}$/i.test(_):!1,c="(([\\d]{0,5})((\\.([\\d]{1,5}))?))",p="(".concat(c,"%)"),m="(([0-9]|[1-9][0-9]|100)%)",b="(".concat(m,"|(0?((\\.([\\d]{1,5}))?))|1)"),v="([\\s]{0,5})\\)?)(([\\s]{0,5})(\\/?)([\\s]{1,5})".concat("(((".concat(m,"))|(0?((\\.([\\d]{1,5}))?))|1))?"),"([\\s]{0,5})\\)"),y="(-?(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-5][0-9])((\\.([\\d]{1,5}))?)|360)(deg)?)",R=_=>{if(i(_)){let A="([\\s]{0,5})([\\d]{1,5})%?([\\s]{0,5}),?",N="((([\\s]{0,5}),?([\\s]{0,5}))|(([\\s]{1,5})))",D=new RegExp("^(rgb)a?\\(".concat("".concat(A).concat(N)).concat("".concat(A).concat(N)).concat("".concat(A).concat(N),"((\\/?([\\s]{0,5})(0?\\.?([\\d]{1,5})%?([\\s]{0,5}))?|1|0))?\\)$"));return _&&D.test(_)}return!1},S=_=>{if(i(_)){let A=new RegExp("^(hsl)a?\\((([\\s]{0,5})(".concat(y,"|(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-9][0-9]|400)grad)|((([0-5])?\\.([\\d]{1,5})|6\\.([0-9]|1[0-9]|2[0-8])|[0-6])rad)|((0?((\\.([\\d]{1,5}))?)|1)turn))((([\\s]{0,5}),([\\s]{0,5}))|(([\\s]{1,5}))))(([\\s]{0,5})(0|").concat(m,")((([\\s]{0,5}),([\\s]{0,5}))|(([\\s]{1,5}))))(([\\s]{0,5})(0|").concat(m,")([\\s]{0,5})\\)?)(([\\s]{0,5})(\\/?|,?)([\\s]{0,5})(((").concat(m,"))|(0?((\\.([\\d]{1,5}))?))|1))?\\)$"));return _&&A.test(_)}return!1},x=_=>{if(i(_)){let A=new RegExp("^(hwb\\(([\\s]{0,5})".concat(y,"([\\s]{1,5}))((0|").concat(m,")([\\s]{1,5}))((0|").concat(m,")").concat(v,"$"));return _&&A.test(_)}return!1},P=_=>{if(i(_)){let A="(-?(([0-9]|[1-9][0-9]|1[0-5][0-9])((\\.([\\d]{1,5}))?)?|160))",N=new RegExp("^(lab\\(([\\s]{0,5})".concat(p,"([\\s]{1,5})").concat(A,"([\\s]{1,5})").concat(A).concat(v,"$"));return _&&N.test(_)}return!1},U=_=>{if(i(_)){let A="((([0-9]|[1-9][0-9])?((\\.([\\d]{1,5}))?)|100)(%)?)",N=""+c,D="((".concat(y,")|(0|").concat(b,")|(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-5][0-9])((\\.([\\d]{1,5}))?)|360))"),re="(\\/([\\s]{0,5})".concat(b,")"),J=new RegExp("^lch\\(".concat("(([\\s]{0,5})".concat(A,"([\\s]{1,5})").concat(N,"([\\s]{1,5})").concat(D,"([\\s]{0,5})(").concat(re,")?)"),"\\)$"));return _&&J.test(_)}return!1},I=_=>!!(_&&l(_)||R(_)||S(_)||x(_)||P(_)||U(_));t.default=_=>!!(_&&l(_)||s(_)||a(_)||R(_)||S(_)||x(_)||P(_)||U(_))}])});var Ge=globalThis,We=Ge.ShadowRoot&&(Ge.ShadyCSS===void 0||Ge.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,di=Symbol(),ui=new WeakMap,qe=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==di)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o,e=this.t;if(We&&t===void 0){let i=e!==void 0&&e.length===1;i&&(t=ui.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&ui.set(e,t))}return t}toString(){return this.cssText}},hi=r=>new qe(typeof r=="string"?r:r+"",void 0,di);var pi=(r,t)=>{if(We)r.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let e of t){let i=document.createElement("style"),n=Ge.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=e.cssText,r.appendChild(i)}},$t=We?r=>r:r=>r instanceof CSSStyleSheet?(t=>{let e="";for(let i of t.cssRules)e+=i.cssText;return hi(e)})(r):r;var{is:Io,defineProperty:No,getOwnPropertyDescriptor:Do,getOwnPropertyNames:Po,getOwnPropertySymbols:Uo,getPrototypeOf:Ho}=Object,ne=globalThis,mi=ne.trustedTypes,Mo=mi?mi.emptyScript:"",Tt=ne.reactiveElementPolyfillSupport,Ie=(r,t)=>r,Ne={toAttribute(r,t){switch(t){case Boolean:r=r?Mo:null;break;case Object:case Array:r=r==null?r:JSON.stringify(r)}return r},fromAttribute(r,t){let e=r;switch(t){case Boolean:e=r!==null;break;case Number:e=r===null?null:Number(r);break;case Object:case Array:try{e=JSON.parse(r)}catch(i){e=null}}return e}},Ae=(r,t)=>!Io(r,t),fi={attribute:!0,type:String,converter:Ne,reflect:!1,useDefault:!1,hasChanged:Ae},gi,bi;(gi=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(bi=ne.litPropertyMetadata)!=null||(ne.litPropertyMetadata=new WeakMap);var Q=class extends HTMLElement{static addInitializer(t){var e;this._$Ei(),((e=this.l)!=null?e:this.l=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=fi){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){let i=Symbol(),n=this.getPropertyDescriptor(t,i,e);n!==void 0&&No(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){var s;let{get:n,set:o}=(s=Do(this.prototype,t))!=null?s:{get(){return this[e]},set(a){this[e]=a}};return{get:n,set(a){let l=n==null?void 0:n.call(this);o==null||o.call(this,a),this.requestUpdate(t,l,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){var e;return(e=this.elementProperties.get(t))!=null?e:fi}static _$Ei(){if(this.hasOwnProperty(Ie("elementProperties")))return;let t=Ho(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Ie("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ie("properties"))){let e=this.properties,i=[...Po(e),...Uo(e)];for(let n of i)this.createProperty(n,e[n])}let t=this[Symbol.metadata];if(t!==null){let e=litPropertyMetadata.get(t);if(e!==void 0)for(let[i,n]of e)this.elementProperties.set(i,n)}this._$Eh=new Map;for(let[e,i]of this.elementProperties){let n=this._$Eu(e,i);n!==void 0&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){let e=[];if(Array.isArray(t)){let i=new Set(t.flat(1/0).reverse());for(let n of i)e.unshift($t(n))}else t!==void 0&&e.push($t(t));return e}static _$Eu(t,e){let i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e,i;((e=this._$EO)!=null?e:this._$EO=new Set).add(t),this.renderRoot!==void 0&&this.isConnected&&((i=t.hostConnected)==null||i.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){let t=new Map,e=this.constructor.elementProperties;for(let i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){var e;let t=(e=this.shadowRoot)!=null?e:this.attachShadow(this.constructor.shadowRootOptions);return pi(t,this.constructor.elementStyles),t}connectedCallback(){var t,e;(t=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(i=>{var n;return(n=i.hostConnected)==null?void 0:n.call(i)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$ET(t,e){var o;let i=this.constructor.elementProperties.get(t),n=this.constructor._$Eu(t,i);if(n!==void 0&&i.reflect===!0){let s=(((o=i.converter)==null?void 0:o.toAttribute)!==void 0?i.converter:Ne).toAttribute(e,i.type);this._$Em=t,s==null?this.removeAttribute(n):this.setAttribute(n,s),this._$Em=null}}_$AK(t,e){var o,s,a,l;let i=this.constructor,n=i._$Eh.get(t);if(n!==void 0&&this._$Em!==n){let c=i.getPropertyOptions(n),p=typeof c.converter=="function"?{fromAttribute:c.converter}:((o=c.converter)==null?void 0:o.fromAttribute)!==void 0?c.converter:Ne;this._$Em=n,this[n]=(l=(a=p.fromAttribute(e,c.type))!=null?a:(s=this._$Ej)==null?void 0:s.get(n))!=null?l:null,this._$Em=null}}requestUpdate(t,e,i){var n,o;if(t!==void 0){let s=this.constructor,a=this[t];if(i!=null||(i=s.getPropertyOptions(t)),!(((n=i.hasChanged)!=null?n:Ae)(a,e)||i.useDefault&&i.reflect&&a===((o=this._$Ej)==null?void 0:o.get(t))&&!this.hasAttribute(s._$Eu(t,i))))return;this.C(t,e,i)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,e,{useDefault:i,reflect:n,wrapped:o},s){var a,l,c;i&&!((a=this._$Ej)!=null?a:this._$Ej=new Map).has(t)&&(this._$Ej.set(t,(l=s!=null?s:e)!=null?l:this[t]),o!==!0||s!==void 0)||(this._$AL.has(t)||(this.hasUpdated||i||(e=void 0),this._$AL.set(t,e)),n===!0&&this._$Em!==t&&((c=this._$Eq)!=null?c:this._$Eq=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}let t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i,n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if((i=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[s,a]of this._$Ep)this[s]=a;this._$Ep=void 0}let o=this.constructor.elementProperties;if(o.size>0)for(let[s,a]of o){let{wrapped:l}=a,c=this[s];l!==!0||this._$AL.has(s)||c===void 0||this.C(s,void 0,a,c)}}let t=!1,e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(n=this._$EO)==null||n.forEach(o=>{var s;return(s=o.hostUpdate)==null?void 0:s.call(o)}),this.update(e)):this._$EM()}catch(o){throw t=!1,this._$EM(),o}t&&this._$AE(e)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(i=>{var n;return(n=i.hostUpdated)==null?void 0:n.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(t){}firstUpdated(t){}},vi;Q.elementStyles=[],Q.shadowRootOptions={mode:"open"},Q[Ie("elementProperties")]=new Map,Q[Ie("finalized")]=new Map,Tt==null||Tt({ReactiveElement:Q}),((vi=ne.reactiveElementVersions)!=null?vi:ne.reactiveElementVersions=[]).push("2.1.0");var Pe=globalThis,ze=Pe.trustedTypes,Ci=ze?ze.createPolicy("lit-html",{createHTML:r=>r}):void 0,Rt="$lit$",ee="lit$".concat(Math.random().toFixed(9).slice(2),"$"),St="?"+ee,Vo="<".concat(St,">"),fe=document,Ue=()=>fe.createComment(""),He=r=>r===null||typeof r!="object"&&typeof r!="function",kt=Array.isArray,Ti=r=>kt(r)||typeof(r==null?void 0:r[Symbol.iterator])=="function",Lt="[ 	\n\f\r]",De=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,_i=/-->/g,yi=/>/g,pe=RegExp(">|".concat(Lt,"(?:([^\\s\"'>=/]+)(").concat(Lt,"*=").concat(Lt,"*(?:[^ 	\n\f\r\"'`<>=]|(\"|')|))|$)"),"g"),Ei=/'/g,Oi=/"/g,Li=/^(?:script|style|textarea|title)$/i,xt=r=>(t,...e)=>({_$litType$:r,strings:t,values:e}),h=xt(1),bs=xt(2),vs=xt(3),W=Symbol.for("lit-noChange"),E=Symbol.for("lit-nothing"),Ai=new WeakMap,me=fe.createTreeWalker(fe,129);function wi(r,t){if(!kt(r)||!r.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ci!==void 0?Ci.createHTML(t):t}var Ri=(r,t)=>{let e=r.length-1,i=[],n,o=t===2?"<svg>":t===3?"<math>":"",s=De;for(let a=0;a<e;a++){let l=r[a],c,p,m=-1,b=0;for(;b<l.length&&(s.lastIndex=b,p=s.exec(l),p!==null);)b=s.lastIndex,s===De?p[1]==="!--"?s=_i:p[1]!==void 0?s=yi:p[2]!==void 0?(Li.test(p[2])&&(n=RegExp("</"+p[2],"g")),s=pe):p[3]!==void 0&&(s=pe):s===pe?p[0]===">"?(s=n!=null?n:De,m=-1):p[1]===void 0?m=-2:(m=s.lastIndex-p[2].length,c=p[1],s=p[3]===void 0?pe:p[3]==='"'?Oi:Ei):s===Oi||s===Ei?s=pe:s===_i||s===yi?s=De:(s=pe,n=void 0);let v=s===pe&&r[a+1].startsWith("/>")?" ":"";o+=s===De?l+Vo:m>=0?(i.push(c),l.slice(0,m)+Rt+l.slice(m)+ee+v):l+ee+(m===-2?a:v)}return[wi(r,o+(r[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]},Me=class r{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let o=0,s=0,a=t.length-1,l=this.parts,[c,p]=Ri(t,e);if(this.el=r.createElement(c,i),me.currentNode=this.el.content,e===2||e===3){let m=this.el.content.firstChild;m.replaceWith(...m.childNodes)}for(;(n=me.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(let m of n.getAttributeNames())if(m.endsWith(Rt)){let b=p[s++],v=n.getAttribute(m).split(ee),y=/([.?@])?(.*)/.exec(b);l.push({type:1,index:o,name:y[2],strings:v,ctor:y[1]==="."?Ke:y[1]==="?"?Je:y[1]==="@"?Xe:be}),n.removeAttribute(m)}else m.startsWith(ee)&&(l.push({type:6,index:o}),n.removeAttribute(m));if(Li.test(n.tagName)){let m=n.textContent.split(ee),b=m.length-1;if(b>0){n.textContent=ze?ze.emptyScript:"";for(let v=0;v<b;v++)n.append(m[v],Ue()),me.nextNode(),l.push({type:2,index:++o});n.append(m[b],Ue())}}}else if(n.nodeType===8)if(n.data===St)l.push({type:2,index:o});else{let m=-1;for(;(m=n.data.indexOf(ee,m+1))!==-1;)l.push({type:7,index:o}),m+=ee.length-1}o++}}static createElement(t,e){let i=fe.createElement("template");return i.innerHTML=t,i}};function ge(r,t,e=r,i){var s,a,l;if(t===W)return t;let n=i!==void 0?(s=e._$Co)==null?void 0:s[i]:e._$Cl,o=He(t)?void 0:t._$litDirective$;return(n==null?void 0:n.constructor)!==o&&((a=n==null?void 0:n._$AO)==null||a.call(n,!1),o===void 0?n=void 0:(n=new o(r),n._$AT(r,e,i)),i!==void 0?((l=e._$Co)!=null?l:e._$Co=[])[i]=n:e._$Cl=n),n!==void 0&&(t=ge(r,n._$AS(r,t.values),n,i)),t}var Ye=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var c;let{el:{content:e},parts:i}=this._$AD,n=((c=t==null?void 0:t.creationScope)!=null?c:fe).importNode(e,!0);me.currentNode=n;let o=me.nextNode(),s=0,a=0,l=i[0];for(;l!==void 0;){if(s===l.index){let p;l.type===2?p=new $e(o,o.nextSibling,this,t):l.type===1?p=new l.ctor(o,l.name,l.strings,this,t):l.type===6&&(p=new Ze(o,this,t)),this._$AV.push(p),l=i[++a]}s!==(l==null?void 0:l.index)&&(o=me.nextNode(),s++)}return me.currentNode=fe,n}p(t){let e=0;for(let i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}},$e=class r{get _$AU(){var t,e;return(e=(t=this._$AM)==null?void 0:t._$AU)!=null?e:this._$Cv}constructor(t,e,i,n){var o;this.type=2,this._$AH=E,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=(o=n==null?void 0:n.isConnected)!=null?o:!0}get parentNode(){let t=this._$AA.parentNode,e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=ge(this,t,e),He(t)?t===E||t==null||t===""?(this._$AH!==E&&this._$AR(),this._$AH=E):t!==this._$AH&&t!==W&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Ti(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==E&&He(this._$AH)?this._$AA.nextSibling.data=t:this.T(fe.createTextNode(t)),this._$AH=t}$(t){var o;let{values:e,_$litType$:i}=t,n=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=Me.createElement(wi(i.h,i.h[0]),this.options)),i);if(((o=this._$AH)==null?void 0:o._$AD)===n)this._$AH.p(e);else{let s=new Ye(n,this),a=s.u(this.options);s.p(e),this.T(a),this._$AH=s}}_$AC(t){let e=Ai.get(t.strings);return e===void 0&&Ai.set(t.strings,e=new Me(t)),e}k(t){kt(this._$AH)||(this._$AH=[],this._$AR());let e=this._$AH,i,n=0;for(let o of t)n===e.length?e.push(i=new r(this.O(Ue()),this.O(Ue()),this,this.options)):i=e[n],i._$AI(o),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){let n=t.nextSibling;t.remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}},be=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,o){this.type=1,this._$AH=E,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=o,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=E}_$AI(t,e=this,i,n){let o=this.strings,s=!1;if(o===void 0)t=ge(this,t,e,0),s=!He(t)||t!==this._$AH&&t!==W,s&&(this._$AH=t);else{let a=t,l,c;for(t=o[0],l=0;l<o.length-1;l++)c=ge(this,a[i+l],e,l),c===W&&(c=this._$AH[l]),s||(s=!He(c)||c!==this._$AH[l]),c===E?t=E:t!==E&&(t+=(c!=null?c:"")+o[l+1]),this._$AH[l]=c}s&&!n&&this.j(t)}j(t){t===E?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t!=null?t:"")}},Ke=class extends be{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===E?void 0:t}},Je=class extends be{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==E)}},Xe=class extends be{constructor(t,e,i,n,o){super(t,e,i,n,o),this.type=5}_$AI(t,e=this){var s;if((t=(s=ge(this,t,e,0))!=null?s:E)===W)return;let i=this._$AH,n=t===E&&i!==E||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,o=t!==E&&(i===E||n);n&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;typeof this._$AH=="function"?this._$AH.call((i=(e=this.options)==null?void 0:e.host)!=null?i:this.element,t):this._$AH.handleEvent(t)}},Ze=class{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){ge(this,t)}},Si={M:Rt,P:ee,A:St,C:1,L:Ri,R:Ye,D:Ti,V:ge,I:$e,H:be,N:Je,U:Xe,B:Ke,F:Ze},wt=Pe.litHtmlPolyfillSupport,$i;wt==null||wt(Me,$e),(($i=Pe.litHtmlVersions)!=null?$i:Pe.litHtmlVersions=[]).push("3.3.0");var X=(r,t,e)=>{var o,s;let i=(o=e==null?void 0:e.renderBefore)!=null?o:t,n=i._$litPart$;if(n===void 0){let a=(s=e==null?void 0:e.renderBefore)!=null?s:null;i._$litPart$=n=new $e(t.insertBefore(Ue(),a),a,void 0,e!=null?e:{})}return n._$AI(r),n};var ve=globalThis,oe=class extends Q{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,i;let t=super.createRenderRoot();return(i=(e=this.renderOptions).renderBefore)!=null||(e.renderBefore=t.firstChild),t}update(t){let e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=X(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return W}},ki;oe._$litElement$=!0,oe.finalized=!0,(ki=ve.litElementHydrateSupport)==null||ki.call(ve,{LitElement:oe});var It=ve.litElementPolyfillSupport;It==null||It({LitElement:oe});var xi;((xi=ve.litElementVersions)!=null?xi:ve.litElementVersions=[]).push("4.2.0");var $=r=>(t,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(r,t)}):customElements.define(r,t)};var Fo={attribute:!0,type:String,converter:Ne,reflect:!1,hasChanged:Ae},Bo=(r=Fo,t,e)=>{let{kind:i,metadata:n}=e,o=globalThis.litPropertyMetadata.get(n);if(o===void 0&&globalThis.litPropertyMetadata.set(n,o=new Map),i==="setter"&&((r=Object.create(r)).wrapped=!0),o.set(e.name,r),i==="accessor"){let{name:s}=e;return{set(a){let l=t.get.call(this);t.set.call(this,a),this.requestUpdate(s,l,r)},init(a){return a!==void 0&&this.C(s,void 0,r,a),a}}}if(i==="setter"){let{name:s}=e;return function(a){let l=this[s];t.call(this,a),this.requestUpdate(s,l,r)}}throw Error("Unsupported decorator location: "+i)};function C(r){return(t,e)=>typeof e=="object"?Bo(r,t,e):((i,n,o)=>{let s=n.hasOwnProperty(o);return n.constructor.createProperty(o,i),s?Object.getOwnPropertyDescriptor(n,o):void 0})(r,t,e)}function k(r){return C(je(G({},r),{state:!0,attribute:!1}))}var Y={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},z=r=>(...t)=>({_$litDirective$:r,values:t}),Z=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}};var{I:jo}=Si;var Ni=r=>r.strings===void 0,Ii=()=>document.createComment(""),Te=(r,t,e)=>{var o;let i=r._$AA.parentNode,n=t===void 0?r._$AB:t._$AA;if(e===void 0){let s=i.insertBefore(Ii(),n),a=i.insertBefore(Ii(),n);e=new jo(s,a,r,r.options)}else{let s=e._$AB.nextSibling,a=e._$AM,l=a!==r;if(l){let c;(o=e._$AQ)==null||o.call(e,r),e._$AM=r,e._$AP!==void 0&&(c=r._$AU)!==a._$AU&&e._$AP(c)}if(s!==n||l){let c=e._$AA;for(;c!==s;){let p=c.nextSibling;i.insertBefore(c,n),c=p}}}return e},se=(r,t,e=r)=>(r._$AI(t,e),r),Go={},Di=(r,t=Go)=>r._$AH=t,Pi=r=>r._$AH,et=r=>{var i;(i=r._$AP)==null||i.call(r,!1,!0);let t=r._$AA,e=r._$AB.nextSibling;for(;t!==e;){let n=t.nextSibling;t.remove(),t=n}};var Ve=(r,t)=>{var i;let e=r._$AN;if(e===void 0)return!1;for(let n of e)(i=n._$AO)==null||i.call(n,t,!1),Ve(n,t);return!0},tt=r=>{let t,e;do{if((t=r._$AM)===void 0)break;e=t._$AN,e.delete(r),r=t}while((e==null?void 0:e.size)===0)},Ui=r=>{for(let t;t=r._$AM;r=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(r))break;e.add(r),zo(t)}};function qo(r){this._$AN!==void 0?(tt(this),this._$AM=r,Ui(this)):this._$AM=r}function Wo(r,t=!1,e=0){let i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(t)if(Array.isArray(i))for(let o=e;o<i.length;o++)Ve(i[o],!1),tt(i[o]);else i!=null&&(Ve(i,!1),tt(i));else Ve(this,r)}var zo=r=>{var t,e;r.type==Y.CHILD&&((t=r._$AP)!=null||(r._$AP=Wo),(e=r._$AQ)!=null||(r._$AQ=qo))},ae=class extends Z{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,i){super._$AT(t,e,i),Ui(this),this.isConnected=t._$AU}_$AO(t,e=!0){var i,n;t!==this.isConnected&&(this.isConnected=t,t?(i=this.reconnected)==null||i.call(this):(n=this.disconnected)==null||n.call(this)),e&&(Ve(this,t),tt(this))}setValue(t){if(Ni(this._$Ct))this._$Ct._$AI(t,this);else{let e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}};var Fe=class extends Z{constructor(t){if(super(t),this.it=E,t.type!==Y.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===E||t==null)return this._t=void 0,this.it=t;if(t===W)return t;if(typeof t!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;let e=[t];return e.raw=e,this._t={_$litType$:this.constructor.resultType,strings:e,values:[]}}};Fe.directiveName="unsafeHTML",Fe.resultType=1;var K=z(Fe);function Hi(r){return{log:t=>{typeof t=="string"?console.log("["+r+"] "+t):console.log("["+r+"]",t)},info:t=>{typeof t=="string"?console.info("["+r+"] "+t):console.info("["+r+"]",t)},error:t=>{typeof t=="string"?console.error("["+r+"] "+t):console.error("["+r+"]",t)},warn:t=>{typeof t=="string"?console.warn("["+r+"] "+t):console.warn("["+r+"]",t)},createLogger:t=>Hi("peertube-plugin-livechat>"+t)}}var L=Hi("peertube-plugin-livechat");var Nt=class{constructor(t,e){this.ptOptions=t,this.logger=e}async getSettings(){return this._settings||(this._settings=await this.ptOptions.peertubeHelpers.getSettings()),this._settings}},Dt;function V(){if(!Dt)throw new Error("Peertube context not set yet, getPtContext was called too soon.");return Dt}function Mi(r){Dt=new Nt(r,L)}var Vi,Pt=class extends ae{constructor(e){super(e);this._translatedValue="";this._localizationId="";this._allowUnsafeHTML=!1;this.render=(e,i=!1)=>(this._localizationId=e,this._allowUnsafeHTML=i,this._translatedValue===""&&(this._translatedValue=e),this._asyncUpdateTranslation().then(()=>{},()=>{}),this._internalRender());this._internalRender=()=>this._allowUnsafeHTML?h(Vi||(Vi=d(["",""])),K(this._translatedValue)):this._translatedValue;this._asyncUpdateTranslation=async()=>{var i;let e=(i=await this._peertubeHelpers.translate(this._localizationId))!=null?i:"";return e!==""&&e!==this._translatedValue&&(this._translatedValue=e,this.setValue(this._internalRender())),!0};this._peertubeHelpers=V().ptOptions.peertubeHelpers,this._asyncUpdateTranslation().then(()=>{},()=>{})}},u=z(Pt);var Fi=Symbol(),F=class{get taskComplete(){return this.t||(this.i===1?this.t=new Promise((t,e)=>{this.o=t,this.h=e}):this.i===3?this.t=Promise.reject(this.l):this.t=Promise.resolve(this.u)),this.t}constructor(t,e,i){var o,s,a;this.p=0,this.i=0,(this._=t).addController(this);let n=typeof e=="object"?e:{task:e,args:i};this.v=n.task,this.j=n.args,this.m=(o=n.argsEqual)!=null?o:Bi,this.k=n.onComplete,this.A=n.onError,this.autoRun=(s=n.autoRun)!=null?s:!0,"initialValue"in n&&(this.u=n.initialValue,this.i=2,this.O=(a=this.T)==null?void 0:a.call(this))}hostUpdate(){this.autoRun===!0&&this.S()}hostUpdated(){this.autoRun==="afterUpdate"&&this.S()}T(){if(this.j===void 0)return;let t=this.j();if(!Array.isArray(t))throw Error("The args function must return an array");return t}async S(){let t=this.T(),e=this.O;this.O=t,t===e||t===void 0||e!==void 0&&this.m(e,t)||await this.run(t)}async run(t){var s,a,l,c,p;let e,i;t!=null||(t=this.T()),this.O=t,this.i===1?(s=this.q)==null||s.abort():(this.t=void 0,this.o=void 0,this.h=void 0),this.i=1,this.autoRun==="afterUpdate"?queueMicrotask(()=>this._.requestUpdate()):this._.requestUpdate();let n=++this.p;this.q=new AbortController;let o=!1;try{e=await this.v(t,{signal:this.q.signal})}catch(m){o=!0,i=m}if(this.p===n){if(e===Fi)this.i=0;else{if(o===!1){try{(a=this.k)==null||a.call(this,e)}catch(m){}this.i=2,(l=this.o)==null||l.call(this,e)}else{try{(c=this.A)==null||c.call(this,i)}catch(m){}this.i=3,(p=this.h)==null||p.call(this,i)}this.u=e,this.l=i}this._.requestUpdate()}}abort(t){var e;this.i===1&&((e=this.q)==null||e.abort(t))}get value(){return this.u}get error(){return this.l}get status(){return this.i}render(t){var e,i,n,o;switch(this.i){case 0:return(e=t.initial)==null?void 0:e.call(t);case 1:return(i=t.pending)==null?void 0:i.call(t);case 2:return(n=t.complete)==null?void 0:n.call(t,this.value);case 3:return(o=t.error)==null?void 0:o.call(t,this.error);default:throw Error("Unexpected status: "+this.i)}}},Bi=(r,t)=>r===t||r.length===t.length&&r.every((e,i)=>!Ae(e,t[i]));var B=class extends Error{constructor(e,i,n){super(i);this.properties={};this.name=e,this.properties=n}};function H({peertubeHelpers:r},t=!1){return t?"/plugins/livechat/router":r.getBaseRouterRoute?r.getBaseRouterRoute():r.getBaseStaticRoute().replace(/\/static.*$/,"/router")}var ji=["image/jpg","image/png","image/gif"];var le=class{constructor(t){this._headers={};this.validateOptions=async t=>{var s;let e={};t.terms&&t.terms.length>400&&(e.terms=[5]);let i=t.bot,n=t.slowMode.duration,o=t.moderation.delay;if(e["slowMode.duration"]=[],e["moderation.delay"]=[],typeof n!="number"||isNaN(n)?e["slowMode.duration"].push(1):(n<0||n>1e3)&&e["slowMode.duration"].push(3),typeof o!="number"||isNaN(o)?e["moderation.delay"].push(1):(o<0||o>60)&&e["moderation.delay"].push(3),i.enabled){if(e["bot.nickname"]=[],e["bot.forbidSpecialChars.tolerance"]=[],e["bot.noDuplicate.delay"]=[],new RegExp("[^\\p{L}\\p{N}\\p{Z}_-]","u").test((s=i.nickname)!=null?s:"")&&e["bot.nickname"].push(2),i.forbidSpecialChars.enabled){let a=t.bot.forbidSpecialChars.tolerance;typeof a!="number"||isNaN(a)?e["bot.forbidSpecialChars.tolerance"].push(1):(a<0||a>10)&&e["bot.forbidSpecialChars.tolerance"].push(3)}if(i.noDuplicate.enabled){let a=t.bot.noDuplicate.delay;typeof a!="number"||isNaN(a)?e["bot.noDuplicate.delay"].push(1):(a<0||a>86400)&&e["bot.noDuplicate.delay"].push(3)}for(let[a,l]of i.forbiddenWords.entries())for(let c of l.entries)if(e["bot.forbiddenWords.".concat(a,".entries")]=[],l.regexp&&c.trim()!=="")try{new RegExp(c)}catch(p){e["bot.forbiddenWords.".concat(a,".entries")].push(2)}for(let[a,l]of i.commands.entries())e["bot.commands.".concat(a,".command")]=[],/\s+/.test(l.command)&&e["bot.commands.".concat(a,".command")].push(2)}if(Object.values(e).find(a=>a.length>0))throw new B("ChannelConfigurationOptionsValidationError",await this._registerClientOptions.peertubeHelpers.translate("There was an error during validation."),e);return!0};this.saveOptions=async(t,e)=>{if(!await this.validateOptions(e))throw new Error("Invalid form data");let i=await fetch(H(this._registerClientOptions)+"/api/configuration/channel/"+encodeURIComponent(t),{method:"POST",headers:this._headers,body:JSON.stringify(e)});if(!i.ok)throw new Error("Failed to save configuration options.");return i.json()};this.fetchUserChannels=async t=>{let e=await(await fetch("/api/v1/accounts/"+encodeURIComponent(t)+"/video-channels?start=0&count=100&sort=name",{method:"GET",headers:this._headers})).json();if(!e||!("data"in e)||!Array.isArray(e.data))throw new Error("Can't get the channel list.");for(let i of e.data)if(i.livechatConfigurationUri="/p/livechat/configuration/channel?channelId="+encodeURIComponent(i.id),!i.avatar&&i.avatars&&Array.isArray(i.avatars)){for(let n of i.avatars)if(n.width===120){i.avatar=n;break}}return e.data};this.fetchConfiguration=async t=>{let e=await fetch(H(this._registerClientOptions)+"/api/configuration/channel/"+encodeURIComponent(t),{method:"GET",headers:this._headers});if(!e.ok)throw new Error("Can't get channel configuration options.");return e.json()};var e;this._registerClientOptions=t,this._headers=(e=this._registerClientOptions.peertubeHelpers.getAuthHeader())!=null?e:{},this._headers["content-type"]="application/json;charset=UTF-8"}async fetchEmojisConfiguration(t){let e=H(this._registerClientOptions)+"/api/configuration/channel/emojis/"+encodeURIComponent(t),i=await fetch(e,{method:"GET",headers:this._headers});if(!i.ok)throw new Error("Can't get channel emojis options.");return i.json()}async validateEmojisConfiguration(t){let e={};if(t.customEmojis.length>200)throw new B("ChannelEmojisValidationError",await this._registerClientOptions.peertubeHelpers.translate("Too many entries"),e);let i=new Map;for(let[n,o]of t.customEmojis.entries())e["emojis.".concat(n,".sn")]=[],o.sn===""?e["emojis.".concat(n,".sn")].push(0):/^:?[\w-]+:?$/.test(o.sn)?i.has(o.sn)?e["emojis.".concat(n,".sn")].push(4):i.set(o.sn,!0):e["emojis.".concat(n,".sn")].push(2),e["emojis.".concat(n,".url")]=[],o.url||e["emojis.".concat(n,".url")].push(0);if(Object.values(e).find(n=>n.length>0))throw new B("ChannelEmojisValidationError",await this._registerClientOptions.peertubeHelpers.translate("There was an error during validation."),e);return!0}async saveEmojisConfiguration(t,e){if(!await this.validateEmojisConfiguration(e))throw new Error("Invalid form data");if(!e.customEmojis.find(a=>a.url.startsWith("data:")))return this._saveEmojisConfiguration(t,e);let i,n=[...e.customEmojis],o=n.findIndex(a=>a.url.startsWith("data:")),s=0;for(;o>=0;){if(s++,s>e.customEmojis.length+10)throw new Error("Seems we have sent too many emojis, this was not expected");let a=n.slice(0,o+1);a.push(...n.slice(o+1).filter(c=>!c.url.startsWith("data:"))),i=await this._saveEmojisConfiguration(t,{customEmojis:a});let l=i.emojis.customEmojis.slice(0,o+1);l.push(...n.slice(o+1)),n=l,o=n.findIndex(c=>c.url.startsWith("data:"))}if(!i)throw new Error("Unexpected: no last result");return i}async _saveEmojisConfiguration(t,e){let i=H(this._registerClientOptions)+"/api/configuration/channel/emojis/"+encodeURIComponent(t),n=await fetch(i,{method:"POST",headers:this._headers,body:JSON.stringify(e)});if(!n.ok)throw new Error("Can't get channel emojis options.");return n.json()}async enableEmojisOnlyModeOnAllRooms(t){let e=H(this._registerClientOptions)+"/api/configuration/channel/emojis/"+encodeURIComponent(t)+"/enable_emoji_only",i=await fetch(e,{method:"POST",headers:this._headers});if(!i.ok)throw new Error("Can't enable Emojis Only Mode on all rooms.");return i.json()}};var Ce=class extends Event{constructor(t,e,i,n){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=e,this.callback=i,this.subscribe=n!=null?n:!1}};var rt=class{get value(){return this.o}set value(t){this.setValue(t)}setValue(t,e=!1){let i=e||!Object.is(t,this.o);this.o=t,i&&this.updateObservers()}constructor(t){this.subscriptions=new Map,this.updateObservers=()=>{for(let[e,{disposer:i}]of this.subscriptions)e(this.o,i)},t!==void 0&&(this.value=t)}addCallback(t,e,i){if(!i)return void t(this.value);this.subscriptions.has(t)||this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:e});let{disposer:n}=this.subscriptions.get(t);t(this.value,n)}clearCallbacks(){this.subscriptions.clear()}};var Ft=class extends Event{constructor(t,e){super("context-provider",{bubbles:!0,composed:!0}),this.context=t,this.contextTarget=e}},Le=class extends rt{constructor(t,e,i){var n,o;super(e.context!==void 0?e.initialValue:i),this.onContextRequest=s=>{var l;if(s.context!==this.context)return;let a=(l=s.contextTarget)!=null?l:s.composedPath()[0];a!==this.host&&(s.stopPropagation(),this.addCallback(s.callback,a,s.subscribe))},this.onProviderRequest=s=>{var l;if(s.context!==this.context||((l=s.contextTarget)!=null?l:s.composedPath()[0])===this.host)return;let a=new Set;for(let[c,{consumerHost:p}]of this.subscriptions)a.has(c)||(a.add(c),p.dispatchEvent(new Ce(this.context,p,c,!0)));s.stopPropagation()},this.host=t,e.context!==void 0?this.context=e.context:this.context=e,this.attachListeners(),(o=(n=this.host).addController)==null||o.call(n,this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new Ft(this.context,this.host))}};function ce({context:r}){return(t,e)=>{let i=new WeakMap;if(typeof e=="object")return{get(){return t.get.call(this)},set(n){return i.get(this).setValue(n),t.set.call(this,n)},init(n){return i.set(this,new Le(this,{context:r,initialValue:n})),n}};{t.constructor.addInitializer(s=>{i.set(s,new Le(s,{context:r}))});let n=Object.getOwnPropertyDescriptor(t,e),o;if(n===void 0){let s=new WeakMap;o={get(){return s.get(this)},set(a){i.get(this).setValue(a),s.set(this,a)},configurable:!0,enumerable:!0}}else{let s=n.set;o=je(G({},n),{set(a){i.get(this).setValue(a),s==null||s.call(this,a)}})}return void Object.defineProperty(t,e,o)}}}var Gi=Symbol("channel-configuration"),we=Symbol("channel-configuration-service");var O=class extends oe{constructor(){super();this.createRenderRoot=()=>this;this.ptContext=V(),this.ptOptions=this.ptContext.ptOptions,this.ptNotifier=this.ptOptions.peertubeHelpers.notifier,this.ptTranslate=this.ptOptions.peertubeHelpers.translate,this.logger=this.ptContext.logger.createLogger(this.tagName.toLowerCase())}};var qi,Wi,zi,Yi,Ki,Ji,Re=class extends O{constructor(){super(...arguments);this._asyncTaskRender=new F(this,{task:async()=>{let e=window.localStorage.getItem("username");if(!e)throw new Error("Can't get the current username.");this._channelDetailsService=new le(this.ptOptions),this._channels=await this._channelDetailsService.fetchUserChannels(e)},args:()=>[]});this.render=()=>this._asyncTaskRender.render({pending:()=>h(qi||(qi=d(["<livechat-spinner></livechat-spinner>"]))),error:()=>h(Wi||(Wi=d(["<livechat-error></livechat-error>"]))),complete:()=>{var e;return h(Ji||(Ji=d(['\n      <div class="margin-content peertube-plugin-livechat-configuration peertube-plugin-livechat-configuration-home">\n        <h1>\n          ',"\n            <livechat-help-button .page=",">\n            </livechat-help-button>\n        </h1>\n        <p>","</p>\n        <p>",'</p>\n        <ul class="peertube-plugin-livechat-configuration-home-channels">\n        ',"\n        </ul>\n      </div>\n      "])),u("Configure your live's chatrooms"),"documentation/user/streamers/channel",u("Here you can configure some advanced options for chatrooms associated to your live streams."),u("Please select bellow one of your channel, to setup its chatting options."),(e=this._channels)==null?void 0:e.map(i=>h(Ki||(Ki=d(['\n          <li>\n            <a href="','" aria-hidden="true">\n              ','\n            </a>\n            <div class="peertube-plugin-livechat-configuration-home-info">\n              <a href="','">\n                <div>',"</div>\n                <div>","</div>\n              </a>\n            </div>\n          </li>\n        "])),i.livechatConfigurationUri,i.avatar?h(zi||(zi=d(['<img class="avatar channel" src="','">'])),i.avatar.path):h(Yi||(Yi=d(['<div class="avatar channel initial gray"></div>']))),i.livechatConfigurationUri,i.displayName,i.name)))}})}};f([k()],Re.prototype,"_channels",2),f([ce({context:we})],Re.prototype,"_channelDetailsService",2),Re=f([$("livechat-channel-home")],Re);var T=z(class extends Z{constructor(r){var t;if(super(r),r.type!==Y.ATTRIBUTE||r.name!=="class"||((t=r.strings)==null?void 0:t.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(r){return" "+Object.keys(r).filter(t=>r[t]).join(" ")+" "}update(r,[t]){var i,n;if(this.st===void 0){this.st=new Set,r.strings!==void 0&&(this.nt=new Set(r.strings.join(" ").split(/\s/).filter(o=>o!=="")));for(let o in t)t[o]&&!((i=this.nt)!=null&&i.has(o))&&this.st.add(o);return this.render(t)}let e=r.element.classList;for(let o of this.st)o in t||(e.remove(o),this.st.delete(o));for(let o in t){let s=!!t[o];s===this.st.has(o)||(n=this.nt)!=null&&n.has(o)||(s?(e.add(o),this.st.add(o)):(e.remove(o),this.st.delete(o)))}return W}});var Xi,Zi,Qi,er;function tr(r){var i,n,o,s,a,l,c,p,m,b,v,y,R,S,x,P,U,I,_,A,N,D,re,J,he,ke,xe,ei,ti,ii,ri,ni,oi,si;let t={forbiddenWords:{entries:{colName:u("Forbidden words or expressions"),description:u("One word or expression per line. If you put multiple words on one line, it will only match messages containing the whole sequence.")},regexp:{colName:u("Consider as regular expressions"),description:u("By checking this option, you can use regular expressions.")},applyToModerators:{colName:u("Also moderate messages from moderators"),description:u("By default, moderator messages will not be affected by this feature. By checking this option, messages from moderators will also be deleted.")},label:{colName:u("Label"),description:u("Label for this forbidden words rule")},reason:{colName:u("Reason"),description:u("Reason to display besides deleted messages")},comments:{colName:u("Comments"),description:u("You can add here some comments about this rule, to remember how and why you created it. These comments are purely indicative, and have no influence on the bot's behavior.")}},quotes:{messages:{colName:u("Messages"),description:u("One message per line. If multiple messages, it will pick one randomly every X minutes.")},delay:{colName:u("Send every X minutes"),description:u("The bot will post the message every X minutes.")}},commands:{command:{colName:u("Command"),description:u('The command, without the starting "!". For example "help", "sponsor", ...')},message:{colName:u("Message"),description:u("The message to send.")}}},e={forbiddenWords:{entries:{inputType:"tags",default:[],separator:"\n"},regexp:{inputType:"checkbox",default:!1},applyToModerators:{inputType:"checkbox",default:!1},label:{inputType:"text",default:""},reason:{inputType:"text",default:""},comments:{inputType:"textarea",default:""}},quotes:{messages:{inputType:"textarea",default:[],separator:"\n"},delay:{inputType:"number",default:10}},commands:{command:{inputType:"text",default:""},message:{inputType:"text",default:""}}};return h(er||(er=d(['\n    <div class="margin-content peertube-plugin-livechat-configuration\n                peertube-plugin-livechat-configuration-channel">\n      <h1>\n        <span class="peertube-plugin-livechat-configuration-channel-info">\n          <span>',"</span>\n          <span>","</span>\n        </span>\n      </h1>\n\n      <livechat-channel-tabs .active="," .channelId=","></livechat-channel-tabs>\n\n      <p>\n        ","\n        <livechat-help-button .page=",'>\n        </livechat-help-button>\n      </p>\n\n      <form livechat-configuration-channel-options role="form" @submit='," @change=",">\n\n        <livechat-configuration-section-header\n          .label=","\n          .description=","\n          .helpPage=",'>\n        </livechat-configuration-section-header>\n        <div class="form-group">\n          <textarea\n            .title=','\n            name="terms"\n            id="peertube-livechat-terms"\n            .value=',"\n            maxlength=","\n            class=","\n            @change=","\n          ></textarea>\n          ","\n        </div>\n\n        <livechat-configuration-section-header\n          .label=","\n          .description=","\n          .helpPage=",'>\n        </livechat-configuration-section-header>\n        <div class="form-group">\n          <label>\n            <input\n              type="checkbox"\n              name="mute_anonymous"\n              id="peertube-livechat-mute-anonymous"\n              @input=','\n              value="1"\n              ?checked=',"\n            />\n            ","\n          </label>\n        </div>\n\n        <livechat-configuration-section-header\n          .label=","\n          .description=","\n          .helpPage=",'>\n        </livechat-configuration-section-header>\n        <div class="form-group">\n          <label>\n            ','\n            <input\n              type="number"\n              name="slowmode_duration"\n              class=','\n              min="0"\n              max="1000"\n              id="peertube-livechat-slowmode-duration"\n              aria-describedby="peertube-livechat-slowmode-duration-feedback"\n              @input=','\n              value="','"\n            />\n          </label>\n          ',"\n        </div>\n\n        <livechat-configuration-section-header\n          .label=","\n          .description=","\n          .helpPage=",'>\n        </livechat-configuration-section-header>\n        <div class="form-group">\n          <label>\n            ','\n            <input\n              type="number"\n              name="moderation_delay"\n              class=','\n              min="0"\n              max="60"\n              id="peertube-livechat-moderation-delay"\n              aria-describedby="peertube-livechat-moderation-delay-feedback"\n              @input=','\n              value="','"\n            />\n          </label>\n          ',"\n        </div>\n\n        <livechat-configuration-section-header\n          .label=","\n          .description=","\n          .helpPage=",'>\n        </livechat-configuration-section-header>\n        <div class="form-group">\n          <label>\n            <input\n              type="checkbox"\n              name="anonymize-moderation"\n              id="peertube-livechat-anonymize-moderation"\n              @input=','\n              value="1"\n              ?checked=',"\n            />\n            ","\n          </label>\n        </div>\n\n        <livechat-configuration-section-header\n          .label=","\n          .description=","\n          .helpPage=",'>\n        </livechat-configuration-section-header>\n        <div class="form-group">\n          <label>\n            <input\n              type="checkbox"\n              name="bot"\n              id="peertube-livechat-bot"\n              @input=','\n              value="1"\n              ?checked=',"\n            />\n            ","\n          </label>\n        </div>\n\n        ",'\n\n        <div class="form-group mt-5">\n          <button type="reset" @click='," ?disabled=",">\n            ",'\n          </button>\n          <button type="submit" ?disabled=',">\n            ","\n          </button>\n        </div>\n      </form>\n    </div>"])),(i=r.channelConfiguration)==null?void 0:i.channel.displayName,(n=r.channelConfiguration)==null?void 0:n.channel.name,"configuration",r.channelId,u("You can setup here some options for this channel (moderation policies, ...)."),"documentation/user/streamers/channel",r.saveConfig,r.resetValidation,u("Channel's chat terms & conditions"),u('You can configure a "terms & conditions" message that will be shown to users joining your chatrooms.',!0),"documentation/user/streamers/terms",u("Channel's chat terms & conditions"),(s=(o=r.channelConfiguration)==null?void 0:o.configuration.terms)!=null?s:"",r.termsMaxLength(),T(Object.assign({"form-control":!0},r.getInputValidationClass("terms"))),g=>{if(g!=null&&g.target&&r.channelConfiguration){let Ot=g.target.value;Ot===""&&(Ot=void 0),r.channelConfiguration.configuration.terms=Ot}r.requestUpdate("channelConfiguration")},r.renderFeedback("peertube-livechat-terms-feedback","terms"),u("Mute anonymous users"),u("Default value for new chatrooms. For existing chatrooms, you can change the feature in the room configuration form. When this feature is enabled, anonymous users can only read the chat, and not send messages.",!0),"documentation/user/streamers/moderation",g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.mute.anonymous=g.target.checked),r.requestUpdate("channelConfiguration")},(a=r.channelConfiguration)==null?void 0:a.configuration.mute.anonymous,u("Mute anonymous users"),u("Slow mode"),u("Slow mode default value: <ul> <li>0: slow mode disabled</li> <li>Any positive integer: users can send a message every X seconds (moderators are not limited)</li> </ul>",!0),"documentation/user/streamers/slow_mode",u("Slow mode"),T(Object.assign({"form-control":!0},r.getInputValidationClass("slowMode.duration"))),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.slowMode.duration=Number(g.target.value)),r.requestUpdate("channelConfiguration")},(c=(l=r.channelConfiguration)==null?void 0:l.configuration.slowMode.duration)!=null?c:"",r.renderFeedback("peertube-livechat-slowmode-duration-feedback","slowMode.duration"),u("Moderation delay"),u("Moderation delay default value: <ul> <li>0: moderation delay disabled</li> <li>Any positive integer: messages will be delayed for X seconds for non-moderator participants, allowing moderators to delete message before any user can read it.</li> </ul>",!0),"documentation/user/streamers/moderation_delay",u("Moderation delay"),T(Object.assign({"form-control":!0},r.getInputValidationClass("moderation.delay"))),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.moderation.delay=Number(g.target.value)),r.requestUpdate("channelConfiguration")},(m=(p=r.channelConfiguration)==null?void 0:p.configuration.moderation.delay)!=null?m:"",r.renderFeedback("peertube-livechat-moderation-delay-feedback","moderation.delay"),u("Anonymize moderation actions"),u("Anonymize moderation actions default value for new rooms. When this is enabled, moderation actions will be anonymized, to avoid disclosing who is banning/kicking/\u2026 occupants.",!0),"documentation/user/streamers/moderation",g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.moderation.anonymize=g.target.checked),r.requestUpdate("channelConfiguration")},(b=r.channelConfiguration)==null?void 0:b.configuration.moderation.anonymize,u("Anonymize moderation actions"),u("Moderation bot options"),"","documentation/user/streamers/channel",g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.enabled=g.target.checked),r.requestUpdate("channelConfiguration")},(v=r.channelConfiguration)==null?void 0:v.configuration.bot.enabled,u("Enable moderation bot"),(y=r.channelConfiguration)!=null&&y.configuration.bot.enabled?h(Qi||(Qi=d(['<div class="form-group">\n            <label for="peertube-livechat-bot-nickname">\n              ','\n            </label>\n            <input\n              type="text"\n              name="bot_nickname"\n              class=','\n              id="peertube-livechat-bot-nickname"\n              aria-describedby="peertube-livechat-bot-nickname-feedback"\n              @input=','\n              value="','"\n            />\n            ',"\n          </div>\n\n          <livechat-configuration-section-header\n            .label=","\n            .description=","\n            .helpPage=",'>\n          </livechat-configuration-section-header>\n          <div class="form-group">\n            <label>\n              <input\n                type="checkbox"\n                name="forbid_special_chars"\n                id="peertube-livechat-forbid-special-chars"\n                @input=','\n                value="1"\n                ?checked=',"\n              />\n              ","\n            </label>\n          </div>\n          ","\n\n          <livechat-configuration-section-header\n            .label=","\n            .description=","\n            .helpPage=",'>\n          </livechat-configuration-section-header>\n          <div class="form-group">\n            <label>\n              <input\n                type="checkbox"\n                name="no_duplicate"\n                id="peertube-livechat-no-duplicate"\n                @input=','\n                value="1"\n                ?checked=',"\n              />\n              ","\n            </label>\n          </div>\n          ","\n\n          <livechat-configuration-section-header\n            .label=","\n            .description=","\n            .helpPage=",">\n          </livechat-configuration-section-header>\n          <livechat-dynamic-table-form\n            .header=","\n            .schema=","\n            .validation=","\n            .validationPrefix=","\n            .rows=","\n            @update=","\n            .formName=","\n          ></livechat-dynamic-table-form>\n\n          <livechat-configuration-section-header\n            .label=","\n            .description=","\n            .helpPage=",">\n          </livechat-configuration-section-header>\n          <livechat-dynamic-table-form\n            .header=","\n            .schema=","\n            .validation=","\n            .validationPrefix=","\n            .rows=","\n            @update=","\n            .formName=","\n          ></livechat-dynamic-table-form>\n\n          <livechat-configuration-section-header\n            .label=","\n            .description=","\n            .helpPage=",">\n          </livechat-configuration-section-header>\n          <livechat-dynamic-table-form\n            .header=","\n            .schema=","\n            .validation=","\n            .validationPrefix=","\n            .rows=","\n            @update=","\n            .formName=","\n          ></livechat-dynamic-table-form>\n        "])),u("Bot nickname"),T(Object.assign({"form-control":!0},r.getInputValidationClass("bot.nickname"))),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.nickname=g.target.value),r.requestUpdate("channelConfiguration")},(S=(R=r.channelConfiguration)==null?void 0:R.configuration.bot.nickname)!=null?S:"",r.renderFeedback("peertube-livechat-bot-nickname-feedback","bot.nickname"),u("Forbid special characters"),u("By enabling this option, the moderation bot will automatically delete messages containing more than X special characters. Special characters are those that don't fit into one of these categories: letters, numbers, punctuation symbols, currency symbols, emojis."),"documentation/user/streamers/bot/special_chars",g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.forbidSpecialChars.enabled=g.target.checked),r.requestUpdate("channelConfiguration")},(x=r.channelConfiguration)==null?void 0:x.configuration.bot.forbidSpecialChars.enabled,u("Forbid special characters"),(P=r.channelConfiguration)!=null&&P.configuration.bot.forbidSpecialChars.enabled?h(Xi||(Xi=d(['\n              <div class="form-group">\n                <label>\n                  ','\n                  <input\n                    type="number"\n                    name="special_chars_tolerance"\n                    class=','\n                    min="0"\n                    max="','"\n                    id="peertube-livechat-forbid-special-chars-tolerance"\n                    aria-describedby="peertube-livechat-forbid-special-chars-tolerance-feedback"\n                    @input=','\n                    value="','"\n                  />\n                </label>\n                <small class="form-text text-muted">\n                  ',"\n                </small>\n                ",'\n              </div>\n              <div class="form-group">\n                <label>\n                  ','\n                  <input\n                    type="text"\n                    name="special_chars_reason"\n                    class=','\n                    id="peertube-livechat-forbid-special-chars-reason"\n                    aria-describedby="peertube-livechat-forbid-special-chars-reason-feedback"\n                    @input=','\n                    value="','"\n                  />\n                </label>\n                <small class="form-text text-muted">\n                  ',"\n                </small>\n                ",'\n              </div>\n              <div class="form-group">\n                <label>\n                  <input\n                    type="checkbox"\n                    name="forbid_special_chars_applyToModerators"\n                    id="peertube-livechat-forbid-special-chars-applyToModerators"\n                    @input=','\n                    value="1"\n                    ?checked=',"\n                  />\n                  ",'\n                </label>\n                <small class="form-text text-muted">\n                  ',"\n                </small>\n              </div>\n              "])),u("Tolerance"),T(Object.assign({"form-control":!0},r.getInputValidationClass("bot.forbidSpecialChars.tolerance"))),10,g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.forbidSpecialChars.tolerance=Number(g.target.value)),r.requestUpdate("channelConfiguration")},(I=(U=r.channelConfiguration)==null?void 0:U.configuration.bot.forbidSpecialChars.tolerance)!=null?I:"0",u("Number of special characters to accept in a message without deleting it."),r.renderFeedback("peertube-livechat-forbid-special-chars-tolerance-feedback","bot.forbidSpecialChars.tolerance"),u("Reason"),T(Object.assign({"form-control":!0},r.getInputValidationClass("bot.forbidSpecialChars.reason"))),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.forbidSpecialChars.reason=g.target.value),r.requestUpdate("channelConfiguration")},(A=(_=r.channelConfiguration)==null?void 0:_.configuration.bot.forbidSpecialChars.reason)!=null?A:"",u("Reason to display besides deleted messages"),r.renderFeedback("peertube-livechat-forbid-special-chars-reason-feedback","bot.forbidSpecialChars.reason"),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.forbidSpecialChars.applyToModerators=g.target.checked),r.requestUpdate("channelConfiguration")},(N=r.channelConfiguration)==null?void 0:N.configuration.bot.forbidSpecialChars.applyToModerators,u("Also moderate messages from moderators"),u("By default, moderator messages will not be affected by this feature. By checking this option, messages from moderators will also be deleted.")):"",u("No duplicate message"),u("By enabling this options, the moderation bot will automatically moderate duplicate messages. That means if a user send the same message twice within X seconds, the second message will be deleted."),"documentation/user/streamers/bot/no_duplicate",g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.noDuplicate.enabled=g.target.checked),r.requestUpdate("channelConfiguration")},(D=r.channelConfiguration)==null?void 0:D.configuration.bot.noDuplicate.enabled,u("No duplicate message"),(re=r.channelConfiguration)!=null&&re.configuration.bot.noDuplicate.enabled?h(Zi||(Zi=d(['\n              <div class="form-group">\n                <label>\n                  ','\n                  <input\n                    type="number"\n                    name="no_duplicate_delay"\n                    class=','\n                    min="0"\n                    max="','"\n                    id="peertube-livechat-no-duplicate-delay"\n                    aria-describedby="peertube-livechat-no-duplicate-delay-feedback"\n                    @input=','\n                    value="','"\n                  />\n                </label>\n                <small class="form-text text-muted">\n                  ',"\n                </small>\n                ",'\n              </div>\n              <div class="form-group">\n                <label>\n                  ','\n                  <input\n                    type="text"\n                    name="no_duplicate_reason"\n                    class=','\n                    id="peertube-livechat-no-duplicate-reason"\n                    aria-describedby="peertube-livechat-no-duplicate-reason-feedback"\n                    @input=','\n                    value="','"\n                  />\n                </label>\n                <small class="form-text text-muted">\n                  ',"\n                </small>\n                ",'\n              </div>\n              <div class="form-group">\n                <label>\n                  <input\n                    type="checkbox"\n                    name="no_duplicate_applyToModerators"\n                    id="peertube-livechat-no-duplicate-applyToModerators"\n                    @input=','\n                    value="1"\n                    ?checked=',"\n                  />\n                  ",'\n                </label>\n                <small class="form-text text-muted">\n                  ',"\n                </small>\n              </div>\n              "])),u("Time interval"),T(Object.assign({"form-control":!0},r.getInputValidationClass("bot.noDuplicate.delay"))),86400 .toString(),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.noDuplicate.delay=Number(g.target.value)),r.requestUpdate("channelConfiguration")},(he=(J=r.channelConfiguration)==null?void 0:J.configuration.bot.noDuplicate.delay)!=null?he:"0",u("The interval, in seconds, during which a user can't send again the same message."),r.renderFeedback("peertube-livechat-no-duplicate-delay-feedback","bot.noDuplicate.delay"),u("Reason"),T(Object.assign({"form-control":!0},r.getInputValidationClass("bot.noDuplicate.reason"))),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.noDuplicate.reason=g.target.value),r.requestUpdate("channelConfiguration")},(xe=(ke=r.channelConfiguration)==null?void 0:ke.configuration.bot.noDuplicate.reason)!=null?xe:"",u("Reason to display besides deleted messages"),r.renderFeedback("peertube-livechat-no-duplicate-reason-feedback","bot.noDuplicate.reason"),g=>{g!=null&&g.target&&r.channelConfiguration&&(r.channelConfiguration.configuration.bot.noDuplicate.applyToModerators=g.target.checked),r.requestUpdate("channelConfiguration")},(ei=r.channelConfiguration)==null?void 0:ei.configuration.bot.noDuplicate.applyToModerators,u("Also moderate messages from moderators"),u("By default, moderator messages will not be affected by this feature. By checking this option, messages from moderators will also be deleted.")):"",u("Forbidden words or expressions"),u("You can configure some words that will be automatically moderated by the bot (messages containing such words will be instantly deleted). You can also add an optional reason that will be displayed at the place of deleted messages. Several examples are provided on the documentation page."),"documentation/user/streamers/bot/forbidden_words",t.forbiddenWords,e.forbiddenWords,(ti=r.validationError)==null?void 0:ti.properties,"bot.forbiddenWords",(ii=r.channelConfiguration)==null?void 0:ii.configuration.bot.forbiddenWords,g=>{r.resetValidation(g),r.channelConfiguration&&(r.channelConfiguration.configuration.bot.forbiddenWords=g.detail,r.requestUpdate("channelConfiguration"))},"forbidden-words",u("Timer"),u("You can configure several timers that will send messages at regular interval. These messages will be sent by the bot every X minutes. You can for example make the bot sent some sponsoring information every 5 minutes."),"documentation/user/streamers/bot/quotes",t.quotes,e.quotes,(ri=r.validationError)==null?void 0:ri.properties,"bot.quotes",(ni=r.channelConfiguration)==null?void 0:ni.configuration.bot.quotes,g=>{r.resetValidation(g),r.channelConfiguration&&(r.channelConfiguration.configuration.bot.quotes=g.detail,r.requestUpdate("channelConfiguration"))},"quote",u("Bot command"),u('You can configure the bot to respond to commands. A command is a message starting with a "!", like for example "!help" that calls the "help" command.'),"documentation/user/streamers/bot/commands",t.commands,e.commands,(oi=r.validationError)==null?void 0:oi.properties,"bot.commands",(si=r.channelConfiguration)==null?void 0:si.configuration.bot.commands,g=>{r.resetValidation(g),r.channelConfiguration&&(r.channelConfiguration.configuration.bot.commands=g.detail,r.requestUpdate("channelConfiguration"))},"command"):"",r.reset,r.actionDisabled,u("Cancel"),r.actionDisabled,u("Save"))}var ir,rr,nr,or,sr,ar,lr,cr,te=class extends O{constructor(){super();this.actionDisabled=!1;this.saveConfig=async e=>{e==null||e.preventDefault(),this._channelDetailsService&&this.channelConfiguration&&(this.actionDisabled=!0,this._channelDetailsService.saveOptions(this.channelConfiguration.channel.id,this.channelConfiguration.configuration).then(()=>{this.validationError=void 0,this.ptTranslate("Successfully saved").then(i=>{this.ptNotifier.info(i)},()=>{}),this.requestUpdate("_validationError")}).catch(async i=>{this.validationError=void 0,i instanceof B&&(this.validationError=i),this.logger.warn("A validation error occurred in saving configuration. ".concat(i.name,": ").concat(i.message)),this.ptNotifier.error(i.message?i.message:await this.ptTranslate("Error")),this.requestUpdate("_validationError")}).finally(()=>{this.actionDisabled=!1}))};this.getInputValidationClass=e=>{var n;let i=(n=this.validationError)==null?void 0:n.properties[e];return i?i.length?{"is-invalid":!0}:{"is-valid":!0}:{}};this.renderFeedback=(e,i)=>{var s,a;let n=[],o=(a=(s=this.validationError)==null?void 0:s.properties[i])!=null?a:void 0;return o&&o.length!==0?(o.includes(0)&&n.push(h(ir||(ir=d(["",""])),u("This value is required."))),o.includes(1)&&n.push(h(rr||(rr=d(["",""])),u("Value is of the wrong type."))),o.includes(2)&&n.push(h(nr||(nr=d(["",""])),u("Value is in the wrong format."))),o.includes(3)&&n.push(h(or||(or=d(["",""])),u("Value is not in authorized range."))),o.includes(5)&&n.push(h(sr||(sr=d(["",""])),u("Value too long"))),h(ar||(ar=d(["<div id=",' class="invalid-feedback">',"</div>"])),e,n)):E};this.render=()=>this._asyncTaskRender.render({pending:()=>h(lr||(lr=d(["<livechat-spinner></livechat-spinner>"]))),error:()=>h(cr||(cr=d(["<livechat-error></livechat-error>"]))),complete:()=>tr(this)});this._asyncTaskRender=this._initTask()}_initTask(){return new F(this,{task:async()=>{var e;this._channelDetailsService=new le(this.ptOptions),this.channelConfiguration=await this._channelDetailsService.fetchConfiguration((e=this.channelId)!=null?e:0),this.actionDisabled=!1},args:()=>[]})}termsMaxLength(){return 400}async reset(e){e==null||e.preventDefault(),this.actionDisabled=!0,this._asyncTaskRender=this._initTask(),this.requestUpdate()}resetValidation(e){this.validationError&&(this.validationError=void 0,this.requestUpdate("_validationError"))}};f([C({attribute:!1})],te.prototype,"channelId",2),f([ce({context:Gi}),k()],te.prototype,"channelConfiguration",2),f([ce({context:we})],te.prototype,"_channelDetailsService",2),f([k()],te.prototype,"validationError",2),f([k()],te.prototype,"actionDisabled",2),te=f([$("livechat-channel-configuration")],te);var ur,dr,hr;function pr(r){var i,n,o,s,a,l,c,p,m,b,v,y;let t={sn:{colName:u("Short name"),description:u('You can use emojis in the chat using ":shortname:". The short name can start and/or end by a colon (:), and only contain alphanumerical characters, underscores and hyphens. It is strongly recommended to start them by a colon, so that users can use autocompletion (by typing ":" then press TAB).'),headerClassList:["peertube-livechat-emojis-col-sn"]},url:{colName:u("File"),description:u("The emoji file."),headerClassList:["peertube-livechat-emojis-col-file"]}},e={sn:{inputType:"text",default:""},url:{inputType:"image-file",default:"",colClassList:["peertube-livechat-emojis-col-file"]}};return h(hr||(hr=d(['\n    <div\n      class="margin-content peertube-plugin-livechat-configuration peertube-plugin-livechat-configuration-channel"\n    >\n      <h1>\n        <span class="peertube-plugin-livechat-configuration-channel-info">\n          <span>',"</span>\n          <span>","</span>\n        </span>\n      </h1>\n\n      <livechat-channel-tabs .active="," .channelId=","></livechat-channel-tabs>\n\n      <h2>","</h2>\n\n      <p>\n        ","\n        <livechat-help-button .page=",'>\n        </livechat-help-button>\n      </p>\n\n      <form role="form" @submit='," @change=",'>\n        <div class="peertube-plugin-livechat-configuration-actions">\n          ',"\n          ","\n        </div>\n\n        <livechat-dynamic-table-form\n          .header=","\n          .schema=","\n          .maxLines=","\n          .validation=","\n          .validationPrefix=","\n          .rows=","\n          @update=",'\n        ></livechat-dynamic-table-form>\n\n        <div class="form-group mt-5">\n          <button type="reset" @click='," ?disabled=",">\n            ",'\n          </button>\n          <button type="submit" ?disabled=',">\n            ","\n          </button>\n        </div>\n      </form>\n\n      <h2>","</h2>\n\n      <p>\n        ","\n      </p>\n      <p>\n        ","\n      </p>\n      <p>\n        ",'\n      </p>\n\n      <div class="peertube-plugin-livechat-configuration-actions">\n        <button type="button" @click=',">\n          ","\n        </button>\n      </div>\n    </div>"])),(i=r.channelEmojisConfiguration)==null?void 0:i.channel.displayName,(n=r.channelEmojisConfiguration)==null?void 0:n.channel.name,"emojis",r.channelId,u("Channel emojis"),u('You can configure custom emojis for your channel. These emojis will be available in the emoji picker. Users can also use them by with their short name (for example by writing ":shortname:").'),"documentation/user/streamers/emojis",r.saveEmojis,r.resetValidation,(a=(s=(o=r.channelEmojisConfiguration)==null?void 0:o.emojis)==null?void 0:s.customEmojis)!=null&&a.length?h(ur||(ur=d(['\n              <button\n                type="button"\n                @click=',"\n                ?disabled=","\n              >\n                ","\n              </button>"])),r.exportEmojis,r.actionDisabled,u("Export")):"",((m=(p=(c=(l=r.channelEmojisConfiguration)==null?void 0:l.emojis)==null?void 0:c.customEmojis)==null?void 0:p.length)!=null?m:0)<200?h(dr||(dr=d(['\n              <button\n                type="button"\n                @click=',"\n                ?disabled=","\n              >\n                ","\n              </button>"])),r.importEmojis,r.actionDisabled,u("Import")):"",t,e,200,(b=r.validationError)==null?void 0:b.properties,"emojis",(y=(v=r.channelEmojisConfiguration)==null?void 0:v.emojis.customEmojis)!=null?y:[],R=>{r.resetValidation(R),r.channelEmojisConfiguration&&(r.channelEmojisConfiguration.emojis.customEmojis=R.detail,r.requestUpdate("channelEmojisConfiguration"))},r.reset,r.actionDisabled,u("Cancel"),r.actionDisabled,u("Save"),u("Emojis only mode"),u('You can enable an "Emojy only mode" in your chatrooms. When this mode is enabled, participants can only send emojis (standard, or channel custom emojis). Moderators are not affected by this limitation.',!0),u("This mode can be usefull for example: <ul> <li>To avoid spam or offensive message when you are not here to moderate.</li> <li>When there are too many speaking participants, and you can't no more moderate correctly.</li> </ul>",!0),u("To enable or disable this mode, you can use the room configuration form. If you want to enable it for all your chatrooms at once, you can use the button bellow.",!0),r.enableEmojisOnlyModeOnAllRooms,u("Enable the emoji only mode on all channel's chatrooms"))}var mr,fr,ue=class extends O{constructor(){super();this.actionDisabled=!1;this.render=()=>this._asyncTaskRender.render({pending:()=>h(mr||(mr=d(["<livechat-spinner></livechat-spinner>"]))),error:()=>h(fr||(fr=d(["<livechat-error></livechat-error>"]))),complete:()=>pr(this)});this._asyncTaskRender=this._initTask()}_initTask(){return new F(this,{task:async()=>{if(!this.channelId)throw new Error("Missing channelId");this._channelDetailsService=new le(this.ptOptions),this.channelEmojisConfiguration=await this._channelDetailsService.fetchEmojisConfiguration(this.channelId),this.channelEmojisConfiguration.emojis.customEmojis.length||this.channelEmojisConfiguration.emojis.customEmojis.push({sn:"",url:""}),this.actionDisabled=!1},args:()=>[]})}async reset(e){e==null||e.preventDefault(),this.actionDisabled=!0,this._asyncTaskRender=this._initTask(),this.requestUpdate()}resetValidation(e){this.validationError&&(this.validationError=void 0,this.requestUpdate("_validationError"))}async saveEmojis(e){if(e==null||e.preventDefault(),!this._channelDetailsService||!this.channelEmojisConfiguration||!this.channelId){this.ptNotifier.error(await this.ptTranslate("Error"));return}try{this.actionDisabled=!0,this.channelEmojisConfiguration=await this._channelDetailsService.saveEmojisConfiguration(this.channelId,this.channelEmojisConfiguration.emojis),this.validationError=void 0,this.ptNotifier.info(await this.ptTranslate("Successfully saved")),this.requestUpdate("channelEmojisConfiguration"),this.requestUpdate("_validationError")}catch(i){this.validationError=void 0;let n;i instanceof B&&(this.validationError=i,i.message&&(n=i.message)),n!=null||(n=await this.ptTranslate("Error")),this.ptNotifier.error(n),this.requestUpdate("_validationError")}finally{this.actionDisabled=!1}}async importEmojis(e){var i,n,o;e.preventDefault();try{let s=await new Promise((p,m)=>{let b=document.createElement("input");b.setAttribute("type","file"),b.setAttribute("accept","application/json"),b.onchange=v=>{var R;v.preventDefault(),v.stopImmediatePropagation();let y=(R=v.target.files)==null?void 0:R[0];if(!y){m(new Error("Missing file"));return}p(y)},b.click(),b.remove()});this.actionDisabled=!0;let a=await new Promise((p,m)=>{let b=new FileReader;b.onerror=m,b.onload=()=>{if(b.result===null){m(new Error("Empty result"));return}b.result instanceof ArrayBuffer?m(new Error("Result is an ArrayBuffer, this was not intended")):p(b.result)},b.readAsText(s)}),l=JSON.parse(a);if(!Array.isArray(l))throw new Error("Invalid data, an array was expected");let c=(i=this.channelEmojisConfiguration)==null?void 0:i.emojis.customEmojis.slice(-1)[0];c&&c.sn===""&&c.url===""&&((n=this.channelEmojisConfiguration)==null||n.emojis.customEmojis.pop());for(let p of l){if(typeof p!="object")throw new Error("Invalid data");if(!p.sn||!p.url||typeof p.sn!="string"||typeof p.url!="string")throw new Error("Invalid data");let m=await this._convertImageToDataUrl(p.url),v={sn:p.sn,url:m};p.isCategoryEmoji===!0&&(v.isCategoryEmoji=!0),(o=this.channelEmojisConfiguration)==null||o.emojis.customEmojis.push(v)}this.requestUpdate("channelEmojisConfiguration"),this.ptNotifier.info(await this.ptTranslate("If imported data are okay, don't forgot to save the form."))}catch(s){this.ptNotifier.error(s.toString(),await this.ptTranslate("Error"))}finally{this.actionDisabled=!1}}async exportEmojis(e){var i,n,o;e.preventDefault(),this.actionDisabled=!0;try{let s=[];for(let c of(o=(n=(i=this.channelEmojisConfiguration)==null?void 0:i.emojis)==null?void 0:n.customEmojis)!=null?o:[]){if(!c.sn||!c.url)continue;let p=await this._convertImageToDataUrl(c.url),m={sn:c.sn,url:p};c.isCategoryEmoji===!0&&(m.isCategoryEmoji=c.isCategoryEmoji),s.push(m)}let a="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(s)),l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("download","emojis.json"),l.click(),l.remove()}catch(s){this.logger.error(s),this.ptNotifier.error(s.toString())}finally{this.actionDisabled=!1}}async enableEmojisOnlyModeOnAllRooms(e){if(e.preventDefault(),!this._channelDetailsService||!this.channelId){this.ptNotifier.error(await this.ptTranslate("Error"));return}try{await this._channelDetailsService.enableEmojisOnlyModeOnAllRooms(this.channelId),this.ptNotifier.info(await this.ptTranslate("Successfully saved"))}catch(i){console.error(i),this.ptNotifier.error(await this.ptTranslate("Error"))}}async _convertImageToDataUrl(e){if(e.startsWith("data:"))return e;let i=await(await fetch(e)).blob();return await new Promise((o,s)=>{let a=new FileReader;a.onload=()=>{if(a.result===null){s(new Error("Empty result"));return}a.result instanceof ArrayBuffer?s(new Error("Result is an ArrayBuffer, this was not intended")):o(a.result)},a.onerror=s,a.readAsDataURL(i)})}};f([C({attribute:!1})],ue.prototype,"channelId",2),f([ce({context:we})],ue.prototype,"_channelDetailsService",2),f([k()],ue.prototype,"validationError",2),f([k()],ue.prototype,"actionDisabled",2),ue=f([$("livechat-channel-emojis")],ue);var gr,Se=class extends O{constructor(){super(...arguments);this.render=()=>{var e,i;return h(gr||(gr=d(["\n      <a\n        class=","\n        href=","\n      >\n        ","\n      </a>\n      <a\n        class=","\n        href=","\n      >\n        ","\n      </a>\n    "])),T({"sub-menu-entry":!0,active:this.active==="configuration"}),"/p/livechat/configuration/channel?channelId="+encodeURIComponent((e=this.channelId)!=null?e:""),u("Channel options"),T({"sub-menu-entry":!0,active:this.active==="emojis"}),"/p/livechat/configuration/emojis?channelId="+encodeURIComponent((i=this.channelId)!=null?i:""),u("Channel emojis"))}}};f([C({attribute:!1})],Se.prototype,"channelId",2),f([C({attribute:!1})],Se.prototype,"active",2),Se=f([$("livechat-channel-tabs")],Se);var br,vr,Cr;async function _r(r){let{peertubeHelpers:t,registerClientRoute:e,registerHook:i}=r;(await t.getSettings())["disable-channel-configuration"]||(e({route:"livechat/configuration",onMount:async({rootEl:o})=>{X(h(br||(br=d(["<livechat-channel-home .registerClientOptions=","></livechat-channel-home>"])),r),o)}}),e({route:"livechat/configuration/channel",onMount:async({rootEl:o})=>{var l;let s=new URLSearchParams(window.location.search),a=parseInt((l=s.get("channelId"))!=null?l:"");if(isNaN(a))throw new Error("Invalid channelId parameter");X(h(vr||(vr=d(["\n        <livechat-channel-configuration\n          .registerClientOptions=","\n          .channelId=","></livechat-channel-configuration\n        ></livechat-channel-configuration>\n      "])),r,a),o)}}),e({route:"livechat/configuration/emojis",onMount:async({rootEl:o})=>{var l;let s=new URLSearchParams(window.location.search),a=parseInt((l=s.get("channelId"))!=null?l:"");if(isNaN(a))throw new Error("Invalid channelId parameter");X(h(Cr||(Cr=d(["\n        <livechat-channel-emojis\n          .registerClientOptions=","\n          .channelId=","\n        ></livechat-channel-emojis>\n      "])),r,a),o)}}),i({target:"filter:left-menu.links.create.result",handler:async o=>{if(!t.isLoggedIn()||!Array.isArray(o))return o;let s;for(let l of o)if(typeof l=="object"&&"key"in l&&(l.key==="in-my-library"||l.key==="my-video-space")){s=l;break}if(!s||!Array.isArray(s.links))return o;let a=await t.translate("Chatrooms");return s.links.unshift({label:a,shortLabel:a,path:"/p/livechat/configuration",icon:"live"}),o}}))}function yr(r){if(!r)return[];let t=r.split("\n");return t=t.map(e=>e.replace(/#.*$/,"").replace(/^\s+/,"").replace(/\s+$/,"")),t.filter(e=>e!=="")}function Er(r,t){var i;if("isLocal"in t){if(!t.isLocal)return!1}else if(t.remote)return!1;return!!(r["chat-per-live-video"]&&t.isLive&&((i=t.pluginData)!=null&&i["livechat-active"])||r["chat-all-lives"]&&t.isLive||r["chat-all-non-lives"]&&!t.isLive||yr(r["chat-videos-list"]).includes(t.uuid))}function Or(r,t){if(r["federation-no-remote-chat"])return!1;if("isLocal"in t){if(t.isLocal)return!1}else if(!t.remote)return!1;return!(!t.pluginData||!t.pluginData["livechat-remote"])}function Bt(r){let t=document.createElement("a");if(t.classList.add("primary-button","orange-button","peertube-button-link","peertube-plugin-livechat-button","peertube-plugin-livechat-button-"+r.name),r.additionalClasses)for(let e=0;e<r.additionalClasses.length;e++)t.classList.add(r.additionalClasses[e]);if("callback"in r&&(t.onclick=r.callback),"href"in r&&(t.href=r.href),(!t.href||t.href==="#")&&(t.role="button",t.tabIndex=0,t.onclick&&(t.onkeydown=e=>{e.key==="Enter"&&(e.preventDefault(),t.click())})),"targetBlank"in r&&r.targetBlank&&(t.target="_blank"),r.icon){try{let e=r.icon(),i=document.createElement("span");i.innerHTML=e.trim();let n=i.firstChild;n&&("ariaHidden"in n&&(n.ariaHidden="true"),t.prepend(n))}catch(e){L.error("Failed to generate the "+r.name+" button: "+e)}t.setAttribute("title",r.label)}else t.textContent=r.label;r.buttonContainer.append(t)}var Ar=()=>'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 4.233 4.233">\n  <rect\n    style="\n      fill:currentColor;\n      stroke:currentColor;stroke-width:.529167;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\n    "\n    width="4.223" height=".427" x=".882" y="-.213" transform="rotate(45)" ry=".213"\n  />\n  <rect\n    style="\n      fill:currentColor;\n      stroke:currentColor;stroke-width:.529167;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\n    "\n    width="4.223" height=".427" x="-2.112" y="2.78" transform="scale(-1 1) rotate(45)" ry=".213"\n  />\n</svg>',$r=()=>'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 8.467 8.467">\n  <path style="fill:transparent;stroke-width:.187325" d="M.838.848h2.643v1.861H.838zM4.896 4.38h2.451v.875H4.896z"/>\n  <path\n    d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2ZM9 11H7V9h2zm4 0h-2V9h2zm4 0h-2V9h2z"\n    style="fill:currentColor;" transform="matrix(-.18741 0 0 .18741 8.493 3.004)"\n  />\n  <path\n    d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2ZM6 9h12v2H6Zm8 5H6v-2h8zm4-6H6V6h12z"\n    style="fill:currentColor;" transform="scale(.18741)"\n  />\n</svg>',Tr=()=>'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 4.233 4.233">\n  <g\n    transform="matrix(.45208 0 0 .45208 -.526 1.335)"\n    style="stroke-width:1.00021;stroke-miterlimit:4;stroke-dasharray:none"\n  >\n    <path\n      style="\n        opacity:.998;fill:none;fill-opacity:1;\n        stroke:currentColor;stroke-width:1.17052322;stroke-miterlimit:4;\n        stroke-dasharray:none;stroke-opacity:1\n      "\n      d="\n        m8.674.744.012 1.266v2.199a.94.94 0 0 1-.943.942H3.345a.94.94\n        0 0 1-.942-.942V-.19a.94.94 0 0 1 .942-.943h2.2l1.255.016\n      "\n    />\n    <rect\n      style="\n        opacity:.998;fill:currentColor;fill-opacity:1;\n        stroke:currentColor;stroke-width:1.17223459;stroke-miterlimit:4;\n        stroke-dasharray:none;stroke-opacity:1\n      "\n      width="5.632" height=".569"\n      x="-6.185" y="4.854" transform="scale(-1.03747 .96108) rotate(45)" ry=".285"\n    />\n    <path\n      style="\n        opacity:.998;fill:currentColor;fill-opacity:1;\n        stroke:currentColor;stroke-width:1.30528;stroke-miterlimit:4;\n        stroke-dasharray:none;stroke-opacity:1\n      "\n      d="m5.15.374 1.091-1.89L7.333.373Z"\n      transform="scale(.89676) rotate(45 9.536 3.618)"\n    />\n  </g>\n</svg>',Lr=()=>'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 4.233 4.233">\n  <g style="stroke-width:1.17052;stroke-miterlimit:4;stroke-dasharray:none">\n    <path style="opacity:.998;fill:none;fill-opacity:1;stroke:currentColor;stroke-width:1.17052;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m6.556-.435 1.132-1.132c.269-.268.618-.351.784-.186L9.867-.357c.166.165.083.515-.186.784L7.418 2.69c-.269.269-.618.352-.784.186l-.698-.697-.39-.407" transform="matrix(.45208 0 0 .45208 -.73 1.423)"/>\n    <path style="opacity:.998;fill:none;fill-opacity:1;stroke:currentColor;stroke-width:1.17052;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M6.038 3.505 4.906 4.637c-.268.268-.618.351-.784.186L2.727 3.427c-.166-.165-.083-.515.186-.784L5.176.38c.27-.269.619-.352.784-.186l.698.697.39.407" transform="matrix(.45208 0 0 .45208 -.73 1.423)"/>\n  </g>\n</svg>\n',nt=()=>'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 4.233 4.233">\n  <path style="display:inline;opacity:.998;fill:none;fill-opacity:1;stroke:currentColor;stroke-width:.529167;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M1.48 1.583V.86c0-.171.085-.31.19-.31h.893c.106 0 .19.139.19.31v.838c0 .171-.107.219-.19.284l-.404.314c-.136.106-.219.234-.221.489l-.003.247"/>\n  <path style="display:inline;fill:currentColor;stroke-width:.235169" d="M1.67 3.429h.529v.597H1.67z"/>\n</svg>\n',wr=()=>'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 4.233 4.233">\n  <g style="stroke-width:1.00021;stroke-miterlimit:4;stroke-dasharray:none">\n    <path style="opacity:.998;fill:none;fill-opacity:1;stroke:currentColor;stroke-width:1.17052;stroke-linecap:butt;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M2.943 1.626V-.34a.94.94 0 0 1 .942-.943l1.962-.023 1.961.01a.94.94 0 0 1 .942.942v1.968S7.126 4.746 5.847 4.767c-1.28.02-2.904-3.14-2.904-3.14Z" transform="matrix(.45208 0 0 .45208 -.526 1.335)"/>\n  </g>\n</svg>\n';var Rr;async function Sr(r,t,e){let i=r.peertubeHelpers,n=await i.translate("Share chat link");L.info("Opening the share modal...");let o=new MutationObserver(s=>{for(let{addedNodes:a}of s)a.forEach(l=>{var c;if(l.localName==="ngb-modal-window"){L.info("Detecting a new modal, checking if this is the good one...");let p=(c=l.querySelector)==null?void 0:c.call(l,".modal-title");if((p==null?void 0:p.textContent)!==n)return;L.info("Yes, it is the good modal!"),o.disconnect();let m=l.querySelector(".modal-body");if(!m){L.error("Modal has no body... Dont know how to fill it.");return}m.childNodes.forEach(b=>m.removeChild(b)),X(h(Rr||(Rr=d(["\n            <livechat-share-chat\n              ._settings=","\n              ._video=","\n            ></livechat-share-chat>\n          "])),t,e),m)}})});o.observe(document.body,{childList:!0}),i.showModal({title:n,content:"",close:!0}),setTimeout(()=>{o.disconnect()},1e3)}function ot(r){return!r.peertubeHelpers.isLoggedIn()}function jt(r,t){var e,i;try{if(!t||!t.isLocal||!window.localStorage)return!1;let n=(e=window.localStorage.getItem("username"))!=null?e:"";return!(!n||n!==((i=t.account)==null?void 0:i.name))}catch(n){return L.error(n),!1}}function Gt(r){var t;try{if(!window.localStorage)return!1;let e=(t=window.localStorage.getItem("role"))!=null?t:"";return!(!e||e!=="0"&&e!=="1")}catch(e){return L.error(e),!1}}function qt(r){let t="https://livingston.frama.io/peertube-plugin-livechat/";return r.lang&&/^[a-zA-Z_-]+$/.test(r.lang)&&(t=t+r.lang+"/"),r.page&&/^[\w/-]+$/.test(r.page)&&(t=t+r.page+"/"),t}async function Jo({peertubeHelpers:r}){let t=await r.translate("_language");return t==="_language"?"en":t}async function st(r,t){let e=(await Jo(r)).toLowerCase();return e==="en"?qt(t):qt(Object.assign({},t,{lang:e}))}var Xo=xr().default;function at(r){return r==="peertube"}function Ir(r){let t=[];for(let e in r){let i=r[e];Xo(i)||t.push(i)}return t.length?t:!0}function lt(){var o;if(!window.getComputedStyle)return L.warn("[AutoColors] getComputedStyle is not available, aborting."),null;let r=window.getComputedStyle(document.body),t=(o=document.querySelector(".publish-button"))!=null?o:document.querySelector(".peertube-button-link");if(!t)return L.warn("[AutoColors] Cant find a button, aborting."),null;let e=window.getComputedStyle(t),i={mainForeground:r.getPropertyValue("--fg").trim()||r.getPropertyValue("--mainForegroundColor").trim(),mainBackground:r.getPropertyValue("--bg").trim()||r.getPropertyValue("--mainBackgroundColor").trim(),greyForeground:r.getPropertyValue("--fg-300").trim()||r.getPropertyValue("--greyForegroundColor").trim(),greyBackground:r.getPropertyValue("--bg-secondary-300").trim()||r.getPropertyValue("--greyBackgroundColor").trim(),menuForeground:r.getPropertyValue("--fg").trim()||r.getPropertyValue("--menuForegroundColor").trim(),menuBackground:r.getPropertyValue("--bg-secondary-400").trim()||r.getPropertyValue("--menuBackgroundColor").trim(),inputForeground:r.getPropertyValue("--input-fg").trim()||r.getPropertyValue("--inputForegroundColor").trim(),inputBackground:r.getPropertyValue("--input-bg").trim()||r.getPropertyValue("--inputBackgroundColor").trim(),buttonForeground:r.getPropertyValue("--on-primary").trim()||e.color.trim(),buttonBackground:r.getPropertyValue("--primary").trim()||r.getPropertyValue("--mainColor").trim(),link:r.getPropertyValue("--fg").trim()||r.getPropertyValue("--mainForegroundColor").trim(),linkHover:r.getPropertyValue("--fg-400").trim()||r.getPropertyValue("--mainForegroundColor").trim()},n=Ir(i);return n!==!0?(L.warn("[AutoColors] Computed colors are not valid, dropping. Invalid values: "+n.join(", ")),null):i}var Nr=!1;async function Zo(r){return new Promise((t,e)=>{let i=document.createElement("link");i.onerror=()=>e(new URIError("CSS ".concat(r," didn't load correctly."))),i.onload=()=>t(),i.setAttribute("type","text/css"),i.setAttribute("rel","stylesheet"),i.setAttribute("href",r),document.head.appendChild(i)})}async function Dr(r){return new Promise((t,e)=>{let i=document.createElement("script");i.onerror=()=>e(new URIError("Script ".concat(r," didn't load correctly."))),i.onload=()=>t(),i.async=!0,i.src=r,document.head.appendChild(i)})}function Qo(){let r=lt();if(!r)return;let t=document.querySelector("body");t&&(t.style.setProperty("--peertube-main-foreground",r.mainForeground),t.style.setProperty("--peertube-main-background",r.mainBackground),t.style.setProperty("--peertube-grey-foreground",r.greyForeground),t.style.setProperty("--peertube-grey-background",r.greyBackground),t.style.setProperty("--peertube-menu-foreground",r.menuForeground),t.style.setProperty("--peertube-menu-background",r.menuBackground),t.style.setProperty("--peertube-input-foreground",r.inputForeground),t.style.setProperty("--peertube-input-background",r.inputBackground),t.style.setProperty("--peertube-button-foreground",r.buttonForeground),t.style.setProperty("--peertube-button-background",r.buttonBackground),t.style.setProperty("--peertube-link",r.link),t.style.setProperty("--peertube-link-hover",r.linkHover))}async function es(r){Qo(),window.converse||await Promise.all([Zo(r.staticBaseUrl+"conversejs/converse.min.css"),Dr(r.staticBaseUrl+"conversejs/converse.min.js")]),window.initConverse||(await Dr(r.staticBaseUrl+"static/builtin.js"),window.initConversePlugins(!0))}async function ct(r,t,e,i,n){let o=r.peertubeHelpers,s=document.createElement("div");s.classList.add("livechat-spinner"),s.setAttribute("id","livechat-loading-spinner"),s.innerHTML="<div></div>",t.append(s);let a=document.createElement("converse-root");a.classList.add("theme-peertube"),t.append(a),a.addEventListener("click",b=>{if(!b.target)return;let v="tagName"in b.target&&b.target.tagName==="A"?b.target:b.target.closest("a");v&&v.getAttribute("href")==="#"&&(L.log("Intercepting a click on href=# in converse root, canceling the event."),b.preventDefault())});let l=o.getAuthHeader(),c=H(r)+"/api/configuration/room/"+encodeURIComponent(e)+(n?"?forcetype=1":""),p=await fetch(c,{method:"GET",headers:l});if(!p.ok)throw new Error("Can't get room configuration.");let m=await p.json();if(!Nr){let b=await r.peertubeHelpers.translate("Your vote has been taking into account, the counters will be updated in a moment.");Nr=!0,document.addEventListener("livechat-poll-vote",()=>{r.peertubeHelpers.notifier.success(b)})}await es(m),await window.initConverse(m,i,l!=null?l:null)}async function Ur(r){var o;let t=V(),e=t.logger;if(!r){e.error("No video provided");return}let i=document.getElementById("plugin-placeholder-player-next");if(!i){e.error("The required placeholder div is not present in the DOM.");return}let n=i.querySelector("#peertube-plugin-livechat-container");if(n){e.log("The chat seems already initialized...");return}n=document.createElement("div"),n.setAttribute("id","peertube-plugin-livechat-container"),n.setAttribute("peertube-plugin-livechat-state","initializing"),n.setAttribute("peertube-plugin-livechat-current-url",window.location.href),n.role="region",n.ariaLabel=await t.ptOptions.peertubeHelpers.translate("Chat"),i.append(n);try{let s=await t.getSettings();if(e.log("Checking if this video should have a chat..."),s["chat-no-anonymous"]===!0&&ot(t.ptOptions)){e.log("No chat for anonymous users");return}if(!Er(s,r)&&!Or(s,r)){e.log("This video has no webchat");return}let a=!1,l=!1;if(r.isLocal){let c=(o=s["chat-share-url"])!=null?o:"";c==="everyone"?a=!0:c==="owner"?a=jt(t.ptOptions,r):c==="owner+moderators"&&(a=jt(t.ptOptions,r)||Gt(t.ptOptions)),Gt(t.ptOptions)&&(l=!0)}await ts(n,r,s,!!s["chat-open-blank"],a,l),s["chat-auto-display"]?await Hr(r):n&&n.setAttribute("peertube-plugin-livechat-state","closed")}catch(s){e.error("initChat has failed"),e.error(s)}}async function ts(r,t,e,i,n,o){let s=V(),a=s.ptOptions.peertubeHelpers,l=s.logger;l.log("Adding livechat in the DOM...");let c=await st(s.ptOptions,{page:"documentation/user/viewers"});return new Promise(m=>{Promise.all([a.translate("Open chat"),a.translate("Open chat in a new window"),a.translate("Close chat"),a.translate("Share chat link"),a.translate("Online help"),a.translate("Become moderator")]).then(b=>{var _,A,N;let v=b[0],y=b[1],R=b[2],S=b[3],x=b[4],P=b[5],U=document.createElement("div");U.classList.add("peertube-plugin-livechat-buttons"),r.append(U);let I=[];if(I.push({buttonContainer:U,name:"open",label:v,callback:()=>{Hr(t).then(()=>{},()=>{})},icon:$r,additionalClasses:[]}),i&&I.push({buttonContainer:U,name:"openblank",label:y,callback:()=>{Pr(),window.open("/p/livechat/room?room="+encodeURIComponent(t.uuid))},icon:Tr,additionalClasses:[]}),n&&I.push({buttonContainer:U,name:"shareurl",label:S,callback:()=>{Sr(s.ptOptions,e,t).then(()=>{},()=>{})},icon:Lr,additionalClasses:[]}),o&&I.push({buttonContainer:U,name:"promote",label:P,callback:async()=>{try{let D=H(s.ptOptions)+"/api/configuration/room/"+encodeURIComponent(t.uuid),J=await(await fetch(D,{method:"GET",headers:a.getAuthHeader()})).json();if(J.isRemoteChat)throw new Error("Cant promote on remote chat.");let he=J.room.replace(/@.*$/,"");await fetch(H(s.ptOptions)+"/api/promote/"+encodeURIComponent(he),{method:"PUT",headers:a.getAuthHeader()})}catch(D){l.error(D)}},icon:wr,additionalClasses:[]}),I.push({buttonContainer:U,name:"help",label:x,href:c,targetBlank:!0,icon:nt,additionalClasses:[]}),I.length>1){(_=I[0].additionalClasses)==null||_.push("peertube-plugin-livechat-multi-button-main");for(let D=1;D<I.length-1;D++)(A=I[D].additionalClasses)==null||A.push("peertube-plugin-livechat-multi-button-secondary");(N=I[I.length-1].additionalClasses)==null||N.push("peertube-plugin-livechat-multi-button-last-secondary")}for(let D of I)Bt(D);Bt({buttonContainer:U,name:"close",label:R,callback:()=>Pr(),icon:Ar}),m()})})}async function Hr(r){var l;let t=V(),e=t.ptOptions.peertubeHelpers,i=t.logger,n=await t.getSettings();if(!r)return i.log("No video."),!1;i.info("Trying to load the chat for video ".concat(r.uuid,"."));let o=r.uuid;if(!o)return i.error("Can't get room xmpp addr"),!1;let s=(l=n["chat-style"])!=null?l:"";i.info("Opening the chat...");let a=document.getElementById("peertube-plugin-livechat-container");try{if(!a)return i.error("Cant found the livechat container."),!1;if(a.getElementsByTagName("converse-root").length)return i.error("Seems that there is already a ConverseJS in the container."),!1;s&&a.setAttribute("style",s),a.setAttribute("peertube-plugin-livechat-state","open"),Wt(!0),await ct(t.ptOptions,a,o,"peertube-video",!1)}catch(c){if(a){let p=document.createElement("div");p.classList.add("peertube-plugin-livechat-error-message"),p.innerText=await e.translate("This chatroom does not exist, or is not accessible to you."),a.append(p),a.querySelectorAll(".livechat-spinner, converse-root").forEach(m=>m.remove())}Wt(!1)}}function Pr(){var e;let r=V().logger,t=document.getElementById("peertube-plugin-livechat-container");if(!t){r.error("Can't close livechat, container not found.");return}(e=window.converse)!=null&&e.livechatDisconnect&&window.converse.livechatDisconnect(),t.querySelectorAll("converse-root, .livechat-spinner, .peertube-plugin-livechat-error-message").forEach(i=>i.remove()),t.setAttribute("peertube-plugin-livechat-state","closed"),Wt(!1)}function Wt(r){try{document.querySelectorAll(".peertube-plugin-livechat-buttons").forEach(t=>{r?t.classList.add("peertube-plugin-livechat-buttons-open"):t.classList.remove("peertube-plugin-livechat-buttons-open")})}catch(t){V().logger.error("Failed hacking styles:  '".concat(t,"'"))}}var Mr;function Qr(r){let t=r.computeUrl();return h(Mr||(Mr=d(['<div class="livechat-shareurl-copy">\n    <input\n      type="text"\n      readonly autocomplete="off" placeholder=""\n      class="form-control readonly"\n      value=',"\n      @click=",'\n    />\n    <button\n      type="button" class="btn btn-outline-secondary text-uppercase"\n      @click=',"\n      ?disabled=","\n    >\n      ",'\n    </button>\n    <button\n      type="button" class="btn btn-outline-secondary text-uppercase"\n      @click=',"\n      ?disabled=","\n    >\n      ","\n    </button>\n    <livechat-help-button .page=","></livechat-help-button>\n  </div>"])),t.shareString,e=>{let i=e.target;i.select(),i.setSelectionRange(0,99999)},r.copyUrl,!t.shareString,u("Copy"),r.openUrl,t.openUrl===void 0,u("Open"),"documentation/user/streamers")}var Vr;function ut(r,t,e){return h(Vr||(Vr=d(["\n    <a\n      class=","\n      @click=","\n    >\n      ","\n    </a>"])),T({"sub-menu-entry":!0,active:r.currentTab===t}),i=>{i.preventDefault(),r.switchTab(t)},u(e))}var Fr;function en(r){return h(Fr||(Fr=d(["\n    ","\n    ","\n    ","\n    ","\n  "])),ut(r,"embed","Embed"),r.dockEnabled?ut(r,"dock","Dock"):"",ut(r,"peertube","Web"),r.xmppUriEnabled?ut(r,"xmpp","Connect using XMPP"):"")}var Br,jr,Gr,qr;function tn(r){let t,e;switch(r.currentTab){case"peertube":t="This link will open the chat within the Peertube interface.";break;case"embed":t="Tips for streamers: To embed the chat in your video stream using OBS for example, generate a read-only link and use it as a browser source.",e=h(Br||(Br=d(["<livechat-help-button .page=","></livechat-help-button>"])),"documentation/user/obs");break;case"dock":t="You can generate a link that will open the chat in full page, logged in with your Peertube account. This can be use, for example, to have a web dock in your OBS, so you can read and interact with the chat directly from OBS. Don't share this link to anyone, as it would allow them to connect as yourself. Please find bellow the list of authentication token you have already generated. You can create a new one, or revoke any previous token. Please note that these tokens have no expiration date.",e=h(jr||(jr=d(["<livechat-help-button .page=","></livechat-help-button>"])),"documentation/user/obs");break;case"xmpp":t="You can connect to the room using an external XMPP account, and your favorite XMPP client.";break}return t?h(qr||(qr=d(['<div class="livechat-shareurl-tips">',"","</div>"])),u(t),e):h(Gr||(Gr=d([""])))}var Wr;function is(r){return h(Wr||(Wr=d([""])))}var zr,Yr;function rs(r){return h(Yr||(Yr=d(['\n    <label>\n      <input\n        type="checkbox"\n        ?checked=',"\n        @click=","\n      />\n      ",'\n    </label>\n\n    <label>\n      <input\n        type="checkbox"\n        ?checked=',"\n        @click=","\n      />\n      ","\n    </label>\n    <div\n      class=",'\n    >\n      <label>\n        <input\n          type="checkbox"\n          ?checked=',"\n          ?disabled=","\n          @click=","\n        />\n        ",'\n      </label>\n      <label>\n        <input\n          type="checkbox"\n          ?checked=',"\n          ?disabled=","\n          @click=","\n        />\n        ","\n      </label>\n    </div>\n\n    ","\n  "])),r.embedIFrame,()=>{r.embedIFrame=!r.embedIFrame},u("Generate an iframe to embed the chat in a website"),r.embedReadOnly,()=>{r.embedReadOnly=!r.embedReadOnly},u("Read-only"),T({"livechat-shareurl-suboptions":!0,"livechat-shareurl-suboptions-disabled":!r.embedReadOnly}),r.embedReadOnlyScrollbar,!r.embedReadOnly,()=>{r.embedReadOnlyScrollbar=!r.embedReadOnlyScrollbar},u("Show the scrollbar"),r.embedReadOnlyTransparentBackground,!r.embedReadOnly,()=>{r.embedReadOnlyTransparentBackground=!r.embedReadOnlyTransparentBackground},u("Transparent background (for stream integration, with OBS for example)"),r.autocolorsAvailable?h(zr||(zr=d(['\n          <label>\n            <input\n              type="checkbox"\n              ?checked=',"\n              @click=","\n            />\n            ","\n          </label>"])),r.embedAutocolors,()=>{r.embedAutocolors=!r.embedAutocolors},u("Use current theme colors")):"")}var Kr;function ns(r){return h(Kr||(Kr=d(['<livechat-token-list\n    mode="select"\n    @update=',"\n  ></livechat-token-list>"])),t=>{r.requestUpdate()})}var Jr;function os(r){return h(Jr||(Jr=d([""])))}var Xr,Zr;function rn(r){let t;switch(r.currentTab){case"peertube":t=is(r);break;case"embed":t=rs(r);break;case"dock":t=ns(r);break;case"xmpp":t=os(r);break;default:t=h(Xr||(Xr=d([""])))}return h(Zr||(Zr=d(['<div class="livechat-shareurl-options">',"</div>"])),t)}function zt(r,t,e,i={}){if(!t)return L.error("Settings are not initialized, too soon to compute the iframeUri"),null;let n=H(r,i.permanent);n+="/webchat/room/"+encodeURIComponent(e.uuid);let o=new URL(n,window.location.origin);if(!i.ignoreAutoColors&&t["converse-autocolors"]&&at(t["converse-theme"])){L.info("We have to try to compute autocolors.");try{let s=lt();if(s)for(let a in s)o.searchParams.set("_ac_"+a,s[a])}catch(s){L.error("Failed computing autocolors:  '".concat(s,"'"))}}return i.readonly&&o.searchParams.set("_readonly",typeof i.readonly=="string"?i.readonly:"true"),i.transparent&&o.searchParams.set("_transparent","true"),n=o.href,n}function nn(r,t,e){if(!t["prosody-room-allow-s2s"])return null;let i;t["prosody-room-type"]==="channel"?i="channel."+e.channel.id.toString():i=e.uuid.toString();let n=window.location.hostname,o=i+"@room."+n;return{jid:o,uri:"xmpp:"+o+"?join"}}var dt=["embed","dock","peertube","xmpp"],on,j=class extends O{constructor(){super(...arguments);this.currentTab=dt[0];this.xmppUriEnabled=!1;this.dockEnabled=!1;this.autocolorsAvailable=!1;this.embedIFrame=!1;this.embedReadOnly=!1;this.embedReadOnlyScrollbar=!1;this.embedReadOnlyTransparentBackground=!1;this.embedAutocolors=!1;this.render=()=>h(on||(on=d(["\n      ","\n      ",'\n      <div class="livechat-shareurl-block">\n        ',"\n        ","\n      </div>\n    "])),en(this),Qr(this),tn(this),rn(this))}firstUpdated(e){super.firstUpdated(e);let i=this._settings;this.xmppUriEnabled=!!i["prosody-room-allow-s2s"],this.dockEnabled=!ot(this.ptContext.ptOptions)&&this._video.isLocal&&!i["livechat-token-disabled"],this.autocolorsAvailable=at(i["converse-theme"]),this._restorePreviousState()}updated(e){super.updated(e),this.logger.log("Updated was triggered, saving current state."),this._saveCurrentState()}_restorePreviousState(){if(!window.localStorage){this.logger.warn("No localStorage, can't restore state.");return}let e=window.localStorage.getItem("peertube-plugin-livechat-shareurl");if(e){try{let i=JSON.parse(e);if(!i||typeof i!="object"||i.version!==2){this.logger.warn("Stored information are invalid, dropping");return}this.logger.log("Restoring previous state"),dt.includes(i.currentTab)&&(this.currentTab=i.currentTab),this.embedIFrame=!!i.embedIFrame,this.embedReadOnly=!!i.embedReadOnly,this.embedReadOnlyScrollbar=!!i.embedReadOnlyScrollbar,this.embedReadOnlyTransparentBackground=!!i.embedReadOnlyTransparentBackground,this.embedAutocolors=!!i.embedAutocolors}catch(i){this.logger.error(i)}!this.xmppUriEnabled&&this.currentTab==="xmpp"&&(this.currentTab=dt[0]),!this.dockEnabled&&this.currentTab==="dock"&&(this.currentTab=dt[0])}}_saveCurrentState(){if(!window.localStorage){this.logger.warn("No localStorage, can't save state.");return}let e={version:2,currentTab:this.currentTab,embedIFrame:this.embedIFrame,embedReadOnly:this.embedReadOnly,embedReadOnlyScrollbar:this.embedReadOnlyScrollbar,embedReadOnlyTransparentBackground:this.embedReadOnlyTransparentBackground,embedAutocolors:this.embedAutocolors};window.localStorage.setItem("peertube-plugin-livechat-shareurl",JSON.stringify(e))}computeUrl(){switch(this.currentTab){case"embed":return this._computeUrlEmbed();case"dock":return this._computeUrlDock();case"peertube":return this._computeUrlPeertube();case"xmpp":return this._computeUrlXMPP();default:return{shareString:"",openUrl:void 0}}}_computeUrlPeertube(){let e=window.location.protocol+"//"+window.location.host+"/p/livechat/room?room="+encodeURIComponent(this._video.uuid);return{shareString:e,openUrl:e}}_computeUrlXMPP(){var i;let e=nn(this.ptContext.ptOptions,this._settings,this._video);return{shareString:(i=e==null?void 0:e.jid)!=null?i:"",openUrl:e==null?void 0:e.uri}}_computeUrlDock(){let e=this.querySelector("livechat-token-list"),i=e==null?void 0:e.currentSelectedToken;if(!i)return{shareString:"",openUrl:void 0};let n={ignoreAutoColors:!0,permanent:!0},o=zt(this.ptContext.ptOptions,this._settings,this._video,n);return o?(o+="#?p="+encodeURIComponent(i.password),o+="&j="+encodeURIComponent(i.jid),i.nickname&&(o+="&n="+encodeURIComponent(i.nickname)),{shareString:o,openUrl:o}):{shareString:"",openUrl:void 0}}_computeUrlEmbed(){let e={ignoreAutoColors:this.autocolorsAvailable?!this.embedAutocolors:!0,permanent:!0};this.embedReadOnly&&(e.readonly=this.embedReadOnlyScrollbar?!0:"noscroll",this.embedReadOnlyTransparentBackground&&(e.transparent=!0));let i=zt(this.ptContext.ptOptions,this._settings,this._video,e);if(!i)return{shareString:"",openUrl:void 0};if(!this.embedIFrame)return{shareString:i,openUrl:i};let n=document.createElement("iframe");n.setAttribute("src",i),n.setAttribute("title",this._video.name),n.setAttribute("sandbox","allow-same-origin allow-scripts allow-popups allow-forms"),n.setAttribute("width","560"),n.setAttribute("height","315"),n.setAttribute("frameborder","0");let o=n.outerHTML;return n.remove(),{shareString:o,openUrl:void 0}}async copyUrl(){await navigator.clipboard.writeText(this.computeUrl().shareString),this.ptNotifier.success(await this.ptTranslate("Copied"))}openUrl(){let e=this.computeUrl().openUrl;e&&window.open(e)}switchTab(e){this.currentTab=e}};f([C({attribute:!1})],j.prototype,"_video",2),f([C({attribute:!1})],j.prototype,"_settings",2),f([C({attribute:!1})],j.prototype,"currentTab",2),f([C({attribute:!1})],j.prototype,"xmppUriEnabled",2),f([C({attribute:!1})],j.prototype,"dockEnabled",2),f([C({attribute:!1})],j.prototype,"autocolorsAvailable",2),f([C({attribute:!1})],j.prototype,"embedIFrame",2),f([C({attribute:!1})],j.prototype,"embedReadOnly",2),f([C({attribute:!1})],j.prototype,"embedReadOnlyScrollbar",2),f([C({attribute:!1})],j.prototype,"embedReadOnlyTransparentBackground",2),f([C({attribute:!1})],j.prototype,"embedAutocolors",2),j=f([$("livechat-share-chat")],j);async function sn(){let r=V();r.ptOptions.registerHook({target:"action:video-watch.video.loaded",handler:({video:t,playlist:e})=>{if(!t){r.logger.error("No video argument in hook action:video-watch.video.loaded");return}if(e){r.logger.info("We are in a playlist, we will not use the webchat");return}Ur(t).then(()=>{},()=>{})}})}async function an(r){let{peertubeHelpers:t,registerClientRoute:e}=r;e({route:"livechat/room",onMount:async({rootEl:i})=>{try{let n=new URLSearchParams(window.location.search),o=n.get("room");if(!o)throw new Error("missing room parameter");let s=n.get("forcetype")==="1",a=document.createElement("div");a.classList.add("livechat-embed-fullpage"),i.append(a),await ct(r,a,o,"peertube-fullpage",s)}catch(n){L.error(n),i.innerHTML="";let o=document.createElement("div");o.classList.add("peertube-plugin-livechat-error-message"),o.innerText=await t.translate("This chatroom does not exist, or is not accessible to you."),i.append(o)}}})}var ln=/^[a-zA-Z0-9_-]+$/;var ht=class{constructor(t){this._headers={};var e;this._registerClientOptions=t,this._headers=(e=this._registerClientOptions.peertubeHelpers.getAuthHeader())!=null?e:{},this._headers["content-type"]="application/json;charset=UTF-8"}async validateConfiguration(t){let e={};if(t.files.length>20)throw new B("AdminFirewallConfigurationValidationError",await this._registerClientOptions.peertubeHelpers.translate("Too many entries"),e);let i=new Map;for(let[n,o]of t.files.entries())e["files.".concat(n,".name")]=[],o.name===""?e["files.".concat(n,".name")].push(0):o.name.length>20?e["files.".concat(n,".name")].push(5):ln.test(o.name)?i.has(o.name)?e["files.".concat(n,".name")].push(4):i.set(o.name,!0):e["files.".concat(n,".name")].push(2),e["files.".concat(n,".content")]=[],o.content.length>3072&&e["files.".concat(n,".content")].push(5);if(Object.values(e).find(n=>n.length>0))throw new B("AdminFirewallConfigurationValidationError",await this._registerClientOptions.peertubeHelpers.translate("There was an error during validation."),e);return!0}async saveConfiguration(t){if(!await this.validateConfiguration(t))throw new Error("Invalid form data");let e=await fetch(H(this._registerClientOptions)+"/api/admin/firewall/",{method:"POST",headers:this._headers,body:JSON.stringify(t)});if(!e.ok)throw new Error("Failed to save configuration.");return e.json()}async fetchConfiguration(){let t=await fetch(H(this._registerClientOptions)+"/api/admin/firewall/",{method:"GET",headers:this._headers});if(!t.ok)throw new Error("Can't get firewall configuration.");return t.json()}};var cn,un;function dn(r){var i,n,o,s;let t={enabled:{colName:u("Enabled")},name:{colName:u("Name"),description:u("Can only contain: alphanumerical characters, underscores and hyphens. Scripts will be loaded in alphabetical order."),headerClassList:["peertube-livechat-admin-firewall-col-name"]},content:{colName:u("File content"),headerClassList:["peertube-livechat-admin-firewall-col-content"]}},e={enabled:{inputType:"checkbox",default:!0},name:{inputType:"text",default:"",maxlength:20},content:{inputType:"textarea",default:"",maxlength:3072}};return h(un||(un=d(['\n    <div class="margin-content peertube-plugin-livechat-admin-firewall">\n      <h1>\n        ',"\n      </h1>\n      <p>\n        ","\n        <livechat-help-button .page=",">\n        </livechat-help-button>\n      </p>\n      ",'\n\n      <form role="form" @submit='," @change=",">\n        <livechat-dynamic-table-form\n          .header=","\n          .schema=","\n          .maxLines=","\n          .validation=","\n          .validationPrefix=","\n          .rows=","\n          @update=",'\n        ></livechat-dynamic-table-form>\n\n        <div class="form-group mt-5">\n          <button type="reset" @click='," ?disabled=",">\n            ",'\n          </button>\n          <button type="submit" ?disabled=',">\n            ","\n          </button>\n        </div>\n      </form>\n    </div>"])),u("Prosody mod_firewall configuration"),u('Here you can configure Prosody <a href="https://modules.prosody.im/mod_firewall" target="_blank">mod_firewall</a> module. You can create multiple configuration files bellow, and change their order. Don\'t hesitate to share your configurations with the community (for example by adding some examples in the plugin documentation).',!0),"documentation/admin/mod_firewall",(i=r.firewallConfiguration)!=null&&i.enabled?"":h(cn||(cn=d(['<p class="peertube-plugin-livechat-warning">',"</p>"])),u('Warning: mod_firewall is disabled in the livechat <a href="/admin/plugins/show/peertube-plugin-livechat" target="_blank">plugin settings</a>, you have to enable it if you want this configuration to be taken into account.',!0)),r.saveConfig,r.resetValidation,t,e,20,(n=r.validationError)==null?void 0:n.properties,"files",(s=(o=r.firewallConfiguration)==null?void 0:o.files)!=null?s:[],a=>{r.resetValidation(a),r.firewallConfiguration&&(r.firewallConfiguration.files=a.detail,r.requestUpdate("firewallConfiguration"))},r.reset,r.actionDisabled,u("Cancel"),r.actionDisabled,u("Save"))}var hn,pn,mn,_e=class extends O{constructor(){super();this.actionDisabled=!1;this.saveConfig=async e=>{e==null||e.preventDefault(),!(!this.firewallConfiguration||!this._adminFirewallService)&&(this.actionDisabled=!0,this._adminFirewallService.saveConfiguration(this.firewallConfiguration).then(i=>{this.validationError=void 0,this.ptTranslate("Successfully saved").then(n=>{this.ptNotifier.info(n)},()=>{}),this.firewallConfiguration=i,this.requestUpdate("firewallConfiguration"),this.requestUpdate("_validationError")}).catch(async i=>{this.validationError=void 0,i instanceof B&&(this.validationError=i),this.logger.warn("A validation error occurred in saving configuration. ".concat(i.name,": ").concat(i.message)),this.ptNotifier.error(i.message?i.message:await this.ptTranslate("Error")),this.requestUpdate("_validationError")}).finally(()=>{this.actionDisabled=!1}))};this.getInputValidationClass=e=>{var n;let i=(n=this.validationError)==null?void 0:n.properties[e];return i?i.length?{"is-invalid":!0}:{"is-valid":!0}:{}};this.renderFeedback=(e,i)=>{var s,a;let n=[],o=(a=(s=this.validationError)==null?void 0:s.properties[i])!=null?a:void 0;return o&&o.length!==0?h(hn||(hn=d(["<div id=",' class="invalid-feedback">',"</div>"])),e,n):E};this.render=()=>this._asyncTaskRender.render({pending:()=>h(pn||(pn=d(["<livechat-spinner></livechat-spinner>"]))),error:()=>h(mn||(mn=d(["<livechat-error></livechat-error>"]))),complete:()=>dn(this)});this._asyncTaskRender=this._initTask()}_initTask(){return new F(this,{task:async()=>{this._adminFirewallService=new ht(this.ptOptions),this.firewallConfiguration=await this._adminFirewallService.fetchConfiguration(),this.actionDisabled=!1},args:()=>[]})}async reset(e){e==null||e.preventDefault(),this.actionDisabled=!0,this._asyncTaskRender=this._initTask(),this.requestUpdate()}resetValidation(e){this.validationError&&(this.validationError=void 0,this.requestUpdate("_validationError"))}};f([k()],_e.prototype,"firewallConfiguration",2),f([k()],_e.prototype,"validationError",2),f([k()],_e.prototype,"actionDisabled",2),_e=f([$("livechat-admin-firewall")],_e);var fn;async function gn(r){let{registerClientRoute:t}=r;t({route:"livechat/admin/firewall",onMount:async({rootEl:e})=>{X(h(fn||(fn=d(["<livechat-admin-firewall .registerClientOptions=","></livechat-admin-firewall>"])),r),e)}})}var bn,ye=class extends O{constructor(){super(...arguments);this.buttonTitle=u("Online help");this.page="";this.url=new URL("https://lmddgtfy.net/");this._asyncTaskRender=new F(this,{task:async()=>{this.url=new URL(await st(this.ptOptions,{page:this.page}))},args:()=>[]});this.render=()=>this._asyncTaskRender.render({complete:()=>h(bn||(bn=d(['<a\n        href="','"\n        target=_blank\n        title="','"\n        class="primary-button orange-button peertube-button-link"\n      >',"</a>"])),this.url.href,this.buttonTitle,K(nt()))})}};f([C({attribute:!1})],ye.prototype,"buttonTitle",2),f([C({attribute:!1})],ye.prototype,"page",2),f([k()],ye.prototype,"url",2),ye=f([$("livechat-help-button")],ye);var vn=(r,t,e)=>{let i=new Map;for(let n=t;n<=e;n++)i.set(r[n],n);return i},Ee=z(class extends Z{constructor(r){if(super(r),r.type!==Y.CHILD)throw Error("repeat() can only be used in text expressions")}dt(r,t,e){let i;e===void 0?e=t:t!==void 0&&(i=t);let n=[],o=[],s=0;for(let a of r)n[s]=i?i(a,s):s,o[s]=e(a,s),s++;return{values:o,keys:n}}render(r,t,e){return this.dt(r,t,e).values}update(r,[t,e,i]){var R;let n=Pi(r),{values:o,keys:s}=this.dt(t,e,i);if(!Array.isArray(n))return this.ut=s,o;let a=(R=this.ut)!=null?R:this.ut=[],l=[],c,p,m=0,b=n.length-1,v=0,y=o.length-1;for(;m<=b&&v<=y;)if(n[m]===null)m++;else if(n[b]===null)b--;else if(a[m]===s[v])l[v]=se(n[m],o[v]),m++,v++;else if(a[b]===s[y])l[y]=se(n[b],o[y]),b--,y--;else if(a[m]===s[y])l[y]=se(n[m],o[y]),Te(r,l[y+1],n[m]),m++,y--;else if(a[b]===s[v])l[v]=se(n[b],o[v]),Te(r,n[m],n[b]),b--,v++;else if(c===void 0&&(c=vn(s,v,y),p=vn(a,m,b)),c.has(a[m]))if(c.has(a[b])){let S=p.get(s[v]),x=S!==void 0?n[S]:null;if(x===null){let P=Te(r,n[m]);se(P,o[v]),l[v]=P}else l[v]=se(x,o[v]),Te(r,n[m],x),n[S]=null;v++}else et(n[b]),b--;else et(n[m]),m++;for(;v<=y;){let S=Te(r,l[y+1]);se(S,o[v]),l[v++]=S}for(;m<=b;){let S=n[m++];S!==null&&et(S)}return this.ut=s,Di(r,l),W}});var w=r=>r!=null?r:E;var pt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"\n  aria-hidden="true"\n  fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"\n  stroke-linejoin="round" class="feather feather-plus-square">\n    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n    <line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line>\n  </svg>',mt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"\n  aria-hidden="true"\n  fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"\n  stroke-linejoin="round" class="feather feather-x-square">\n    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>\n    <line x1="9" y1="9" x2="15" y2="15"></line><line x1="15" y1="9" x2="9" y2="15"></line>\n  </svg>';var Cn,_n,yn,En,On,An,$n,Tn,Ln,wn,Rn,Sn,kn,xn,In,Nn,Dn,Pn,Un,Hn,Mn,Vn,Fn,Bn,jn,Gn,qn,Wn,zn,Yn,Kn,Jn,Xn,Zn,Qn,q=class extends O{constructor(){super(...arguments);this.header={};this.schema={};this.maxLines=void 0;this.validationPrefix="";this.rows=[];this._rowsById=[];this.formName="";this._lastRowId=1;this.columnOrder=[];this._updateLastRowId=()=>{for(let e of this._rowsById)this._lastRowId=Math.max(this._lastRowId,e._id+1)};this._getDefaultRow=()=>(this._updateLastRowId(),Object.fromEntries([...Object.entries(this.schema).map(e=>{var i;return[e[0],(i=e[1].default)!=null?i:""]})]));this.render=()=>{let e="peertube-livechat-".concat(this.formName.replace(/_/g,"-"),"-table");this._updateLastRowId(),this._rowsById=this._rowsById.filter(i=>this.rows.includes(i.row));for(let i=0;i<this.rows.length;i++)this._rowsById.find(n=>n.row===this.rows[i])?this._rowsById.filter(n=>n.row===this.rows[i]).forEach(n=>{n._originalIndex=i}):this._rowsById.push({_id:this._lastRowId++,_originalIndex:i,row:this.rows[i]});return this.columnOrder.length!==Object.keys(this.header).length&&(this.columnOrder=this.columnOrder.filter(i=>Object.keys(this.header).includes(i)),this.columnOrder.push(...Object.keys(this.header).filter(i=>!this.columnOrder.includes(i)))),h(Cn||(Cn=d(['\n      <div class="table-responsive">\n        <table class="table" id=',">\n          ","\n          <tbody>\n            ","\n          </tbody>\n          ","\n        </table>\n      </div>\n    "])),e,this._renderHeader(),Ee(this._rowsById,i=>i._id,this._renderDataRow),this._renderFooter())};this._renderHeader=()=>{let e=Object.entries(this.header).sort(([i,n],[o,s])=>this.columnOrder.indexOf(i)-this.columnOrder.indexOf(o));return h(_n||(_n=d(["<thead>\n      <tr>\n        ",'\n        <th scope="col"></th>\n      </tr>\n      <tr>\n        ','\n        <th scope="col"></th>\n      </tr>\n    </thead>'])),e.map(([i,n])=>this._renderHeaderCell(n)),e.map(([i,n])=>this._renderHeaderDescriptionCell(n)))};this._renderHeaderCell=e=>{var i,n;return h(yn||(yn=d(['<th scope="col" class=','>\n      <div\n        data-toggle="tooltip"\n        data-placement="bottom"\n        data-html="true"\n      >\n        ',"\n      </div>\n    </th>"])),(n=(i=e.headerClassList)==null?void 0:i.join(" "))!=null?n:"",e.colName)};this._renderDataRow=e=>{let i="peertube-livechat-".concat(this.formName.replace(/_/g,"-"),"-row-").concat(e._id);return h(On||(On=d(["<tr id=",">\n      ",'\n      <td class="form-group">\n        <button type="button"\n          class="dynamic-table-remove-row"\n          .title=',"\n          @click=","\n        >\n          ","\n        </button>\n      </td>\n    </tr>"])),i,Object.keys(this.header).sort((n,o)=>this.columnOrder.indexOf(n)-this.columnOrder.indexOf(o)).map(n=>{var o;return this.renderDataCell(n,(o=e.row[n])!=null?o:this.schema[n].default,e._id,e._originalIndex)}),u("Remove this entry"),async()=>this._removeRow(e._id),K(mt))};this._renderFooter=()=>this.maxLines&&this._rowsById.length>=this.maxLines?h(An||(An=d([""]))):h(Tn||(Tn=d(['<tfoot>\n    <tr>\n      <td class="dynamic-table-add-row-cell">\n        <button type="button"\n          class="dynamic-table-add-row"\n          .title=',"\n          @click=","\n        >\n          ","\n        </button>\n      </td>\n      ","\n    </tr>\n  </tfoot>"])),u("Add an entry"),this._addRow,K(pt),Object.values(this.header).map(()=>h($n||($n=d(["<td></td>"])))));this.renderDataCell=(e,i,n,o)=>{var v,y,R,S,x,P,U,I,_,A,N,D,re,J,he,ke,xe;let s=(v=this.schema[e])!=null?v:{},a,l="".concat(this.formName.replace(/-/g,"_"),"_").concat(e.toString().replace(/-/g,"_"),"_").concat(n),c="peertube-livechat-".concat(this.formName.replace(/_/g,"-"),"-").concat(e.toString().replace(/_/g,"-"),"-").concat(n),p=(R=s.inputTitle)!=null?R:(y=this.header[e])==null?void 0:y.colName,m=this._renderFeedback(c,e,o);switch((S=s.default)==null?void 0:S.constructor){case String:switch((x=s.inputType)!=null||(s.inputType="text"),s.inputType){case"text":case"color":case"date":case"datetime":case"datetime-local":case"email":case"file":case"image":case"month":case"number":case"password":case"range":case"tel":case"time":case"url":case"week":a=h(Ln||(Ln=d(["","\n              ","\n              "])),this._renderInput(n,c,l,p,e,s,i,o),m);break;case"textarea":a=h(wn||(wn=d(["","\n              ","\n              "])),this._renderTextarea(n,c,l,p,e,s,i,o),m);break;case"select":a=h(Rn||(Rn=d(["","\n              ","\n              "])),this._renderSelect(n,c,l,p,e,s,i,o),m);break;case"image-file":a=h(Sn||(Sn=d(["","\n              ","\n              "])),this._renderImageFileInput(n,c,l,p,e,s,i==null?void 0:i.toString(),o),m);break}break;case Date:switch((P=s.inputType)!=null||(s.inputType="datetime"),s.inputType){case"date":case"datetime":case"datetime-local":case"time":a=h(kn||(kn=d(["","\n              ","\n              "])),this._renderInput(n,c,l,p,e,s,i.toISOString(),o),m);break}break;case Number:switch((U=s.inputType)!=null||(s.inputType="number"),s.inputType){case"number":case"range":a=h(xn||(xn=d(["","\n              ","\n              "])),this._renderInput(n,c,l,p,e,s,i,o),m);break}break;case Boolean:switch((I=s.inputType)!=null||(s.inputType="checkbox"),s.inputType){case"checkbox":a=h(In||(In=d(["","\n              ","\n              "])),this._renderCheckbox(n,c,l,p,e,s,i,o),m);break}break;case Array:switch((_=s.inputType)!=null||(s.inputType="text"),s.inputType){case"text":case"color":case"date":case"datetime":case"datetime-local":case"email":case"file":case"image":case"month":case"number":case"password":case"range":case"tel":case"time":case"url":case"week":i.constructor!==Array&&(i=i?[i]:[]),a=h(Nn||(Nn=d(["","\n              ","\n              "])),this._renderInput(n,c,l,p,e,s,(re=(D=(N=i==null?void 0:i.join((A=s.separator)!=null?A:","))!=null?N:i)!=null?D:s.default)!=null?re:"",o),m);break;case"textarea":i.constructor!==Array&&(i=i?[i]:[]),a=h(Dn||(Dn=d(["","\n              ","\n              "])),this._renderTextarea(n,c,l,p,e,s,(xe=(ke=(he=i==null?void 0:i.join((J=s.separator)!=null?J:","))!=null?he:i)!=null?ke:s.default)!=null?xe:"",o),m);break;case"tags":i.constructor!==Array&&(i=i?[i]:[]),a=h(Pn||(Pn=d(["","\n              ","\n              "])),this._renderTagsInput(n,c,l,p,e,s,i,o),m);break}}a||this.logger.warn("value type '".concat(i.constructor.toString(),"' is incompatible")+"with field type '".concat(s.inputType,"' for form entry '").concat(e.toString(),"'."));let b=["form-group"];return s.colClassList&&b.push(...s.colClassList),h(Un||(Un=d(["<td class=",">","</td>"])),b.join(" "),a)};this._renderInput=(e,i,n,o,s,a,l,c)=>{var p;return h(Vn||(Vn=d(["<input\n      type=","\n      name=","\n      class=","\n      id=","\n      title=",'\n      aria-describedby="','-feedback"\n      list=',"\n      min=","\n      max=","\n      minlength=","\n      maxlength=","\n      @change=","\n      .value=","\n    />\n    ",""])),a.inputType,n,T(Object.assign({"form-control":!0},this._getInputValidationClass(s,c))),i,w(o),i,w(a.datalist?i+"-datalist":void 0),w(a.min),w(a.max),w(a.minlength),w(a.maxlength),m=>this._updatePropertyFromValue(m,s,a,e),l,a.datalist?h(Mn||(Mn=d(["<datalist id=",">\n      ","\n    </datalist>"])),i+"-datalist",((p=a.datalist)!=null?p:[]).map(m=>h(Hn||(Hn=d(["<option value=",">"])),m.toString()))):E)};this._renderTagsInput=(e,i,n,o,s,a,l,c)=>{var p;return h(Fn||(Fn=d(["<livechat-tags-input\n      .name=","\n      class=","\n      id=","\n      .inputTitle=",'\n      aria-describedby="','-feedback"\n      .min=',"\n      .max=","\n      .minlength=","\n      .maxlength=","\n      .datalist=","\n      .separator=","\n      @change=","\n      .value=","\n      ></livechat-tags-input>"])),n,T(Object.assign({"form-control":!0},this._getInputValidationClass(s,c))),i,o,i,a.min,a.max,a.minlength,a.maxlength,a.datalist,(p=a.separator)!=null?p:"\n",m=>this._updatePropertyFromValue(m,s,a,e),l)};this._renderTextarea=(e,i,n,o,s,a,l,c)=>h(Bn||(Bn=d(["<textarea\n      name=","\n      class=","\n      id=","\n      title=",'\n      aria-describedby="','-feedback"\n      min=',"\n      max=","\n      minlength=","\n      maxlength=","\n      @change=","\n      .value=","></textarea>"])),n,T(Object.assign({"form-control":!0},this._getInputValidationClass(s,c))),i,w(o),i,w(a.min),w(a.max),w(a.minlength),w(a.maxlength),p=>this._updatePropertyFromValue(p,s,a,e),l);this._renderCheckbox=(e,i,n,o,s,a,l,c)=>h(jn||(jn=d(['<input\n      type="checkbox"\n      name=',"\n      class=","\n      id=","\n      title=",'\n      aria-describedby="','-feedback"\n      @change=','\n      value="1"\n      ?checked='," />"])),n,T(Object.assign({"form-check-input":!0},this._getInputValidationClass(s,c))),i,w(o),i,p=>this._updatePropertyFromValue(p,s,a,e),l);this._renderSelect=(e,i,n,o,s,a,l,c)=>{var p,m;return h(qn||(qn=d(["<select\n      class=","\n      id=","\n      title=",'\n      aria-describedby="','-feedback"\n      aria-label=',"\n      @change=","\n    >\n      <option ?selected=",">","</option>\n      ","\n    </select>"])),T(Object.assign({"form-select":!0},this._getInputValidationClass(s,c))),i,w(o),i,n,b=>this._updatePropertyFromValue(b,s,a,e),!l,o!=null?o:"",(m=Object.entries((p=a.options)!=null?p:{}))==null?void 0:m.map(([b,v])=>h(Gn||(Gn=d(["<option ?selected="," value=",">","</option>"])),l===b,b,v)))};this._renderImageFileInput=(e,i,n,o,s,a,l,c)=>h(Wn||(Wn=d(["<livechat-image-file-input\n      .name=","\n      class=","\n      id=","\n      .inputTitle=",'\n      aria-describedby="','-feedback"\n      @change=',"\n      .value=","\n      .maxSize=","\n      .accept=","\n    ></livechat-image-file-input>"])),n,T(this._getInputValidationClass(s,c)),i,o,i,p=>this._updatePropertyFromValue(p,s,a,e),l,30720,ji);this._getInputValidationClass=(e,i)=>{var o;let n=(o=this.validation)==null?void 0:o["".concat(this.validationPrefix,".").concat(i,".").concat(e)];return n!==void 0?n.length?{"is-invalid":!0}:{"is-valid":!0}:{}};this._renderFeedback=(e,i,n)=>{var a;let o=[],s=(a=this.validation)==null?void 0:a["".concat(this.validationPrefix,".").concat(n,".").concat(i)];return s!==void 0&&s.length!==0?(s.includes(0)&&o.push(h(zn||(zn=d(["",""])),u("This value is required."))),s.includes(1)&&o.push(h(Yn||(Yn=d(["",""])),u("Value is of the wrong type."))),s.includes(2)&&o.push(h(Kn||(Kn=d(["",""])),u("Value is in the wrong format."))),s.includes(3)&&o.push(h(Jn||(Jn=d(["",""])),u("Value is not in authorized range."))),s.includes(4)&&o.push(h(Xn||(Xn=d(["",""])),u("Duplicate value"))),s.includes(5)&&o.push(h(Zn||(Zn=d(["",""])),u("Value too long"))),h(Qn||(Qn=d(['<div id="','-feedback" class="invalid-feedback">',"</div>"])),e,o)):E};this._updatePropertyFromValue=(e,i,n,o)=>{var c;let s=e.target,a=s?s instanceof HTMLInputElement&&s.type==="checkbox"?!!s.checked:s.value:void 0;if(a===void 0){this.logger.warn("Could not update property : Target or value was undefined");return}let l=this._rowsById.find(p=>p._id===o);if(!l){this.logger.warn("Could not update property : Did not find a property named '".concat(i,"' in row '").concat(o,"'"));return}switch((c=n.default)==null?void 0:c.constructor){case Array:a.constructor===Array||!n.separator?l.row[i]=a:l.row[i]=a.split(n.separator);break;default:l.row[i]=a;break}this.rows=this._rowsById.map(p=>p.row),this.requestUpdate("rows"),this.requestUpdate("_rowsById"),this.dispatchEvent(new CustomEvent("update",{detail:this.rows}))}}async _addRow(){var n;let e=this._getDefaultRow();this._rowsById.push({_id:this._lastRowId++,_originalIndex:this.rows.length,row:e}),this.rows.push(e),this.requestUpdate("rows"),this.requestUpdate("_rowsById"),this.dispatchEvent(new CustomEvent("update",{detail:this.rows})),await this.updateComplete;let i=(n=this.querySelector("table"))==null?void 0:n.querySelector("&>tbody>tr:last-child>td input:not([type=hidden]),&>tbody>tr:last-child>td livechat-tags-input,&>tbody>tr:last-child>td textarea");i&&i.focus()}async _removeRow(e){let i=await this.ptTranslate("Are you sure you want to remove this entry?");await new Promise((o,s)=>{this.ptOptions.peertubeHelpers.showModal({title:i,content:"",close:!0,cancel:{value:"cancel",action:s},confirm:{value:"confirm",action:o}})});let n=this._rowsById.filter(o=>o._id===e).map(o=>o.row)[0];this._rowsById=this._rowsById.filter(o=>o._id!==e),this.rows=this.rows.filter(o=>o!==n),this.requestUpdate("rows"),this.requestUpdate("_rowsById"),this.dispatchEvent(new CustomEvent("update",{detail:this.rows}))}_renderHeaderDescriptionCell(e){var n;let i=["livechat-dynamic-table-form-description-header"];return e.headerClassList&&i.push(...e.headerClassList),h(En||(En=d(['<th scope="col" class=',">\n      ","\n    </th>"])),i.join(" "),(n=e.description)!=null?n:"")}};f([C({attribute:!1})],q.prototype,"header",2),f([C({attribute:!1})],q.prototype,"schema",2),f([C({attribute:!1})],q.prototype,"maxLines",2),f([C()],q.prototype,"validation",2),f([C({attribute:!1})],q.prototype,"validationPrefix",2),f([C({attribute:!1})],q.prototype,"rows",2),f([k()],q.prototype,"_rowsById",2),f([C({attribute:!1})],q.prototype,"formName",2),f([k()],q.prototype,"_lastRowId",2),f([C({attribute:!1})],q.prototype,"columnOrder",2),q=f([$("livechat-dynamic-table-form")],q);var eo,to,io,Oe=class extends O{constructor(){super(...arguments);this.label="???";this.render=()=>h(io||(io=d(["\n      <h2>\n        ","\n        ","\n      </h2>\n      ",""])),this.label,this.helpPage===void 0?"":h(eo||(eo=d(["<livechat-help-button .page=","></livechat-help-button>"])),this.helpPage),this.description===void 0?"":h(to||(to=d(["<p>","</p>"])),this.description))}};f([C({attribute:!1})],Oe.prototype,"label",2),f([C({attribute:!1})],Oe.prototype,"description",2),f([C({attribute:!1})],Oe.prototype,"helpPage",2),Oe=f([$("livechat-configuration-section-header")],Oe);var Xt=new WeakMap;var ro=0,Zt=new Map,no=new WeakSet,Qt=()=>new Promise(r=>requestAnimationFrame(r));var bt=[{opacity:0}];var vt=[{opacity:0},{opacity:1}];var oo=(r,t)=>{let e=r-t;return e===0?void 0:e},so=(r,t)=>{let e=r/t;return e===1?void 0:e},ft={left:(r,t)=>{let e=oo(r,t);return{value:e,transform:e==null||isNaN(e)?void 0:"translateX(".concat(e,"px)")}},top:(r,t)=>{let e=oo(r,t);return{value:e,transform:e==null||isNaN(e)?void 0:"translateY(".concat(e,"px)")}},width:(r,t)=>{let e;t===0&&(t=1,e={width:"1px"});let i=so(r,t);return{value:i,overrideFrom:e,transform:i==null||isNaN(i)?void 0:"scaleX(".concat(i,")")}},height:(r,t)=>{let e;t===0&&(t=1,e={height:"1px"});let i=so(r,t);return{value:i,overrideFrom:e,transform:i==null||isNaN(i)?void 0:"scaleY(".concat(i,")")}}},lo={duration:333,easing:"ease-in-out"},co=["left","top","width","height","opacity","color","background"],ao=new WeakMap,gt=class extends ae{constructor(t){if(super(t),this.t=!1,this.i=null,this.o=null,this.h=!0,this.shouldLog=!1,t.type===Y.CHILD)throw Error("The `animate` directive must be used in attribute position.");this.createFinished()}createFinished(){var t;(t=this.resolveFinished)==null||t.call(this),this.finished=new Promise(e=>{this.l=e})}async resolveFinished(){var t;(t=this.l)==null||t.call(this),this.l=void 0}render(t){return E}getController(){return Xt.get(this.u)}isDisabled(){var t;return this.options.disabled||((t=this.getController())==null?void 0:t.disabled)}update(t,[e]){var n;let i=this.u===void 0;return i&&(this.u=(n=t.options)==null?void 0:n.host,this.u.addController(this),this.u.updateComplete.then(o=>this.t=!0),this.element=t.element,ao.set(this.element,this)),this.optionsOrCallback=e,(i||typeof e!="function")&&this.p(e),this.render(e)}p(t){var i;t=t!=null?t:{};let e=this.getController();e!==void 0&&((t=G(G({},e.defaultOptions),t)).keyframeOptions=G(G({},e.defaultOptions.keyframeOptions),t.keyframeOptions)),(i=t.properties)!=null||(t.properties=co),this.options=t}m(){let t={},e=this.element.getBoundingClientRect(),i=getComputedStyle(this.element);return this.options.properties.forEach(n=>{var a;let o=(a=e[n])!=null?a:ft[n]?void 0:i[n],s=Number(o);t[n]=isNaN(s)?o+"":s}),t}v(){let t,e=!0;return this.options.guard&&(t=this.options.guard(),e=((i,n)=>{if(Array.isArray(i)){if(Array.isArray(n)&&n.length===i.length&&i.every((o,s)=>o===n[s]))return!1}else if(n===i)return!1;return!0})(t,this._)),this.h=this.t&&!this.isDisabled()&&!this.isAnimating()&&e&&this.element.isConnected,this.h&&(this._=Array.isArray(t)?Array.from(t):t),this.h}hostUpdate(){var t;typeof this.optionsOrCallback=="function"&&this.p(this.optionsOrCallback()),this.v()&&(this.A=this.m(),this.i=(t=this.i)!=null?t:this.element.parentNode,this.o=this.element.nextSibling)}async hostUpdated(){if(!this.h||!this.element.isConnected||this.options.skipInitial&&!this.isHostRendered)return;let t;this.prepare(),await Qt;let e=this.O(),i=this.j(this.options.keyframeOptions,e),n=this.m();if(this.A!==void 0){let{from:o,to:s}=this.N(this.A,n,e);this.log("measured",[this.A,n,o,s]),t=this.calculateKeyframes(o,s)}else{let o=Zt.get(this.options.inId);if(o){Zt.delete(this.options.inId);let{from:s,to:a}=this.N(o,n,e);t=this.calculateKeyframes(s,a),t=this.options.in?[G(G({},this.options.in[0]),t[0]),...this.options.in.slice(1),t[1]]:t,ro++,t.forEach(l=>l.zIndex=ro)}else this.options.in&&(t=[...this.options.in,{}])}this.animate(t,i)}resetStyles(){var t;this.P!==void 0&&(this.element.setAttribute("style",(t=this.P)!=null?t:""),this.P=void 0)}commitStyles(){var t,e;this.P=this.element.getAttribute("style"),(t=this.webAnimation)==null||t.commitStyles(),(e=this.webAnimation)==null||e.cancel()}reconnected(){}async disconnected(){var e;if(!this.h||(this.options.id!==void 0&&Zt.set(this.options.id,this.A),this.options.out===void 0))return;if(this.prepare(),await Qt(),(e=this.i)==null?void 0:e.isConnected){let i=this.o&&this.o.parentNode===this.i?this.o:null;if(this.i.insertBefore(this.element,i),this.options.stabilizeOut){let n=this.m();this.log("stabilizing out");let o=this.A.left-n.left,s=this.A.top-n.top;getComputedStyle(this.element).position!=="static"||o===0&&s===0||(this.element.style.position="relative"),o!==0&&(this.element.style.left=o+"px"),s!==0&&(this.element.style.top=s+"px")}}let t=this.j(this.options.keyframeOptions);await this.animate(this.options.out,t),this.element.remove()}prepare(){this.createFinished()}start(){var t,e;(e=(t=this.options).onStart)==null||e.call(t,this)}didFinish(t){var e,i;t&&((i=(e=this.options).onComplete)==null||i.call(e,this)),this.A=void 0,this.animatingProperties=void 0,this.frames=void 0,this.resolveFinished()}O(){let t=[];for(let e=this.element.parentNode;e;e=e==null?void 0:e.parentNode){let i=ao.get(e);i&&!i.isDisabled()&&i&&t.push(i)}return t}get isHostRendered(){let t=no.has(this.u);return t||this.u.updateComplete.then(()=>{no.add(this.u)}),t}j(t,e=this.O()){let i=G({},lo);return e.forEach(n=>Object.assign(i,n.options.keyframeOptions)),Object.assign(i,t),i}N(t,e,i){t=G({},t),e=G({},e);let n=i.map(a=>a.animatingProperties).filter(a=>a!==void 0),o=1,s=1;return n.length>0&&(n.forEach(a=>{a.width&&(o/=a.width),a.height&&(s/=a.height)}),t.left!==void 0&&e.left!==void 0&&(t.left=o*t.left,e.left=o*e.left),t.top!==void 0&&e.top!==void 0&&(t.top=s*t.top,e.top=s*e.top)),{from:t,to:e}}calculateKeyframes(t,e,i=!1){var l;let n={},o={},s=!1,a={};for(let c in e){let p=t[c],m=e[c];if(c in ft){let b=ft[c];if(p===void 0||m===void 0)continue;let v=b(p,m);v.transform!==void 0&&(a[c]=v.value,s=!0,n.transform="".concat((l=n.transform)!=null?l:""," ").concat(v.transform),v.overrideFrom!==void 0&&Object.assign(n,v.overrideFrom))}else p!==m&&p!==void 0&&m!==void 0&&(s=!0,n[c]=p,o[c]=m)}return n.transformOrigin=o.transformOrigin=i?"center center":"top left",this.animatingProperties=a,s?[n,o]:void 0}async animate(t,e=this.options.keyframeOptions){this.start(),this.frames=t;let i=!1;if(!this.isAnimating()&&!this.isDisabled()&&(this.options.onFrames&&(this.frames=t=this.options.onFrames(this),this.log("modified frames",t)),t!==void 0)){this.log("animate",[t,e]),i=!0,this.webAnimation=this.element.animate(t,e);let n=this.getController();n==null||n.add(this);try{await this.webAnimation.finished}catch(o){}n==null||n.remove(this)}return this.didFinish(i),i}isAnimating(){var t,e;return((t=this.webAnimation)==null?void 0:t.playState)==="running"||((e=this.webAnimation)==null?void 0:e.pending)}log(t,e){this.shouldLog&&!this.isDisabled()&&console.log(t,this.options.id,e)}},Ct=z(gt);var ls=["top","right","bottom","left"],_t=class extends ae{constructor(t){if(super(t),t.type!==Y.ELEMENT)throw Error("The `position` directive must be used in attribute position.")}render(t,e){return E}update(t,[e,i]){var n;return this.u===void 0&&(this.u=(n=t.options)==null?void 0:n.host,this.u.addController(this)),this.S=t.element,this.C=e,this.F=i!=null?i:["left","top","width","height"],this.render(e,i)}hostUpdated(){this.$()}$(){var o,s;let t=typeof this.C=="function"?this.C():(o=this.C)==null?void 0:o.value,e=t.offsetParent;if(t===void 0||!e)return;let i=t.getBoundingClientRect(),n=e.getBoundingClientRect();(s=this.F)==null||s.forEach(a=>{let l=ls.includes(a)?i[a]-n[a]:i[a];this.S.style[a]=l+"px"})}},cs=z(_t);var us='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 4.233 4.233">\n  <g style="stroke-width:1.00021;stroke-miterlimit:4;stroke-dasharray:none"><path style="opacity:.998;fill:none;fill-opacity:1;stroke:currentColor;stroke-width:1.17052;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m4.084 4.046-.616.015-.645-.004a.942.942 0 0 1-.942-.942v-4.398a.94.94 0 0 1 .942-.943H7.22a.94.94 0 0 1 .942.943l-.006.334-.08.962" transform="matrix(.45208 0 0 .45208 -.528 1.295)"/><path style="opacity:.998;fill:none;fill-opacity:1;stroke:currentColor;stroke-width:1.17052;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M8.434 5.85c-.422.009-1.338.009-1.76.01-.733.004-2.199 0-2.199 0a.94.94 0 0 1-.942-.941V.52a.94.94 0 0 1 .942-.942h4.398a.94.94 0 0 1 .943.942s.004 1.466 0 2.2c-.003.418-.019 1.251-.006 1.67.024.812-.382 1.439-1.376 1.46z" transform="matrix(.45208 0 0 .45208 -.528 1.295)"/></g>\n</svg>',uo,ho,po,mo,fo,go,M=class extends O{constructor(){super(...arguments);this._inputValue="";this.inputTitle="";this.value=[];this._searchedTagsIndex=[];this._isPressingKey=[];this.separator="\n";this.animDuration=200;this.render=()=>{var e,i,n,o,s,a;return h(go||(go=d(["\n      <div class=","\n      >\n        <ul\n          class=",">\n            ","\n          </ul>\n          ","\n      </div>\n        <ul class=","\n        >\n          ",'\n        </ul>\n        <input\n        type="text"\n        name=','\n        id="','-input"\n        list="','-input-datalist"\n        min=',"\n        max=","\n        minlength=","\n        maxlength=","\n        @paste=","\n        @keydown=","\n        @keyup=","\n        @input=","\n        @change=","\n        .value=","\n        title="," />\n        ",""])),T({"livechat-empty":!this.value.length,"livechat-tags-container":!0}),T({"livechat-empty":!this.value.length,"livechat-unfocused":this._searchedTagsIndex.length,"livechat-tags":!0}),Ee(this.value,l=>l,(l,c)=>h(uo||(uo=d(["<li key=",' class="livechat-tag" title='," ",">\n                <span class='livechat-tag-name'>","</span>\n                <span class='livechat-tag-close'\n                      @click=","></span>\n              </li>"])),c,l,Ct({keyframeOptions:{duration:this.animDuration,fill:"both"},in:vt,out:bt}),l,()=>this._handleDeleteTag(c))),((e=this.value)==null?void 0:e.length)===0?"":h(ho||(ho=d(['<button\n                type="button"\n                class="peertube-plugin-livechat-tags-input-copy"\n                title=',"\n                @click=","\n              >","</button>"])),u("Copy"),async l=>{l.preventDefault(),await navigator.clipboard.writeText(this.value.join(this.separator)),this.ptNotifier.success(await this.ptTranslate("Copied"))},K(us)),T({"livechat-empty":!this._searchedTagsIndex.length,"livechat-tags-searched":!0}),Ee(this._searchedTagsIndex,l=>l,l=>h(po||(po=d(["<li key=",' class="livechat-tag-searched" title='," ",">\n              <span class='livechat-tag-name'>","</span>\n              <span class='livechat-tag-close'\n                    @click=",">\n              </span>\n            </li>"])),l,this.value[l],Ct({keyframeOptions:{duration:this.animDuration,fill:"both"},in:vt,out:bt}),this.value[l],()=>this._handleDeleteTag(l))),w(this.name),(i=this.id)!=null?i:"tags-input",(n=this.id)!=null?n:"tags-input",w(this.min),w(this.max),w(this.minlength),w(this.maxlength),l=>this._handlePaste(l),l=>this._handleKeyDown(l),l=>this._handleKeyUp(l),l=>this._handleInputEvent(l),l=>l.stopPropagation(),(o=this._inputValue)!=null?o:"",w(this.inputTitle),this.datalist?h(fo||(fo=d(['<datalist id="','-datalist">\n            ',"\n          </datalist>"])),(s=this.id)!=null?s:"tags-input",((a=this.datalist)!=null?a:[]).map(l=>h(mo||(mo=d(["<option value=",">"])),l))):"")};this._handlePaste=e=>{var n,o,s,a,l,c,p,m,b,v,y,R;let i=e==null?void 0:e.target;if(i){e.preventDefault();let x="".concat((l=(a=i==null?void 0:i.value)==null?void 0:a.slice(0,(s=(o=i.selectionStart)!=null?o:(n=i==null?void 0:i.value)==null?void 0:n.length)!=null?s:0))!=null?l:"").concat((p=(c=e.clipboardData)==null?void 0:c.getData("text/plain"))!=null?p:"").concat((R=(y=i==null?void 0:i.value)==null?void 0:y.slice((v=(b=i.selectionEnd)!=null?b:(m=i==null?void 0:i.value)==null?void 0:m.length)!=null?v:0))!=null?R:"").split(this.separator);if(x=x.map(P=>P.trim()).filter(P=>P!==""),x.length>0)return i.value="",this.value=[...new Set([...this.value,...x])],this._inputValue=i.value,this._updateSearchedTags(),this.requestUpdate("value"),this.dispatchEvent(new CustomEvent("change",{detail:this.value})),!1}return!0};this._handleKeyDown=e=>{let i=e==null?void 0:e.target;if(i)switch(e.key){case"Enter":if(!this._isPressingKey.includes(e.key))this._isPressingKey.push(e.key);else return e.preventDefault(),!1;return i.value===""?(this._isPressingKey.push(e.key),!0):(e.preventDefault(),this._handleNewTag(e),!1);case"Backspace":this._isPressingKey.includes(e.key)||(this._isPressingKey.push(e.key),i.selectionStart===i.selectionEnd&&i.selectionStart===0&&this._handleDeleteTag(this._searchedTagsIndex.length?this._searchedTagsIndex.slice(-1)[0]:this.value.length-1));break;case"Delete":this._isPressingKey.includes(e.key)||(this._isPressingKey.push(e.key),i.selectionStart===i.selectionEnd&&i.selectionStart===i.value.length&&this._handleDeleteTag(this._searchedTagsIndex.length?this._searchedTagsIndex[0]:0));break;default:break}return!0};this._handleKeyUp=e=>{if(e==null?void 0:e.target)switch(e.key){case"Enter":case"Backspace":case"Delete":this._isPressingKey.includes(e.key)&&this._isPressingKey.splice(this._isPressingKey.indexOf(e.key));break;default:break}return!0};this._handleInputEvent=e=>{let i=e==null?void 0:e.target;return i&&(this._inputValue=i.value,this.separator===i.value.slice(-1)?(e.preventDefault(),i.value=i.value.slice(0,-1),this._handleNewTag(e)):this._updateSearchedTags()),!0};this._handleNewTag=e=>{let i=e==null?void 0:e.target;i&&(this._addTag(i.value),i.value="",this._inputValue="",this._updateSearchedTags())};this._handleDeleteTag=e=>{this._removeTag(e),this._updateSearchedTags()};this._updateSearchedTags=()=>{var n;let e=[],i=(n=this._inputValue)==null?void 0:n.trim();if(i!=null&&i.length)for(let[o,s]of this.value.entries())s.toLowerCase().includes(i.toLowerCase())&&e.push(o);this._searchedTagsIndex=e,this.requestUpdate("_searchedTagsIndex")};this._addTag=e=>{if(e===void 0){this.logger.warn("Could not add tag : Target or value was undefined");return}e=e.trim(),e&&(this.value.push(e),this.value=[...new Set(this.value)],this.requestUpdate("value"),this.dispatchEvent(new CustomEvent("change",{detail:this.value})))};this._removeTag=e=>{if(e<0||e>=this.value.length){this.logger.warn("Could not remove tag : index out of range");return}this.value.splice(e,1),this.requestUpdate("value"),this.dispatchEvent(new CustomEvent("change",{detail:this.value}))}}focus(){let e=this.querySelector("input[type=text]");if(e){e.focus();return}this.updateComplete.then(()=>{let i=this.querySelector("input[type=text]");i&&i.focus()},()=>{})}};f([C({attribute:!1})],M.prototype,"name",2),f([C({attribute:!1})],M.prototype,"min",2),f([C({attribute:!1})],M.prototype,"max",2),f([C({attribute:!1})],M.prototype,"maxlength",2),f([C({attribute:!1})],M.prototype,"minlength",2),f([k()],M.prototype,"_inputValue",2),f([C({attribute:!1})],M.prototype,"inputTitle",2),f([C({attribute:!1})],M.prototype,"datalist",2),f([C({reflect:!0,type:Array})],M.prototype,"value",2),f([k()],M.prototype,"_searchedTagsIndex",2),f([k()],M.prototype,"_isPressingKey",2),f([C({attribute:!1})],M.prototype,"separator",2),f([C({attribute:!1})],M.prototype,"animDuration",2),M=f([$("livechat-tags-input")],M);var bo,vo,ie=class extends O{constructor(){super(...arguments);this.accept=["image/jpg","image/png","image/gif"];this.render=()=>h(vo||(vo=d(["\n      ",'\n      <input\n        type="file"\n        title=','\n        accept="','"\n        class="form-control"\n        style=',"\n        @change=","\n      />\n    "])),this.value?h(bo||(bo=d(["<img src="," alt="," @click="," />"])),this.value,w(this.inputTitle),e=>{var n;e.preventDefault();let i=(n=this.parentElement)==null?void 0:n.querySelector('input[type="file"]');i==null||i.click()}):"",w(this.inputTitle),this.accept.join(","),this.value?"display: none;":"",async e=>this._upload(e))}async _upload(e){var o;e.preventDefault(),e.stopImmediatePropagation();let n=(o=e.target.files)==null?void 0:o[0];if(n){if(this.maxSize&&n.size>this.maxSize){let s=await this.ptTranslate("File size is too big (max size: %s).");s&&(s=s.replace("%s",Math.round(this.maxSize/1024).toString()+"k"),this.ptNotifier.error(s));return}try{let s=await new Promise((l,c)=>{let p=new FileReader;p.onload=()=>{if(p.result===null){c(new Error("Empty result"));return}p.result instanceof ArrayBuffer?c(new Error("Result is an ArrayBuffer, this was not intended")):l(p.result)},p.onerror=c,p.readAsDataURL(n)});this.value=s;let a=new Event("change");this.dispatchEvent(a)}catch(s){this.logger.error(s)}}}};f([C({attribute:!1})],ie.prototype,"name",2),f([C({reflect:!0})],ie.prototype,"value",2),f([C({attribute:!1})],ie.prototype,"maxSize",2),f([C({attribute:!1})],ie.prototype,"inputTitle",2),f([C({attribute:!1})],ie.prototype,"accept",2),ie=f([$("livechat-image-file-input")],ie);var Co,yt=class extends O{constructor(){super(...arguments);this.render=()=>h(Co||(Co=d(["<div></div>"])))}};yt=f([$("livechat-spinner")],yt);var Et=class{constructor(){this._headers={};var t;this._headers=(t=V().ptOptions.peertubeHelpers.getAuthHeader())!=null?t:{},this._headers["content-type"]="application/json;charset=UTF-8",this._apiUrl=H(V().ptOptions)+"/api/auth/tokens"}async fetchTokenList(){let t=await fetch(this._apiUrl,{method:"GET",headers:this._headers});if(!t.ok)throw new Error("Can't get livechat token list.");return t.json()}async createToken(t){let e=await fetch(this._apiUrl,{method:"POST",headers:this._headers,body:JSON.stringify({label:t})});if(!e.ok)throw new Error("Can't create livechat token.");return e.json()}async revokeToken(t){let e=await fetch(this._apiUrl+"/"+encodeURIComponent(t.id),{method:"DELETE",headers:this._headers});if(!e.ok)throw new Error("Can't delete livechat token.");return e.json()}};var _o,yo,Eo;function Oo(r){var t;return h(Eo||(Eo=d(['<div class="table-responsive">\n    <table class="table">\n      <thead>\n        <tr>\n          <th scope="col"></th>\n          <th scope="col">','</th>\n          <th scope="col">','</th>\n          <th scope="col"></th>\n        </tr>\n      </thead>\n      <tbody>\n        ','\n      </tbody>\n      <tfoot>\n        <tr>\n          <td>\n          <button type="button"\n            class="livechat-create-token"\n            .title=',"\n            ?disabled=","\n            @click=","\n          >\n            ","\n          </button>\n          </td>\n        </tr>\n      </tfoot>\n    </table>\n  </div>"])),u("Label"),u("Date"),Ee((t=r.tokenList)!=null?t:[],e=>e.id,e=>{var n;let i="";try{let o=new Date(e.date);i=o.toLocaleDateString()+" "+o.toLocaleTimeString()}catch(o){}return h(yo||(yo=d(["<tr>\n              <td>","</td>\n              <td>\n                <label for=",">\n                  ","\n                </label>\n              </td>\n              <td>\n                <label for=",">\n                  ",'\n                </label>\n              </td>\n              <td>\n                <button type="button"\n                  class="livechat-revoke-token"\n                  .title=',"\n                  ?disabled=","\n                  @click=","\n                >\n                  ","\n                </button>\n              </td>\n            </tr>"])),r.mode==="select"?h(_o||(_o=d(['<input\n                  type="radio"\n                  name="livechat-token"\n                  value=',"\n                  id=","\n                  ?checked=","\n                  @click=","\n                />"])),e.id,"livechat-token-radio-".concat(e.id),((n=r.currentSelectedToken)==null?void 0:n.id)===e.id,o=>r.selectToken(o,e)):"","livechat-token-radio-".concat(e.id),e.label,"livechat-token-radio-".concat(e.id),i,u("Revoke the token"),r.actionDisabled,()=>{r.revokeToken(e).then(()=>{},()=>{})},K(mt))}),u("Create a new token"),r.actionDisabled,()=>{r.createToken().then(()=>{},()=>{})},K(pt))}var Ao,$o,de=class extends O{constructor(){super();this.mode="list";this.actionDisabled=!1;this.render=()=>this._asyncTaskRender.render({pending:()=>h(Ao||(Ao=d(["<livechat-spinner></livechat-spinner>"]))),error:()=>h($o||($o=d(["<livechat-error></livechat-error>"]))),complete:()=>Oo(this)});this._tokenListService=new Et,this._asyncTaskRender=this._initTask()}_initTask(){return new F(this,{task:async()=>{this.tokenList=await this._tokenListService.fetchTokenList(),this.mode==="select"&&this.tokenList.length&&(this.currentSelectedToken=this.tokenList[0],this.dispatchEvent(new CustomEvent("update",{}))),this.actionDisabled=!1},args:()=>[]})}selectToken(e,i){var n;(n=this.tokenList)!=null&&n.includes(i)&&(this.currentSelectedToken=i,this.requestUpdate("tokenList"),this.dispatchEvent(new CustomEvent("update",{})))}async revokeToken(e){var n,o;let i=await this.ptTranslate("Are you sure you want to revoke this token?");if(window.confirm(i)){this.actionDisabled=!0;try{await this._tokenListService.revokeToken(e),this.tokenList=(o=(n=this.tokenList)==null?void 0:n.filter(s=>s!==e))!=null?o:[],this.currentSelectedToken===e&&(this.currentSelectedToken=void 0),this.requestUpdate("tokenList"),this.dispatchEvent(new CustomEvent("update",{}))}catch(s){this.logger.error(s),this.ptNotifier.error(s.toString(),await this.ptTranslate("Error"))}finally{this.actionDisabled=!1}}}async createToken(){var e;this.actionDisabled=!0;try{let i=await this._tokenListService.createToken(await this.ptTranslate("Token generated from the web interface"));(e=this.tokenList)!=null||(this.tokenList=[]),this.tokenList.push(i),this.mode==="select"&&(this.currentSelectedToken=i),this.requestUpdate("tokenList"),this.dispatchEvent(new CustomEvent("update",{}))}catch(i){this.logger.error(i),this.ptNotifier.error(i.toString(),await this.ptTranslate("Error"))}finally{this.actionDisabled=!1}}};f([C({attribute:!0})],de.prototype,"mode",2),f([C({attribute:!1})],de.prototype,"tokenList",2),f([C({attribute:!1})],de.prototype,"currentSelectedToken",2),f([C({attribute:!1})],de.prototype,"actionDisabled",2),de=f([$("livechat-token-list")],de);var To,Be=class extends O{constructor(){super(...arguments);this.msg=u("An error occured while loading data.");this.render=()=>h(To||(To=d(["",""])),this.msg)}};f([C({attribute:!1})],Be.prototype,"msg",2),Be=f([$("livechat-error")],Be);async function zp(r){let{peertubeHelpers:t,registerHook:e,registerVideoField:i}=r;Mi(r),e({target:"action:router.navigation-end",handler:()=>{var c;let l=document.querySelector("#peertube-plugin-livechat-container");if(l){let p=l.getAttribute("peertube-plugin-livechat-current-url");if(p&&p===window.location.href){console.warn("[peertube-plugin-livechat navigation-end] It seems that action:router.navigation-end was called after action:video-watch.video.loaded. Not removing the chat from the DOM.");return}l.remove()}(c=window.converse)!=null&&c.livechatDisconnect&&window.converse.livechatDisconnect()}}),e({target:"action:video-watch.video.loaded",handler:()=>{let c=0,p=setInterval(()=>{let m=document.querySelector("textarea.chat-textarea");(m||++c>=10)&&clearInterval(p),m&&(m.maxLength=500,m.placeholder=(m.placeholder||"").replace(/$/," (max 500 chars)"))},500)}});let[n,o,s]=await Promise.all([t.translate("Use chat"),t.translate("If enabled, there will be a chat next to the video."),t.getSettings()]),a={name:"livechat-active",label:n,descriptionHTML:o,type:"input-checkbox",default:!0,hidden:({liveVideo:l})=>!!(!l||!s["chat-per-live-video"]||s["chat-all-lives"])};i(a,{type:"update"}),i(a,{type:"go-live"}),await Promise.all([sn(),an(r),_r(r),gn(r)])}export{zp as register};
/*! Bundled license information:

@lit/reactive-element/css-tag.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/reactive-element.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/lit-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-element/lit-element.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/is-server.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/custom-element.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/property.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/state.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/event-options.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/base.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query-all.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query-async.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query-assigned-elements.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/reactive-element/decorators/query-assigned-nodes.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directive-helpers.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/async-directive.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/unsafe-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/task/task.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/context-request-event.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/create-context.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/controllers/context-consumer.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/value-notifier.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/controllers/context-provider.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/context-root.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/decorators/provide.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

@lit/context/lib/decorators/consume.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/class-map.js:
  (**
   * @license
   * Copyright 2018 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/repeat.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)

lit-html/directives/if-defined.js:
  (**
   * @license
   * Copyright 2018 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/
