"use strict";(()=>{function C(){let l,m,b,a=document.querySelector("div");if(!a)throw new Error("Cant find main container");a.innerHTML="";let y=document.createElement("h1");y.textContent="Diagnostic",a.append(y);let p=document.createElement("ul");a.append(p);function x(e){var g;let t=document.createElement("li"),n=document.createElement("span");n.textContent=((g=e.label)!=null?g:e.test)+": ",t.append(n);let s=document.createElement("b");if(e.ok?(s.textContent="OK",s.style.color="green"):(s.textContent="KO",s.style.color="red"),t.append(s),e.messages.length){let i=document.createElement("ul");for(let h=0;h<e.messages.length;h++){let d=document.createElement("li"),o=e.messages[h];if(typeof o=="string")d.textContent=o;else{let u=document.createElement("span");if(o.level==="warning"?u.style.color="orange":o.level==="error"&&(u.style.color="red"),u.textContent=o.message+" ",d.append(u),o.help){let w=document.createElement("a");w.href=o.help.url,w.textContent=o.help.text,d.append(w)}}i.append(d)}t.append(i)}p.append(t)}let r;function k(e){var t;if((t=e.debug)!=null&&t.length){if(!r){r=document.createElement("div");let n=document.createElement("h2");n.textContent="Additional debugging information",r.append(n),a==null||a.append(r)}for(let n=0;n<e.debug.length;n++){let s=e.debug[n],g=document.createElement("h3");g.textContent=s.title,r.append(g);let i=document.createElement("div");i.setAttribute("style","white-space: pre;"),i.textContent=s.message,r.append(i)}}}function E(){var t,n,s;let e={ok:!1,next:"backend",messages:[],test:"browser",label:"Browser"};return window.fetch||e.messages.push("Missing fetch function"),window.localStorage?(l=(t=window.localStorage.getItem("token_type"))!=null?t:"",m=(n=window.localStorage.getItem("access_token"))!=null?n:"",b=(s=window.localStorage.getItem("refresh_token"))!=null?s:"",l===""?e.messages.push("Your browser is not authenticated on your Peertube instance (no token_type)"):l.toLowerCase()!=="bearer"?e.messages.push("Your brower is authenticated with an unknown token type: "+l):m===""?e.messages.push("Your browser is not authenticated on your Peertube instance (no access_token)"):b===""&&e.messages.push("Your browser is not authenticated on your Peertube instance (no refresh_token)")):e.messages.push("Browser has no local storage"),e.ok=e.messages.length===0,e}let c=window.location.pathname;c[c.length-1]!=="/"&&(c+="/"),c+="test";async function v(e){var s;let t=await window.fetch(c,{method:"POST",headers:new Headers({Authorization:l+" "+m,"content-type":"application/json;charset=UTF-8"}),body:JSON.stringify({test:e})});if(!t.ok)return{test:e,messages:[(s=t.statusText)!=null?s:"Unknown error"],ok:!1};let n=await t.json();return typeof n!="object"?{test:e,messages:["Incorrect reponse type: "+typeof n],ok:!1}:n}async function f(e){if(x(e),k(e),!e.ok||!e.next)return;let t=document.createElement("li");if(t.innerHTML="<i>Testing...</i>",p.append(t),typeof e.next=="function"){let n=e.next();t.remove(),await f(n)}else{console.log("Calling test "+e.next);let n=await v(e.next);t.remove(),await f(n)}}f({label:"Starting tests",messages:[],next:E,ok:!0,test:"start"}).then(()=>{},e=>{console.error(e);let t=document.createElement("div");t.style.color="red",t.textContent=e,document.body.append(t)})}C();})();
