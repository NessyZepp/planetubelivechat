"use strict";(()=>{var k=Object.freeze,ce=Object.defineProperty;var g=(n,e)=>k(ce(n,"raw",{value:k(e||n.slice())}));function x(){try{return window.self!==window.top}catch(n){return!0}}function E({forceReadonly:n,transparent:e},t){let o=document.querySelector("body");t&&o&&(o.classList.add("livechat-iframe"),o.style.overflowX="hidden"),n&&(o==null||o.classList.add("livechat-readonly"),n==="noscroll"&&(o==null||o.classList.add("livechat-noscroll"))),e&&(o==null||o.classList.add("livechat-transparent"))}function T({forceReadonly:n,theme:e,assetsPath:t,room:o,forceDefaultHideMucParticipants:i,autofocus:s,peertubeVideoOriginalUrl:a,peertubeVideoUUID:r,customEmojisUrl:c}){let m={assets_path:t,authentication:"anonymous",ping_interval:25,auto_login:!0,auto_join_rooms:[o],keepalive:!0,discover_connection_methods:!1,notify_all_room_messages:[o],show_desktop_notifications:!1,show_tab_notifications:!1,singleton:!0,auto_focus:s===!0,hide_muc_participants:i===!0,play_sounds:!1,muc_mention_autocomplete_min_chars:2,muc_mention_autocomplete_filter:"contains",muc_instant_rooms:!0,show_client_info:!1,allow_adhoc_commands:!1,allow_contact_requests:!1,allow_logout:!1,show_controlbox_by_default:!1,view_mode:"fullscreen",allow_message_corrections:"all",allow_message_retraction:"all",visible_toolbar_buttons:{call:!1,spoiler:!1,emoji:!0},theme:e||"peertube",dark_theme:e||"peertube",persistent_store:"sessionStorage",show_images_inline:!1,render_media:!1,whitelisted_plugins:["livechatWindowTitlePlugin","livechatSpecifics","livechatMiniMucHeadPlugin","livechatViewerModePlugin","livechatDisconnectOnUnloadPlugin","converse-slow-mode","livechatEmojis","converse-moderation-delay","livechatAnnouncementsPlugin"],show_retraction_warning:!1,muc_show_info_messages:n?["301","307","321","322","332","333"]:["100","102","103","172","173","174","110","104","201","170","171","210","303","301","307","321","322","332","333","owner","admin","member","exadmin","exowner","exoutcast","exmember","op","deop","voice","mute"],send_chat_state_notifications:!1,prune_messages_above:100,pruning_behavior:"unscrolled",colorize_username:!0,send_chat_markers:[],reuse_scram_keys:!1,livechat_load_all_vcards:!!n,livechat_peertube_video_original_url:a,livechat_peertube_video_uuid:r,livechat_custom_emojis_url:c};return m.clear_cache_on_logout=!0,m.allow_user_trust_override=!1,m.emoji_categories={custom:null,smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:"},m}function N(n,e,t){I(n,e,t),w(n,t)}function O(n,e){e.jid=n.localAnonymousJID,w(n,e)}function j(n,e,t){I(n,e,t),w(n,t)}function y(n,e,t){t.jid=n.remoteAnonymousJID,e!=null&&e.nickname&&(t.nickname=e.nickname),le(n,t)}function I(n,e,t){t.authentication="login",t.auto_login=!0,t.jid=e.jid,t.password=e.password,e.nickname&&(t.nickname=e.nickname),t.muc_nickname_from_jid=!0,t.keepalive=!1}function w(n,e){e.bosh_service_url=n.localBoshServiceUrl,e.websocket_url=n.localWebsocketServiceUrl}function le(n,e){e.bosh_service_url=n.remoteBoshServiceUrl,e.websocket_url=n.remoteWebsocketServiceUrl}async function R(n,e,t){var o,i,s,a;try{if(n==="")return console.error("Missing authenticationUrl"),!1;if(!window.fetch)return console.error("Your browser has not the fetch api, we cant log you in"),!1;if(t===void 0){if(!window.localStorage)return console.error("Your browser has no localStorage, we cant log you in"),!1;let m=(o=window.localStorage.getItem("token_type"))!=null?o:"",l=(i=window.localStorage.getItem("access_token"))!=null?i:"",d=(s=window.localStorage.getItem("refresh_token"))!=null?s:"";m===""&&l===""&&d===""?(console.info("User seems not to be logged in."),t=null):t={Authorization:m+" "+l}}let r;if(e&&!t&&window.sessionStorage){let m=window.sessionStorage.getItem("peertube-plugin-livechat-external-auth-oidc-token");m&&typeof m=="string"&&(r={"X-Peertube-Plugin-Livechat-External-Auth-OIDC-Token":m})}if(t===null&&r===void 0)return console.info("User is not logged in."),!1;let c=await window.fetch(n,{method:"GET",headers:new Headers(Object.assign({},t!=null?t:{},r!=null?r:{},{"content-type":"application/json;charset=UTF-8"}))});if(!c.ok)return console.error("Failed fetching user informations"),!1;let u=await c.json();return typeof u!="object"?(console.error("Failed reading user informations"),!1):!u.jid||!u.password?(console.error("User informations does not contain required fields"),!1):{jid:u.jid,password:u.password,nickname:u.nickname,type:(a=u.type)!=null?a:"peertube"}}catch(r){return console.error(r),!1}}function U(){var n;try{let e=window.location.hash;if(!(e!=null&&e.startsWith("#?")))return;let t=new URL("http://localhost"+e.substring(1)),o=t.searchParams.get("j"),i=t.searchParams.get("p");if(!o||!i)return;let s=(n=t.searchParams.get("n"))!=null?n:void 0;return{type:"livechat-token",jid:o,password:i,nickname:s}}catch(e){console.error(e);return}}function p(n){let e=1e5+Math.floor(Math.random()*9e5);return n+" "+e.toString()}function b(){var n;try{let e=parseInt((n=localStorage.getItem("livechat-previous-anonymous-nickname-last-access"))!=null?n:"0"),t=Date.now();if(e&&!isNaN(e)){let i=e+432e5;if(t>i)return console.log("Anonymous nickname has expired."),localStorage.removeItem("livechat-previous-anonymous-nickname"),localStorage.removeItem("livechat-previous-anonymous-nickname-last-access"),null}let o=localStorage.getItem("livechat-previous-anonymous-nickname");return o!==null&&localStorage.setItem("livechat-previous-anonymous-nickname-last-access",t.toString()),o}catch(e){return console.error(e),null}}function z(n){try{console.log("Storing anonymous nickname",n),localStorage.setItem("livechat-previous-anonymous-nickname",n),localStorage.setItem("livechat-previous-anonymous-nickname-last-access",Date.now().toString())}catch(e){console.error(e)}}var D={dependencies:["converse-muc","converse-muc-views"],async initialize(){this._converse.api.listen.on("sendMessage",function(e){var a,r;let{chatbox:t}=e;if(t.getOwnOccupant().isModerator())return;let i=(r=(a=t==null?void 0:t.config)==null?void 0:a.get("slow_mode_duration"))!=null?r:NaN,s=typeof i=="string"?parseInt(i):typeof i=="number"?Math.trunc(i):NaN;s>0&&(console.log("Slow mode is enabled, disabling the message field for ".concat(s," seconds.")),setTimeout(()=>{document.querySelectorAll(".chat-textarea").forEach(c=>{c.setAttribute("readonly","readonly"),setTimeout(()=>{c.removeAttribute("readonly")},s*1e3+100)})},100))})}};var L={dependencies:["converse-muc-views"],overrides:{ChatRoomView:{requestUpdate:function(){var n;console.log("[livechatWindowTitlePlugin] updating the document title.");try{if((n=this.model)!=null&&n.getDisplayName){let e=this.model.getDisplayName();document.title!==e&&(document.title=e)}}catch(e){console.error("[livechatWindowTitlePlugin] Failed updating the window title",e)}return this.__super__.requestUpdate.apply(this)}}}};function F(){let n={isResolved:!1,isPending:!0,isRejected:!1},e=new Promise((t,o)=>{n.resolve=t,n.reject=o});return Object.assign(e,n),e.then(function(t){return e.isResolved=!0,e.isPending=!1,e.isRejected=!1,t},function(t){throw e.isResolved=!1,e.isPending=!1,e.isRejected=!0,t}),e}async function J(n,e){var s;let t=n.__,o=[t("Are you sure you want to destroy this groupchat?")],i=[{name:"reason",label:t("Optional reason for destroying this groupchat"),placeholder:t("Reason"),value:void 0}];try{i=await n.api.confirm(t("Confirm"),o,i);let a=(s=i.filter(c=>c.name==="reason").pop())==null?void 0:s.value;return e.sendDestroyIQ(a,void 0).then(()=>e.close())}catch(a){console.error(a)}}function B(n){let e=n._converse;e.api.listen.on("getHeadingButtons",ue.bind(n)),me(e)}function ue(n,e){let t=this._converse;return n.model.get("type")!==t.constants.CHATROOMS_TYPE||t.api.settings.get("livechat_specific_external_authent")&&e.push({i18n_text:t.__("Log out"),handler:async o=>{o.preventDefault(),o.stopPropagation();let i=[t.__("Are you sure you want to leave this groupchat?")];if(!await t.api.confirm(t.__("Confirm"),i))return;if(window.sessionStorage.removeItem("peertube-plugin-livechat-external-auth-oidc-token"),t.api.settings.get("livechat_external_auth_reconnect_mode")==="button-close-open"){let r=document.getElementsByClassName("peertube-plugin-livechat-button-close")[0];r.click&&r.click();return}window.location.reload()},a_class:"close-chatbox-button",icon_class:"fa-sign-out-alt",name:"signout"}),e}function me(n){let e=n.api.elements.registry["converse-muc-heading"];if(e){class t extends e{async destroy(i){i.preventDefault(),await J(n,this.model)}}n.api.elements.define("converse-muc-heading",t)}}function q(n){n._converse.api.listen.on("getToolbarButtons",de.bind(n))}var W,G,H;function de(n,e){let t=this._converse,o=t.__("Hide participants"),i=t.__("Show participants"),s=window.converse.env.html,a=n.hidden_occupants?s(W||(W=g(['<converse-icon\n            color="var(--muc-toolbar-btn-color)"\n            class="fa fa-angle-double-left"\n            size="1em">\n        </converse-icon>\n        <converse-icon\n            color="var(--muc-toolbar-btn-color)"\n            class="fa users"\n            size="1em">\n        </converse-icon>']))):s(G||(G=g(['<converse-icon\n            color="var(--muc-toolbar-btn-color)"\n            class="fa users"\n            size="1em">\n        </converse-icon>\n        <converse-icon\n            color="var(--muc-toolbar-btn-color)"\n            class="fa fa-angle-double-right"\n            size="1em">\n        </converse-icon>'])));return e.push(s(H||(H=g(['\n      <button class="toggle-occupants btn" type="button"\n              title="','"\n              @click=',">\n              ","\n      </button>"])),n.hidden_occupants?i:o,r=>{r==null||r.preventDefault(),n.model.save({hidden_occupants:!n.model.get("hidden_occupants")})},a)),e}function V(n){let e=n._converse;window.converse.livechatDisconnect=function(){e.api.connection.connected()&&(console.log("[livechatSpecificsPlugin] disconnecting converseJS..."),e.api.user.logout())},window.reconnectConverse=function(o){console.log("[livechatSpecificsPlugin] reconnecting converseJS..."),e.api.settings.set("auto_join_rooms",o.auto_join_rooms),e.api.settings.set("notify_all_room_messages",o.notify_all_room_messages);for(let i of["bosh_service_url","websocket_url","authentication","nickname","muc_nickname_from_jid","auto_login","jid","password","keepalive"])e.api.settings.set(i,o[i]);for(let i of["hide_muc_participants","livechat_enable_viewer_mode","livechat_external_auth_oidc_buttons","livechat_external_auth_reconnect_mode","livechat_mini_muc_head","livechat_specific_external_authent","livechat_task_app_enabled","livechat_task_app_restore","livechat_custom_emojis_url","emoji_categories"])e.api.settings.set(i,o[i]);window.converse.emojis={initialized:!1,initialized_promise:F()},e.api.user.login()}}function $(){return{getActionInfoMessage:function(e,t,o){return e==="303"&&/^Anonymous \d+$/.test(t)?null:this.__super__.getActionInfoMessage(e,t,o)},canPostMessages:function(){return this.isEntered()&&this.getOwnRole()!=="visitor"},initOccupants:function(){let e=this.__super__.initOccupants(),t=this.occupants.comparator;return this.occupants.comparator=function(o,i){let s=o.getDisplayName(),a=i.getDisplayName(),r=s.startsWith("Anonymous "),c=a.startsWith("Anonymous ");return r===c?t.call(this,o,i):r?1:-1},e}}}function Y(){return{isFollowup:function(){return!1}}}function X(n){let e=n._converse,t=e.api.elements.registry["converse-message-actions"];if(t){class o extends t{async onMessageCopyButtonClicked(s){var r;(r=s==null?void 0:s.preventDefault)==null||r.call(s);let a="";try{a+=this.model.getDisplayName(),a+=" - ";let c=new Date(this.model.get("edited")||this.model.get("time"));a+=c.toLocaleDateString()+" "+c.toLocaleTimeString(),a+="\n"}catch(c){}a+=this.model.getMessageText(),await navigator.clipboard.writeText(a)}}e.api.elements.define("converse-message-actions",o)}}function Q(n){let e=n._converse,t=e.api.elements.registry["converse-muc-occupant-modal"];if(!t)return;class o extends t{initialize(){var s;return(s=this.model)!=null&&s.getOccupant&&(this.model=this.model.getOccupant()),super.initialize()}}e.api.elements.define("converse-profile-modal",o)}function K(n){let e=n._converse,t=e.api.elements.registry["converse-muc-bottom-panel"];if(t){class o extends t{async initialize(){await super.initialize(),this.listenTo(this.model.features,"change:x_peertubelivechat_emoji_only_mode",()=>this.requestUpdate())}}e.api.elements.define("converse-muc-bottom-panel",o)}}var Z={dependencies:["converse-muc","converse-muc-views"],initialize:function(){let n=this._converse;n.api.settings.extend({livechat_specific_external_authent:!1,livechat_specific_is_anonymous:!1}),B(this),q(this),X(this),Q(this),K(this),n.api.listen.on("chatRoomViewInitialized",function(e){var t;(t=document.getElementById("livechat-loading-spinner"))==null||t.remove()}),V(this),window.location.protocol==="http:"&&(window._livechatConverse=n)},overrides:{ChatRoom:$(),ChatRoomMessage:Y()}};var ee={dependencies:["converse-muc","converse-muc-views"],initialize:function(){let n=this._converse;n.api.settings.extend({livechat_enable_viewer_mode:!1,livechat_peertube_video_original_url:void 0,livechat_peertube_video_uuid:void 0,livechat_external_auth_oidc_buttons:void 0,livechat_external_auth_reconnect_mode:void 0});let e=n.exports.getDefaultMUCNickname;e?Object.assign(n.exports,{getDefaultMUCNickname:function(...o){var i,s;return n.api.settings.get("livechat_enable_viewer_mode")?(s=(i=e.apply(this,o))!=null?i:b())!=null?s:p("Anonymous"):e.apply(this,o)}}):console.error("[livechatViewerModePlugin] getDefaultMUCNickname is not initialized.");function t(o){console.log("[livechatViewerModePlugin] refreshViewerMode: "+(o?"off":"on")),o===null?document.body.removeAttribute("livechat-viewer-mode"):o?document.body.setAttribute("livechat-viewer-mode","off"):document.body.setAttribute("livechat-viewer-mode","on")}n.api.listen.on("livechatViewerModeSetNickname",()=>t(!0)),n.ChatRoomOccupants.prototype.on("change:nick",(o,i)=>{var s;try{if(!n.api.settings.get("livechat_enable_viewer_mode")){t(null);return}i&&((s=o==null?void 0:o.attributes)==null?void 0:s.is_me)===!0&&(console.log("Nickname change, storing to previousAnonymousNick"),z(i),t(!!i&&!/^Anonymous /.test(i)))}catch(a){console.error("Error on nick change handling...",a)}}),n.api.listen.on("chatRoomInitialized",function(o){var s;if(!n.api.settings.get("livechat_enable_viewer_mode")){t(null);return}let i=(s=b())!=null?s:o!=null&&o.get?o.get("nick"):"";t(!!i&&!/^Anonymous /.test(i))})}};var ne={dependencies:["converse-muc","converse-muc-views"],initialize:function(){let n=this._converse;n.api.settings.extend({livechat_mini_muc_head:!1}),n.api.listen.on("getHeadingButtons",(t,o)=>(t.model.get("type")!==n.constants.CHATROOMS_TYPE||(o=o.filter(i=>i.name!=="toggle-topic")),o));let e=()=>{console.log("[peertube-plugin-livechat] Removing class peertube-plugin-livechat-buttons-cloned"),document.querySelectorAll(".peertube-plugin-livechat-buttons-cloned").forEach(t=>t.classList.remove("peertube-plugin-livechat-buttons-cloned"))};n.api.listen.on("disconnected",e),n.api.listen.on("chatBoxClosed",e)}};var te={dependencies:["converse-emoji"],initialize:function(){let n=this._converse;n.api.settings.extend({livechat_custom_emojis_url:!1}),n.api.listen.on("loadEmojis",async(e,t)=>{let o=n.api.settings.get("livechat_custom_emojis_url");if(!o)return t;let i;try{i=await fe(o)}catch(a){console.error(a)}if(!(i!=null&&i.length))return t;t=JSON.parse(JSON.stringify(t)),t.custom={};let s;for(let a of i){t.custom[a.sn]={sn:a.sn,url:a.url,c:"custom"},a.isCategoryEmoji&&(s!=null||(s=a));for(let r of Object.keys(t)){let c=t[r];r!=="custom"&&r!=="modifiers"&&a.sn in c&&delete c[a.sn]}}if(s!=null||(s=i[0]),s){let a=n.api.settings.get("emoji_categories");a.custom=s.sn,n.api.settings.set("emoji_categories",a)}return t})}};async function fe(n){let e=await fetch(n,{method:"GET",headers:{"content-type":"application/json;charset=UTF-8"}});if(!e.ok)throw new Error("Can't get channel emojis options.");return(await e.json()).customEmojis}var ge="moderation-delay",oe,ie={dependencies:["converse-muc","converse-muc-views"],async initialize(){let n=this._converse;n.api.listen.on("parseMUCMessage",(t,o)=>{var s,a;let i=(a=(s=window.converse.env.sizzle(ge,t))==null?void 0:s[0])==null?void 0:a.getAttribute("waiting");return i?Object.assign(o,{moderation_delay_waiting:i}):o});let e=n.api.elements.registry["converse-chat-message"];if(e){class t extends e{getDerivedMessageProps(){let i=super.getDerivedMessageProps(),s=this.model.get("moderation_delay_waiting");if(!s)return i;let a=s-Date.now()/1e3;return a<0||(i.pretty_time=window.converse.env.html(oe||(oe=g(["\n            ",'<span aria-hidden="true">&nbsp;-&nbsp;',"\u23F1</span>\n          "])),i.pretty_time,Math.round(a)),setTimeout(()=>this.requestUpdate(),1e3)),i}}n.api.elements.define("converse-chat-message",t)}else console.error("Cannot find converse-chat-message custom elements, moderation delay will not be properly shown.")},overrides:{ChatRoom:{getUpdatedMessageAttributes:function(e,t){let o=this.__super__.getUpdatedMessageAttributes(e,t);return t.moderation_delay_waiting&&Object.assign(o,{moderation_delay_waiting:t.moderation_delay_waiting}),o}}}};var ae={dependencies:["converse-muc","converse-muc-views"],initialize:function(){let n=this._converse,e={announcementType:void 0};pe(n,e),n.api.listen.on("getToolbarButtons",he.bind(this)),n.api.listen.on("chatRoomInitialized",t=>_e(n,t)),n.api.listen.on("getOutgoingMessageAttributes",(t,o)=>ve(e,n,t,o)),n.api.listen.on("createMessageStanza",ye),n.api.listen.on("parseMUCMessage",we),be(n)}};function pe(n,e){let t=n.api.elements.registry["converse-muc-message-form"];if(t){class o extends t{async onFormSubmitted(s){var r,c;let a=this.querySelector("[name=livechat-announcements]");e.announcementType=((c=(r=a==null?void 0:a.selectedOptions)==null?void 0:r[0])==null?void 0:c.value)||void 0;try{await super.onFormSubmitted(s),a&&(a.selectedIndex=0)}catch(u){console.log(u)}e.announcementType=void 0}insertIntoTextArea(...s){super.insertIntoTextArea(...s);try{let a=this.querySelector(".chat-textarea");if(!a)return;let r=window.converse.env.u.hasClass("correcting",a),c=this.querySelector(".livechat-announcements-form"),u=this.querySelector("[name=livechat-announcements]");r?(u&&(u.selectedIndex=0),c&&(c.style.display="none")):c&&(c.style.display="block")}catch(a){console.error(a)}}}n.api.elements.define("converse-muc-message-form",o)}}var se;function he(n,e){let t=this._converse,o=n.model;if(!n.is_groupchat)return e;let i=o.getOwnOccupant();if(!i||!["admin","owner"].includes(i.get("affiliation")))return e;let{__:s}=t,{html:a}=window.converse.env,r=s("Message type"),c=s("Standard"),u=s("Announcement"),m=s("Highlight"),l=s("Warning"),d=a(se||(se=g(['<span class="livechat-announcements-form form-inline">\n    <label for="livechat-announcements-select">','</label>\n    <select\n      name="livechat-announcements"\n      id="livechat-announcements-select"\n      class="form-control form-control-sm"\n      title=','\n    >\n      <option value="">','</option>\n      <option value="highlight">','</option>\n      <option value="announcement">','</option>\n      <option value="warning">',"</option>\n    </select>\n  </span>"])),r,r,c,m,u,l);return t.api.settings.get("visible_toolbar_buttons").emoji?e=[e.shift(),d,...e]:e.unshift(d),e}function _e(n,e){e.occupants.on("change:affiliation",t=>{t.get("jid")===n.bare_jid&&document.querySelectorAll("converse-chat-toolbar").forEach(o=>{var i;return(i=o.requestUpdate)==null?void 0:i.call(o)})})}function ve(n,e,t,o){if(!n.announcementType)return o;let{__:i}=e;return o.livechat_announcement_type=n.announcementType,n.announcementType==="announcement"?o.body="* "+i("Announcement")+" * \n"+o.body:n.announcementType==="warning"&&(o.body="* "+i("Warning")+" *\n"+o.body),o}async function ye(n,e){var s;let{message:t,stanza:o}=e,i=t.get("livechat_announcement_type");return i&&((s=o.tree().querySelector("message body"))==null||s.setAttribute("x-livechat-announcement-type",i)),e}function we(n,e){var s;let{sizzle:t}=window.converse.env,o=(s=t("message body",n))==null?void 0:s[0];if(!o)return e;let i=o.getAttribute("x-livechat-announcement-type");return i&&(e.livechat_announcement_type=i),e}function be(n){let e=n.api.elements.registry["converse-chat-message"];if(e){class t extends e{getExtraMessageClasses(){var a;let i=(a=super.getExtraMessageClasses())!=null?a:"",s=this.model.get("livechat_announcement_type");return s&&["announcement","highlight","warning"].includes(s)&&(i+=" livechat-"+s),i}}n.api.elements.define("converse-chat-message",t)}}function Me(n){let e=window.converse;n||e.plugins.add("livechatWindowTitlePlugin",L),e.plugins.add("converse-slow-mode",D),e.plugins.add("livechatSpecifics",Z),e.plugins.add("livechatEmojis",te),n&&e.plugins.add("livechatMiniMucHeadPlugin",ne),e.plugins.add("livechatViewerModePlugin",ee),e.plugins.add("converse-moderation-delay",ie),e.plugins.add("livechatAnnouncementsPlugin",ae)}window.initConversePlugins=Me;async function Se(n,e="chat-only",t){var A,P,C;(A=n.localWebsocketServiceUrl)!=null&&A.startsWith("/")&&(n.localWebsocketServiceUrl=new URL(n.localWebsocketServiceUrl,(window.location.protocol==="http:"?"ws://":"wss://")+window.location.host).toString());let{isRemoteChat:o,remoteAnonymousXMPPServer:i,remoteAuthenticatedXMPPServer:s,authenticationUrl:a,autoViewerMode:r,forceReadonly:c}=n,u=window.converse,m=x();E(n,m),n.autofocus=e==="peertube-fullpage"||e==="chat-only"&&!m,n.forceDefaultHideMucParticipants=m||e==="peertube-video";let l=T(n);l.view_mode=e==="chat-only"?"fullscreen":"embedded",l.allow_url_history_change=e==="chat-only";let d=!1,h=!1,M=!1,_=((C=(P=n.externalAuthOIDC)==null?void 0:P.length)!=null?C:0)>0,f,S=!1;if(e==="chat-only"&&(f=U(),f&&(S=!0)),f!=null||(f=await R(a,_,t)),f?o?s?(j(n,f,l),d=!0,h=f.type!=="peertube"):i?(y(n,f,l),M=!0):(console.error("Remote server does not allow remote connection"),l.jid=null):(N(n,f,l),d=!0,h=f.type!=="peertube"):o?i?y(n,null,l):(console.error("Remote server does not allow remote connection"),l.jid=null):O(n,l),l.jid===null)if(e==="chat-only"){console.error("Seems that anonymous users are not allowed on the target server"),document.body.innerHTML="<h1>This chatroom does not exist, or is not accessible to you.</h1>";return}else throw new Error("Can't connect, no JID");if(d||(console.log("User is not authenticated."),c&&(l.nickname=p("Viewer"))),l.livechat_enable_viewer_mode=r&&!d&&!M,l.livechat_specific_external_authent=h,l.livechat_specific_is_anonymous=!d,_&&!d&&(l.livechat_external_auth_oidc_buttons=n.externalAuthOIDC),_)switch(e){case"peertube-video":l.livechat_external_auth_reconnect_mode="button-close-open";break;case"peertube-fullpage":case"chat-only":default:l.livechat_external_auth_reconnect_mode="reload"}e==="peertube-video"&&(l.livechat_mini_muc_head=!0);let v=!1;(e==="peertube-video"||e==="peertube-fullpage"||e==="chat-only"&&S&&!n.transparent&&!n.forceReadonly)&&(v=!0),v&&(l.livechat_task_app_enabled=!0,l.livechat_task_app_restore=e==="peertube-fullpage"||e==="chat-only",l.livechat_note_app_enabled=!0,l.livechat_note_app_restore=e==="peertube-fullpage"||e==="chat-only",l.livechat_mam_search_app_enabled=!0);try{window.reconnectConverse?window.reconnectConverse(l):u.initialize(l)}catch(re){console.error("Failed initializing converseJS",re)}}window.initConverse=Se;})();
