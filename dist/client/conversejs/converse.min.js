/*! For license information please see converse.min.js.LICENSE.txt */
(()=>{var e,t,s,n,i={169:(e,t,s)=>{var n;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(e){return function(e,t){var s,n,o,a,c,l,d,u,h,m=1,f=e.length,g="";for(n=0;n<f;n++)if("string"==typeof e[n])g+=e[n];else if("object"==typeof e[n]){if((a=e[n]).keys)for(s=t[m],o=0;o<a.keys.length;o++){if(null==s)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));s=s[a.keys[o]]}else s=a.param_no?t[a.param_no]:t[m++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&s instanceof Function&&(s=s()),i.numeric_arg.test(a.type)&&"number"!=typeof s&&isNaN(s))throw new TypeError(r("[sprintf] expecting number but found %T",s));switch(i.number.test(a.type)&&(u=s>=0),a.type){case"b":s=parseInt(s,10).toString(2);break;case"c":s=String.fromCharCode(parseInt(s,10));break;case"d":case"i":s=parseInt(s,10);break;case"j":s=JSON.stringify(s,null,a.width?parseInt(a.width):0);break;case"e":s=a.precision?parseFloat(s).toExponential(a.precision):parseFloat(s).toExponential();break;case"f":s=a.precision?parseFloat(s).toFixed(a.precision):parseFloat(s);break;case"g":s=a.precision?String(Number(s.toPrecision(a.precision))):parseFloat(s);break;case"o":s=(parseInt(s,10)>>>0).toString(8);break;case"s":s=String(s),s=a.precision?s.substring(0,a.precision):s;break;case"t":s=String(!!s),s=a.precision?s.substring(0,a.precision):s;break;case"T":s=Object.prototype.toString.call(s).slice(8,-1).toLowerCase(),s=a.precision?s.substring(0,a.precision):s;break;case"u":s=parseInt(s,10)>>>0;break;case"v":s=s.valueOf(),s=a.precision?s.substring(0,a.precision):s;break;case"x":s=(parseInt(s,10)>>>0).toString(16);break;case"X":s=(parseInt(s,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?g+=s:(!i.number.test(a.type)||u&&!a.sign?h="":(h=u?"+":"-",s=s.toString().replace(i.sign,"")),l=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",d=a.width-(h+s).length,c=a.width&&d>0?l.repeat(d):"",g+=a.align?h+s+c:"0"===l?h+c+s:c+h+s)}return g}(function(e){if(a[e])return a[e];var t,s=e,n=[],r=0;for(;s;){if(null!==(t=i.text.exec(s)))n.push(t[0]);else if(null!==(t=i.modulo.exec(s)))n.push("%");else{if(null===(t=i.placeholder.exec(s)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){r|=1;var o=[],c=t[2],l=[];if(null===(l=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(l[1]);""!==(c=c.substring(l[0].length));)if(null!==(l=i.key_access.exec(c)))o.push(l[1]);else{if(null===(l=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(l[1])}t[2]=o}else r|=2;if(3===r)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}s=s.substring(t[0].length)}return a[e]=n}(e),arguments)}function o(e,t){return r.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=r,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=r,window.vsprintf=o,void 0===(n=function(){return{sprintf:r,vsprintf:o}}.call(t,s,t,e))||(e.exports=n))}()},4335:function(e,t,s){var n,i;!function(r,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(n=o)?n.call(t,s,t,e):n)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,s,n=e.toLowerCase().split(":"),i=n.length,r=8;for(""===n[0]&&""===n[1]&&""===n[2]?(n.shift(),n.shift()):""===n[0]&&""===n[1]?n.shift():""===n[i-1]&&""===n[i-2]&&n.pop(),-1!==n[(i=n.length)-1].indexOf(".")&&(r=7),t=0;t<i&&""!==n[t];t++);if(t<r)for(n.splice(t,1,"0000");n.length<r;)n.splice(t,0,"0000");for(var o=0;o<r;o++){s=n[o].split("");for(var a=0;a<3&&("0"===s[0]&&s.length>1);a++)s.splice(0,1);n[o]=s.join("")}var c=-1,l=0,d=0,u=-1,h=!1;for(o=0;o<r;o++)h?"0"===n[o]?d+=1:(h=!1,d>l&&(c=u,l=d)):"0"===n[o]&&(h=!0,u=o,d=1);d>l&&(c=u,l=d),l>1&&n.splice(c,l,""),i=n.length;var m="";for(""===n[0]&&(m=":"),o=0;o<i&&(m+=n[o],o!==i-1);o++)m+=":";return""===n[i-1]&&(m+=":"),m},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},4817:function(e,t,s){var n,i;!function(r,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(n=o)?n.call(t,s,t,e):n)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,s={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return!1;var i=s.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(n+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var n=s.list[e.slice(t+1)];return!!n&&n.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return null;var i=s.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(n+1,t)+" ")<0?null:e.slice(n+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return s}))},9542:function(e,t,s){var n,i,r;!function(o,a){"use strict";e.exports?e.exports=a(s(5413),s(4335),s(4817)):(i=[s(5413),s(4335),s(4817)],void 0===(r="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=r))}(0,(function(e,t,s,n){"use strict";var i=n&&n.URI;function r(e,t){var s=arguments.length>=1;if(!(this instanceof r))return s?arguments.length>=2?new r(e,t):new r(e):new r;if(void 0===e){if(s)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&s)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}r.version="1.19.11";var o=r.prototype,a=Object.prototype.hasOwnProperty;function c(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function l(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function d(e){return"Array"===l(e)}function u(e,t){var s,n,i={};if("RegExp"===l(t))i=null;else if(d(t))for(s=0,n=t.length;s<n;s++)i[t[s]]=!0;else i[t]=!0;for(s=0,n=e.length;s<n;s++){(i&&void 0!==i[e[s]]||!i&&t.test(e[s]))&&(e.splice(s,1),n--,s--)}return e}function h(e,t){var s,n;if(d(t)){for(s=0,n=t.length;s<n;s++)if(!h(e,t[s]))return!1;return!0}var i=l(t);for(s=0,n=e.length;s<n;s++)if("RegExp"===i){if("string"==typeof e[s]&&e[s].match(t))return!0}else if(e[s]===t)return!0;return!1}function m(e,t){if(!d(e)||!d(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var s=0,n=e.length;s<n;s++)if(e[s]!==t[s])return!1;return!0}function f(e){return e.replace(/^\/+|\/+$/g,"")}function g(e){return escape(e)}function p(e){return encodeURIComponent(e).replace(/[!'()*]/g,g).replace(/\*/g,"%2A")}r._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:r.preventInvalidHostname,duplicateQueryParameters:r.duplicateQueryParameters,escapeQuerySpace:r.escapeQuerySpace}},r.preventInvalidHostname=!1,r.duplicateQueryParameters=!1,r.escapeQuerySpace=!0,r.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,r.idn_expression=/[^a-z0-9\._-]/i,r.punycode_expression=/(xn--)/i,r.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,r.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,r.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},r.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,r.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},r.hostProtocols=["http","https"],r.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,r.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},r.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return r.domAttributes[t]}},r.encode=p,r.decode=decodeURIComponent,r.iso8859=function(){r.encode=escape,r.decode=unescape},r.unicode=function(){r.encode=p,r.decode=decodeURIComponent},r.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},r.encodeQuery=function(e,t){var s=r.encode(e+"");return void 0===t&&(t=r.escapeQuerySpace),t?s.replace(/%20/g,"+"):s},r.decodeQuery=function(e,t){e+="",void 0===t&&(t=r.escapeQuerySpace);try{return r.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var v,_={encode:"encode",decode:"decode"},b=function(e,t){return function(s){try{return r[t](s+"").replace(r.characters[e][t].expression,(function(s){return r.characters[e][t].map[s]}))}catch(e){return s}}};for(v in _)r[v+"PathSegment"]=b("pathname",_[v]),r[v+"UrnPathSegment"]=b("urnpath",_[v]);var y=function(e,t,s){return function(n){var i;i=s?function(e){return r[t](r[s](e))}:r[t];for(var o=(n+"").split(e),a=0,c=o.length;a<c;a++)o[a]=i(o[a]);return o.join(e)}};function w(e){return function(t,s){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!s),this)}}function A(e,t){return function(s,n){return void 0===s?this._parts[e]||"":(null!==s&&(s+="").charAt(0)===t&&(s=s.substring(1)),this._parts[e]=s,this.build(!n),this)}}r.decodePath=y("/","decodePathSegment"),r.decodeUrnPath=y(":","decodeUrnPathSegment"),r.recodePath=y("/","encodePathSegment","decode"),r.recodeUrnPath=y(":","encodeUrnPathSegment","decode"),r.encodeReserved=b("reserved","encode"),r.parse=function(e,t){var s;return t||(t={preventInvalidHostname:r.preventInvalidHostname}),(s=(e=(e=e.replace(r.leading_whitespace_expression,"")).replace(r.ascii_tab_whitespace,"")).indexOf("#"))>-1&&(t.fragment=e.substring(s+1)||null,e=e.substring(0,s)),(s=e.indexOf("?"))>-1&&(t.query=e.substring(s+1)||null,e=e.substring(0,s)),"//"===(e=(e=e.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://")).replace(/^[/\\]{2,}/i,"//")).substring(0,2)?(t.protocol=null,e=e.substring(2),e=r.parseAuthority(e,t)):(s=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,s)||null,t.protocol&&!t.protocol.match(r.protocol_expression)?t.protocol=void 0:"//"===e.substring(s+1,s+3).replace(/\\/g,"/")?(e=e.substring(s+3),e=r.parseAuthority(e,t)):(e=e.substring(s+1),t.urn=!0)),t.path=e,t},r.parseHost=function(e,t){e||(e="");var s,n,i=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===i&&(i=e.length),"["===e.charAt(0))s=e.indexOf("]"),t.hostname=e.substring(1,s)||null,t.port=e.substring(s+2,i)||null,"/"===t.port&&(t.port=null);else{var o=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",o+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,i)||null,t.port=null):(n=e.substring(0,i).split(":"),t.hostname=n[0]||null,t.port=n[1]||null)}return t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),t.preventInvalidHostname&&r.ensureValidHostname(t.hostname,t.protocol),t.port&&r.ensureValidPort(t.port),e.substring(i)||"/"},r.parseAuthority=function(e,t){return e=r.parseUserinfo(e,t),r.parseHost(e,t)},r.parseUserinfo=function(e,t){var s=e;-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/"));var n,i=e.indexOf("/"),o=e.lastIndexOf("@",i>-1?i:e.length-1);return o>-1&&(-1===i||o<i)?(n=e.substring(0,o).split(":"),t.username=n[0]?r.decode(n[0]):null,n.shift(),t.password=n[0]?r.decode(n.join(":")):null,e=s.substring(o+1)):(t.username=null,t.password=null),e},r.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var s,n,i,o={},c=e.split("&"),l=c.length,d=0;d<l;d++)s=c[d].split("="),n=r.decodeQuery(s.shift(),t),i=s.length?r.decodeQuery(s.join("="),t):null,"__proto__"!==n&&(a.call(o,n)?("string"!=typeof o[n]&&null!==o[n]||(o[n]=[o[n]]),o[n].push(i)):o[n]=i);return o},r.build=function(e){var t="",s=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",s=!0),t+=r.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&s&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},r.buildHost=function(e){var t="";return e.hostname?(r.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},r.buildAuthority=function(e){return r.buildUserinfo(e)+r.buildHost(e)},r.buildUserinfo=function(e){var t="";return e.username&&(t+=r.encode(e.username)),e.password&&(t+=":"+r.encode(e.password)),t&&(t+="@"),t},r.buildQuery=function(e,t,s){var n,i,o,c,l="";for(i in e)if("__proto__"!==i&&a.call(e,i))if(d(e[i]))for(n={},o=0,c=e[i].length;o<c;o++)void 0!==e[i][o]&&void 0===n[e[i][o]+""]&&(l+="&"+r.buildQueryParameter(i,e[i][o],s),!0!==t&&(n[e[i][o]+""]=!0));else void 0!==e[i]&&(l+="&"+r.buildQueryParameter(i,e[i],s));return l.substring(1)},r.buildQueryParameter=function(e,t,s){return r.encodeQuery(e,s)+(null!==t?"="+r.encodeQuery(t,s):"")},r.addQuery=function(e,t,s){if("object"==typeof t)for(var n in t)a.call(t,n)&&r.addQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=s);"string"==typeof e[t]&&(e[t]=[e[t]]),d(s)||(s=[s]),e[t]=(e[t]||[]).concat(s)}},r.setQuery=function(e,t,s){if("object"==typeof t)for(var n in t)a.call(t,n)&&r.setQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===s?null:s}},r.removeQuery=function(e,t,s){var n,i,o;if(d(t))for(n=0,i=t.length;n<i;n++)e[t[n]]=void 0;else if("RegExp"===l(t))for(o in e)t.test(o)&&(e[o]=void 0);else if("object"==typeof t)for(o in t)a.call(t,o)&&r.removeQuery(e,o,t[o]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==s?"RegExp"===l(s)?!d(e[t])&&s.test(e[t])?e[t]=void 0:e[t]=u(e[t],s):e[t]!==String(s)||d(s)&&1!==s.length?d(e[t])&&(e[t]=u(e[t],s)):e[t]=void 0:e[t]=void 0}},r.hasQuery=function(e,t,s,n){switch(l(t)){case"String":break;case"RegExp":for(var i in e)if(a.call(e,i)&&t.test(i)&&(void 0===s||r.hasQuery(e,i,s)))return!0;return!1;case"Object":for(var o in t)if(a.call(t,o)&&!r.hasQuery(e,o,t[o]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(l(s)){case"Undefined":return t in e;case"Boolean":return s===Boolean(d(e[t])?e[t].length:e[t]);case"Function":return!!s(e[t],t,e);case"Array":return!!d(e[t])&&(n?h:m)(e[t],s);case"RegExp":return d(e[t])?!!n&&h(e[t],s):Boolean(e[t]&&e[t].match(s));case"Number":s=String(s);case"String":return d(e[t])?!!n&&h(e[t],s):e[t]===s;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},r.joinPaths=function(){for(var e=[],t=[],s=0,n=0;n<arguments.length;n++){var i=new r(arguments[n]);e.push(i);for(var o=i.segment(),a=0;a<o.length;a++)"string"==typeof o[a]&&t.push(o[a]),o[a]&&s++}if(!t.length||!s)return new r("");var c=new r("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},r.commonPath=function(e,t){var s,n=Math.min(e.length,t.length);for(s=0;s<n;s++)if(e.charAt(s)!==t.charAt(s)){s--;break}return s<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(s)&&"/"===t.charAt(s)||(s=e.substring(0,s).lastIndexOf("/")),e.substring(0,s+1))},r.withinString=function(e,t,s){s||(s={});var n=s.start||r.findUri.start,i=s.end||r.findUri.end,o=s.trim||r.findUri.trim,a=s.parens||r.findUri.parens,c=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var l=n.exec(e);if(!l)break;var d=l.index;if(s.ignoreHtml){var u=e.slice(Math.max(d-3,0),d);if(u&&c.test(u))continue}for(var h=d+e.slice(d).search(i),m=e.slice(d,h),f=-1;;){var g=a.exec(m);if(!g)break;var p=g.index+g[0].length;f=Math.max(f,p)}if(!((m=f>-1?m.slice(0,f)+m.slice(f).replace(o,""):m.replace(o,"")).length<=l[0].length||s.ignore&&s.ignore.test(m))){var v=t(m,d,h=d+m.length,e);void 0!==v?(v=String(v),e=e.slice(0,d)+v+e.slice(h),n.lastIndex=d+v.length):n.lastIndex=h}}return n.lastIndex=0,e},r.ensureValidHostname=function(t,s){var n=!!t,i=!1;if(!!s&&(i=h(r.hostProtocols,s)),i&&!n)throw new TypeError("Hostname cannot be empty, if protocol is "+s);if(t&&t.match(r.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(r.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},r.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},r.noConflict=function(e){if(e){var t={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(t.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(t.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=n.SecondLevelDomains.noConflict()),t}return n.URI===this&&(n.URI=i),this},o.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=r.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new r(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},o.protocol=w("protocol"),o.username=w("username"),o.password=w("password"),o.hostname=w("hostname"),o.port=w("port"),o.query=A("query","?"),o.fragment=A("fragment","#"),o.search=function(e,t){var s=this.query(e,t);return"string"==typeof s&&s.length?"?"+s:s},o.hash=function(e,t){var s=this.fragment(e,t);return"string"==typeof s&&s.length?"#"+s:s},o.pathname=function(e,t){if(void 0===e||!0===e){var s=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?r.decodeUrnPath:r.decodePath)(s):s}return this._parts.urn?this._parts.path=e?r.recodeUrnPath(e):"":this._parts.path=e?r.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var s;if(void 0===e)return this.toString();this._string="",this._parts=r._parts();var n=e instanceof r,i="object"==typeof e&&(e.hostname||e.path||e.pathname);e.nodeName&&(e=e[r.getDomAttribute(e)]||"",i=!1);if(!n&&i&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=r.parse(String(e),this._parts);else{if(!n&&!i)throw new TypeError("invalid input");var o=n?e._parts:e;for(s in o)"query"!==s&&a.call(this._parts,s)&&(this._parts[s]=o[s]);o.query&&this.query(o.query,!1)}return this.build(!t),this},o.is=function(e){var t=!1,n=!1,i=!1,o=!1,a=!1,c=!1,l=!1,d=!this._parts.urn;switch(this._parts.hostname&&(d=!1,n=r.ip4_expression.test(this._parts.hostname),i=r.ip6_expression.test(this._parts.hostname),a=(o=!(t=n||i))&&s&&s.has(this._parts.hostname),c=o&&r.idn_expression.test(this._parts.hostname),l=o&&r.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return d;case"absolute":return!d;case"domain":case"name":return o;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return i;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return l}return null};var S=o.protocol,x=o.port,E=o.hostname;o.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(r.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return S.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),r.ensureValidPort(e))),x.call(this,e,t))},o.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var s={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==r.parseHost(e,s))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=s.hostname,this._parts.preventInvalidHostname&&r.ensureValidHostname(e,this._parts.protocol)}return E.call(this,e,t)},o.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var s=this.protocol();return this.authority()?(s?s+"://":"")+this.authority():""}var n=r(e);return this.protocol(n.protocol()).authority(n.authority()).build(!t),this},o.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildHost(this._parts):"";if("/"!==r.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildAuthority(this._parts):"";if("/"!==r.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var s=r.buildUserinfo(this._parts);return s?s.substring(0,s.length-1):s}return"@"!==e[e.length-1]&&(e+="@"),r.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var s;return void 0===e?this.path()+this.search()+this.hash():(s=r.parse(e),this._parts.path=s.path,this._parts.query=s.query,this._parts.fragment=s.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var s=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,s)||""}var n=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,n),o=new RegExp("^"+c(i));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&r.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var s=this._parts.hostname.match(/\./g);if(s&&s.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(t).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(r.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(n+1);return!0!==t&&s&&s.list[i.toLowerCase()]&&s.get(this._parts.hostname)||i}var r;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!s||!s.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');r=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");r=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var s=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,s)||(this._parts.hostname?"/":"");return e?r.decodePath(n):n}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),a=new RegExp("^"+c(o));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var s=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(s+1);return e?r.decodePathSegment(n):n}var i=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var o=new RegExp(c(this.filename())+"$");return e=r.recodePath(e),this._parts.path=this._parts.path.replace(o,e),i?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var s,n,i=this.filename(),o=i.lastIndexOf(".");return-1===o?"":(s=i.substring(o+1),n=/^[a-z0-9%]+$/i.test(s)?s:"",e?r.decodePathSegment(n):n)}"."===e.charAt(0)&&(e=e.substring(1));var a,l=this.suffix();if(l)a=e?new RegExp(c(l)+"$"):new RegExp(c("."+l)+"$");else{if(!e)return this;this._parts.path+="."+r.recodePath(e)}return a&&(e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},o.segment=function(e,t,s){var n=this._parts.urn?":":"/",i=this.path(),r="/"===i.substring(0,1),o=i.split(n);if(void 0!==e&&"number"!=typeof e&&(s=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(r&&o.shift(),e<0&&(e=Math.max(o.length+e,0)),void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e])if(d(t)){o=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||o.length&&o[o.length-1].length)&&(o.length&&!o[o.length-1].length&&o.pop(),o.push(f(t[a])))}else(t||"string"==typeof t)&&(t=f(t),""===o[o.length-1]?o[o.length-1]=t:o.push(t));else t?o[e]=f(t):o.splice(e,1);return r&&o.unshift(""),this.path(o.join(n),s)},o.segmentCoded=function(e,t,s){var n,i,o;if("number"!=typeof e&&(s=t,t=e,e=void 0),void 0===t){if(d(n=this.segment(e,t,s)))for(i=0,o=n.length;i<o;i++)n[i]=r.decode(n[i]);else n=void 0!==n?r.decode(n):void 0;return n}if(d(t))for(i=0,o=t.length;i<o;i++)t[i]=r.encode(t[i]);else t="string"==typeof t||t instanceof String?r.encode(t):t;return this.segment(e,t,s)};var $=o.query;return o.query=function(e,t){if(!0===e)return r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var s=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=e.call(this,s);return this._parts.query=r.buildQuery(n||s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=r.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):$.call(this,e,t)},o.setQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)n[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)a.call(e,i)&&(n[i]=e[i])}return this._parts.query=r.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(s=t),this.build(!s),this},o.addQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.addQuery(n,e,void 0===t?null:t),this._parts.query=r.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(s=t),this.build(!s),this},o.removeQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.removeQuery(n,e,t),this._parts.query=r.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(s=t),this.build(!s),this},o.hasQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.hasQuery(n,e,t,s)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(s){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!s)),this},o.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===r.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){var t,s=this._parts.path;if(!s)return this;if(this._parts.urn)return this._parts.path=r.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var n,i,o="";for("/"!==(s=r.recodePath(s)).charAt(0)&&(t=!0,s="/"+s),"/.."!==s.slice(-3)&&"/."!==s.slice(-2)||(s+="/"),s=s.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(o=s.substring(1).match(/^(\.\.\/)+/)||"")&&(o=o[0]);-1!==(n=s.search(/\/\.\.(\/|$)/));)0!==n?(-1===(i=s.substring(0,n).lastIndexOf("/"))&&(i=n),s=s.substring(0,i)+s.substring(n+3)):s=s.substring(3);return t&&this.is("relative")&&(s=o+s.substring(1)),this._parts.path=s,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(r.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=r.encode,t=r.decode;r.encode=escape,r.decode=decodeURIComponent;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},o.unicode=function(){var e=r.encode,t=r.decode;r.encode=p,r.decode=unescape;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var s="";if(t._parts.protocol&&(s+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(s+=e.toUnicode(t._parts.hostname),t._parts.port&&(s+=":"+t._parts.port)):s+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(s+="/"),s+=t.path(!0),t._parts.query){for(var n="",i=0,o=t._parts.query.split("&"),a=o.length;i<a;i++){var c=(o[i]||"").split("=");n+="&"+r.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(n+="="+r.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}s+="?"+n.substring(1)}return s+=r.decodeQuery(t.hash(),!0)},o.absoluteTo=function(e){var t,s,n,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof r||(e=new r(e)),i._parts.protocol)return i;if(i._parts.protocol=e._parts.protocol,this._parts.hostname)return i;for(s=0;n=o[s];s++)i._parts[n]=e._parts[n];return i._parts.path?(".."===i._parts.path.substring(-2)&&(i._parts.path+="/"),"/"!==i.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),i._parts.path=(t?t+"/":"")+i._parts.path,i.normalizePath())):(i._parts.path=e._parts.path,i._parts.query||(i._parts.query=e._parts.query)),i.build(),i},o.relativeTo=function(e){var t,s,n,i,o,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new r(e).normalize(),t=a._parts,s=e._parts,i=a.path(),o=e.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==o.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===s.protocol&&(t.protocol=null),t.username!==s.username||t.password!==s.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==s.hostname||t.port!==s.port)return a.build();if(t.hostname=null,t.port=null,i===o)return t.path="",a.build();if(!(n=r.commonPath(i,o)))return a.build();var c=s.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(n.length)||"./",a.build()},o.equals=function(e){var t,s,n,i,o,c=this.clone(),l=new r(e),u={};if(c.normalize(),l.normalize(),c.toString()===l.toString())return!0;if(n=c.query(),i=l.query(),c.query(""),l.query(""),c.toString()!==l.toString())return!1;if(n.length!==i.length)return!1;for(o in t=r.parseQuery(n,this._parts.escapeQuerySpace),s=r.parseQuery(i,this._parts.escapeQuerySpace),t)if(a.call(t,o)){if(d(t[o])){if(!m(t[o],s[o]))return!1}else if(t[o]!==s[o])return!1;u[o]=!0}for(o in s)if(a.call(s,o)&&!u[o])return!1;return!0},o.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},r}))},5413:function(e,t,s){var n;e=s.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof s.g&&s.g;r.global!==r&&r.window!==r&&r.self;var o,a=2147483647,c=36,l=1,d=26,u=38,h=700,m=72,f=128,g="-",p=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},y=c-l,w=Math.floor,A=String.fromCharCode;function S(e){throw new RangeError(b[e])}function x(e,t){for(var s=e.length,n=[];s--;)n[s]=t(e[s]);return n}function E(e,t){var s=e.split("@"),n="";return s.length>1&&(n=s[0]+"@",e=s[1]),n+x((e=e.replace(_,".")).split("."),t).join(".")}function $(e){for(var t,s,n=[],i=0,r=e.length;i<r;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<r?56320==(64512&(s=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&s)+65536):(n.push(t),i--):n.push(t);return n}function C(e){return x(e,(function(e){var t="";return e>65535&&(t+=A((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=A(e)})).join("")}function k(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,s){var n=0;for(e=s?w(e/h):e>>1,e+=w(e/t);e>y*d>>1;n+=c)e=w(e/y);return w(n+(y+1)*e/(e+u))}function j(e){var t,s,n,i,r,o,u,h,p,v,_,b=[],y=e.length,A=0,x=f,E=m;for((s=e.lastIndexOf(g))<0&&(s=0),n=0;n<s;++n)e.charCodeAt(n)>=128&&S("not-basic"),b.push(e.charCodeAt(n));for(i=s>0?s+1:0;i<y;){for(r=A,o=1,u=c;i>=y&&S("invalid-input"),((h=(_=e.charCodeAt(i++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:c)>=c||h>w((a-A)/o))&&S("overflow"),A+=h*o,!(h<(p=u<=E?l:u>=E+d?d:u-E));u+=c)o>w(a/(v=c-p))&&S("overflow"),o*=v;E=T(A-r,t=b.length+1,0==r),w(A/t)>a-x&&S("overflow"),x+=w(A/t),A%=t,b.splice(A++,0,x)}return C(b)}function N(e){var t,s,n,i,r,o,u,h,p,v,_,b,y,x,E,C=[];for(b=(e=$(e)).length,t=f,s=0,r=m,o=0;o<b;++o)(_=e[o])<128&&C.push(A(_));for(n=i=C.length,i&&C.push(g);n<b;){for(u=a,o=0;o<b;++o)(_=e[o])>=t&&_<u&&(u=_);for(u-t>w((a-s)/(y=n+1))&&S("overflow"),s+=(u-t)*y,t=u,o=0;o<b;++o)if((_=e[o])<t&&++s>a&&S("overflow"),_==t){for(h=s,p=c;!(h<(v=p<=r?l:p>=r+d?d:p-r));p+=c)E=h-v,x=c-v,C.push(A(k(v+E%x,0))),h=w(E/x);C.push(A(k(h,0))),r=T(s,y,n==i),s=0,++n}++s,++t}return C.join("")}o={version:"1.3.2",ucs2:{decode:$,encode:C},decode:j,encode:N,toASCII:function(e){return E(e,(function(e){return v.test(e)?"xn--"+N(e):e}))},toUnicode:function(e){return E(e,(function(e){return p.test(e)?j(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return o}.call(t,s,t,e))||(e.exports=n)}()},6820:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>qL});var n={};s.r(n),s.d(n,{DOMParser:()=>q,WebSocket:()=>B,getDummyXMLDOMDocument:()=>H});var i={};s.r(i),s.d(i,{addCookies:()=>re,arrayBufToBase64:()=>se,base64ToArrayBuf:()=>ne,copyElement:()=>ge,createHtml:()=>fe,default:()=>Ce,escapeNode:()=>we,forEachChild:()=>_e,getBareJidFromJid:()=>$e,getDomainFromJid:()=>xe,getNodeFromJid:()=>Se,getResourceFromJid:()=>Ee,getText:()=>ye,handleError:()=>Z,isTagEqual:()=>be,stringToArrayBuf:()=>ie,unescapeNode:()=>Ae,utf16to8:()=>ee,validAttribute:()=>he,validCSS:()=>me,validTag:()=>ue,xmlElement:()=>de,xmlGenerator:()=>ae,xmlHtmlNode:()=>le,xmlTextNode:()=>ce,xmlescape:()=>pe,xmlunescape:()=>ve,xorArrayBuffers:()=>te});var r={};s.r(r),s.d(r,{decodeHTMLEntities:()=>pt,isElement:()=>dt,isTagEqual:()=>ut,queryChildren:()=>mt,siblingIndex:()=>ft,stringToElement:()=>ht});var o={};s.r(o),s.d(o,{isError:()=>Bd,isFunction:()=>qd,merge:()=>Ud});var a={};s.r(a),s.d(a,{clearSession:()=>tu,getUnloadEvent:()=>Xd,isTestEnv:()=>Yd,isUniView:()=>Jd,replacePromise:()=>Kd,shouldClearCache:()=>Zd,tearDown:()=>eu});var c={};s.r(c),s.d(c,{ACTIVE:()=>gu,ANONYMOUS:()=>ru,BOSH_WAIT:()=>su,CHATROOMS_TYPE:()=>yu,CHAT_STATES:()=>$u,CLOSED:()=>ou,COMPOSING:()=>pu,CONNECTION_STATUS:()=>Su,CONTROLBOX_TYPE:()=>Au,CORE_PLUGINS:()=>xu,EXTERNAL:()=>au,FAILURE:()=>mu,GONE:()=>_u,HEADLINES_TYPE:()=>wu,INACTIVE:()=>fu,KEYCODES:()=>Cu,LOGIN:()=>cu,LOGOUT:()=>lu,OPENED:()=>du,PAUSED:()=>vu,PREBIND:()=>uu,PRIVATE_CHAT_TYPE:()=>bu,STATUS_WEIGHTS:()=>iu,SUCCESS:()=>hu,URL_PARSE_OPTIONS:()=>Eu,VERSION_NAME:()=>nu,XFORM_TYPE_MAP:()=>ku,XFORM_VALIDATE_TYPE_MAP:()=>Tu});var l={};s.r(l),s.d(l,{createStore:()=>qu,getDefaultStore:()=>Uu,initStorage:()=>Hu});var d={};s.r(d),s.d(d,{getJIDFromURI:()=>Yu,isSameBareJID:()=>Qu,isSameDomain:()=>Ju,isValidJID:()=>Wu,isValidMUCJID:()=>Vu});var u={};s.r(u),s.d(u,{getAttributes:()=>Dh,isErrorStanza:()=>Ih,isForbiddenError:()=>Mh,isServiceUnavailableError:()=>Rh});var h={};s.r(h),s.d(h,{colorize:()=>Bh});var m={};s.r(m),s.d(m,{getCurrentWord:()=>Vh,getSelectValues:()=>Gh,isMentionBoundary:()=>Qh,placeCaretAtEnd:()=>Yh,replaceCurrentWord:()=>Jh,webForm2xForm:()=>Wh});var f={};s.r(f),s.d(f,{appendArrayBuffer:()=>Xh,arrayBufferToBase64:()=>tm,arrayBufferToHex:()=>Kh,arrayBufferToString:()=>Zh,base64ToArrayBuffer:()=>sm,hexToArrayBuffer:()=>nm,stringToArrayBuffer:()=>em});var g={};s.r(g),s.d(g,{checkFileTypes:()=>am,filterQueryParamsFromURL:()=>cm,getMediaURLs:()=>pm,getMediaURLsMetadata:()=>gm,getURI:()=>om,isAudioURL:()=>um,isEncryptedFileURL:()=>fm,isGIFURL:()=>dm,isImageURL:()=>mm,isURLWithImageExtension:()=>lm,isValidURL:()=>rm,isVideoURL:()=>hm});var p={};s.r(p),s.d(p,{AFFILIATIONS:()=>cv,AFFILIATION_CHANGES:()=>dv,AFFILIATION_CHANGES_LIST:()=>uv,INFO_CODES:()=>pv,MUC_NICK_CHANGED_CODE:()=>bv,MUC_ROLE_CHANGES:()=>fv,MUC_ROLE_CHANGES_LIST:()=>gv,MUC_ROLE_WEIGHTS:()=>lv,MUC_TRAFFIC_STATES:()=>hv,MUC_TRAFFIC_STATES_LIST:()=>mv,ROLES:()=>av,ROOMSTATUS:()=>vv,ROOM_FEATURES:()=>_v});var v={};s.r(v),s.d(v,{afterMain:()=>Kw,afterRead:()=>Jw,afterWrite:()=>tA,applyStyles:()=>cA,arrow:()=>kA,auto:()=>Lw,basePlacements:()=>zw,beforeMain:()=>Yw,beforeRead:()=>Vw,beforeWrite:()=>Zw,bottom:()=>Mw,clippingParents:()=>Uw,computeStyles:()=>OA,createPopper:()=>cS,createPopperBase:()=>aS,createPopperLite:()=>lS,detectOverflow:()=>QA,end:()=>Fw,eventListeners:()=>MA,flip:()=>JA,hide:()=>KA,left:()=>Dw,main:()=>Xw,modifierPhases:()=>sA,offset:()=>ZA,placements:()=>Ww,popper:()=>qw,popperGenerator:()=>oS,popperOffsets:()=>eS,preventOverflow:()=>tS,read:()=>Qw,reference:()=>Hw,right:()=>Rw,start:()=>Pw,top:()=>Iw,variationPlacements:()=>Gw,viewport:()=>Bw,write:()=>eA});var _=s(5072),b=s.n(_),y=s(7825),w=s.n(y),A=s(7659),S=s.n(A),x=s(5056),E=s.n(x),$=s(540),C=s.n($),k=s(1113),T=s.n(k),j=s(6342),N={};N.styleTagTransform=T(),N.setAttributes=E(),N.insert=S().bind(null,"head"),N.domAPI=w(),N.insertStyleElement=C();b()(j.A,N);j.A&&j.A.locals&&j.A.locals;var O=s(1615),I=s.n(O),M=s(5569),R=s.n(M),D=s(9807),L=s.n(D),z=s(4360),P=s.n(z),F=s(8870),U=s.n(F);const B=window.WebSocket,q=window.DOMParser;function H(){return document.implementation.createDocument("jabber:client","strophe",null)}const G={HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},W={tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"]},V={ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12,RECONNECTING:13},Q={BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},J={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},Y={NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11};let X=J.DEBUG;const K={setLogLevel(e){if(e<J.DEBUG||e>J.FATAL)throw new Error("Invalid log level supplied to setLogLevel");X=e},log(e,t){e<X||(e>=J.ERROR?console?.error(t):e===J.INFO?console?.info(t):e===J.WARN?console?.warn(t):e===J.DEBUG&&console?.debug(t))},debug(e){this.log(J.DEBUG,e)},info(e){this.log(J.INFO,e)},warn(e){this.log(J.WARN,e)},error(e){this.log(J.ERROR,e)},fatal(e){this.log(J.FATAL,e)}};function Z(e){void 0!==e.stack&&K.fatal(e.stack),K.fatal("error: "+e.message)}function ee(e){let t="";const s=e.length;for(let n=0;n<s;n++){const s=e.charCodeAt(n);s>=0&&s<=127?t+=e.charAt(n):s>2047?(t+=String.fromCharCode(224|s>>12&15),t+=String.fromCharCode(128|s>>6&63),t+=String.fromCharCode(128|63&s)):(t+=String.fromCharCode(192|s>>6&31),t+=String.fromCharCode(128|63&s))}return t}function te(e,t){const s=new Uint8Array(e),n=new Uint8Array(t),i=new Uint8Array(e.byteLength);for(let t=0;t<e.byteLength;t++)i[t]=s[t]^n[t];return i.buffer}function se(e){let t="";const s=new Uint8Array(e),n=s.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(s[e]);return btoa(t)}function ne(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))?.buffer}function ie(e){return(new TextEncoder).encode(e).buffer}function re(e){"undefined"==typeof document&&K.error("addCookies: not adding any cookies, since there's no document object"),e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let s="",n="",i="";const r=e[t],o="object"==typeof r,a=escape(unescape(o?r.value:r));o&&(s=r.expires?";expires="+r.expires:"",n=r.domain?";domain="+r.domain:"",i=r.path?";path="+r.path:""),document.cookie=t+"="+a+s+n+i}}let oe=null;function ae(){return oe||(oe=H()),oe}function ce(e){return ae().createTextNode(e)}function le(e){return(new q).parseFromString(e,"text/xml")}function de(e,t,s){if(!e)return null;const n=ae().createElement(e);if(!s||"string"!=typeof s&&"number"!=typeof s){if("string"==typeof t||"number"==typeof t)return n.appendChild(ce(t.toString())),n}else n.appendChild(ce(s.toString()));if(!t)return n;if(Array.isArray(t))for(const e of t)Array.isArray(e)&&null!=e[0]&&null!=e[1]&&n.setAttribute(e[0],e[1]);else if("object"==typeof t)for(const e of Object.keys(t))e&&null!=t[e]&&n.setAttribute(e,t[e].toString());return n}function ue(e){for(let t=0;t<W.tags.length;t++)if(e===W.tags[t])return!0;return!1}function he(e,t){const s=W.attributes[e];if(s?.length>0)for(let e=0;e<s.length;e++)if(t===s[e])return!0;return!1}function me(e){for(let t=0;t<W.css.length;t++)if(e===W.css[t])return!0;return!1}function fe(e){if(e.nodeType===Y.NORMAL)return function(e){let t;const s=e.nodeName.toLowerCase();if(ue(s))try{if(t=de(s),s in W.attributes){const n=W.attributes[s];for(let s=0;s<n.length;s++){const i=n[s];let r=e.getAttribute(i);if(null!=r&&""!==r)if("style"===i&&"object"==typeof r&&(r=r.cssText??r),"style"===i){const e=[],s=r.split(";");for(let t=0;t<s.length;t++){const n=s[t].split(":"),i=n[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(me(i)){const t=n[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(r=e.join("; "),t.setAttribute(i,r))}else t.setAttribute(i,r)}for(let s=0;s<e.childNodes.length;s++)t.appendChild(fe(e.childNodes[s]))}}catch(e){t=ce("")}else{t=ae().createDocumentFragment();for(let s=0;s<e.childNodes.length;s++)t.appendChild(fe(e.childNodes[s]))}return t}(e);if(e.nodeType===Y.FRAGMENT){const t=ae().createDocumentFragment();for(let s=0;s<e.childNodes.length;s++)t.appendChild(fe(e.childNodes[s]));return t}return e.nodeType===Y.TEXT?ce(e.nodeValue):void 0}function ge(e){let t;if(e.nodeType===Y.NORMAL){const s=e;t=de(s.tagName);for(let e=0;e<s.attributes.length;e++)t.setAttribute(s.attributes[e].nodeName,s.attributes[e].value);for(let e=0;e<s.childNodes.length;e++)t.appendChild(ge(s.childNodes[e]))}else e.nodeType===Y.TEXT&&(t=ae().createTextNode(e.nodeValue));return t}function pe(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")}function ve(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')}function _e(e,t,s){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];i.nodeType!==Y.NORMAL||t&&!this.isTagEqual(i,t)||s(i)}}function be(e,t){return e.tagName===t}function ye(e){if(!e)return null;let t="";e.childNodes?.length||e.nodeType!==Y.TEXT||(t+=e.nodeValue);for(let s=0;s<e.childNodes?.length;s++)e.childNodes[s].nodeType===Y.TEXT&&(t+=e.childNodes[s].nodeValue);return pe(t)}function we(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function Ae(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}function Se(e){return e.indexOf("@")<0?null:e.split("@")[0]}function xe(e){const t=$e(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}}function Ee(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))}function $e(e){return e?e.split("/")[0]:null}const Ce={utf16to8:ee,xorArrayBuffers:te,arrayBufToBase64:se,base64ToArrayBuf:ne,stringToArrayBuf:ie,addCookies:re};function ke(e,t){return new Oe(e,t)}function Te(e){return new Oe("message",e)}function je(e){return new Oe("iq",e)}function Ne(e){return new Oe("presence",e)}class Oe{constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=G.CLIENT:t||(t={xmlns:G.CLIENT})),this.nodeTree=de(e,t),this.node=this.nodeTree}static serialize(e){if(!e)return null;const t=e instanceof Oe?e.tree():e,s=[...Array(t.attributes.length).keys()].map((e=>t.attributes[e].nodeName));s.sort();let n=s.reduce(((e,s)=>`${e} ${s}="${pe(t.attributes.getNamedItem(s).value)}"`),`<${t.nodeName}`);if(t.childNodes.length>0){n+=">";for(let e=0;e<t.childNodes.length;e++){const s=t.childNodes[e];switch(s.nodeType){case Y.NORMAL:n+=Oe.serialize(s);break;case Y.TEXT:n+=pe(s.nodeValue);break;case Y.CDATA:n+="<![CDATA["+s.nodeValue+"]]>"}}n+="</"+t.nodeName+">"}else n+="/>";return n}tree(){return this.nodeTree}toString(){return Oe.serialize(this.nodeTree)}up(){return this.node=this.node.parentElement?this.node.parentElement:this.node.parentNode,this}root(){return this.node=this.nodeTree,this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(null!=e[t]?this.node.setAttribute(t,e[t].toString()):this.node.removeAttribute(t));return this}c(e,t,s){const n=de(e,t,s);return this.node.appendChild(n),"string"!=typeof s&&"number"!=typeof s&&(this.node=n),this}cnode(e){let t;const s=ae();try{t=void 0!==s.importNode}catch(e){t=!1}const n=t?s.importNode(e,!0):ge(e);return this.node.appendChild(n),this.node=n,this}t(e){const t=ce(e);return this.node.appendChild(t),this}h(e){const t=ae().createElement("body");t.innerHTML=e;const s=fe(t);for(;s.childNodes.length>0;)this.node.appendChild(s.childNodes[0]);return this}}const Ie=Oe;let Me=0;const Re=class{constructor(e,t,s,n=0){this.id=++Me,this.xmlData=e,this.data=Ie.serialize(e),this.origFunc=t,this.func=t,this.rid=s,this.date=NaN,this.sends=n,this.abort=!1,this.dead=null,this.age=()=>this.date?((new Date).valueOf()-this.date.valueOf())/1e3:0,this.timeDead=()=>this.dead?((new Date).valueOf()-this.dead.valueOf())/1e3:0,this.xhr=this._newXHR()}getResponse(){let e=this.xhr.responseXML?.documentElement;if(e){if("parsererror"===e.tagName)throw K.error("invalid response received"),K.error("responseText: "+this.xhr.responseText),K.error("responseXML: "+Ie.serialize(e)),new Error("parsererror")}else if(this.xhr.responseText){K.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=(new q).parseFromString(this.xhr.responseText,"application/xml").documentElement;const t=e?.getElementsByTagName("parsererror").item(0);if(!e||t){t&&(K.error("invalid response received: "+t.textContent),K.error("responseText: "+this.xhr.responseText));const e=new Error;throw e.name=Q.BAD_FORMAT,e}}return e}_newXHR(){const e=new XMLHttpRequest;return e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"),e.onreadystatechange=this.func.bind(null,this),e}};let De=1.1,Le=.1;class ze{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.strip=ze.prototype.strip??!1,this.lastResponseHeaders=null,this._requests=[]}static setTimeoutMultiplier(e){De=e}static getTimeoutMultplier(){return De}static setSecondaryTimeoutMultiplier(e){Le=e}static getSecondaryTimeoutMultplier(){return Le}_buildBody(){const e=ke("body",{rid:this.rid++,xmlns:G.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,s){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const n=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":G.BOSH});s&&n.attrs({route:s});const i=this._conn._connect_cb;this._requests.push(new Re(n.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),Number(n.tree().getAttribute("rid")))),this._throttledRequestHandler()}_attach(e,t,s,n,i,r,o){this._conn.jid=e,this.sid=t,this.rid=s,this._conn.connect_callback=n,this._conn.domain=xe(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=r||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(V.ATTACHED,null)}_restore(e,t,s,n,i){const r=JSON.parse(sessionStorage.getItem("strophe-bosh-session"));if(!(null!=r&&r.rid&&r.sid&&r.jid&&(null==e||$e(r.jid)===$e(e)||null===Se(e)&&xe(r.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(r.jid,r.sid,r.rid,t,s,n,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");K.error("BOSH-Connection failed: "+t);const s=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&s.length>0&&(t="conflict"),this._conn._changeConnectStatus(V.CONNFAIL,t)):this._conn._changeConnectStatus(V.CONNFAIL,"unknown"),this._conn._doDisconnect(t),V.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const s=e.getAttribute("requests");s&&(this.window=parseInt(s,10));const n=e.getAttribute("hold");n&&(this.hold=parseInt(n,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const r=e.getAttribute("inactivity");r&&(this.inactivity=parseInt(r,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(e){const t=ze._getRequestStatus(e),s=this._conn.protocolErrorHandlers.HTTP[t];s&&s.call(this,t)}_hitError(e){this.errors++,K.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){K.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new Re(t.tree(),this._onRequestStateChange.bind(this,e),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(K.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let s=0;s<e.length;s++)null!==e[s]&&("restart"===e[s]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":G.BOSH}):t.cnode(e[s]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Re(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(De*this.wait)&&this._throttledRequestHandler(),e>Math.floor(De*this.wait)&&(K.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(De*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let s;if(4===e.xhr.readyState)try{s=e.xhr.status}catch(e){K.error("Caught an error while retrieving a request's status, reqStatus: "+s)}return void 0===s&&(s="number"==typeof t?t:0),s}_onRequestStateChange(e,t){if(K.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);if(4!==t.xhr.readyState)return;const s=ze._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this._conn.disconnecting&&s>=400)return this._hitError(s),void this._callProtocolErrorHandlers(t);const n=this._requests[0]===t,i=this._requests[1]===t,r=s>0&&s<500,o=t.sends>this._conn.maxRetries;(r||o)&&(this._removeRequest(t),K.debug("request id "+t.id+" should now be removed")),200===s?((i||n&&this._requests.length>0&&this._requests[0].age()>Math.floor(De*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(t.rid+1),K.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):0===s||s>=400&&s<600||s>=12e3?(K.error("request id "+t.id+"."+t.sends+" error "+s+" happened"),this._hitError(s),this._callProtocolErrorHandlers(t),s>=400&&s<500&&(this._conn._changeConnectStatus(V.DISCONNECTING,null),this._conn._doDisconnect())):K.error("request id "+t.id+"."+t.sends+" error "+s+" happened"),r||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(V.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(e){let t=this._requests[e];const s=ze._getRequestStatus(t,-1);if(t.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const n=t.age(),i=!isNaN(n)&&n>Math.floor(De*this.wait),r=null!==t.dead&&t.timeDead()>Math.floor(Le*this.wait),o=4===t.xhr.readyState&&(s<1||s>=500);if((i||r||o)&&(r&&K.error(`Request ${this._requests[e].id} timed out (secondary), restarting`),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){},this._requests[e]=new Re(t.xmlData,t.origFunc,t.rid,t.sends),t=this._requests[e]),0===t.xhr.readyState){K.debug("request id "+t.id+"."+t.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";t.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==t.xhr.setRequestHeader&&t.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(t.xhr.withCredentials=!0)}catch(e){return K.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(V.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(t.date=(new Date).valueOf(),this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.xhr.setRequestHeader(s,e[s])}t.xhr.send(t.data)};if(t.sends>1){const s=1e3*Math.min(Math.floor(De*this.wait),Math.pow(t.sends,3));setTimeout((function(){e()}),s)}else e();t.sends++,this.strip&&"body"===t.xmlData.nodeName&&t.xmlData.childNodes.length?this._conn.xmlOutput?.(t.xmlData.children[0]):this._conn.xmlOutput?.(t.xmlData),this._conn.rawOutput?.(t.data)}else K.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+t.xhr.readyState)}_removeRequest(e){K.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){K.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"}),s=e instanceof Ie?e.tree():e;e&&t.cnode(s);const n=new Re(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")));this._requests.push(n),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?K.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):K.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}const Pe=ze;var Fe=s(2665);const Ue=class{constructor(e,t,s,n,i,r,o){this.handler=e,this.ns=t,this.name=s,this.type=n,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBareFromJid?this.from=r?$e(r):null:this.from=r,this.user=!0}getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t}namespaceMatch(e){let t=!1;return!this.ns||(_e(e,null,(e=>{this.getNamespace(e)===this.ns&&(t=!0)})),t||this.getNamespace(e)===this.ns)}isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=$e(t));const s=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!be(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(s):s!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)}run(e){let t=null;try{t=this.handler(e)}catch(e){throw Z(e),e}return t}toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};const Be=class{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};const qe=class{constructor(e,t,s){this.mechname=e,this.isClientFirst=t,this.priority=s}test(e){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}};const He=class extends qe{constructor(e="ANONYMOUS",t=!1,s=20){super(e,t,s)}test(e){return null===e.authcid}};const Ge=class extends qe{constructor(e="EXTERNAL",t=!0,s=10){super(e,t,s)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}};const We=class extends qe{constructor(e="OAUTHBEARER",t=!0,s=40){super(e,t,s)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",Ce.utf16to8(t)}};const Ve=class extends qe{constructor(e="PLAIN",t=!0,s=50){super(e,t,s)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:s,domain:n,pass:i}=e;if(!n)throw new Error("SASLPlain onChallenge: domain is not defined!");let r=s!==`${t}@${n}`?s:"";return r+="\0",r+=t,r+="\0",r+=i,Ce.utf16to8(r)}};const Qe={async scramResponse(e,t,s,n){const i=e._sasl_data.cnonce,r=function(e){let t,s,n;const i=/([a-z]+)=([^,]+)(,|$)/;for(;e.match(i);){const r=e.match(i);switch(e=e.replace(r[0],""),r[1]){case"r":t=r[2];break;case"s":s=Ce.base64ToArrayBuf(r[2]);break;case"i":n=parseInt(r[2],10);break;case"m":return}}if(isNaN(n)||n<4096)K.warn("Failing SCRAM authentication because server supplied iteration count < 4096.");else{if(s)return{nonce:t,salt:s,iter:n};K.warn("Failing SCRAM authentication because server supplied incorrect salt.")}}(t);if(!r&&r?.nonce.slice(0,i.length)!==i)return K.warn("Failing SCRAM authentication because server supplied incorrect nonce."),e._sasl_data={},e._sasl_failure_cb();let o,a;const{pass:c}=e;if("string"==typeof e.pass||e.pass instanceof String){const e=await async function(e,t,s,n,i){const r=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:s,hash:{name:n}},await crypto.subtle.importKey("raw",Ce.stringToArrayBuf(e),"PBKDF2",!1,["deriveBits"]),i),o=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:n},!1,["sign"]);return{ck:await crypto.subtle.sign("HMAC",o,Ce.stringToArrayBuf("Client Key")),sk:await crypto.subtle.sign("HMAC",o,Ce.stringToArrayBuf("Server Key"))}}(c,r.salt,r.iter,s,n);o=e.ck,a=e.sk}else{if(c?.name!==s||c?.salt!==Ce.arrayBufToBase64(r.salt)||c?.iter!==r.iter)return e._sasl_failure_cb();{const{ck:e,sk:t}=c;o=Ce.base64ToArrayBuf(e),a=Ce.base64ToArrayBuf(t)}}const l=e._sasl_data["client-first-message-bare"],d=t,u=`c=biws,r=${r.nonce}`,h=`${l},${d},${u}`,m=await async function(e,t,s){const n=await crypto.subtle.importKey("raw",await crypto.subtle.digest(s,t),{name:"HMAC",hash:s},!1,["sign"]),i=await crypto.subtle.sign("HMAC",n,Ce.stringToArrayBuf(e));return Ce.xorArrayBuffers(t,i)}(h,o,s),f=await async function(e,t,s){const n=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:s},!1,["sign"]);return crypto.subtle.sign("HMAC",n,Ce.stringToArrayBuf(e))}(h,a,s);return e._sasl_data["server-signature"]=Ce.arrayBufToBase64(f),e._sasl_data.keys={name:s,iter:r.iter,salt:Ce.arrayBufToBase64(r.salt),ck:Ce.arrayBufToBase64(o),sk:Ce.arrayBufToBase64(a)},`${u},p=${Ce.arrayBufToBase64(m)}`},clientChallenge(e,t){const s=t||function(){const e=new Uint8Array(16);return Ce.arrayBufToBase64(crypto.getRandomValues(e).buffer)}(),n=`n=${e.authcid},r=${s}`;return e._sasl_data.cnonce=s,e._sasl_data["client-first-message-bare"]=n,`n,,${n}`}};const Je=class extends qe{constructor(e="SCRAM-SHA-1",t=!0,s=60){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await Qe.scramResponse(e,t,"SHA-1",160)}clientChallenge(e,t){return Qe.clientChallenge(e,t)}};const Ye=class extends qe{constructor(e="SCRAM-SHA-256",t=!0,s=70){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await Qe.scramResponse(e,t,"SHA-256",256)}clientChallenge(e,t){return Qe.clientChallenge(e,t)}};const Xe=class extends qe{constructor(e="SCRAM-SHA-384",t=!0,s=71){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await Qe.scramResponse(e,t,"SHA-384",384)}clientChallenge(e,t){return Qe.clientChallenge(e,t)}};const Ke=class extends qe{constructor(e="SCRAM-SHA-512",t=!0,s=72){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await Qe.scramResponse(e,t,"SHA-512",512)}clientChallenge(e,t){return Qe.clientChallenge(e,t)}};const Ze=class extends qe{constructor(e="X-OAUTH2",t=!0,s=30){super(e,t,s)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,Ce.utf16to8(t)}};class et extends Error{constructor(e){super(e),this.name="StropheSessionError"}}const tt=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let s="";"ws"===e.options.protocol&&"https:"!==location.protocol?s+="ws":s+="wss",s+="://"+location.host,0!==t.indexOf("/")?s+=location.pathname+t:s+=t,e.service=s}}_buildStream(){return ke("open",{xmlns:G.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let s;if(s=e.getElementsByTagNameNS?e.getElementsByTagNameNS(G.STREAM,"error"):e.getElementsByTagName("stream:error"),0===s.length)return!1;const n=s[0];let i="",r="";for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];if(t.nodeType===t.ELEMENT_NODE){if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break}"text"===t.nodeName?r=t.textContent:i=t.nodeName}let o="WebSocket stream error: ";return o+=i||"unknown",r&&(o+=" - "+r),K.error(o),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new B(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,V.CONNFAIL))return V.CONNFAIL}_handleStreamStart(e){let t=null;const s=e.getAttribute("xmlns");"string"!=typeof s?t="Missing xmlns in <open />":s!==G.FRAMING&&(t="Wrong xmlns in <open />: "+s);const n=e.getAttribute("version");return"string"!=typeof n?t="Missing version in <open />":"1.0"!==n&&(t="Wrong version in <open />: "+n),!t||(this._conn._changeConnectStatus(V.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const s=(new q).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(s),this._conn.rawInput(e.data),this._handleStreamStart(s)&&this._connect_cb(s)}else if(0===e.data.indexOf("<close ")){const t=(new q).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const s=t.getAttribute("see-other-uri");if(s){const e=this._conn.service;(e.indexOf("wss:")>=0&&s.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(V.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=s,this._connect())}else this._conn._changeConnectStatus(V.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),s=(new q).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(s,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==B.CLOSED){e&&this._conn.send(e);const t=ke("close",{xmlns:G.FRAMING});this._conn.xmlOutput(t.tree());const s=Ie.serialize(t);this._conn.rawOutput(s);try{this.socket.send(s)}catch(e){K.warn("Couldn't send <close /> tag.")}}setTimeout((()=>this._conn._doDisconnect()),0)}_doDisconnect(){K.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){K.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(K.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(K.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(V.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):K.debug("Websocket closed")}_no_auth_received(e){K.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(V.CONNFAIL,Q.NO_AUTH_MECH),e?.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){K.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(V.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){const s="restart"===e[t]?this._buildStream().tree():e[t];if("restart"===s)throw new Error("Wrong type for stanza");const n=Ie.serialize(s);this._conn.xmlOutput(s),this._conn.rawOutput(n),this.socket.send(n)}this._conn._data=[]}}_onMessage(e){let t;const s='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===s)return this._conn.rawInput(s),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new q).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const s=this._streamWrap(e.data);t=(new q).parseFromString(s,"text/xml").documentElement}return this._checkStreamError(t,V.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstElementChild.nodeName&&"unavailable"===t.firstElementChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Ie.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){K.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=Ie.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const st=class extends tt{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{console?.error(e),K.error(`Shared Worker Error: ${e}`)}}_setSocket(){this.socket={send:e=>this.worker.port.postMessage(["send",e]),close:()=>this.worker.port.postMessage(["_closeSocket"]),onopen:()=>{},onerror:e=>this._onError(e),onclose:e=>this._onClose(e),onmessage:()=>{},readyState:null}}_connect(){this._setSocket(),this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._setSocket(),this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===V.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(V.ATTACHED)):e===V.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(V.ATTACHFAIL))}_disconnect(e){e&&this._conn.send(e);const t=ke("close",{xmlns:G.FRAMING});this._conn.xmlOutput(t.tree());const s=Ie.serialize(t);this._conn.rawOutput(s),this.worker.port.postMessage(["send",s]),this._conn._doDisconnect()}_closeSocket(){this.socket.close()}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,s=t[0];if("_onMessage"===s)this._messageHandler(t[1]);else if(s in this)try{this[s].apply(this,e.data.slice(1))}catch(e){K.error(e)}else if("log"===s){const e={debug:J.DEBUG,info:J.INFO,warn:J.WARN,error:J.ERROR,fatal:J.FATAL},s=t[1],n=t[2];K.log(e[s],n)}else K.error(`Found unhandled service worker message: ${t}`)}},nt={};class it{constructor(e,t={}){this.service=e,this.options=t,this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),re(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new Ue((e=>this.send(je({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:G.STANZAS}))),null,"iq",["get","set"]);for(const e in nt)if(Object.prototype.hasOwnProperty.call(nt,e)){const t=function(){};t.prototype=nt[e],this[e]=new t,this[e].init(this)}}static addConnectionPlugin(e,t){nt[e]=t}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new st(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new tt(this):this._proto=new Pe(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,s){this.protocolErrorHandlers[e][t]=s}connect(e,t,s,n,i,r,o,a=3e3){this.jid=e,this.authzid=$e(this.jid),this.authcid=o||Se(this.jid),this.pass=t,this.scram_keys=null,this.connect_callback=s,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=a,this.domain=xe(this.jid),this._changeConnectStatus(V.CONNECTING,null),this._proto._connect(n,i,r)}attach(e,t,s,n,i,r,o){if(this._proto instanceof Pe&&"string"==typeof e)return this._proto._attach(e,t,s,n,i,r,o);if(this._proto instanceof st&&"function"==typeof e){const t=e;return this._proto._attach(t)}throw new et('The "attach" method is not available for your connection protocol')}restore(e,t,s,n,i){if(!(this._proto instanceof Pe&&this._sessionCachingSupported()))throw new et('The "restore" method can only be used with a BOSH connection.');this._sessionCachingSupported()&&this._proto._restore(e,t,s,n,i)}_sessionCachingSupported(){if(this._proto instanceof Pe){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if(Array.isArray(e))e.forEach((e=>this._queueData(e instanceof Ie?e.tree():e)));else{const t=e instanceof Ie?e.tree():e;this._queueData(t)}this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,s,n){let i=null;const r=e instanceof Ie?e.tree():e;let o=r.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),r.setAttribute("id",o)),"function"==typeof t||"function"==typeof s){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?s?.(e):t&&t(e)}),null,"presence",null,o);n&&(i=this.addTimedHandler(n,(()=>(this.deleteHandler(e),s?.(null),!1))))}return this.send(r),o}sendIQ(e,t,s,n){let i=null;const r=e instanceof Ie?e.tree():e;let o=r.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),r.setAttribute("id",o)),"function"==typeof t||"function"==typeof s){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i);const n=e.getAttribute("type");if("result"===n)t?.(e);else{if("error"!==n){const e=new Error(`Got bad IQ type of ${n}`);throw e.name="StropheError",e}s?.(e)}}),null,"iq",["error","result"],o);n&&(i=this.addTimedHandler(n,(()=>(this.deleteHandler(e),s?.(null),!1))))}return this.send(r),o}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const s=new Be(e,t);return this.addTimeds.push(s),s}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,s,n,i,r,o){const a=new Ue(e,t,s,n,i,r,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e||[He,Ge,We,Ze,Ve,Je,Ye,Xe,Ke]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(V.DISCONNECTING,e),e?K.info("Disconnect was called because: "+e):K.debug("Disconnect was called"),this.connected){let e=null;this.disconnecting=!0,this.authenticated&&(e=Ne({xmlns:G.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else K.debug("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,s){for(const s in nt)if(Object.prototype.hasOwnProperty.call(nt,s)){const n=this[s];if(n.statusChanged)try{n.statusChanged(e,t)}catch(e){K.error(`${s} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,s)}catch(e){Z(e),K.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),K.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(V.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const s="_reqToData"in this._proto?this._proto._reqToData(e):e;if(null===s)return;for(this.xmlInput!==it.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==it.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(Ie.serialize(s)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const n=s.getAttribute("type");if(null!==n&&"terminate"===n){if(this.disconnecting)return;let e=s.getAttribute("condition");const t=s.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(V.CONNFAIL,e)):this._changeConnectStatus(V.CONNFAIL,Q.UNKNOWN_REASON),void this._doDisconnect(e)}_e(s,null,(e=>{const t=[];this.handlers=this.handlers.reduce(((s,n)=>{try{!n.isMatch(e)||!this.authenticated&&n.user?s.push(n):(n.run(e)&&s.push(n),t.push(n))}catch(e){K.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return s}),[]),!t.length&&this.iqFallbackHandler.isMatch(e)&&this.iqFallbackHandler.run(e)}))}_connect_cb(e,t,s){let n;K.debug("_connect_cb was called"),this.connected=!0;try{n="_reqToData"in this._proto?this._proto._reqToData(e):e}catch(e){if(e.name!==Q.BAD_FORMAT)throw e;this._changeConnectStatus(V.CONNFAIL,Q.BAD_FORMAT),this._doDisconnect(Q.BAD_FORMAT)}if(!n)return;this.xmlInput!==it.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==it.prototype.rawInput&&(s?this.rawInput(s):this.rawInput(Ie.serialize(n)));if(this._proto._connect_cb(n)===V.CONNFAIL)return;let i;if(i=n.getElementsByTagNameNS?n.getElementsByTagNameNS(G.STREAM,"features").length>0:n.getElementsByTagName("stream:features").length>0||n.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const r=Array.from(n.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==r.length||0!==n.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let s=t;for(let n=t+1;n<e.length;++n)e[n].priority>e[s].priority&&(s=n);if(s!==t){const n=e[t];e[t]=e[s],e[s]=n}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let s=0;s<e.length;++s){if(!e[s].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[s],this._sasl_mechanism.onStart(this);const n=ke("auth",{xmlns:G.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);n.t((0,Fe.btoa)(e))}this.send(n.tree()),t=!0;break}return t}async _sasl_challenge_cb(e){const t=(0,Fe.atob)(ye(e)),s=await this._sasl_mechanism.onChallenge(this,t),n=ke("response",{xmlns:G.SASL});return s&&n.t((0,Fe.btoa)(s)),this.send(n.tree()),!0}_attemptLegacyAuth(){null===Se(this.jid)?(this._changeConnectStatus(V.CONNFAIL,Q.MISSING_JID_NODE),this.disconnect(Q.MISSING_JID_NODE)):(this._changeConnectStatus(V.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(je({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:G.AUTH}).c("username",{}).t(Se(this.jid)).tree()))}_onLegacyAuthIQResult(){const e="string"==typeof this.pass?this.pass:"",t=je({type:"set",id:"_auth_2"}).c("query",{xmlns:G.AUTH}).c("username",{}).t(Se(this.jid)).up().c("password").t(e);return Ee(this.jid)||(this.jid=$e(this.jid)+"/strophe"),t.up().c("resource",{}).t(Ee(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const s=/([a-z]+)=([^,]+)(,|$)/,n=(0,Fe.atob)(ye(e)).match(s);if("v"===n[1]&&(t=n[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}K.info("SASL authentication succeeded."),this._sasl_data.keys&&(this.scram_keys=this._sasl_data.keys),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],s=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>s(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>s(t,e)),G.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes[t];"bind"===s.nodeName&&(this.do_bind=!0),"session"===s.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(V.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(V.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void K.info('Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=Ee(this.jid);e?this.send(je({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:G.BIND}).c("resource",{}).t(e).tree()):this.send(je({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:G.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){K.warn("Resource binding failed.");let t;return e.getElementsByTagName("conflict").length>0&&(t=Q.CONFLICT),this._changeConnectStatus(V.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return K.warn("Resource binding failed."),this._changeConnectStatus(V.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=ye(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(V.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Connection.prototype._establishSession called but apparently ${G.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(je({type:"set",id:"_session_auth_2"}).c("session",{xmlns:G.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(V.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,K.warn("Session creation failed."),this._changeConnectStatus(V.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(V.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(V.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(V.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const s=new Be(e,t);return s.user=!1,this.addTimeds.push(s),s}_addSysHandler(e,t,s,n,i){const r=new Ue(e,t,s,n,i);return r.user=!1,this.addHandlers.push(r),r}_onDisconnectTimeout(){return K.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(V.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let s=0;s<this.timedHandlers.length;s++){const n=this.timedHandlers[s];if(this.authenticated||!n.user){n.lastCalled+n.period-e<=0?n.run()&&t.push(n):t.push(n)}}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}}const rt=it,ot="http://www.w3.org/1999/xhtml";function at(e,t){const s=le(e);if(s.getElementsByTagNameNS(ot,"parsererror").length)throw new Error(`Parser Error: ${e}`);const n=s.firstElementChild;if(["message","iq","presence"].includes(n.nodeName.toLowerCase())&&"jabber:client"!==n.namespaceURI&&"jabber:server"!==n.namespaceURI){const e=`Invalid namespaceURI ${n.namespaceURI}`;if(t)throw new Error(e);K.error(e)}return n}class ct{constructor(e,t){this.strings=e,this.values=t}toString(){return this.string=this.string||this.strings.reduce(((e,t)=>{const s=this.strings.indexOf(t);return e+t+(this.values.length>s?this.values[s].toString():"")}),""),this.string}tree(){return this.node=this.node??at(this.toString(),!0),this.node}}const lt={VERSION:"3.0.0",get TIMEOUT(){return Pe.getTimeoutMultplier()},set TIMEOUT(e){Pe.setTimeoutMultiplier(e)},get SECONDARY_TIMEOUT(){return Pe.getSecondaryTimeoutMultplier()},set SECONDARY_TIMEOUT(e){Pe.setSecondaryTimeoutMultiplier(e)},...i,...K,shims:n,Request:Re,Bosh:Pe,Websocket:tt,WorkerWebsocket:st,Connection:rt,Handler:Ue,SASLAnonymous:He,SASLPlain:Ve,SASLSHA1:Je,SASLSHA256:Ye,SASLSHA384:Xe,SASLSHA512:Ke,SASLOAuthBearer:We,SASLExternal:Ge,SASLXOAuth2:Ze,Builder:Ie,ElementType:Y,ErrorCondition:Q,LogLevel:J,NS:G,SASLMechanism:qe,Status:V,TimedHandler:Be,XHTML:{...W,validTag:ue,validCSS:me,validAttribute:he},serialize:e=>Ie.serialize(e),setLogLevel(e){K.setLogLevel(e)},addNamespace(e,t){lt.NS[e]=t},addConnectionPlugin(e,t){rt.addConnectionPlugin(e,t)}};function dt(e){return e instanceof Element||e instanceof HTMLDocument}function ut(e,t){if(e instanceof lt.Builder)return ut(e.tree(),t);if(e instanceof Element)return lt.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")}function ht(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function mt(e,t){return Array.from(e.childNodes).filter((e=>e instanceof Element&&e.matches(t)))}function ft(e){for(var t=0;e=e.previousElementSibling;t++);return t}globalThis.$build=ke,globalThis.$iq=je,globalThis.$msg=Te,globalThis.$pres=Ne,globalThis.Strophe=lt,globalThis.toStanza=at;const gt=document.createElement("div");function pt(e){return e&&"string"==typeof e&&(gt.innerHTML=U().sanitize(e),e=gt.textContent,gt.textContent=""),e}const vt={debug:0,info:1,warn:2,error:3,fatal:4},_t=Object.assign({debug:console?.log?console.log.bind(console):function(){},error:console?.log?console.log.bind(console):function(){},info:console?.log?console.log.bind(console):function(){},warn:console?.log?console.log.bind(console):function(){}},console),bt={setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t,s=""){if(vt[t]<vt[this.loglevel])return;"error"===t||"fatal"===t?s=s||"color: maroon":"debug"===t&&(s=s||"color: green"),e instanceof Error?e=e.stack:dt(e)&&(e=e.outerHTML);const n=s?"%c":"";"error"===t?_t.error(`${n} ERROR: ${e}`,s):"warn"===t?_t.warn(`${n} ${(new Date).toISOString()} WARNING: ${e}`,s):"fatal"===t?_t.error(`${n} FATAL: ${e}`,s):"debug"===t?_t.debug(`${n} ${(new Date).toISOString()} DEBUG: ${e}`,s):_t.info(`${n} ${(new Date).toISOString()} INFO: ${e}`,s)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}};var yt=s(169);const wt={async initialize(){},__:(...e)=>(0,yt.sprintf)(...e)};function At(e,t,s,n,...i){return"function"==typeof s&&(void 0===this.__super__&&(this.__super__=n),this.__super__[e]=s.bind(this)),t.apply(this,i)}class St{constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}_overrideAttribute(e,t){const s=t.overrides[e];if("function"==typeof s){const t={};t[this.name]=this.plugged;const n=this.plugged[e];this.plugged[e]=function(...i){return At.apply(this,[e,s,n,t,...i])}}else this.plugged[e]=s}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[s,n]of Object.entries(t))if("events"===s)e.prototype[s]=Object.assign(n,e.prototype[s]);else if("function"==typeof n){const t={};t[this.name]=this.plugged;const i=e.prototype[s];e.prototype[s]=function(...e){return At.apply(this,[s,n,i,t,...e])}}else e.prototype[s]=n}loadPluginDependencies(e){e.dependencies?.forEach((t=>{const s=this.plugins[t];if(s){if(s.dependencies?.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(s)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const s=e.overrides[t];"object"==typeof s?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],s):this._overrideAttribute(t,e)}))}initializePlugin(e){Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||e.enabled?.(this.plugged)||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(e={},t=[],s=[]){if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,n]of Object.entries(this.plugins))t.length&&!t.includes(e)||s.includes(e)||(this.allowed_plugins[e]=n);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}}const xt={enable:function(e,t,s){return void 0===s&&(s="pluginSocket"),void 0===t&&(t="plugged"),e[s]=new St(e,t),e}};const Et="object"==typeof global&&global&&global.Object===Object&&global;var $t="object"==typeof self&&self&&self.Object===Object&&self;const Ct=Et||$t||Function("return this")();const kt=Ct.Symbol;const Tt=function(e,t){for(var s=-1,n=null==e?0:e.length,i=Array(n);++s<n;)i[s]=t(e[s],s,e);return i};const jt=Array.isArray;var Nt=Object.prototype,Ot=Nt.hasOwnProperty,It=Nt.toString,Mt=kt?kt.toStringTag:void 0;const Rt=function(e){var t=Ot.call(e,Mt),s=e[Mt];try{e[Mt]=void 0;var n=!0}catch(e){}var i=It.call(e);return n&&(t?e[Mt]=s:delete e[Mt]),i};var Dt=Object.prototype.toString;const Lt=function(e){return Dt.call(e)};var zt=kt?kt.toStringTag:void 0;const Pt=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":zt&&zt in Object(e)?Rt(e):Lt(e)};const Ft=function(e){return null!=e&&"object"==typeof e};const Ut=function(e){return"symbol"==typeof e||Ft(e)&&"[object Symbol]"==Pt(e)};var Bt=kt?kt.prototype:void 0,qt=Bt?Bt.toString:void 0;const Ht=function e(t){if("string"==typeof t)return t;if(jt(t))return Tt(t,e)+"";if(Ut(t))return qt?qt.call(t):"";var s=t+"";return"0"==s&&1/t==-1/0?"-0":s};const Gt=function(e){return null==e?"":Ht(e)};var Wt=0;const Vt=function(e){var t=++Wt;return Gt(e)+t};var Qt;const Jt=window,Yt=Jt.trustedTypes,Xt=Yt?Yt.createPolicy("lit-html",{createHTML:e=>e}):void 0,Kt="$lit$",Zt=`lit$${(Math.random()+"").slice(9)}$`,es="?"+Zt,ts=`<${es}>`,ss=document,ns=()=>ss.createComment(""),is=e=>null===e||"object"!=typeof e&&"function"!=typeof e,rs=Array.isArray,os=e=>rs(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),as="[ \t\n\f\r]",cs=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ls=/-->/g,ds=/>/g,us=RegExp(`>|${as}(?:([^\\s"'>=/]+)(${as}*=${as}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),hs=/'/g,ms=/"/g,fs=/^(?:script|style|textarea|title)$/i,gs=e=>(t,...s)=>({_$litType$:e,strings:t,values:s}),ps=(gs(1),gs(2),Symbol.for("lit-noChange")),vs=Symbol.for("lit-nothing"),_s=new WeakMap,bs=ss.createTreeWalker(ss,129,null,!1);function ys(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==Xt?Xt.createHTML(t):t}const ws=(e,t)=>{const s=e.length-1,n=[];let i,r=2===t?"<svg>":"",o=cs;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(o.lastIndex=d,c=o.exec(s),null!==c);)d=o.lastIndex,o===cs?"!--"===c[1]?o=ls:void 0!==c[1]?o=ds:void 0!==c[2]?(fs.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=us):void 0!==c[3]&&(o=us):o===us?">"===c[0]?(o=null!=i?i:cs,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?us:'"'===c[3]?ms:hs):o===ms||o===hs?o=us:o===ls||o===ds?o=cs:(o=us,i=void 0);const u=o===us&&e[t+1].startsWith("/>")?" ":"";r+=o===cs?s+ts:l>=0?(n.push(a),s.slice(0,l)+Kt+s.slice(l)+Zt+u):s+Zt+(-2===l?(n.push(void 0),t):u)}return[ys(e,r+(e[s]||"<?>")+(2===t?"</svg>":"")),n]};class As{constructor({strings:e,_$litType$:t},s){let n;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=ws(e,t);if(this.el=As.createElement(c,s),bs.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(n=bs.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes()){const e=[];for(const t of n.getAttributeNames())if(t.endsWith(Kt)||t.startsWith(Zt)){const s=l[r++];if(e.push(t),void 0!==s){const e=n.getAttribute(s.toLowerCase()+Kt).split(Zt),t=/([.?@])?(.*)/.exec(s);a.push({type:1,index:i,name:t[2],strings:e,ctor:"."===t[1]?Cs:"?"===t[1]?Ts:"@"===t[1]?js:$s})}else a.push({type:6,index:i})}for(const t of e)n.removeAttribute(t)}if(fs.test(n.tagName)){const e=n.textContent.split(Zt),t=e.length-1;if(t>0){n.textContent=Yt?Yt.emptyScript:"";for(let s=0;s<t;s++)n.append(e[s],ns()),bs.nextNode(),a.push({type:2,index:++i});n.append(e[t],ns())}}}else if(8===n.nodeType)if(n.data===es)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(Zt,e+1));)a.push({type:7,index:i}),e+=Zt.length-1}i++}}static createElement(e,t){const s=ss.createElement("template");return s.innerHTML=e,s}}function Ss(e,t,s=e,n){var i,r,o,a;if(t===ps)return t;let c=void 0!==n?null===(i=s._$Co)||void 0===i?void 0:i[n]:s._$Cl;const l=is(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==l&&(null===(r=null==c?void 0:c._$AO)||void 0===r||r.call(c,!1),void 0===l?c=void 0:(c=new l(e),c._$AT(e,s,n)),void 0!==n?(null!==(o=(a=s)._$Co)&&void 0!==o?o:a._$Co=[])[n]=c:s._$Cl=c),void 0!==c&&(t=Ss(e,c._$AS(e,t.values),c,n)),t}class xs{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:s},parts:n}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:ss).importNode(s,!0);bs.currentNode=i;let r=bs.nextNode(),o=0,a=0,c=n[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new Es(r,r.nextSibling,this,e):1===c.type?t=new c.ctor(r,c.name,c.strings,this,e):6===c.type&&(t=new Ns(r,this,e)),this._$AV.push(t),c=n[++a]}o!==(null==c?void 0:c.index)&&(r=bs.nextNode(),o++)}return bs.currentNode=ss,i}v(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class Es{constructor(e,t,s,n){var i;this.type=2,this._$AH=vs,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=n,this._$Cp=null===(i=null==n?void 0:n.isConnected)||void 0===i||i}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ss(this,e,t),is(e)?e===vs||null==e||""===e?(this._$AH!==vs&&this._$AR(),this._$AH=vs):e!==this._$AH&&e!==ps&&this._(e):void 0!==e._$litType$?this.g(e):void 0!==e.nodeType?this.$(e):os(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==vs&&is(this._$AH)?this._$AA.nextSibling.data=e:this.$(ss.createTextNode(e)),this._$AH=e}g(e){var t;const{values:s,_$litType$:n}=e,i="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=As.createElement(ys(n.h,n.h[0]),this.options)),n);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.v(s);else{const e=new xs(i,this),t=e.u(this.options);e.v(s),this.$(t),this._$AH=e}}_$AC(e){let t=_s.get(e.strings);return void 0===t&&_s.set(e.strings,t=new As(e)),t}T(e){rs(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,n=0;for(const i of e)n===t.length?t.push(s=new Es(this.k(ns()),this.k(ns()),this,this.options)):s=t[n],s._$AI(i),n++;n<t.length&&(this._$AR(s&&s._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var s;for(null===(s=this._$AP)||void 0===s||s.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cp=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class $s{constructor(e,t,s,n,i){this.type=1,this._$AH=vs,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=vs}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,s,n){const i=this.strings;let r=!1;if(void 0===i)e=Ss(this,e,t,0),r=!is(e)||e!==this._$AH&&e!==ps,r&&(this._$AH=e);else{const n=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=Ss(this,n[s+o],t,o),a===ps&&(a=this._$AH[o]),r||(r=!is(a)||a!==this._$AH[o]),a===vs?e=vs:e!==vs&&(e+=(null!=a?a:"")+i[o+1]),this._$AH[o]=a}r&&!n&&this.j(e)}j(e){e===vs?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class Cs extends $s{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===vs?void 0:e}}const ks=Yt?Yt.emptyScript:"";class Ts extends $s{constructor(){super(...arguments),this.type=4}j(e){e&&e!==vs?this.element.setAttribute(this.name,ks):this.element.removeAttribute(this.name)}}class js extends $s{constructor(e,t,s,n,i){super(e,t,s,n,i),this.type=5}_$AI(e,t=this){var s;if((e=null!==(s=Ss(this,e,t,0))&&void 0!==s?s:vs)===ps)return;const n=this._$AH,i=e===vs&&n!==vs||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,r=e!==vs&&(n===vs||i);i&&this.element.removeEventListener(this.name,this,n),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,s;"function"==typeof this._$AH?this._$AH.call(null!==(s=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==s?s:this.element,e):this._$AH.handleEvent(e)}}class Ns{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Ss(this,e)}}const Os=Jt.litHtmlPolyfillSupport;null==Os||Os(As,Es),(null!==(Qt=Jt.litHtmlVersions)&&void 0!==Qt?Qt:Jt.litHtmlVersions=[]).push("2.8.0");var Is=/\s/;const Ms=function(e){for(var t=e.length;t--&&Is.test(e.charAt(t)););return t};var Rs=/^\s+/;const Ds=function(e){return e?e.slice(0,Ms(e)+1).replace(Rs,""):e};const Ls=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var zs=/^[-+]0x[0-9a-f]+$/i,Ps=/^0b[01]+$/i,Fs=/^0o[0-7]+$/i,Us=parseInt;const Bs=function(e){if("number"==typeof e)return e;if(Ut(e))return NaN;if(Ls(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ls(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ds(e);var s=Ps.test(e);return s||Fs.test(e)?Us(e.slice(2),s?2:8):zs.test(e)?NaN:+e};var qs=1/0;const Hs=function(e){return e?(e=Bs(e))===qs||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Gs=function(e){var t=Hs(e),s=t%1;return t==t?s?t-s:t:0};const Ws=function(e,t){var s;if("function"!=typeof t)throw new TypeError("Expected a function");return e=Gs(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=void 0),s}};const Vs=function(e){return Ws(2,e)};const Qs=function(e,t){for(var s=-1,n=Array(e);++s<e;)n[s]=t(s);return n};const Js=function(e){return Ft(e)&&"[object Arguments]"==Pt(e)};var Ys=Object.prototype,Xs=Ys.hasOwnProperty,Ks=Ys.propertyIsEnumerable;const Zs=Js(function(){return arguments}())?Js:function(e){return Ft(e)&&Xs.call(e,"callee")&&!Ks.call(e,"callee")};const en=function(){return!1};var tn="object"==typeof exports&&exports&&!exports.nodeType&&exports,sn=tn&&"object"==typeof module&&module&&!module.nodeType&&module,nn=sn&&sn.exports===tn?Ct.Buffer:void 0;const rn=(nn?nn.isBuffer:void 0)||en;var on=/^(?:0|[1-9]\d*)$/;const an=function(e,t){var s=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==s||"symbol"!=s&&on.test(e))&&e>-1&&e%1==0&&e<t};const cn=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var ln={};ln["[object Float32Array]"]=ln["[object Float64Array]"]=ln["[object Int8Array]"]=ln["[object Int16Array]"]=ln["[object Int32Array]"]=ln["[object Uint8Array]"]=ln["[object Uint8ClampedArray]"]=ln["[object Uint16Array]"]=ln["[object Uint32Array]"]=!0,ln["[object Arguments]"]=ln["[object Array]"]=ln["[object ArrayBuffer]"]=ln["[object Boolean]"]=ln["[object DataView]"]=ln["[object Date]"]=ln["[object Error]"]=ln["[object Function]"]=ln["[object Map]"]=ln["[object Number]"]=ln["[object Object]"]=ln["[object RegExp]"]=ln["[object Set]"]=ln["[object String]"]=ln["[object WeakMap]"]=!1;const dn=function(e){return Ft(e)&&cn(e.length)&&!!ln[Pt(e)]};const un=function(e){return function(t){return e(t)}};var hn="object"==typeof exports&&exports&&!exports.nodeType&&exports,mn=hn&&"object"==typeof module&&module&&!module.nodeType&&module,fn=mn&&mn.exports===hn&&Et.process;const gn=function(){try{var e=mn&&mn.require&&mn.require("util").types;return e||fn&&fn.binding&&fn.binding("util")}catch(e){}}();var pn=gn&&gn.isTypedArray;const vn=pn?un(pn):dn;var _n=Object.prototype.hasOwnProperty;const bn=function(e,t){var s=jt(e),n=!s&&Zs(e),i=!s&&!n&&rn(e),r=!s&&!n&&!i&&vn(e),o=s||n||i||r,a=o?Qs(e.length,String):[],c=a.length;for(var l in e)!t&&!_n.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||an(l,c))||a.push(l);return a};var yn=Object.prototype;const wn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||yn)};const An=function(e,t){return function(s){return e(t(s))}};const Sn=An(Object.keys,Object);var xn=Object.prototype.hasOwnProperty;const En=function(e){if(!wn(e))return Sn(e);var t=[];for(var s in Object(e))xn.call(e,s)&&"constructor"!=s&&t.push(s);return t};const $n=function(e){if(!Ls(e))return!1;var t=Pt(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const Cn=function(e){return null!=e&&cn(e.length)&&!$n(e)};const kn=function(e){return Cn(e)?bn(e):En(e)},Tn=/\s+/;function jn(e,t,s,n,i){let r,o=0;if(s&&"object"==typeof s){void 0!==n&&"context"in i&&void 0===i.context&&(i.context=n);for(r=kn(s);o<r.length;o++)t=jn(e,t,r[o],s[r[o]],i)}else if(s&&Tn.test(s))for(r=s.split(Tn);o<r.length;o++)t=e(t,r[o],n,i);else t=e(t,s,n,i);return t}function Nn(e,t,s,n){if(s){const i=e[t]||(e[t]=[]),r=n.context,o=n.ctx,a=n.listening;a&&a.count++,i.push({callback:s,context:r,ctx:r||o,listening:a})}return e}function On(e,t,s,n){if(!e)return;const i=n.context,r=n.listeners;let o,a=0;if(t||i||s){for(o=t?[t]:kn(e);a<o.length;a++){const n=e[t=o[a]];if(!n)break;const r=[];for(let e=0;e<n.length;e++){const o=n[e];if(s&&s!==o.callback&&s!==o.callback._callback||i&&i!==o.context)r.push(o);else{const e=o.listening;e&&e.stop(t,s)}}r.length?e[t]=r:delete e[t]}return e}for(o=kn(r);a<o.length;a++)r[o[a]].cleanup()}function In(e,t,s,n){if(s){const i=e[t]=Vs((function(){n(t,i),s.apply(this,arguments)}));i._callback=s}return e}function Mn(e,t,s,n){if(e){const s=e[t];let i=e.all;s&&i&&(i=i.slice()),s&&Rn(s,n),i&&Rn(i,[t].concat(n))}return e}function Rn(e,t){let s,n=-1;const i=e.length,r=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++n<i;)(s=e[n]).callback.call(s.ctx);return;case 1:for(;++n<i;)(s=e[n]).callback.call(s.ctx,r);return;case 2:for(;++n<i;)(s=e[n]).callback.call(s.ctx,r,o);return;case 3:for(;++n<i;)(s=e[n]).callback.call(s.ctx,r,o,a);return;default:for(;++n<i;)(s=e[n]).callback.apply(s.ctx,t);return}}const Dn=class{constructor(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0}start(e,t,s,n){if(this._events=jn(Nn,this._events||{},e,t,{context:this.obj,ctx:s,listening:n}),n){(this.obj._listeners||(this.obj._listeners={}))[this.id]=this,this.interop=!1}return this}stop(e,t){let s;this.interop?(this._events=jn(On,this._events,e,t,{context:void 0,listeners:void 0}),s=!this._events):(this.count--,s=0===this.count),s&&this.cleanup()}cleanup(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]}};const Ln=Ct["__core-js_shared__"];var zn,Pn=(zn=/[^.]+$/.exec(Ln&&Ln.keys&&Ln.keys.IE_PROTO||""))?"Symbol(src)_1."+zn:"";const Fn=function(e){return!!Pn&&Pn in e};var Un=Function.prototype.toString;const Bn=function(e){if(null!=e){try{return Un.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var qn=/^\[object .+?Constructor\]$/,Hn=Function.prototype,Gn=Object.prototype,Wn=Hn.toString,Vn=Gn.hasOwnProperty,Qn=RegExp("^"+Wn.call(Vn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Jn=function(e){return!(!Ls(e)||Fn(e))&&($n(e)?Qn:qn).test(Bn(e))};const Yn=function(e,t){return null==e?void 0:e[t]};const Xn=function(e,t){var s=Yn(e,t);return Jn(s)?s:void 0};const Kn=Xn(Ct,"DataView");const Zn=Xn(Ct,"Map");const ei=Xn(Ct,"Promise");const ti=Xn(Ct,"Set");const si=Xn(Ct,"WeakMap");var ni="[object Map]",ii="[object Promise]",ri="[object Set]",oi="[object WeakMap]",ai="[object DataView]",ci=Bn(Kn),li=Bn(Zn),di=Bn(ei),ui=Bn(ti),hi=Bn(si),mi=Pt;(Kn&&mi(new Kn(new ArrayBuffer(1)))!=ai||Zn&&mi(new Zn)!=ni||ei&&mi(ei.resolve())!=ii||ti&&mi(new ti)!=ri||si&&mi(new si)!=oi)&&(mi=function(e){var t=Pt(e),s="[object Object]"==t?e.constructor:void 0,n=s?Bn(s):"";if(n)switch(n){case ci:return ai;case li:return ni;case di:return ii;case ui:return ri;case hi:return oi}return t});const fi=mi;var gi=Object.prototype.hasOwnProperty;const pi=function(e){if(null==e)return!0;if(Cn(e)&&(jt(e)||"string"==typeof e||"function"==typeof e.splice||rn(e)||vn(e)||Zs(e)))return!e.length;var t=fi(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(wn(e))return!En(e).length;for(var s in e)if(gi.call(e,s))return!1;return!0};let vi;const _i=function(e){return class extends e{on(e,t,s){if(this._events=jn(Nn,this._events||{},e,t,{context:s,ctx:this,listening:vi}),vi){(this._listeners||(this._listeners={}))[vi.id]=vi,vi.interop=!1}return this}listenTo(e,t,s){if(!e)return this;const n=e._listenId||(e._listenId=Vt("l")),i=this._listeningTo||(this._listeningTo={});let r=vi=i[n];r||(this._listenId||(this._listenId=Vt("l")),r=vi=i[n]=new Dn(this,e));const o=function(e,t,s,n){try{e.on(t,s,n)}catch(e){return e}}(e,t,s,this);if(vi=void 0,o)throw o;return r.interop&&r.start(t,s,this,vi),this}off(e,t,s){return this._events?(this._events=jn(On,this._events,e,t,{context:s,listeners:this._listeners}),this):this}stopListening(e,t,s){const n=this._listeningTo;if(!n)return this;const i=e?[e._listenId]:kn(n);for(let e=0;e<i.length;e++){const r=n[i[e]];if(!r)break;r.obj.off(t,s,this),r.interop&&r.stop(t,s)}return pi(n)&&(this._listeningTo=void 0),this}once(e,t,s){const n=jn(In,{},e,t,this.off.bind(this));return"string"==typeof e&&null==s&&(t=void 0),this.on(n,t,s)}listenToOnce(e,t,s){const n=jn(In,{},t,s,this.stopListening.bind(this,e));return this.listenTo(e,n)}trigger(e,...t){return this._events?(jn(Mn,this._events,e,void 0,t),this):this}}},bi=/^(\S+)\s*(.*)$/;class yi extends(_i(HTMLElement)){set events(e){this._declarativeEvents=e}get events(){return this._declarativeEvents}constructor(e={}){super(),this.stopListening=null,this.cid=Vt("view"),this._declarativeEvents={},this._domEvents=[];const{model:t,collection:s,events:n}=e;Object.assign(this,{model:t,collection:s,events:n})}createRenderRoot(){return this}connectedCallback(){this._initialized||(this.preinitialize.apply(this,arguments),this.initialize.apply(this,arguments),this._initialized=!0),this.delegateEvents()}disconnectedCallback(){this.undelegateEvents(),this.stopListening?.()}preinitialize(){}initialize(){}beforeRender(){}afterRender(){}render(){return this.beforeRender(),((e,t,s)=>{var n,i;const r=null!==(n=null==s?void 0:s.renderBefore)&&void 0!==n?n:t;let o=r._$litPart$;if(void 0===o){const e=null!==(i=null==s?void 0:s.renderBefore)&&void 0!==i?i:null;r._$litPart$=o=new Es(t.insertBefore(ns(),e),e,void 0,null!=s?s:{})}o._$AI(e)})(this.toHTML(),this),this.afterRender(),this}toHTML(){return""}delegateEvents(){if(!this.events)return this;this.undelegateEvents();for(const e in this.events){let t=this.events[e];if("function"!=typeof t&&(t=this[t]),!t)continue;const s=e.match(bi);this.delegate(s[1],s[2],t.bind(this))}return this}delegate(e,t,s){const n=this;if(!n)return this;if("function"==typeof t&&(s=t,t=null),-1!==["focus","blur"].indexOf(e)){const n=this.querySelectorAll(t);for(let t=0,i=n.length;t<i;t++){const i=n[t];i.addEventListener(e,s,!1),this._domEvents.push({el:i,eventName:e,handler:s})}return s}const i=t?function(e){let i=e.target||e.srcElement;for(;i&&i!=n;i=i.parentNode)i.matches(t)&&(e.delegateTarget=i,s(e))}:s;return this.addEventListener(e,i,!1),this._domEvents.push({el:this,eventName:e,handler:i,listener:s,selector:t}),this}undelegateEvents(){if(this){for(let e=0,t=this._domEvents.length;e<t;e++){const t=this._domEvents[e];t.el.removeEventListener(t.eventName,t.handler,!1)}this._domEvents.length=0}return this}undelegate(e,t,s){if("function"==typeof t&&(s=t,t=null),this){const n=this._domEvents.slice();let i=n.length;for(;i--;){const r=n[i];!(r.eventName!==e||s&&r.listener!==s||t&&r.selector!==t)&&(r.el.removeEventListener(r.eventName,r.handler,!1),this._domEvents.splice(i,1))}}return this}}const wi=yi;var Ai=s(8781);const Si=function(){this.__data__=[],this.size=0};const xi=function(e,t){return e===t||e!=e&&t!=t};const Ei=function(e,t){for(var s=e.length;s--;)if(xi(e[s][0],t))return s;return-1};var $i=Array.prototype.splice;const Ci=function(e){var t=this.__data__,s=Ei(t,e);return!(s<0)&&(s==t.length-1?t.pop():$i.call(t,s,1),--this.size,!0)};const ki=function(e){var t=this.__data__,s=Ei(t,e);return s<0?void 0:t[s][1]};const Ti=function(e){return Ei(this.__data__,e)>-1};const ji=function(e,t){var s=this.__data__,n=Ei(s,e);return n<0?(++this.size,s.push([e,t])):s[n][1]=t,this};function Ni(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var n=e[t];this.set(n[0],n[1])}}Ni.prototype.clear=Si,Ni.prototype.delete=Ci,Ni.prototype.get=ki,Ni.prototype.has=Ti,Ni.prototype.set=ji;const Oi=Ni;const Ii=function(){this.__data__=new Oi,this.size=0};const Mi=function(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s};const Ri=function(e){return this.__data__.get(e)};const Di=function(e){return this.__data__.has(e)};const Li=Xn(Object,"create");const zi=function(){this.__data__=Li?Li(null):{},this.size=0};const Pi=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Fi=Object.prototype.hasOwnProperty;const Ui=function(e){var t=this.__data__;if(Li){var s=t[e];return"__lodash_hash_undefined__"===s?void 0:s}return Fi.call(t,e)?t[e]:void 0};var Bi=Object.prototype.hasOwnProperty;const qi=function(e){var t=this.__data__;return Li?void 0!==t[e]:Bi.call(t,e)};const Hi=function(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Li&&void 0===t?"__lodash_hash_undefined__":t,this};function Gi(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var n=e[t];this.set(n[0],n[1])}}Gi.prototype.clear=zi,Gi.prototype.delete=Pi,Gi.prototype.get=Ui,Gi.prototype.has=qi,Gi.prototype.set=Hi;const Wi=Gi;const Vi=function(){this.size=0,this.__data__={hash:new Wi,map:new(Zn||Oi),string:new Wi}};const Qi=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const Ji=function(e,t){var s=e.__data__;return Qi(t)?s["string"==typeof t?"string":"hash"]:s.map};const Yi=function(e){var t=Ji(this,e).delete(e);return this.size-=t?1:0,t};const Xi=function(e){return Ji(this,e).get(e)};const Ki=function(e){return Ji(this,e).has(e)};const Zi=function(e,t){var s=Ji(this,e),n=s.size;return s.set(e,t),this.size+=s.size==n?0:1,this};function er(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var n=e[t];this.set(n[0],n[1])}}er.prototype.clear=Vi,er.prototype.delete=Yi,er.prototype.get=Xi,er.prototype.has=Ki,er.prototype.set=Zi;const tr=er;const sr=function(e,t){var s=this.__data__;if(s instanceof Oi){var n=s.__data__;if(!Zn||n.length<199)return n.push([e,t]),this.size=++s.size,this;s=this.__data__=new tr(n)}return s.set(e,t),this.size=s.size,this};function nr(e){var t=this.__data__=new Oi(e);this.size=t.size}nr.prototype.clear=Ii,nr.prototype.delete=Mi,nr.prototype.get=Ri,nr.prototype.has=Di,nr.prototype.set=sr;const ir=nr;const rr=function(e,t){for(var s=-1,n=null==e?0:e.length;++s<n&&!1!==t(e[s],s,e););return e};const or=function(){try{var e=Xn(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const ar=function(e,t,s){"__proto__"==t&&or?or(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s};var cr=Object.prototype.hasOwnProperty;const lr=function(e,t,s){var n=e[t];cr.call(e,t)&&xi(n,s)&&(void 0!==s||t in e)||ar(e,t,s)};const dr=function(e,t,s,n){var i=!s;s||(s={});for(var r=-1,o=t.length;++r<o;){var a=t[r],c=n?n(s[a],e[a],a,s,e):void 0;void 0===c&&(c=e[a]),i?ar(s,a,c):lr(s,a,c)}return s};const ur=function(e,t){return e&&dr(t,kn(t),e)};const hr=function(e){var t=[];if(null!=e)for(var s in Object(e))t.push(s);return t};var mr=Object.prototype.hasOwnProperty;const fr=function(e){if(!Ls(e))return hr(e);var t=wn(e),s=[];for(var n in e)("constructor"!=n||!t&&mr.call(e,n))&&s.push(n);return s};const gr=function(e){return Cn(e)?bn(e,!0):fr(e)};const pr=function(e,t){return e&&dr(t,gr(t),e)};var vr="object"==typeof exports&&exports&&!exports.nodeType&&exports,_r=vr&&"object"==typeof module&&module&&!module.nodeType&&module,br=_r&&_r.exports===vr?Ct.Buffer:void 0,yr=br?br.allocUnsafe:void 0;const wr=function(e,t){if(t)return e.slice();var s=e.length,n=yr?yr(s):new e.constructor(s);return e.copy(n),n};const Ar=function(e,t){var s=-1,n=e.length;for(t||(t=Array(n));++s<n;)t[s]=e[s];return t};const Sr=function(e,t){for(var s=-1,n=null==e?0:e.length,i=0,r=[];++s<n;){var o=e[s];t(o,s,e)&&(r[i++]=o)}return r};const xr=function(){return[]};var Er=Object.prototype.propertyIsEnumerable,$r=Object.getOwnPropertySymbols;const Cr=$r?function(e){return null==e?[]:(e=Object(e),Sr($r(e),(function(t){return Er.call(e,t)})))}:xr;const kr=function(e,t){return dr(e,Cr(e),t)};const Tr=function(e,t){for(var s=-1,n=t.length,i=e.length;++s<n;)e[i+s]=t[s];return e};const jr=An(Object.getPrototypeOf,Object);var Nr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Tr(t,Cr(e)),e=jr(e);return t}:xr;const Or=Nr;const Ir=function(e,t){return dr(e,Or(e),t)};const Mr=function(e,t,s){var n=t(e);return jt(e)?n:Tr(n,s(e))};const Rr=function(e){return Mr(e,kn,Cr)};const Dr=function(e){return Mr(e,gr,Or)};var Lr=Object.prototype.hasOwnProperty;const zr=function(e){var t=e.length,s=new e.constructor(t);return t&&"string"==typeof e[0]&&Lr.call(e,"index")&&(s.index=e.index,s.input=e.input),s};const Pr=Ct.Uint8Array;const Fr=function(e){var t=new e.constructor(e.byteLength);return new Pr(t).set(new Pr(e)),t};const Ur=function(e,t){var s=t?Fr(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)};var Br=/\w*$/;const qr=function(e){var t=new e.constructor(e.source,Br.exec(e));return t.lastIndex=e.lastIndex,t};var Hr=kt?kt.prototype:void 0,Gr=Hr?Hr.valueOf:void 0;const Wr=function(e){return Gr?Object(Gr.call(e)):{}};const Vr=function(e,t){var s=t?Fr(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)};const Qr=function(e,t,s){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return Fr(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Ur(e,s);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Vr(e,s);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return qr(e);case"[object Symbol]":return Wr(e)}};var Jr=Object.create,Yr=function(){function e(){}return function(t){if(!Ls(t))return{};if(Jr)return Jr(t);e.prototype=t;var s=new e;return e.prototype=void 0,s}}();const Xr=Yr;const Kr=function(e){return"function"!=typeof e.constructor||wn(e)?{}:Xr(jr(e))};const Zr=function(e){return Ft(e)&&"[object Map]"==fi(e)};var eo=gn&&gn.isMap;const to=eo?un(eo):Zr;const so=function(e){return Ft(e)&&"[object Set]"==fi(e)};var no=gn&&gn.isSet;const io=no?un(no):so;var ro="[object Arguments]",oo="[object Function]",ao="[object Object]",co={};co[ro]=co["[object Array]"]=co["[object ArrayBuffer]"]=co["[object DataView]"]=co["[object Boolean]"]=co["[object Date]"]=co["[object Float32Array]"]=co["[object Float64Array]"]=co["[object Int8Array]"]=co["[object Int16Array]"]=co["[object Int32Array]"]=co["[object Map]"]=co["[object Number]"]=co[ao]=co["[object RegExp]"]=co["[object Set]"]=co["[object String]"]=co["[object Symbol]"]=co["[object Uint8Array]"]=co["[object Uint8ClampedArray]"]=co["[object Uint16Array]"]=co["[object Uint32Array]"]=!0,co["[object Error]"]=co[oo]=co["[object WeakMap]"]=!1;const lo=function e(t,s,n,i,r,o){var a,c=1&s,l=2&s,d=4&s;if(n&&(a=r?n(t,i,r,o):n(t)),void 0!==a)return a;if(!Ls(t))return t;var u=jt(t);if(u){if(a=zr(t),!c)return Ar(t,a)}else{var h=fi(t),m=h==oo||"[object GeneratorFunction]"==h;if(rn(t))return wr(t,c);if(h==ao||h==ro||m&&!r){if(a=l||m?{}:Kr(t),!c)return l?Ir(t,pr(a,t)):kr(t,ur(a,t))}else{if(!co[h])return r?t:{};a=Qr(t,h,c)}}o||(o=new ir);var f=o.get(t);if(f)return f;o.set(t,a),io(t)?t.forEach((function(i){a.add(e(i,s,n,i,t,o))})):to(t)&&t.forEach((function(i,r){a.set(r,e(i,s,n,r,t,o))}));var g=u?void 0:(d?l?Dr:Rr:l?gr:kn)(t);return rr(g||t,(function(i,r){g&&(i=t[r=i]),lr(a,r,e(i,s,n,r,t,o))})),a};const uo=function(e){return lo(e,5)};const ho=function(e){return"string"==typeof e||!jt(e)&&Ft(e)&&"[object String]"==Pt(e)};const mo=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();const fo=function(){try{if(!mo||!mo.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};const go=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var s=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)s.append(e[n]);return s.getBlob(t.type)}};"undefined"==typeof Promise&&s(1078);const po=Promise;const vo=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))};const _o=function(e,t,s){"function"==typeof t&&e.then(t),"function"==typeof s&&e.catch(s)};function bo(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function yo(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const wo="local-forage-detect-blob-support";let Ao;const So={},xo=Object.prototype.toString,Eo="readonly",$o="readwrite";function Co(e){return"boolean"==typeof Ao?po.resolve(Ao):function(e){return new po((function(t){var s=e.transaction(wo,$o),n=go([""]);s.objectStore(wo).put(n,"key"),s.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},s.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),s=navigator.userAgent.match(/Edge\//);t(s||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return Ao=e,Ao}))}function ko(e){var t=So[e.name],s={};s.promise=new po((function(e,t){s.resolve=e,s.reject=t})),t.deferredOperations.push(s),t.dbReady?t.dbReady=t.dbReady.then((function(){return s.promise})):t.dbReady=s.promise}function To(e){var t=So[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function jo(e,t){var s=So[e.name].deferredOperations.pop();if(s)return s.reject(t),s.promise}function No(e,t){return new po((function(s,n){if(So[e.name]=So[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return s(e.db);ko(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=mo.open.apply(mo,i);t&&(r.onupgradeneeded=function(t){var s=r.result;try{s.createObjectStore(e.storeName),t.oldVersion<=1&&s.createObjectStore(wo)}catch(s){if("ConstraintError"!==s.name)throw s;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),n(r.error)},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close()},s(t),To(e)}}))}function Oo(e){return No(e,!1)}function Io(e){return No(e,!0)}function Mo(e,t){if(!e.db)return!0;var s=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||s){if(s){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function Ro(e){var t=function(e){for(var t=e.length,s=new ArrayBuffer(t),n=new Uint8Array(s),i=0;i<t;i++)n[i]=e.charCodeAt(i);return s}(atob(e.data));return go([t],{type:e.type})}function Do(e){return e&&e.__local_forage_encoded_blob}function Lo(e){var t=this,s=t._initReady().then((function(){var e=So[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return _o(s,e,e),s}function zo(e,t,s,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);s(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return po.resolve().then((()=>{if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),Io(e)})).then((()=>function(e){ko(e);for(var t=So[e.name],s=t.forages,n=0;n<s.length;n++){const e=s[n];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return e.db=null,Oo(e).then((t=>(e.db=t,Mo(e)?Io(e):t))).then((n=>{e.db=t.db=n;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=n})).catch((t=>{throw jo(e,t),t}))}(e).then((function(){zo(e,t,s,n-1)})))).catch(s);s(i)}}var Po={_driver:"asyncStorage",_initStorage:function(e){var t=this,s={db:null};if(e)for(var n in e)s[n]=e[n];var i=So[s.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},So[s.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=Lo);var r=[];function o(){return po.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&r.push(c._initReady().catch(o))}var l=i.forages.slice(0);return po.all(r).then((function(){return s.db=i.db,Oo(s)})).then((function(e){return s.db=e,Mo(s,t._defaultConfig.version)?Io(s):e})).then((function(e){s.db=i.db=e,t._dbInfo=s;for(var n=0;n<l.length;n++){var r=l[n];r!==t&&(r._dbInfo.db=s.db,r._dbInfo.version=s.version)}}))},_support:fo(),iterate:function(e,t){var s=this,n=new po((function(t,n){s.ready().then((function(){zo(s._dbInfo,Eo,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var s=o.result;if(s){var n=s.value;Do(n)&&(n=Ro(n));var i=e(n,s.key,a++);void 0!==i?t(i):s.continue()}else t()},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return vo(n,t),n},getItem:function(e,t){var s=this;e=bo(e);var n=new po((function(t,n){s.ready().then((function(){zo(s._dbInfo,Eo,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),Do(e)&&(e=Ro(e)),t(e)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return vo(n,t),n},setItem:function(e,t,s){var n=this;e=bo(e);var i=new po((function(s,i){var r;n.ready().then((function(){return r=n._dbInfo,"[object Blob]"===xo.call(t)?Co(r.db).then((function(e){return e?t:(s=t,new po((function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){var n=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:s.type})},n.readAsBinaryString(s)})));var s})):t})).then((function(t){zo(n._dbInfo,$o,(function(r,o){if(r)return i(r);try{var a=o.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),s(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return vo(i,s),i},removeItem:function(e,t){var s=this;e=bo(e);var n=new po((function(t,n){s.ready().then((function(){zo(s._dbInfo,$o,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){n(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return vo(n,t),n},clear:function(e){var t=this,s=new po((function(e,s){t.ready().then((function(){zo(t._dbInfo,$o,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return vo(s,e),s},length:function(e){var t=this,s=new po((function(e,s){t.ready().then((function(){zo(t._dbInfo,Eo,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return vo(s,e),s},key:function(e,t){var s=this,n=new po((function(t,n){e<0?t(null):s.ready().then((function(){zo(s._dbInfo,Eo,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var s=c.result;s?0===e||a?t(s.key):(a=!0,s.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}}))})).catch(n)}));return vo(n,t),n},keys:function(e){var t=this,s=new po((function(e,s){t.ready().then((function(){zo(t._dbInfo,Eo,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return vo(s,e),s},dropInstance:function(e,t){t=yo.apply(this,arguments);var s,n=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),e.name){const t=e.name===n.name&&this._dbInfo.db?po.resolve(this._dbInfo.db):Oo(e).then((t=>{const s=So[e.name],n=s.forages;s.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}));s=e.storeName?t.then((t=>{if(!t.objectStoreNames.contains(e.storeName))return;const s=t.version+1;ko(e);const n=So[e.name],i=n.forages;t.close();for(let e=0;e<i.length;e++){const t=i[e];t._dbInfo.db=null,t._dbInfo.version=s}const r=new po(((t,n)=>{const i=mo.open(e.name,s);i.onerror=e=>{i.result.close(),n(e)},i.onupgradeneeded=()=>{i.result.deleteObjectStore(e.storeName)},i.onsuccess=()=>{const e=i.result;e.close(),t(e)}}));return r.then((e=>{n.db=e;for(let t=0;t<i.length;t++){const s=i[t];s._dbInfo.db=e,To(s._dbInfo)}})).catch((t=>{throw(jo(e,t)||po.resolve()).catch((()=>{})),t}))})):t.then((t=>{ko(e);const s=So[e.name],n=s.forages;t.close();for(var i=0;i<n.length;i++){n[i]._dbInfo.db=null}const r=new po(((t,s)=>{var n=mo.deleteDatabase(e.name);n.onerror=()=>{const e=n.result;e&&e.close(),s(n.error)},n.onblocked=()=>{console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=()=>{const e=n.result;e&&e.close(),t(e)}}));return r.then((e=>{s.db=e;for(var t=0;t<n.length;t++){To(n[t]._dbInfo)}})).catch((t=>{throw(jo(e,t)||po.resolve()).catch((()=>{})),t}))}))}else s=po.reject("Invalid arguments");return vo(s,t),s}};const Fo=Po;const Uo=function(){return"function"==typeof openDatabase};var Bo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qo=/^~~local_forage_type~([^~]+)~/,Ho="__lfsc__:",Go="arbf",Wo="blob",Vo="si08",Qo="ui08",Jo="uic8",Yo="si16",Xo="si32",Ko="ur16",Zo="ui32",ea="fl32",ta="fl64",sa=Object.prototype.toString;function na(e){var t,s,n,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)s=Bo.indexOf(e[t]),n=Bo.indexOf(e[t+1]),i=Bo.indexOf(e[t+2]),r=Bo.indexOf(e[t+3]),d[c++]=s<<2|n>>4,d[c++]=(15&n)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function ia(e){var t,s=new Uint8Array(e),n="";for(t=0;t<s.length;t+=3)n+=Bo[s[t]>>2],n+=Bo[(3&s[t])<<4|s[t+1]>>4],n+=Bo[(15&s[t+1])<<2|s[t+2]>>6],n+=Bo[63&s[t+2]];return s.length%3==2?n=n.substring(0,n.length-1)+"=":s.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var ra={serialize:function(e,t){var s="";if(e&&(s=sa.call(e)),e&&("[object ArrayBuffer]"===s||e.buffer&&"[object ArrayBuffer]"===sa.call(e.buffer))){var n,i=Ho;e instanceof ArrayBuffer?(n=e,i+=Go):(n=e.buffer,"[object Int8Array]"===s?i+=Vo:"[object Uint8Array]"===s?i+=Qo:"[object Uint8ClampedArray]"===s?i+=Jo:"[object Int16Array]"===s?i+=Yo:"[object Uint16Array]"===s?i+=Ko:"[object Int32Array]"===s?i+=Xo:"[object Uint32Array]"===s?i+=Zo:"[object Float32Array]"===s?i+=ea:"[object Float64Array]"===s?i+=ta:t(new Error("Failed to get type for BinaryArray"))),t(i+ia(n))}else if("[object Blob]"===s){var r=new FileReader;r.onload=function(){var s="~~local_forage_type~"+e.type+"~"+ia(this.result);t(Ho+Wo+s)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(s){console.error("Couldn't convert value into a JSON string: ",e),t(null,s)}},deserialize:function(e){if(e.substring(0,9)!==Ho)return JSON.parse(e);var t,s=e.substring(13),n=e.substring(9,13);if(n===Wo&&qo.test(s)){var i=s.match(qo);t=i[1],s=s.substring(i[0].length)}var r=na(s);switch(n){case Go:return r;case Wo:return go([r],{type:t});case Vo:return new Int8Array(r);case Qo:return new Uint8Array(r);case Jo:return new Uint8ClampedArray(r);case Yo:return new Int16Array(r);case Ko:return new Uint16Array(r);case Xo:return new Int32Array(r);case Zo:return new Uint32Array(r);case ea:return new Float32Array(r);case ta:return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:na,bufferToString:ia};const oa=ra;function aa(e,t,s,n){e.executeSql(`CREATE TABLE IF NOT EXISTS ${t.storeName} (id INTEGER PRIMARY KEY, key unique, value)`,[],s,n)}function ca(e,t,s,n,i,r){e.executeSql(s,n,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):aa(e,t,(function(){e.executeSql(s,n,i,r)}),r)}),r):r(e,o)}),r)}function la(e,t,s,n){var i=this;e=bo(e);var r=new po((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(s){ca(s,c,`INSERT OR REPLACE INTO ${c.storeName} (key, value) VALUES (?, ?)`,[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void r(la.apply(i,[e,a,s,n-1]));o(t)}}))}))})).catch(o)}));return vo(r,s),r}var da={_driver:"webSQLStorage",_initStorage:function(e){var t=this,s={db:null};if(e)for(var n in e)s[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new po((function(e,n){try{s.db=openDatabase(s.name,String(s.version),s.description,s.size)}catch(e){return n(e)}s.db.transaction((function(i){aa(i,s,(function(){t._dbInfo=s,e()}),(function(e,t){n(t)}))}),n)}));return s.serializer=oa,i},_support:Uo(),iterate:function(e,t){var s=this,n=new po((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ca(s,i,`SELECT * FROM ${i.storeName}`,[],(function(s,n){for(var r=n.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return vo(n,t),n},getItem:function(e,t){var s=this;e=bo(e);var n=new po((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ca(s,i,`SELECT * FROM ${i.storeName} WHERE key = ? LIMIT 1`,[e],(function(e,s){var n=s.rows.length?s.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return vo(n,t),n},setItem:function(e,t,s){return la.apply(this,[e,t,s,1])},removeItem:function(e,t){var s=this;e=bo(e);var n=new po((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ca(s,i,`DELETE FROM ${i.storeName} WHERE key = ?`,[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return vo(n,t),n},clear:function(e){var t=this,s=new po((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ca(t,n,`DELETE FROM ${n.storeName}`,[],(function(){e()}),(function(e,t){s(t)}))}))})).catch(s)}));return vo(s,e),s},length:function(e){var t=this,s=new po((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ca(t,n,`SELECT COUNT(key) as c FROM ${n.storeName}`,[],(function(t,s){var n=s.rows.item(0).c;e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return vo(s,e),s},key:function(e,t){var s=this,n=new po((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ca(s,i,`SELECT key FROM ${i.storeName} WHERE id = ? LIMIT 1`,[e+1],(function(e,s){var n=s.rows.length?s.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return vo(n,t),n},keys:function(e){var t=this,s=new po((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ca(t,n,`SELECT key FROM ${n.storeName}`,[],(function(t,s){for(var n=[],i=0;i<s.rows.length;i++)n.push(s.rows.item(i).key);e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return vo(s,e),s},dropInstance:function(e,t){t=yo.apply(this,arguments);var s=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName);var n,i=this;return n=e.name?new po((function(t){var n;n=e.name===s.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(function(e){return new po((function(t,s){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(s,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){s(t)}))}),(function(e){s(e)}))}))}(n))})).then((function(e){return new po((function(t,s){e.db.transaction((function(n){function i(e){return new po((function(t,s){n.executeSql(`DROP TABLE IF EXISTS ${e}`,[],(function(){t()}),(function(e,t){s(t)}))}))}for(var r=[],o=0,a=e.storeNames.length;o<a;o++)r.push(i(e.storeNames[o]));po.all(r).then((function(){t()})).catch((function(e){s(e)}))}),(function(e){s(e)}))}))})):po.reject("Invalid arguments"),vo(n,t),n}};const ua=da;function ha(e,t){var s=e.name+"/";return e.storeName!==t.storeName&&(s+=e.storeName+"/"),s}function ma(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var fa={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var s in e)t[s]=e[s];return t.keyPrefix=ha(e,this._defaultConfig),ma()?(this._dbInfo=t,t.serializer=oa,po.resolve()):po.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var s=this,n=s.ready().then((function(){for(var t=s._dbInfo,n=t.keyPrefix,i=n.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(n)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return vo(n,t),n},getItem:function(e,t){var s=this;e=bo(e);var n=s.ready().then((function(){var t=s._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return vo(n,t),n},setItem:function(e,t,s){var n=this;e=bo(e);var i=n.ready().then((function(){void 0===t&&(t=null);var s=t;return new po((function(i,r){var o=n._dbInfo;o.serializer.serialize(t,(function(t,n){if(n)r(n);else try{localStorage.setItem(o.keyPrefix+e,t),i(s)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return vo(i,s),i},removeItem:function(e,t){var s=this;e=bo(e);var n=s.ready().then((function(){var t=s._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return vo(n,t),n},clear:function(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,s=localStorage.length-1;s>=0;s--){var n=localStorage.key(s);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return vo(s,e),s},length:function(e){var t=this.keys().then((function(e){return e.length}));return vo(t,e),t},key:function(e,t){var s=this,n=s.ready().then((function(){var t,n=s._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return vo(n,t),n},keys:function(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo,s=localStorage.length,n=[],i=0;i<s;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n}));return vo(s,e),s},dropInstance:function(e,t){if(t=yo.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var s=this.config();e.name=e.name||s.name,e.storeName=e.storeName||s.storeName}var n,i=this;return n=e.name?new po((function(t){e.storeName?t(ha(e,i._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var s=localStorage.key(t);0===s.indexOf(e)&&localStorage.removeItem(s)}})):po.reject("Invalid arguments"),vo(n,t),n}};const ga=fa,pa=(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),va=(e,t)=>{const s=e.length;let n=0;for(;n<s;){if(pa(e[n],t))return!0;n++}return!1},_a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ba={},ya={},wa={INDEXEDDB:Fo,WEBSQL:ua,LOCALSTORAGE:ga},Aa=[wa.INDEXEDDB._driver,wa.WEBSQL._driver,wa.LOCALSTORAGE._driver],Sa=["dropInstance"],xa=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Sa),Ea={description:"",driver:Aa.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function $a(e,t){e[t]=function(){const s=arguments;return e.ready().then((function(){return e[t].apply(e,s)}))}}function Ca(){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(t)for(let e in t)t.hasOwnProperty(e)&&(_a(t[e])?arguments[0][e]=t[e].slice():arguments[0][e]=t[e])}return arguments[0]}class ka{constructor(e){for(let e in wa)if(wa.hasOwnProperty(e)){const t=wa[e],s=t._driver;this[e]=s,ba[s]||this.defineDriver(t)}this._defaultConfig=Ca({},Ea),this._config=Ca({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}))}config(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config}defineDriver(e,t,s){const n=new po((function(t,s){try{const n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void s(i);const r=xa.concat("_initStorage");for(let t=0,n=r.length;t<n;t++){const n=r[t];if((!va(Sa,n)||e[n])&&"function"!=typeof e[n])return void s(i)}const o=function(){const t=function(e){return function(){const t=new Error(`Method ${e} is not implemented by the current driver`),s=po.reject(t);return vo(s,arguments[arguments.length-1]),s}};for(let s=0,n=Sa.length;s<n;s++){const n=Sa[s];e[n]||(e[n]=t(n))}};o();const a=function(s){ba[n]&&console.info(`Redefining LocalForage driver: ${n}`),ba[n]=e,ya[n]=s,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(a,s):a(!!e._support):a(!0)}catch(e){s(e)}}));return _o(n,t,s),n}driver(){return this._driver||null}getDriver(e,t,s){const n=ba[e]?po.resolve(ba[e]):po.reject(new Error("Driver not found."));return _o(n,t,s),n}getSerializer(e){const t=po.resolve(oa);return _o(t,e),t}ready(e){const t=this,s=t._driverSet.then((()=>(null===t._ready&&(t._ready=t._initDriver()),t._ready)));return _o(s,e,e),s}setDriver(e,t,s){const n=this;_a(e)||(e=[e]);const i=this._getSupportedDrivers(e);function r(){n._config.driver=n.driver()}function o(e){return n._extend(e),r(),n._ready=n._initStorage(n._config),n._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>po.resolve())):po.resolve();return this._driverSet=a.then((()=>{const e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((e=>{n._driver=e._driver,r(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){let t=0;return function s(){for(;t<e.length;){let i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(o).catch(s)}r();const i=new Error("No available storage method found.");return n._driverSet=po.reject(i),n._driverSet}()}}(i)}))})).catch((()=>{r();const e=new Error("No available storage method found.");return n._driverSet=po.reject(e),n._driverSet})),_o(this._driverSet,t,s),this._driverSet}supports(e){return!!ya[e]}_extend(e){Ca(this,e)}_getSupportedDrivers(e){const t=[];for(let s=0,n=e.length;s<n;s++){const n=e[s];this.supports(n)&&t.push(n)}return t}_wrapLibraryMethodsWithReady(){for(let e=0,t=xa.length;e<t;e++)$a(this,xa[e])}createInstance(e){return new ka(e)}}const Ta=new ka;const ja=function(e,t,s){(void 0!==s&&!xi(e[t],s)||void 0===s&&!(t in e))&&ar(e,t,s)};const Na=function(e){return function(t,s,n){for(var i=-1,r=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===s(r[c],c,r))break}return t}};const Oa=Na();const Ia=function(e){return Ft(e)&&Cn(e)};var Ma=Function.prototype,Ra=Object.prototype,Da=Ma.toString,La=Ra.hasOwnProperty,za=Da.call(Object);const Pa=function(e){if(!Ft(e)||"[object Object]"!=Pt(e))return!1;var t=jr(e);if(null===t)return!0;var s=La.call(t,"constructor")&&t.constructor;return"function"==typeof s&&s instanceof s&&Da.call(s)==za};const Fa=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};const Ua=function(e){return dr(e,gr(e))};const Ba=function(e,t,s,n,i,r,o){var a=Fa(e,s),c=Fa(t,s),l=o.get(c);if(l)ja(e,s,l);else{var d=r?r(a,c,s+"",e,t,o):void 0,u=void 0===d;if(u){var h=jt(c),m=!h&&rn(c),f=!h&&!m&&vn(c);d=c,h||m||f?jt(a)?d=a:Ia(a)?d=Ar(a):m?(u=!1,d=wr(c,!0)):f?(u=!1,d=Vr(c,!0)):d=[]:Pa(c)||Zs(c)?(d=a,Zs(a)?d=Ua(a):Ls(a)&&!$n(a)||(d=Kr(c))):u=!1}u&&(o.set(c,d),i(d,c,n,r,o),o.delete(c)),ja(e,s,d)}};const qa=function e(t,s,n,i,r){t!==s&&Oa(s,(function(o,a){if(r||(r=new ir),Ls(o))Ba(t,s,a,n,e,i,r);else{var c=i?i(Fa(t,a),o,a+"",t,s,r):void 0;void 0===c&&(c=o),ja(t,a,c)}}),gr)};const Ha=function(e){return e};const Ga=function(e,t,s){switch(s.length){case 0:return e.call(t);case 1:return e.call(t,s[0]);case 2:return e.call(t,s[0],s[1]);case 3:return e.call(t,s[0],s[1],s[2])}return e.apply(t,s)};var Wa=Math.max;const Va=function(e,t,s){return t=Wa(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,r=Wa(n.length-t,0),o=Array(r);++i<r;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=s(o),Ga(e,this,a)}};const Qa=function(e){return function(){return e}};const Ja=or?function(e,t){return or(e,"toString",{configurable:!0,enumerable:!1,value:Qa(t),writable:!0})}:Ha;var Ya=Date.now;const Xa=function(e){var t=0,s=0;return function(){var n=Ya(),i=16-(n-s);if(s=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Ja);const Ka=function(e,t){return Xa(Va(e,t,Ha),e+"")};const Za=function(e,t,s){if(!Ls(s))return!1;var n=typeof t;return!!("number"==n?Cn(s)&&an(t,s.length):"string"==n&&t in s)&&xi(s[t],e)};const ec=function(e){return Ka((function(t,s){var n=-1,i=s.length,r=i>1?s[i-1]:void 0,o=i>2?s[2]:void 0;for(r=e.length>3&&"function"==typeof r?(i--,r):void 0,o&&Za(s[0],s[1],o)&&(r=i<3?void 0:r,i=1),t=Object(t);++n<i;){var a=s[n];a&&e(t,a,n,r)}return t}))};const tc=ec((function(e,t,s){qa(e,t,s)}));const sc=ec((function(e,t,s,n){qa(e,t,s,n)}));const nc=function(){return Ct.Date.now()};function ic(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,s)=>{e.resolve=t,e.reject=s}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}const rc=Math.max,oc=Math.min;const ac=function(e,t,s={}){let n,i,r,o,a,c,l=0,d=!1,u=s.promise?ic():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const r=n,a=i,c=u;return n=i=void 0,l=t,o=e.apply(a,r),s.promise&&(c.resolve(o),u=ic()),s.promise?c:o}function m(e){const s=e-c;return void 0===c||s>=t||s<0||d&&e-l>=r}function f(){const e=nc();if(m(e))return g(e);a=setTimeout(f,function(e){const s=t-(e-c);return d?oc(s,r-(e-l)):s}(e))}function g(e){return a=void 0,n?h(e):(n=i=void 0,s.promise?u:o)}function p(e,t){if(Array.isArray(e)&&Array.isArray(t))return s?.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function v(){const e=nc(),r=m(e);var g;if(g=Array.from(arguments),n=n?.length?g.length?s?.concatArrays||s?.dedupeArrays?sc(n,g,p):tc(n,g):n:g||[],i=this,c=e,r){if(void 0===a)return function(e){return l=e,a=setTimeout(f,t),s.promise?u:o}(c);if(d)return clearTimeout(a),a=setTimeout(f,t),h(c)}return void 0===a&&(a=setTimeout(f,t)),s.promise?u:o}return t=Bs(t)||0,Ls(s)&&(d="maxWait"in s,r=d?rc(Bs(s.maxWait)||0,t):r),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,n=c=i=a=void 0},v.flush=function(){return void 0===a?o:g(nc())},v};function cc(e,t){let s=e.name+"/";return e.storeName!==t.storeName&&(s+=e.storeName+"/"),s}const lc={serializer:{serialize:oa.serialize,deserialize:oa.deserialize}};const dc={_driver:"sessionStorageWrapper",_initStorage:function(e){if(lc.keyPrefix=cc(e,this._defaultConfig),e)for(const t in e)lc[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const s=this.ready().then((function(){const t=lc.keyPrefix,s=t.length,n=sessionStorage.length;let i=1;for(let r=0;r<n;r++){const n=sessionStorage.key(r);if(0!==n.indexOf(t))continue;let o=sessionStorage.getItem(n);if(o&&(o=lc.serializer.deserialize(o)),o=e(o,n.substring(s),i++),void 0!==o)return o}}));return vo(s,t),s},getItem:function(e,t){e=bo(e);const s=this.ready().then((function(){let t=sessionStorage.getItem(lc.keyPrefix+e);return t&&(t=lc.serializer.deserialize(t)),t}));return vo(s,t),s},setItem:async function(e,t,s){e=bo(e),await this.ready();const n=t=t??null;lc.serializer.serialize(t,((t,i)=>{if(i)throw i;try{sessionStorage.setItem(lc.keyPrefix+e,t),vo(Promise.resolve(n),s)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}}))},removeItem:function(e,t){e=bo(e);const s=this.ready().then((function(){sessionStorage.removeItem(lc.keyPrefix+e)}));return vo(s,t),s},clear:function(e){const t=this.ready().then((function(){const e=lc.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const s=sessionStorage.key(t);0===s.indexOf(e)&&sessionStorage.removeItem(s)}}));return vo(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return vo(t,e),t},key:function(e,t){const s=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(lc.keyPrefix.length)),t}));return vo(s,t),s},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let s=0;s<e;s++){const e=sessionStorage.key(s);0===e.indexOf(lc.keyPrefix)&&t.push(e.substring(lc.keyPrefix.length))}return t}));return vo(t,e),t},dropInstance:function(e,t){if(t=yo.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const s=this;let n;return n=e.name?new Promise((function(t){e.storeName?t(cc(e,s._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const s=sessionStorage.key(t);0===s.indexOf(e)&&sessionStorage.removeItem(s)}})):Promise.reject(new Error("Invalid arguments")),vo(n,t),n}},uc=dc;var hc=s(9212),mc=s(9214);function fc(e){return fc.result?fc.result:e&&"function"==typeof e.getSerializer?(fc.result=e.getSerializer(),fc.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function gc(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function pc(e,t){var s=this.getItem(e).then((function(t){return{key:e,value:t}}));return gc(s,t),s}function vc(e){var t=this,s=new Promise((function(s,n){for(var i=[],r=0,o=e.length;r<o;r++)i.push(pc.call(t,e[r]));Promise.all(i).then((function(e){for(var t={},n=0,i=e.length;n<i;n++){var r=e[n];t[r.key]=r.value}s(t)})).catch(n)}));return s}function _c(){var e={};return this.iterate((function(t,s){e[s]=t})).then((function(){return e}))}var bc="undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0;function yc(e){e=e.slice();var t=this;function s(e,t){return e<t?-1:e>t?1:0}var n=new Promise((function(n,i){t.ready().then((function(){var r,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),c=e.sort(s),l=bc.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(r=a.getAll(l)).onsuccess=function(){var e=r.result;void 0===e&&(e=null),n(e)};else{r=a.openCursor(l);var d={},u=0;r.onsuccess=function(){var e=r.result;if(e){for(var t=e.key;t>c[u];)if(++u===c.length)return void n(d);if(t===c[u]){var s=e.value;void 0===s&&(s=null),d[t]=s,e.continue()}else e.continue(c[u])}else n(d)}}r.onerror=function(){i(r.error)}})).catch(i)}));return n}function wc(e){var t=this,s=new Promise((function(s,n){t.ready().then((function(){return fc(t)})).then((function(i){var r=t._dbInfo;r.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+r.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var n={},r=t.rows,o=0,a=r.length;o<a;o++){var c=r.item(o),l=c.value;l&&(l=i.deserialize(l)),n[c.key]=l}s(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s}function Ac(e,t){var s,n=this;if(arguments.length&&null!==e){var i=n.driver();s=i===n.INDEXEDDB?yc.apply(n,arguments):i===n.WEBSQL?wc.apply(n,arguments):vc.apply(n,arguments)}else s=_c.apply(n);return gc(s,t),s}function Sc(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=Ac,t.getItems.indexedDB=function(){return yc.apply(this,arguments)},t.getItems.websql=function(){return wc.apply(this,arguments)},t.getItems.generic=function(){return vc.apply(this,arguments)})}Sc(s.n(mc)());var xc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ec=/^\w*$/;const $c=function(e,t){if(jt(e))return!1;var s=typeof e;return!("number"!=s&&"symbol"!=s&&"boolean"!=s&&null!=e&&!Ut(e))||(Ec.test(e)||!xc.test(e)||null!=t&&e in Object(t))};function Cc(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var s=function(){var n=arguments,i=t?t.apply(this,n):n[0],r=s.cache;if(r.has(i))return r.get(i);var o=e.apply(this,n);return s.cache=r.set(i,o)||r,o};return s.cache=new(Cc.Cache||tr),s}Cc.Cache=tr;const kc=Cc;const Tc=function(e){var t=kc(e,(function(e){return 500===s.size&&s.clear(),e})),s=t.cache;return t};var jc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Nc=/\\(\\)?/g,Oc=Tc((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(jc,(function(e,s,n,i){t.push(n?i.replace(Nc,"$1"):s||e)})),t}));const Ic=Oc;const Mc=function(e,t){return jt(e)?e:$c(e,t)?[e]:Ic(Gt(e))};const Rc=function(e){if("string"==typeof e||Ut(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};const Dc=function(e,t,s){var n=-1,i=(t=Mc(t,e)).length;for(i||(i=1,e=void 0);++n<i;){var r=null==e?void 0:e[Rc(t[n])];void 0===r&&(n=i,r=s),e=$n(r)?r.call(e):r}return e};function Lc(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function zc(){const e={isResolved:!1,isPending:!0,isRejected:!1,resolve:null,reject:null},t=new Promise(((t,s)=>{e.resolve=t,e.reject=s}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function Pc(){throw new Error('A "url" property or function must be specified')}function Fc(e,t){const s=t.error;t.error=function(n){s&&s.call(t.context,e,n,t),e.trigger("error",e,n,t)}}const Uc={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function Bc(e){const t=Dc(e,"browserStorage")||Dc(e.collection,"browserStorage");return t?t.sync():qc}function qc(e,t,s={}){let n=s.data;null!=n||!t||"create"!==e&&"update"!==e&&"patch"!==e||(n=s.attrs||t.toJSON());const i={method:Uc[e],body:n?JSON.stringify(n):"",success:s.success,error:s.error},r=s.url||Dc(t,"url")||Pc(),o=s.xhr=fetch(r,i);return t.trigger("request",t,o,{...i,xhr:o}),o}const Hc=Ai._driver;Ta.defineDriver(Ai),(0,hc.extendPrototype)(Ta),Sc(Ta);class Gc{constructor(e,t,s=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");ho(t)?this.storeInitialized=this.initStore(t,s):(this.store=t,s&&(this.store.debouncedSetItems=ac((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)await Ta.setDriver(uc._driver);else if("local"===e)await Ta.config({driver:Ta.LOCALSTORAGE});else if("in_memory"===e)await Ta.config({driver:Hc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=Ta,t&&(this.store.debouncedSetItems=ac((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){return this.store.debouncedSetItems?.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(){const e=this;async function t(t,s,n){let i,r,o,a;const c=s.collection;["patch","update"].includes(t)&&(a=uo(s.attributes)),await e.storeInitialized;try{const r=s.attributes;switch(t){case"read":i=void 0!==s.id?await e.find(s):await e.findAll();break;case"create":i=await e.create(s,n);break;case"patch":case"update":n.wait&&(s.attributes=a),o=e.update(s),n.wait&&(s.attributes=r),i=await o;break;case"delete":i=await e.destroy(s,c)}}catch(t){r=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(i){if(n&&n.success){const e="read"===t?i:null;n.success(e,n)}}else r=r||"Record Not Found",n&&n.error&&n.error(r)}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const s=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,s)}addCollectionReference(e,t){if(!t)return;const s=t.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);return s.includes(n)||s.push(n),this.store.setItem(this.name,s)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),s=this.getItemName(e.id);t.includes(s)||t.push(s);const n={};return n[this.name]=t,n}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),s=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),s}}create(e,t){return e.id||(e.id=Lc()+Lc()+"-"+Lc()+"-"+Lc()+"-"+Lc()+"-"+Lc()+Lc()+Lc(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);if(e?.length){const t=await this.store.getItems(e);return Object.values(t)}return[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}Gc.sessionStorageInitialized=Ta.defineDriver(uc),Gc.localForage=Ta;const Wc=Gc;const Vc=function(e){return lo(e,4)};var Qc=Object.prototype,Jc=Qc.hasOwnProperty,Yc=Ka((function(e,t){e=Object(e);var s=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&Za(t[0],t[1],i)&&(n=1);++s<n;)for(var r=t[s],o=gr(r),a=-1,c=o.length;++a<c;){var l=o[a],d=e[l];(void 0===d||xi(d,Qc[l])&&!Jc.call(e,l))&&(e[l]=r[l])}return e}));const Xc=Yc;const Kc=function(e,t,s){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,s)}),t)};const Zc=Ka((function(e,t){return Kc(e,1,t)}));var el=Object.prototype.hasOwnProperty;const tl=function(e,t){return null!=e&&el.call(e,t)};const sl=function(e,t,s){for(var n=-1,i=(t=Mc(t,e)).length,r=!1;++n<i;){var o=Rc(t[n]);if(!(r=null!=e&&s(e,o)))break;e=e[o]}return r||++n!=i?r:!!(i=null==e?0:e.length)&&cn(i)&&an(o,i)&&(jt(e)||Zs(e))};const nl=function(e,t){return null!=e&&sl(e,t,tl)};const il=function(e,t){return e&&Oa(e,t,kn)};const rl=function(e,t,s,n){return il(e,(function(e,i,r){t(n,s(e),i,r)})),n};const ol=function(e,t){return function(s,n){return rl(s,e,t(n),{})}};var al=Object.prototype.toString,cl=ol((function(e,t,s){null!=t&&"function"!=typeof t.toString&&(t=al.call(t)),e[t]=s}),Qa(Ha));const ll=cl;const dl=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const ul=function(e){return this.__data__.has(e)};function hl(e){var t=-1,s=null==e?0:e.length;for(this.__data__=new tr;++t<s;)this.add(e[t])}hl.prototype.add=hl.prototype.push=dl,hl.prototype.has=ul;const ml=hl;const fl=function(e,t){for(var s=-1,n=null==e?0:e.length;++s<n;)if(t(e[s],s,e))return!0;return!1};const gl=function(e,t){return e.has(t)};const pl=function(e,t,s,n,i,r){var o=1&s,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=r.get(e),d=r.get(t);if(l&&d)return l==t&&d==e;var u=-1,h=!0,m=2&s?new ml:void 0;for(r.set(e,t),r.set(t,e);++u<a;){var f=e[u],g=t[u];if(n)var p=o?n(g,f,u,t,e,r):n(f,g,u,e,t,r);if(void 0!==p){if(p)continue;h=!1;break}if(m){if(!fl(t,(function(e,t){if(!gl(m,t)&&(f===e||i(f,e,s,n,r)))return m.push(t)}))){h=!1;break}}else if(f!==g&&!i(f,g,s,n,r)){h=!1;break}}return r.delete(e),r.delete(t),h};const vl=function(e){var t=-1,s=Array(e.size);return e.forEach((function(e,n){s[++t]=[n,e]})),s};const _l=function(e){var t=-1,s=Array(e.size);return e.forEach((function(e){s[++t]=e})),s};var bl=kt?kt.prototype:void 0,yl=bl?bl.valueOf:void 0;const wl=function(e,t,s,n,i,r,o){switch(s){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!r(new Pr(e),new Pr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return xi(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=vl;case"[object Set]":var c=1&n;if(a||(a=_l),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;n|=2,o.set(e,t);var d=pl(a(e),a(t),n,i,r,o);return o.delete(e),d;case"[object Symbol]":if(yl)return yl.call(e)==yl.call(t)}return!1};var Al=Object.prototype.hasOwnProperty;const Sl=function(e,t,s,n,i,r){var o=1&s,a=Rr(e),c=a.length;if(c!=Rr(t).length&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in t:Al.call(t,d)))return!1}var u=r.get(e),h=r.get(t);if(u&&h)return u==t&&h==e;var m=!0;r.set(e,t),r.set(t,e);for(var f=o;++l<c;){var g=e[d=a[l]],p=t[d];if(n)var v=o?n(p,g,d,t,e,r):n(g,p,d,e,t,r);if(!(void 0===v?g===p||i(g,p,s,n,r):v)){m=!1;break}f||(f="constructor"==d)}if(m&&!f){var _=e.constructor,b=t.constructor;_==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(m=!1)}return r.delete(e),r.delete(t),m};var xl="[object Arguments]",El="[object Array]",$l="[object Object]",Cl=Object.prototype.hasOwnProperty;const kl=function(e,t,s,n,i,r){var o=jt(e),a=jt(t),c=o?El:fi(e),l=a?El:fi(t),d=(c=c==xl?$l:c)==$l,u=(l=l==xl?$l:l)==$l,h=c==l;if(h&&rn(e)){if(!rn(t))return!1;o=!0,d=!1}if(h&&!d)return r||(r=new ir),o||vn(e)?pl(e,t,s,n,i,r):wl(e,t,c,s,n,i,r);if(!(1&s)){var m=d&&Cl.call(e,"__wrapped__"),f=u&&Cl.call(t,"__wrapped__");if(m||f){var g=m?e.value():e,p=f?t.value():t;return r||(r=new ir),i(g,p,s,n,r)}}return!!h&&(r||(r=new ir),Sl(e,t,s,n,i,r))};const Tl=function e(t,s,n,i,r){return t===s||(null==t||null==s||!Ft(t)&&!Ft(s)?t!=t&&s!=s:kl(t,s,n,i,e,r))};const jl=function(e,t){return Tl(e,t)};const Nl=function(e,t,s,n){var i=s.length,r=i,o=!n;if(null==e)return!r;for(e=Object(e);i--;){var a=s[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<r;){var c=(a=s[i])[0],l=e[c],d=a[1];if(o&&a[2]){if(void 0===l&&!(c in e))return!1}else{var u=new ir;if(n)var h=n(l,d,c,e,t,u);if(!(void 0===h?Tl(d,l,3,n,u):h))return!1}}return!0};const Ol=function(e){return e==e&&!Ls(e)};const Il=function(e){for(var t=kn(e),s=t.length;s--;){var n=t[s],i=e[n];t[s]=[n,i,Ol(i)]}return t};const Ml=function(e,t){return function(s){return null!=s&&(s[e]===t&&(void 0!==t||e in Object(s)))}};const Rl=function(e){var t=Il(e);return 1==t.length&&t[0][2]?Ml(t[0][0],t[0][1]):function(s){return s===e||Nl(s,e,t)}};const Dl=function(e,t){for(var s=0,n=(t=Mc(t,e)).length;null!=e&&s<n;)e=e[Rc(t[s++])];return s&&s==n?e:void 0};const Ll=function(e,t,s){var n=null==e?void 0:Dl(e,t);return void 0===n?s:n};const zl=function(e,t){return null!=e&&t in Object(e)};const Pl=function(e,t){return null!=e&&sl(e,t,zl)};const Fl=function(e,t){return $c(e)&&Ol(t)?Ml(Rc(e),t):function(s){var n=Ll(s,e);return void 0===n&&n===t?Pl(s,e):Tl(t,n,3)}};const Ul=function(e){return function(t){return null==t?void 0:t[e]}};const Bl=function(e){return function(t){return Dl(t,e)}};const ql=function(e){return $c(e)?Ul(Rc(e)):Bl(e)};const Hl=function(e){return"function"==typeof e?e:null==e?Ha:"object"==typeof e?jt(e)?Fl(e[0],e[1]):Rl(e):ql(e)};const Gl=function(e){return Hl("function"==typeof e?e:lo(e,1))};const Wl=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};const Vl=function(e,t,s){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(s=s>i?i:s)<0&&(s+=i),i=t>s?0:s-t>>>0,t>>>=0;for(var r=Array(i);++n<i;)r[n]=e[n+t];return r};const Ql=function(e,t){return t.length<2?e:Dl(e,Vl(t,0,-1))};const Jl=function(e,t){return t=Mc(t,e),null==(e=Ql(e,t))||delete e[Rc(Wl(t))]};const Yl=function(e){return Pa(e)?void 0:e};var Xl=kt?kt.isConcatSpreadable:void 0;const Kl=function(e){return jt(e)||Zs(e)||!!(Xl&&e&&e[Xl])};const Zl=function e(t,s,n,i,r){var o=-1,a=t.length;for(n||(n=Kl),r||(r=[]);++o<a;){var c=t[o];s>0&&n(c)?s>1?e(c,s-1,n,i,r):Tr(r,c):i||(r[r.length]=c)}return r};const ed=function(e){return(null==e?0:e.length)?Zl(e,1):[]};const td=function(e){return Xa(Va(e,void 0,ed),e+"")};var sd=td((function(e,t){var s={};if(null==e)return s;var n=!1;t=Tt(t,(function(t){return t=Mc(t,e),n||(n=t.length>1),t})),dr(e,Dr(e),s),n&&(s=lo(s,7,Yl));for(var i=t.length;i--;)Jl(s,t[i]);return s}));const nd=sd;const id=function(e,t,s,n){if(!Ls(e))return e;for(var i=-1,r=(t=Mc(t,e)).length,o=r-1,a=e;null!=a&&++i<r;){var c=Rc(t[i]),l=s;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var d=a[c];void 0===(l=n?n(d,c,a):void 0)&&(l=Ls(d)?d:an(t[i+1])?[]:{})}lr(a,c,l),a=a[c]}return e};const rd=function(e,t,s){for(var n=-1,i=t.length,r={};++n<i;){var o=t[n],a=Dl(e,o);s(a,o)&&id(r,Mc(o,e),a)}return r};const od=function(e,t){return rd(e,t,(function(t,s){return Pl(e,s)}))};const ad=td((function(e,t){return null==e?{}:od(e,t)}));class cd extends(_i(Object)){constructor(e,t){super();let s=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=Vt(this.cidPrefix),this.attributes={},this.validationError=null,t.collection&&(this.collection=t.collection),t.parse&&(s=this.parse(s,t)||{});const n=Dc(this,"defaults");s=Xc(Object.assign({},n,s),n),this.set(s,t),this.initialize.apply(this,arguments),this.changed={}}set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get idAttribute(){return"id"}get cidPrefix(){return"c"}preinitialize(){}initialize(){}validate(e,t){return""}toJSON(){return Vc(this.attributes)}sync(e,t,s){return Bc(t)(e,t,s)}get(e){return this.attributes[e]}keys(){return Object.keys(this.attributes)}values(){return Object.values(this.attributes)}pairs(){return this.entries()}entries(){return Object.entries(this.attributes)}invert(){return ll(this.attributes)}pick(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),ad(this.attributes,e)}omit(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),nd(this.attributes,e)}isEmpty(){return pi(this.attributes)}has(e){return null!=this.get(e)}matches(e){return!!Gl(e,this)(this.attributes)}set(e,t,s){if(null==e)return this;let n;if("object"==typeof e?(n=e,s=t):(n={})[e]=t,s||(s={}),!this._validate(n,s))return!1;const i=s.unset,r=s.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=Vc(this.attributes),this.changed={});const c=this.attributes,l=this.changed,d=this._previousAttributes;for(const e in n)t=n[e],jl(c[e],t)||o.push(e),jl(d[e],t)?delete l[e]:l[e]=t,i?delete c[e]:c[e]=t;if(this.idAttribute in n&&(this.id=this.get(this.idAttribute)),!r){o.length&&(this._pending=s);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],s)}if(a)return this;if(!r)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this}unset(e,t){return this.set(e,void 0,Object.assign({},t,{unset:!0}))}clear(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Object.assign({},e,{unset:!0}))}hasChanged(e){return null==e?!pi(this.changed):nl(this.changed,e)}changedAttributes(e){if(!e)return!!this.hasChanged()&&Vc(this.changed);const t=this._changing?this._previousAttributes:this.attributes,s={};let n;for(const i in e){const r=e[i];jl(t[i],r)||(s[i]=r,n=!0)}return!!n&&s}previous(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null}previousAttributes(){return Vc(this._previousAttributes)}fetch(e={}){const t=(e=Object.assign({parse:!0},e)).success;return e.success=s=>{const n=e.parse?this.parse(s,e):s;if(!this.set(n,e))return!1;t&&t.call(e.context,this,s,e),this.trigger("sync",this,s,e)},Fc(this,e),this.sync("read",this,e)}save(e,t,s){let n;null==e||"object"==typeof e?(n=e,s=t):(n={})[e]=t;const i=(s=Object.assign({validate:!0,parse:!0},s)).wait,r=s.promise,o=r&&zc();if(n&&!i){if(!this.set(n,s))return!1}else if(!this._validate(n,s))return!1;const a=s.success,c=s.error,l=this.attributes;s.success=e=>{this.attributes=l;let t=s.parse?this.parse(e,s):e;if(i&&(t=Object.assign({},n,t)),t&&!this.set(t,s))return!1;a&&a.call(s.context,this,e,s),this.trigger("sync",this,e,s),r&&o.resolve()},s.error=(e,t,s)=>{c&&c.call(s.context,e,t,s),r&&o.reject(t)},Fc(this,s),n&&i&&(this.attributes=Object.assign({},l,n));const d=this.isNew()?"create":s.patch?"patch":"update";"patch"!==d||s.attrs||(s.attrs=n);const u=this.sync(d,this,s);return this.attributes=l,r?o:u}destroy(e){const t=(e=e?Vc(e):{}).success,s=e.wait,n=()=>{this.stopListening(),this.trigger("destroy",this,this.collection,e)};e.success=i=>{s&&n(),t&&t.call(e.context,this,i,e),this.isNew()||this.trigger("sync",this,i,e)};let i=!1;return this.isNew()?Zc(e.success):(Fc(this,e),i=this.sync("delete",this,e)),s||n(),i}url(){const e=Dc(this,"urlRoot")||Dc(this.collection,"url")||Pc();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)}parse(e,t){return e}isNew(){return!this.has(this.idAttribute)}isValid(e){return this._validate({},Object.assign({},e,{validate:!0}))}_validate(e,t){if(!t.validate||!this.validate)return!0;e=Object.assign({},this.attributes,e);const s=this.validationError=this.validate(e,t)||null;return!s||(this.trigger("invalid",this,s,Object.assign(t,{validationError:s})),!1)}}const ld=function(e,t,s,n){for(var i=-1,r=null==e?0:e.length;++i<r;){var o=e[i];t(n,o,s(o),e)}return n};const dd=function(e,t){return function(s,n){if(null==s)return s;if(!Cn(s))return e(s,n);for(var i=s.length,r=t?i:-1,o=Object(s);(t?r--:++r<i)&&!1!==n(o[r],r,o););return s}};const ud=dd(il);const hd=function(e,t,s,n){return ud(e,(function(e,i,r){t(n,e,s(e),r)})),n};const md=function(e,t){return function(s,n){var i=jt(s)?ld:hd,r=t?t():{};return i(s,e,Hl(n,2),r)}};var fd=Object.prototype.hasOwnProperty,gd=md((function(e,t,s){fd.call(e,s)?++e[s]:ar(e,s,1)}));const pd=gd;var vd=Object.prototype.hasOwnProperty,_d=md((function(e,t,s){vd.call(e,s)?e[s].push(t):ar(e,s,[t])}));const bd=_d;var yd=md((function(e,t,s){ar(e,s,t)}));const wd=yd;const Ad=function(e,t){var s=-1,n=Cn(e)?Array(e.length):[];return ud(e,(function(e,i,r){n[++s]=t(e,i,r)})),n};const Sd=function(e,t){var s=e.length;for(e.sort(t);s--;)e[s]=e[s].value;return e};const xd=function(e,t){if(e!==t){var s=void 0!==e,n=null===e,i=e==e,r=Ut(e),o=void 0!==t,a=null===t,c=t==t,l=Ut(t);if(!a&&!l&&!r&&e>t||r&&o&&c&&!a&&!l||n&&o&&c||!s&&c||!i)return 1;if(!n&&!r&&!l&&e<t||l&&s&&i&&!n&&!r||a&&s&&i||!o&&i||!c)return-1}return 0};const Ed=function(e,t,s){for(var n=-1,i=e.criteria,r=t.criteria,o=i.length,a=s.length;++n<o;){var c=xd(i[n],r[n]);if(c)return n>=a?c:c*("desc"==s[n]?-1:1)}return e.index-t.index};const $d=function(e,t,s){t=t.length?Tt(t,(function(e){return jt(e)?function(t){return Dl(t,1===e.length?e[0]:e)}:e})):[Ha];var n=-1;t=Tt(t,un(Hl));var i=Ad(e,(function(e,s,i){var r=Tt(t,(function(t){return t(e)}));return{criteria:r,index:++n,value:e}}));return Sd(i,(function(e,t){return Ed(e,t,s)}))};var Cd=Ka((function(e,t){if(null==e)return[];var s=t.length;return s>1&&Za(e,t[0],t[1])?t=[]:s>2&&Za(t[0],t[1],t[2])&&(t=[t[0]]),$d(e,Zl(t,1),[])}));const kd=Cd,Td=Array.prototype.slice,jd={add:!0,remove:!0,merge:!0},Nd={add:!0,remove:!1};class Od extends(_i(Object)){constructor(e,t){super(),t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this._model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,Object.assign({silent:!0},t)),this[Symbol.iterator]=this.values}set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get model(){return this._model??cd}set model(e){this._model=e}get length(){return this.models.length}preinitialize(){}initialize(){}toJSON(e){return this.map((function(t){return t.toJSON(e)}))}sync(e,t,s){return Bc(this)(e,t,s)}add(e,t){return this.set(e,Object.assign({merge:!1},t,Nd))}remove(e,t){t=Object.assign({},t);const s=!Array.isArray(e),n=s?[e]:e.slice(),i=this._removeModels(n,t);return!t.silent&&i.length&&(t.changes={added:[],merged:[],removed:i},this.trigger("update",this,t)),s?i[0]:i}set(e,t){if(null==e)return;(t=Object.assign({},jd,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const s=!Array.isArray(e);e=s?[e]:e.slice();let n=t.at;null!=n&&(n=+n),n>this.length&&(n=this.length),n<0&&(n+=this.length+1);const i=[],r=[],o=[],a=[],c={},l=t.add,d=t.merge,u=t.remove;let h=!1;const m=this.comparator&&null==n&&!1!==t.sort,f=ho(this.comparator)?this.comparator:null;let g,p;for(p=0;p<e.length;p++){g=e[p];const s=this.get(g);if(s){if(d&&g!==s){let e=this._isModel(g)?g.attributes:g;t.parse&&(e=s.parse(e,t)),s.set(e,t),o.push(s),m&&!h&&(h=s.hasChanged(f))}c[s.cid]||(c[s.cid]=!0,i.push(s)),e[p]=s}else l&&(g=e[p]=this._prepareModel(g,t),g&&(r.push(g),this._addReference(g,t),c[g.cid]=!0,i.push(g)))}if(u){for(p=0;p<this.length;p++)g=this.models[p],c[g.cid]||a.push(g);a.length&&this._removeModels(a,t)}let v=!1;const _=!m&&l&&u;if(i.length&&_)v=this.length!==i.length||this.models.some(((e,t)=>e!==i[t])),this.models.length=0,this.models.splice(0,0,...i);else if(r.length){m&&(h=!0);let e=null==n?this.length:n;e=Math.min(Math.max(e,0),this.models.length),this.models.splice(e,0,...r)}if(h&&this.sort({silent:!0}),!t.silent){for(p=0;p<r.length;p++)null!=n&&(t.index=n+p),g=r[p],g.trigger("add",g,this,t);(h||v)&&this.trigger("sort",this,t),(r.length||a.length||o.length)&&(t.changes={added:r,removed:a,merged:o},this.trigger("update",this,t))}return s?e[0]:e}async clearStore(e={},t=(e=>e)){await Promise.all(this.models.filter(t).map((t=>new Promise((s=>{t.destroy(Object.assign(e,{success:s,error:(e,t)=>{console.error(t),s()}}))}))))),await this.browserStorage.clear(),this.reset()}reset(e,t){t=t?Vc(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,Object.assign({silent:!0},t)),t.silent||this.trigger("reset",this,t),e}push(e,t){return this.add(e,Object.assign({at:this.length},t))}pop(e){const t=this.at(this.length-1);return this.remove(t,e)}unshift(e,t){return this.add(e,Object.assign({at:0},t))}shift(e){const t=this.at(0);return this.remove(t,e)}slice(){return Td.apply(this.models,arguments)}filter(e,t){return this.models.filter($n(e)?e:t=>t.matches(e),t)}every(e){return $n(e)?this.models.map((e=>e.attributes)).every(e):this.models.every((t=>t.matches(e)))}difference(e){return this.models.filter((t=>!e.includes(t)))}max(){return Math.max.apply(Math,this.models)}min(){return Math.min.apply(Math,this.models)}drop(e=1){return this.models.slice(e)}some(e){return $n(e)?this.models.map((e=>e.attributes)).some(e):this.models.some((t=>t.matches(e)))}sortBy(e){return kd(this.models,$n(e)?e:t=>ho(e)?t.get(e):t.matches(e))}isEmpty(){return!this.models.length}keyBy(e){return wd(this.models,e)}each(e,t){return this.forEach(e,t)}forEach(e,t){return this.models.forEach(e,t)}includes(e){return this.models.includes(e)}size(){return this.models.length}countBy(e){return pd(this.models,$n(e)?e:t=>ho(e)?t.get(e):t.matches(e))}groupBy(e){return bd(this.models,$n(e)?e:t=>ho(e)?t.get(e):t.matches(e))}indexOf(e){return this.models.indexOf(e)}findLastIndex(e,t){return this.models.findLastIndex($n(e)?e:t=>ho(e)?t.get(e):t.matches(e),t)}lastIndexOf(e){return this.models.lastIndexOf(e)}findIndex(e){return this.models.findIndex($n(e)?e:t=>ho(e)?t.get(e):t.matches(e))}last(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0}head(){return this.models[0]}first(){return this.head()}map(e,t){return this.models.map($n(e)?e:t=>ho(e)?t.get(e):t.matches(e),t)}reduce(e,t){return this.models.reduce(e,t||this.models[0])}reduceRight(e,t){return this.models.reduceRight(e,t||this.models[0])}toArray(){return Array.from(this.models)}get(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]}has(e){return null!=this.get(e)}at(e){return e<0&&(e+=this.length),this.models[e]}where(e,t){return this[t?"find":"filter"](e)}findWhere(e){return this.where(e,!0)}find(e,t){const s=$n(e)?e:t=>t.matches(e);return this.models.find(s,t)}sort(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const s=t.length;return $n(t)&&(t=t.bind(this)),1===s||ho(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this}pluck(e){return this.map(e+"")}fetch(e){const t=(e=Object.assign({parse:!0},e)).success,s=this,n=e.promise&&zc();return e.success=function(i){const r=e.reset?"reset":"set";s[r](i,e),t&&t.call(e.context,s,i,e),n&&n.resolve(),s.trigger("sync",s,i,e)},Fc(this,e),n||this.sync("read",this,e)}create(e,t){const s=(t=t?Vc(t):{}).wait,n=t.promise,i=n&&zc();if(!(e=this._prepareModel(e,t)))return!1;s||this.add(e,t);const r=this,o=t.success,a=t.error;return t.success=function(e,t,a){s&&r.add(e,a),o&&o.call(a.context,e,t,a),n&&i.resolve(e)},t.error=function(e,t,s){a&&a.call(s.context,e,t,s),n&&i.reject(t)},e.save(null,Object.assign(t,{promise:!1})),n?i:e}parse(e,t){return e}modelId(e){return e[this.model.prototype?.idAttribute||"id"]}values(){return new Dd(this,Id)}keys(){return new Dd(this,Md)}entries(){return new Dd(this,Rd)}_reset(){this.models=[],this._byId={}}createModel(e,t){return new(0,this.model)(e,t)}_prepareModel(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?Vc(t):{}).collection=this;const s=this.createModel(e,t);return s.validationError?(this.trigger("invalid",this,s.validationError,t),null):s}_removeModels(e,t){const s=[];for(let n=0;n<e.length;n++){const i=this.get(e[n]);if(!i)continue;const r=this.indexOf(i);this.models.splice(r,1),delete this._byId[i.cid];const o=this.modelId(i.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=r,i.trigger("remove",i,this,t)),s.push(i),this._removeReference(i,t)}return s}_isModel(e){return e instanceof cd}_addReference(e,t){this._byId[e.cid]=e;const s=this.modelId(e.attributes);null!=s&&(this._byId[s]=e),e.on("all",this._onModelEvent,this)}_removeReference(e,t){delete this._byId[e.cid];const s=this.modelId(e.attributes);null!=s&&delete this._byId[s],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)}_onModelEvent(e,t,s,n){if(t){if(("add"===e||"remove"===e)&&s!==this)return;if("destroy"===e&&this.remove(t,n),"change"===e){const e=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);e!==s&&(null!=e&&delete this._byId[e],null!=s&&(this._byId[s]=t))}}this.trigger.apply(this,arguments)}}const Id=1,Md=2,Rd=3;class Dd{constructor(e,t){this._collection=e,this._kind=t,this._index=0}next(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===Id)t=e;else{const s=this._collection.modelId(e.attributes);t=this._kind===Md?s:[s,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}}[Symbol.iterator](){return this}}const Ld={Collection:Od,ElementView:wi,EventEmitter:_i,Model:cd,sync:qc},zd="object"==typeof self&&self.self===self&&self||"object"==typeof s.g&&s.g.global===s.g&&s.g;Ld.VERSION="0.0.1";const Pd=zd.Skeletor;Ld.noConflict=function(){return zd.Skeletor=Pd,this},zd.Skeletor=Ld;const Fd={allow_non_roster_messaging:!1,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,disable_effects:!1,discover_connection_methods:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,jid:void 0,reuse_scram_keys:!0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","en","eo","es","eu","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","mr","nb","nl","oc","pl","pt","pt_BR","ro","ru","sv","th","tr","ug","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,stanza_timeout:6e4,view_mode:"overlayed",websocket_url:void 0,whitelisted_plugins:[]};function Ud(e,t){for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&"__proto__"!==s&&"constructor"!==s&&(e[s]instanceof Object?Ud(e[s],t[s]):e[s]=t[s])}function Bd(e){return"[object Error]"===Object.prototype.toString.call(e)}function qd(e){return"function"==typeof e}let Hd,Gd={};class Wd extends(_i(Object)){}const Vd={extend:e=>function(e){Ud(Fd,e);const t=Object.keys(e).filter((e=>e in Fd)),s=ad(Gd,t),n=Object.assign(ad(e,t),s);Ud(Hd,n)}(e),update(e){return bt.warn("The api.settings.update method has been deprecated and will be removed. Please use api.settings.extend instead."),this.extend(e)},get:e=>e?function(e){if(Object.keys(Fd).includes(e))return Hd[e]}(e):Hd,set(e,t){!function(e,t){if(null==e)return this;let s;e instanceof Object?s=e:"string"==typeof e&&(s={},s[e]=t);const n=Object.keys(s).filter((e=>e in Fd)),i={};n.forEach((e=>{const t=s[e];jl(Hd[e],t)||(i[e]=t,Hd[e]=t)})),Object.keys(i).forEach((e=>Hd.trigger("change:"+e,i[e]))),Hd.trigger("change",i)}(e,t)},listen:{on(e,t,s){!function(e,t,s){Hd.on(e,t,s)}(e,t,s)},not(e,t){!function(e,t){Hd.off(e,t)}(e,t)}}},Qd=Vd;function Jd(){return["fullscreen","embedded"].includes(Qd.get("view_mode"))}function Yd(){return"montague.lit/http-bind"===Gd.bosh_service_url}function Xd(){return"onpagehide"in window?"pagehide":"onbeforeunload"in window?"beforeunload":"unload"}function Kd(e,t){const s=e.promises[t];if(!s)throw new Error(`Tried to replace non-existing promise: ${t}`);if(s.replace){const n=ic();n.replace=s.replace,e.promises[t]=n}else bt.debug(`Not replacing promise "${t}"`)}function Zd(e){const{api:t}=e;return!e.state.config.get("trusted")||t.settings.get("clear_cache_on_logout")||Yd()}async function eu(e){const{api:t}=e;return await t.trigger("beforeTearDown",{synchronous:!0}),t.trigger("afterTearDown"),e}function tu(e){return Zd(e)&&e.api.user.settings.clear(),e.initSession(),e.api.trigger("clearSession",{synchronous:!0})}const su=59,nu="v11.0.0",iu={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},ru="anonymous",ou="closed",au="external",cu="login",lu="logout",du="opened",uu="prebind",hu="success",mu="failure",fu="inactive",gu="active",pu="composing",vu="paused",_u="gone",bu="chatbox",yu="chatroom",wu="headline",Au="controlbox",Su={};Su[lt.Status.ATTACHED]="ATTACHED",Su[lt.Status.AUTHENTICATING]="AUTHENTICATING",Su[lt.Status.AUTHFAIL]="AUTHFAIL",Su[lt.Status.CONNECTED]="CONNECTED",Su[lt.Status.CONNECTING]="CONNECTING",Su[lt.Status.CONNFAIL]="CONNFAIL",Su[lt.Status.DISCONNECTED]="DISCONNECTED",Su[lt.Status.DISCONNECTING]="DISCONNECTING",Su[lt.Status.ERROR]="ERROR",Su[lt.Status.RECONNECTING]="RECONNECTING",Su[lt.Status.REDIRECT]="REDIRECT",lt.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),lt.addNamespace("CARBONS","urn:xmpp:carbons:2"),lt.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),lt.addNamespace("CSI","urn:xmpp:csi:0"),lt.addNamespace("DELAY","urn:xmpp:delay"),lt.addNamespace("EME","urn:xmpp:eme:0"),lt.addNamespace("FASTEN","urn:xmpp:fasten:0"),lt.addNamespace("FORWARD","urn:xmpp:forward:0"),lt.addNamespace("HINTS","urn:xmpp:hints"),lt.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),lt.addNamespace("MAM","urn:xmpp:mam:2"),lt.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),lt.addNamespace("MENTIONS","urn:xmpp:mmn:0"),lt.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),lt.addNamespace("MODERATE","urn:xmpp:message-moderate:0"),lt.addNamespace("NICK","http://jabber.org/protocol/nick"),lt.addNamespace("OCCUPANTID","urn:xmpp:occupant-id:0"),lt.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),lt.addNamespace("OUTOFBAND","jabber:x:oob"),lt.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),lt.addNamespace("RAI","urn:xmpp:rai:0"),lt.addNamespace("RECEIPTS","urn:xmpp:receipts"),lt.addNamespace("REFERENCE","urn:xmpp:reference:0"),lt.addNamespace("REGISTER","jabber:iq:register"),lt.addNamespace("RETRACT","urn:xmpp:message-retract:0"),lt.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),lt.addNamespace("RSM","http://jabber.org/protocol/rsm"),lt.addNamespace("SID","urn:xmpp:sid:0"),lt.addNamespace("SPOILER","urn:xmpp:spoiler:0"),lt.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),lt.addNamespace("STYLING","urn:xmpp:styling:0"),lt.addNamespace("VCARD","vcard-temp"),lt.addNamespace("VCARDUPDATE","vcard-temp:x:update"),lt.addNamespace("XFORM","jabber:x:data"),lt.addNamespace("XHTML","http://www.w3.org/1999/xhtml");const xu=["converse-adhoc","converse-bookmarks","converse-bosh","converse-caps","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],Eu={start:/(\b|_)(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi},$u=["active","composing","gone","inactive","paused"],Cu={TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,FORWARD_SLASH:47,AT:50,META:91,META_RIGHT:93},ku={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"},Tu={"xs:anyURI":"url","xs:byte":"number","xs:date":"date","xs:dateTime":"datetime","xs:int":"number","xs:integer":"number","xs:time":"time"},ju={chatboxes:null,bookmarks:null,ANONYMOUS:ru,CLOSED:ou,EXTERNAL:au,LOGIN:cu,LOGOUT:lu,OPENED:du,PREBIND:uu,SUCCESS:hu,FAILURE:mu,INACTIVE:fu,ACTIVE:gu,COMPOSING:pu,PAUSED:vu,GONE:_u};class Nu extends(_i(Object)){constructor(){super();const e=new Proxy(this,{get:(e,t)=>(Yd()||"string"!=typeof t||Object.keys(ju).includes(t)&&bt.warn(`Accessing ${t} on _converse is DEPRECATED`),Reflect.get(e,t))});return e.initialize(),e}initialize(){this.VERSION_NAME=nu,this.strict_plugin_dependencies=!1,this.pluggable=null,this.templates={},this.storage={},this.promises={initialized:ic()},this.NUM_PREKEYS=100,this.TIMEOUTS={PAUSED:1e4,INACTIVE:9e4},Object.assign(this,ju),this.api=null,this.labels={},this.exports={},this.constants={},this.state={},this.initSession()}initSession(){this.session?.destroy(),this.session=new cd,Object.assign(this,{jid:void 0,bare_jid:void 0,domain:void 0,resource:void 0})}__(...e){return wt.__(...e)}___(e){return e}}const Ou=new Nu;xt.enable(Ou,"_converse","pluggable");const Iu=Ou,Mu={async trigger(e){if(!Iu._events)return;const t=Array.from(arguments),s=t.pop();if(s&&s.synchronous){const s=Iu._events[e]||[],n=t.splice(1);await Promise.all(s.map((e=>e.callback.apply(e.ctx,n))))}else Iu.trigger.apply(Iu,arguments);const n=Iu.promises[e];void 0!==n&&n.resolve()},hook(e,t,s){const n=Iu._events[e]||[];return n.length?n.reduce(((e,s)=>e.then((e=>s.callback(t,e)))),Promise.resolve(s)):s},listen:{once:Iu.once.bind(Iu),on:Iu.on.bind(Iu),not:Iu.off.bind(Iu),stanza(e,t,s){qd(t)?(s=t,t={}):t=t||{},Iu.api.connection.get().addHandler(s,t.ns,e,t.type,t.id,t.from,t)}}};var Ru=Math.max,Du=Math.min;const Lu=function(e,t,s){var n,i,r,o,a,c,l=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var s=n,r=i;return n=i=void 0,l=t,o=e.apply(r,s)}function f(e){var s=e-c;return void 0===c||s>=t||s<0||u&&e-l>=r}function g(){var e=nc();if(f(e))return p(e);a=setTimeout(g,function(e){var s=t-(e-c);return u?Du(s,r-(e-l)):s}(e))}function p(e){return a=void 0,h&&n?m(e):(n=i=void 0,o)}function v(){var e=nc(),s=f(e);if(n=arguments,i=this,c=e,s){if(void 0===a)return function(e){return l=e,a=setTimeout(g,t),d?m(e):o}(c);if(u)return clearTimeout(a),a=setTimeout(g,t),m(c)}return void 0===a&&(a=setTimeout(g,t)),o}return t=Bs(t)||0,Ls(s)&&(d=!!s.leading,r=(u="maxWait"in s)?Ru(Bs(s.maxWait)||0,t):r,h="trailing"in s?!!s.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,n=c=i=a=void 0},v.flush=function(){return void 0===a?o:p(nc())},v};var zu=s(4103),Pu=s(6245);const Fu=Vd;function Uu(){if(Iu.state.config.get("trusted")){return"sessionStorage"===Fu.get("persistent_store")?"session":"persistent"}return"session"}function Bu(e){return"persistent"===e&&"IndexedDB"===Fu.get("persistent_store")}function qu(e,t){const s=t||Uu(),n=Iu.storage[s];if(void 0===n)throw new TypeError(`createStore: Could not find store for ${e}`);return new Wc(e,n,Bu(t))}function Hu(e,t,s){const n=s||Uu();if(e.browserStorage=qu(t,n),Bu(n)){const t=()=>e.browserStorage.flush(),s=Xd();window.addEventListener(s,t),e.on("destroy",(()=>window.removeEventListener(s,t))),e.listenTo(Iu,"beforeLogout",t)}}function Gu(){return("WebSocket"in window||"MozWebSocket"in window)&&Vd.get("websocket_url")?Vd.get("websocket_url"):Vd.get("bosh_service_url")?Vd.get("bosh_service_url"):""}function Wu(e){return"string"==typeof e&&(2===e.split("@").filter((e=>!!e)).length&&!e.startsWith("@")&&!e.endsWith("@"))}function Vu(e){return!e.startsWith("@")&&!e.endsWith("@")}function Qu(e,t){return"string"==typeof e&&"string"==typeof t&&lt.getBareJidFromJid(e).toLowerCase()===lt.getBareJidFromJid(t).toLowerCase()}function Ju(e,t){return"string"==typeof e&&"string"==typeof t&&lt.getDomainFromJid(e).toLowerCase()===lt.getDomainFromJid(t).toLowerCase()}function Yu(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e}function Xu(e,t){const{api:s}=e;s.settings.get("authentication")===ru||lt.getResourceFromJid(t)||(t=t.toLowerCase()+`/converse.js-${Math.floor(139749528*Math.random()).toString()}`);const n=lt.getBareJidFromJid(t),i=lt.getResourceFromJid(t),r=lt.getDomainFromJid(t);Object.assign(e,{jid:t,bare_jid:n,resource:i,domain:r}),e.session.save({jid:t,bare_jid:n,resource:i,domain:r,active:!0}),s.connection.get().jid=t}async function Ku(e){return await async function(e,t){const s=e.api.settings.get("connection_options").worker,n=lt.getBareJidFromJid(t).toLowerCase(),i=`converse.session-${n}`;e.session?.get("id")!==i?(!function(e,t){if("sessionStorage"===e.api.settings.get("persistent_store"))return;if("BrowserExtLocal"===e.api.settings.get("persistent_store"))return Wc.localForage.defineDriver(zu.A).then((()=>Wc.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage.persistent=Wc.localForage);if("BrowserExtSync"===e.api.settings.get("persistent_store"))return Wc.localForage.defineDriver(Pu.A).then((()=>Wc.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage.persistent=Wc.localForage);const s={name:Yd()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===e.api.settings.get("persistent_store")?(s.description="localStorage instance",s.driver=[Wc.localForage.LOCALSTORAGE]):"IndexedDB"===e.api.settings.get("persistent_store")&&(s.description="indexedDB instance",s.driver=[Wc.localForage.INDEXEDDB]),e.storage.persistent=Wc.localForage.createInstance(s)}(e,n),e.session.set({id:i}),Hu(e.session,i,s?"persistent":"session"),await new Promise((t=>e.session.fetch({success:t,error:t}))),!s&&e.session.get("active")&&(e.session.clear(),e.session.save({id:i})),Xu(e,t),window.addEventListener(Xd(),(()=>e.session?.save("active",!1))),e.api.trigger("userSessionInitialized")):Xu(e,t)}(Iu,e),Iu.api.trigger("setUserJID"),e}function Zu(e=0){return new Promise(Lu((async(e,t)=>{let s=new XMLHttpRequest;s.open("GET",Iu.api.settings.get("credentials_url"),!0),s.setRequestHeader("Accept","application/json, text/javascript"),s.onload=()=>{if(s.status>=200&&s.status<400){const t=JSON.parse(s.responseText);Ku(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${s.status}: ${s.responseText}`))},s.onerror=t,s=await Iu.api.hook("beforeFetchLoginCredentials",this,s),s.send()}),e))}async function eh(e,t){const{api:s}=Iu;if(s.settings.get("authentication")===cu){const t=Iu.session.get("jid");if(e)return sh(e);if(s.settings.get("credentials_url"))return sh(await async function(){let e,t=0;for(;!e;){try{e=await Zu(t)}catch(e){bt.error("Could not fetch login credentials"),bt.error(e)}t=2e3}return e}());if(t&&(s.settings.get("password")||s.connection.get().pass))return sh();if(s.settings.get("reuse_scram_keys")){const e=await async function(){const e=localStorage.getItem("conversejs-session-jid");if(!e)return null;await Ku(e);const t=(await th(e)).get("scram_keys");return t?{jid:e,password:t}:null}();if(e)return sh(e)}if(!Yd()&&"credentials"in navigator){const e=await async function(){if(!localStorage.getItem("conversejs-session-jid"))return null;try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&Wu(e.id))return await Ku(e.id),{jid:e.id,password:e.password}}catch(e){return bt.error(e),null}}();if(e)return sh(e)}Yd()||bt.warn("attemptNonPreboundSession: Couldn't find credentials to log in with")}else![ru,au].includes(s.settings.get("authentication"))||t&&!s.settings.get("auto_login")||sh()}async function th(e){const t=`converse.scram-keys-${lt.getBareJidFromJid(e)}`,s=new cd({id:t});return Hu(s,t,"persistent"),await new Promise((e=>s.fetch({success:e,error:e}))),s}async function sh(e){const{api:t}=Iu,s=Iu.session.get("jid"),n=t.connection.get();if([ru,au].includes(t.settings.get("authentication"))){if(!s)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");n.reconnecting||n.reset(),n.connect(s.toLowerCase())}else if(t.settings.get("authentication")===cu){const i=e?.password??(n?.pass||t.settings.get("password"));if(!i){if(t.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return n.setDisconnectionCause(lt.Status.AUTHFAIL,void 0,!0),void t.connection.disconnect()}let r;if(n.reconnecting||(n.reset(),n.service=Gu()),Iu.state.config.get("trusted")&&s&&t.settings.get("reuse_scram_keys")&&!i?.ck){const e=await th(s);r=t=>{const{scram_keys:s}=n;s&&e.save({scram_keys:s}),n.onConnectStatusChanged(t)}}n.connect(s,i,r)}}const nh=Object.keys(lt.Status).reduce(((e,t)=>Math.max(e,lt.Status[t])),0);lt.Status.RECONNECTING=nh+1;class ih extends lt.Connection{constructor(e,t){super(e,t),this.send_initial_presence=!0,this.debouncedReconnect=Lu(this.reconnect,3e3)}xmlInput(e){bt.debug(e.outerHTML,"color: darkgoldenrod")}xmlOutput(e){bt.debug(e.outerHTML,"color: darkcyan")}async bind(){const{api:e}=Iu;await e.trigger("beforeResourceBinding",{synchronous:!0}),super.bind()}async onDomainDiscovered(e){const{api:t}=Iu,s=await e.text(),n=(new DOMParser).parseFromString(s,"text/xml").firstElementChild;if("XRD"!=n.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=n.namespaceURI)return bt.warn("Could not discover XEP-0156 connection methods");const i=P()('Link[rel="urn:xmpp:alt-connections:xbosh"]',n),r=P()('Link[rel="urn:xmpp:alt-connections:websocket"]',n),o=i.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("https:"))),a=r.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("wss:")));0===o.length&&0===a.length?bt.warn("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(t.settings.set("websocket_url",a.pop()),t.settings.set("bosh_service_url",o.pop()),this.service=t.settings.get("websocket_url")||t.settings.get("bosh_service_url"),this.setProtocol())}async discoverConnectionMethods(e){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},s=`https://${e}/.well-known/host-meta`;let n;try{n=await fetch(s,t)}catch(e){return bt.error(`Failed to discover alternative connection methods at ${s}`),void bt.error(e)}n.status>=200&&n.status<400?await this.onDomainDiscovered(n):bt.warn("Could not discover XEP-0156 connection methods")}async connect(e,t,s){const{api:n}=Iu;if(n.settings.get("discover_connection_methods")){const t=lt.getDomainFromJid(e);await this.discoverConnectionMethods(t)}if(!n.settings.get("bosh_service_url")&&!n.settings.get("websocket_url"))throw new Error("You must supply a value for either the bosh_service_url or websocket_url or both.");super.connect(e,t,s||this.onConnectStatusChanged,su)}disconnect(e){super.disconnect(e),this.send_initial_presence=!0}async switchTransport(){const{api:e}=Iu,t=Iu.session.get("bare_jid");e.connection.isType("websocket")&&e.settings.get("bosh_service_url")?(await Ku(t),this._proto._doDisconnect(),this._proto=new lt.Bosh(this),this.service=e.settings.get("bosh_service_url")):e.connection.isType("bosh")&&e.settings.get("websocket_url")&&(e.settings.get("authentication")===ru?await Ku(e.settings.get("jid")):await Ku(t),this._proto._doDisconnect(),this._proto=new lt.Websocket(this),this.service=e.settings.get("websocket_url"))}async reconnect(){const{api:e}=Iu;bt.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.reconnecting=!0,await eu(Iu);const t=Iu.state.connfeedback.get("connection_status");t===lt.Status.CONNFAIL?this.switchTransport():t===lt.Status.AUTHFAIL&&e.settings.get("authentication")===ru&&await Ku(e.settings.get("jid")),e.trigger("will-reconnect"),e.settings.get("authentication")===ru&&await tu(Iu);const s=Iu.session.get("jid");return e.user.login(s)}async onConnected(e){const{api:t}=Iu;if(delete this.reconnecting,this.flush(),await Ku(this.jid),Iu.state.config.get("trusted")){const e=Iu.session.get("bare_jid");localStorage.setItem("conversejs-session-jid",e)}await t.trigger("afterResourceBinding",e,{synchronous:!0}),e?t.trigger("reconnected"):t.trigger("connected")}setDisconnectionCause(e,t,s){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||s)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,Iu.state.connfeedback.set({connection_status:e,message:t})}async finishDisconnection(){const{api:e}=Iu;bt.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),eu(Iu),await tu(Iu),e.connection.destroy(),e.trigger("disconnected")}onDisconnected(){const{api:e}=Iu;if(!e.settings.get("auto_reconnect"))return this.finishDisconnection();{const t=this.disconnection_reason;if(this.disconnection_cause===lt.Status.AUTHFAIL)return e.settings.get("credentials_url")||e.settings.get("authentication")===ru?e.connection.reconnect():this.finishDisconnection();if(this.status===lt.Status.CONNECTING){const{__:e}=Iu;return this.setConnectionStatus(lt.Status.CONNFAIL,e("An error occurred while connecting to the chat server.")),this.finishDisconnection()}if(this.disconnection_cause===lu||t===lt.ErrorCondition.NO_AUTH_MECH||"host-unknown"===t||"remote-connection-failed"===t)return this.finishDisconnection();e.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:s}=Iu;if(bt.debug(`Status changed to: ${Su[e]}`),e===lt.Status.ATTACHFAIL)this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!1);else if(e===lt.Status.CONNECTED||e===lt.Status.ATTACHED){if(this.worker_attach_promise?.isResolved&&this.status===lt.Status.ATTACHED)return;this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!0),this.setDisconnectionCause(),this.reconnecting?(bt.debug(e===lt.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(bt.debug(e===lt.Status.CONNECTED?"Connected":"Attached"),this.restored&&(this.send_initial_presence=!1),this.onConnected())}else if(e===lt.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===lt.Status.BINDREQUIRED)this.bind();else if(e===lt.Status.ERROR)this.setConnectionStatus(e,s("An error occurred while connecting to the chat server."));else if(e===lt.Status.CONNECTING)this.setConnectionStatus(e);else if(e===lt.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===lt.Status.AUTHFAIL)t||(t=s("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===lt.Status.CONNFAIL){let n=t;"host-unknown"===t||"remote-connection-failed"==t?n=s("Sorry, we could not connect to the XMPP host with domain: %1$s",`"${lt.getDomainFromJid(this.jid)}"`):void 0!==t&&t===lt?.ErrorCondition?.NO_AUTH_MECH&&(n=s("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,n),this.setDisconnectionCause(e,t)}else e===lt.Status.DISCONNECTING&&this.setDisconnectionCause(e,t)}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof lt.Websocket:"bosh"===e.toLowerCase()?lt.Bosh&&this._proto instanceof lt.Bosh:void 0}hasResumed(){const{api:e}=Iu;return e.settings.get("connection_options")?.worker||this.isType("bosh")?Iu.state.connfeedback.get("connection_status")===lt.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=ic(),this.worker_attach_promise}}class rh extends ih{constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=lt.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstElementChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(lt.Status.BINDREQUIRED)}}_processRequest(){}sendIQ(e,t,s){e=e.tree?.()??e,this.IQ_stanzas.push(e);const n=super.sendIQ(e,t,s);return this.IQ_ids.push(n),n}send(e){return e=e.tree?.()??e,this.sent_stanzas.push(e),super.send(e)}async bind(){const{api:e}=Iu;await e.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,this._changeConnectStatus(lt.Status.CONNECTED)}}let oh;const ah={explicitResourceBinding:!0},ch={init(e){if(e&&oh?.jid&&Ju(oh.jid,e))return oh;if(!Vd.get("bosh_service_url")&&Vd.get("authentication")===uu)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");const t=Yd()?rh:ih;return oh=new t(Gu(),Object.assign(ah,Vd.get("connection_options"),{keepalive:Vd.get("keepalive")})),function(){const e=Vd.get("loglevel");lt.setLogLevel(lt.LogLevel[e.toUpperCase()]);const t={};t[lt.LogLevel.DEBUG]="debug",t[lt.LogLevel.INFO]="info",t[lt.LogLevel.WARN]="warn",t[lt.LogLevel.ERROR]="error",t[lt.LogLevel.FATAL]="fatal",lt.log=(e,s)=>bt.log(s,t[e]),lt.error=e=>bt.error(e)}(),Mu.trigger("connectionInitialized"),oh},get:()=>oh,destroy(){this.disconnect(),oh?.disconnect(),oh=void 0},authenticated:()=>oh?.authenticated&&!0,connected:()=>oh?.connected&&!0,disconnect(){oh?.disconnect()},reconnect:()=>(oh.setConnectionStatus(lt.Status.RECONNECTING,"The connection has dropped, attempting to reconnect."),oh?.reconnecting?oh.debouncedReconnect():oh.reconnect()),isType:e=>oh.isType(e)};function lh(e,t){clearTimeout(e),clearInterval(t)}function dh(e,t=300,s=3){try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const n=ic(),i=new Error;const r=setInterval((function(){try{const t=e();t&&(lh(o,r),n.resolve(t))}catch(e){lh(o,r),n.reject(e)}}),s);const o=setTimeout((function(){lh(o,r);const e=`Wait until promise timed out: \n\n${i.stack}`;console.trace(),bt.error(e),n.reject(new Error(e))}),t);return n}const uh={promises:{add(e,t=!0){(e=Array.isArray(e)?e:[e]).forEach((e=>{const s=ic();s.replace=t,Iu.promises[e]=s}))}},waitUntil(e){if(qd(e))return dh(e);{const t=Iu.promises[e];return void 0===t?null:t}}};class hh extends Error{constructor(e){super(e),this.retry_event_id=null}}const mh={send(e){const{api:t}=Iu;return t.connection.connected()?("string"==typeof e?e=at(e):e?.tree&&(e=e.tree()),"iq"===e.tagName?t.sendIQ(e):(t.connection.get().send(e),void t.trigger("send",e))):(bt.warn("Not sending stanza because we're not connected!"),void bt.warn(lt.serialize(e)))},sendIQ(e,t,s=!0){const{api:n}=Iu;if(!n.connection.connected())throw new Error("Not sending IQ stanza because we're not connected!");const i=n.connection.get();let r;return e=e.tree?.()??e,["get","set"].includes(e.getAttribute("type"))?(t=t||n.settings.get("stanza_timeout"),s?(r=new Promise(((s,n)=>i.sendIQ(e,s,n,t))),r.catch((s=>{if(null===s)throw new hh(`Timeout error after ${t}ms for the following IQ stanza: ${lt.serialize(e)}`)}))):r=new Promise((s=>i.sendIQ(e,s,s,t)))):(i.sendIQ(e),r=Promise.resolve()),n.trigger("send",e),r}};async function fh(e,t,s){let n;e=lt.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{n=new s(t,{collection:Iu.state.chatboxes})}catch(e){return bt.error(e),null}return await n.initialized,n.isValid()?(Iu.state.chatboxes.add(n),n):(n.destroy(),null)}const{waitUntil:gh}=uh,ph={},vh={create:async(e=[],t={},s)=>(await gh("chatBoxesFetched"),"string"==typeof e?fh(e,t,s):Promise.all(e.map((e=>fh(e,t,s))))),async get(e){await gh("chatBoxesFetched");const{chatboxes:t}=Iu.state;return void 0===e?t.models:"string"==typeof e?t.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),t.models.filter((t=>e.includes(t.get("jid")))))},registry:{add(e,t){ph[e]=t},get:e=>ph[e]}},{waitUntil:_h}=uh,bh={create(e,t={}){if(!(t="string"==typeof t?{nick:t}:t||{}).nick&&Vd.get("muc_nickname_from_jid")){const e=Iu.session.get("bare_jid");t.nick=lt.getNodeFromJid(e)}if(void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?bh.get(Yu(e),t,!0):Promise.all(e.map((e=>bh.get(Yu(e),t,!0))))},async open(e,t={},s=!1){if(await _h("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw bt.error(e),new TypeError(e)}if("string"==typeof e){const n=await bh.get(e,t,!0);return!t.hidden&&n?.maybeShow(s),n}{const n=await Promise.all(e.map((e=>n.get(e,t,!0))));return n.forEach((e=>!t.hidden&&e.maybeShow(s))),n}},async get(e,t={},s=!1){async function n(e){e=Yu(e);let n=await vh.get(e);return!n&&s?n=await vh.create(e,t,Iu.exports.MUC):(n=n&&n.get("type")===yu?n:null,n&&Object.keys(t).length&&n.save(t)),n}if(await _h("chatBoxesFetched"),void 0===e){return(await vh.get()).filter((e=>e.get("type")===yu))}return"string"==typeof e?n(e):Promise.all(e.map((e=>n(e))))}},yh={rooms:bh},{waitUntil:wh}=uh,{send:Ah}=mh,{rooms:Sh}=yh,xh={presence:{async send(e,t,s,n){await wh("statusInitialized");let i=[];n&&(i=Array.isArray(n)?n:[n]);const r=Iu.state.xmppstatus,o=await r.constructPresence(e,t,s);if(i.map((e=>e?.tree()??e)).forEach((e=>o.cnode(e).up())),Ah(o),["away","chat","dnd","online","xa",void 0].includes(e)){(await Sh.get()).forEach((t=>t.sendStatusPresence(e,s,i)))}}}};let Eh;function $h(){const e=Iu.session.get("bare_jid");if(!e){const e="No JID to fetch user settings for";throw bt.error(e),Error(e)}const t=`converse.user-settings.${e}`;if(Eh?.get("id")!==t)return Eh=new cd({id:t}),Hu(Eh,t),Eh.fetch({promise:!0})}async function Ch(){return await $h(),Eh}async function kh(e,t){return await $h(),Eh.save(e,t)}const Th={getModel:()=>Ch(),async get(e,t){const s=await Ch();return void 0===s.get(e)?t:s.get(e)},set(e,t){if(e instanceof Object)return kh(e,{promise:!0});{const s={};return s[e]=t,kh(s,{promise:!0})}},clear:()=>async function(){if(Iu.session.get("bare_jid"))return await $h(),Eh.clear();Eh=void 0}()},jh={user:{settings:Th,...xh,jid:()=>ch.get()?.jid,async login(e,t,s=!1){const{api:n}=Iu;e=e||n.settings.get("jid");const i=ch.init(e);if(n.settings.get("connection_options")?.worker&&await i.restoreWorkerSession())return;e&&(e=await Ku(e));const{success:r}=await Iu.api.hook("login",this,{jid:e,password:t,automatic:s});if(r)return;t=t||n.settings.get("password");const o=e&&t?{jid:e,password:t}:null;await eh(o,s)},async logout(){const{api:e}=Iu;await e.trigger("beforeLogout",{synchronous:!0});const t=ic(),s=()=>{Object.keys(Iu.promises).forEach((e=>Kd(Iu,e))),localStorage.removeItem("conversejs-session-jid"),e.trigger("logout"),t.resolve()},n=ch.get();return n?(n.setDisconnectionCause(lu,void 0,!0),e.listen.once("disconnected",(()=>s())),n.disconnect()):s(),t}}},Nh=jh,Oh={connection:ch,settings:Vd,...mh,...Nh,...Mu,...uh,disco:null,elements:null,contacts:null};function Ih(e){return!!dt(e)&&"error"===e.getAttribute("type")}function Mh(e){return!!dt(e)&&P()(`error[type="auth"] forbidden[xmlns="${lt.NS.STANZAS}"]`,e).length>0}function Rh(e){return!!dt(e)&&P()(`error[type="cancel"] service-unavailable[xmlns="${lt.NS.STANZAS}"]`,e).length>0}function Dh(e){return e.getAttributeNames().reduce(((t,s)=>(t[s]=lt.xmlunescape(e.getAttribute(s)),t)),{})}var Lh=s(9542),zh=s.n(Lh);const Ph=class extends cd{defaults(){return{connection_status:lt.Status.DISCONNECTED,message:""}}initialize(){super.initialize();const{api:e}=Iu;this.on("change",(()=>e.trigger("connfeedback",Iu.state.connfeedback)))}};class Fh{constructor(){this.hex="#000000",this.rgb_r=0,this.rgb_g=0,this.rgb_b=0,this.xyz_x=0,this.xyz_y=0,this.xyz_z=0,this.luv_l=0,this.luv_u=0,this.luv_v=0,this.lch_l=0,this.lch_c=0,this.lch_h=0,this.hsluv_h=0,this.hsluv_s=0,this.hsluv_l=0,this.hpluv_h=0,this.hpluv_p=0,this.hpluv_l=0,this.r0s=0,this.r0i=0,this.r1s=0,this.r1i=0,this.g0s=0,this.g0i=0,this.g1s=0,this.g1i=0,this.b0s=0,this.b0i=0,this.b1s=0,this.b1i=0}static fromLinear(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}static toLinear(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}static yToL(e){return e<=Fh.epsilon?e/Fh.refY*Fh.kappa:116*Math.pow(e/Fh.refY,1/3)-16}static lToY(e){return e<=8?Fh.refY*e/Fh.kappa:Fh.refY*Math.pow((e+16)/116,3)}static rgbChannelToHex(e){const t=Math.round(255*e),s=t%16,n=(t-s)/16|0;return Fh.hexChars.charAt(n)+Fh.hexChars.charAt(s)}static hexToRgbChannel(e,t){return(16*Fh.hexChars.indexOf(e.charAt(t))+Fh.hexChars.indexOf(e.charAt(t+1)))/255}static distanceFromOriginAngle(e,t,s){const n=t/(Math.sin(s)-e*Math.cos(s));return n<0?1/0:n}static distanceFromOrigin(e,t){return Math.abs(t)/Math.sqrt(Math.pow(e,2)+1)}static min6(e,t,s,n,i,r){return Math.min(e,Math.min(t,Math.min(s,Math.min(n,Math.min(i,r)))))}rgbToHex(){this.hex="#",this.hex+=Fh.rgbChannelToHex(this.rgb_r),this.hex+=Fh.rgbChannelToHex(this.rgb_g),this.hex+=Fh.rgbChannelToHex(this.rgb_b)}hexToRgb(){this.hex=this.hex.toLowerCase(),this.rgb_r=Fh.hexToRgbChannel(this.hex,1),this.rgb_g=Fh.hexToRgbChannel(this.hex,3),this.rgb_b=Fh.hexToRgbChannel(this.hex,5)}xyzToRgb(){this.rgb_r=Fh.fromLinear(Fh.m_r0*this.xyz_x+Fh.m_r1*this.xyz_y+Fh.m_r2*this.xyz_z),this.rgb_g=Fh.fromLinear(Fh.m_g0*this.xyz_x+Fh.m_g1*this.xyz_y+Fh.m_g2*this.xyz_z),this.rgb_b=Fh.fromLinear(Fh.m_b0*this.xyz_x+Fh.m_b1*this.xyz_y+Fh.m_b2*this.xyz_z)}rgbToXyz(){const e=Fh.toLinear(this.rgb_r),t=Fh.toLinear(this.rgb_g),s=Fh.toLinear(this.rgb_b);this.xyz_x=.41239079926595*e+.35758433938387*t+.18048078840183*s,this.xyz_y=.21263900587151*e+.71516867876775*t+.072192315360733*s,this.xyz_z=.019330818715591*e+.11919477979462*t+.95053215224966*s}xyzToLuv(){const e=this.xyz_x+15*this.xyz_y+3*this.xyz_z;let t=4*this.xyz_x,s=9*this.xyz_y;0!==e?(t/=e,s/=e):(t=NaN,s=NaN),this.luv_l=Fh.yToL(this.xyz_y),0===this.luv_l?(this.luv_u=0,this.luv_v=0):(this.luv_u=13*this.luv_l*(t-Fh.refU),this.luv_v=13*this.luv_l*(s-Fh.refV))}luvToXyz(){if(0===this.luv_l)return this.xyz_x=0,this.xyz_y=0,void(this.xyz_z=0);const e=this.luv_u/(13*this.luv_l)+Fh.refU,t=this.luv_v/(13*this.luv_l)+Fh.refV;this.xyz_y=Fh.lToY(this.luv_l),this.xyz_x=0-9*this.xyz_y*e/((e-4)*t-e*t),this.xyz_z=(9*this.xyz_y-15*t*this.xyz_y-t*this.xyz_x)/(3*t)}luvToLch(){if(this.lch_l=this.luv_l,this.lch_c=Math.sqrt(this.luv_u*this.luv_u+this.luv_v*this.luv_v),this.lch_c<1e-8)this.lch_h=0;else{const e=Math.atan2(this.luv_v,this.luv_u);this.lch_h=180*e/Math.PI,this.lch_h<0&&(this.lch_h=360+this.lch_h)}}lchToLuv(){const e=this.lch_h/180*Math.PI;this.luv_l=this.lch_l,this.luv_u=Math.cos(e)*this.lch_c,this.luv_v=Math.sin(e)*this.lch_c}calculateBoundingLines(e){const t=Math.pow(e+16,3)/1560896,s=t>Fh.epsilon?t:e/Fh.kappa,n=s*(284517*Fh.m_r0-94839*Fh.m_r2),i=s*(838422*Fh.m_r2+769860*Fh.m_r1+731718*Fh.m_r0),r=s*(632260*Fh.m_r2-126452*Fh.m_r1),o=s*(284517*Fh.m_g0-94839*Fh.m_g2),a=s*(838422*Fh.m_g2+769860*Fh.m_g1+731718*Fh.m_g0),c=s*(632260*Fh.m_g2-126452*Fh.m_g1),l=s*(284517*Fh.m_b0-94839*Fh.m_b2),d=s*(838422*Fh.m_b2+769860*Fh.m_b1+731718*Fh.m_b0),u=s*(632260*Fh.m_b2-126452*Fh.m_b1);this.r0s=n/r,this.r0i=i*e/r,this.r1s=n/(r+126452),this.r1i=(i-769860)*e/(r+126452),this.g0s=o/c,this.g0i=a*e/c,this.g1s=o/(c+126452),this.g1i=(a-769860)*e/(c+126452),this.b0s=l/u,this.b0i=d*e/u,this.b1s=l/(u+126452),this.b1i=(d-769860)*e/(u+126452)}calcMaxChromaHpluv(){const e=Fh.distanceFromOrigin(this.r0s,this.r0i),t=Fh.distanceFromOrigin(this.r1s,this.r1i),s=Fh.distanceFromOrigin(this.g0s,this.g0i),n=Fh.distanceFromOrigin(this.g1s,this.g1i),i=Fh.distanceFromOrigin(this.b0s,this.b0i),r=Fh.distanceFromOrigin(this.b1s,this.b1i);return Fh.min6(e,t,s,n,i,r)}calcMaxChromaHsluv(e){const t=e/360*Math.PI*2,s=Fh.distanceFromOriginAngle(this.r0s,this.r0i,t),n=Fh.distanceFromOriginAngle(this.r1s,this.r1i,t),i=Fh.distanceFromOriginAngle(this.g0s,this.g0i,t),r=Fh.distanceFromOriginAngle(this.g1s,this.g1i,t),o=Fh.distanceFromOriginAngle(this.b0s,this.b0i,t),a=Fh.distanceFromOriginAngle(this.b1s,this.b1i,t);return Fh.min6(s,n,i,r,o,a)}hsluvToLch(){if(this.hsluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hsluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hsluv_l,this.calculateBoundingLines(this.hsluv_l);const e=this.calcMaxChromaHsluv(this.hsluv_h);this.lch_c=e/100*this.hsluv_s}this.lch_h=this.hsluv_h}lchToHsluv(){if(this.lch_l>99.9999999)this.hsluv_s=0,this.hsluv_l=100;else if(this.lch_l<1e-8)this.hsluv_s=0,this.hsluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHsluv(this.lch_h);this.hsluv_s=this.lch_c/e*100,this.hsluv_l=this.lch_l}this.hsluv_h=this.lch_h}hpluvToLch(){if(this.hpluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hpluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hpluv_l,this.calculateBoundingLines(this.hpluv_l);const e=this.calcMaxChromaHpluv();this.lch_c=e/100*this.hpluv_p}this.lch_h=this.hpluv_h}lchToHpluv(){if(this.lch_l>99.9999999)this.hpluv_p=0,this.hpluv_l=100;else if(this.lch_l<1e-8)this.hpluv_p=0,this.hpluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHpluv();this.hpluv_p=this.lch_c/e*100,this.hpluv_l=this.lch_l}this.hpluv_h=this.lch_h}hsluvToRgb(){this.hsluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hpluvToRgb(){this.hpluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hsluvToHex(){this.hsluvToRgb(),this.rgbToHex()}hpluvToHex(){this.hpluvToRgb(),this.rgbToHex()}rgbToHsluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHsluv()}rgbToHpluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHpluv()}hexToHsluv(){this.hexToRgb(),this.rgbToHsluv()}hexToHpluv(){this.hexToRgb(),this.rgbToHpluv()}}Fh.hexChars="0123456789abcdef",Fh.refY=1,Fh.refU=.19783000664283,Fh.refV=.46831999493879,Fh.kappa=903.2962962,Fh.epsilon=.0088564516,Fh.m_r0=3.240969941904521,Fh.m_r1=-1.537383177570093,Fh.m_r2=-.498610760293,Fh.m_g0=-.96924363628087,Fh.m_g1=1.87596750150772,Fh.m_g2=.041555057407175,Fh.m_b0=.055630079696993,Fh.m_b1=-.20397695888897,Fh.m_b2=1.056971514242878;const Uh=new Map;async function Bh(e){const t=Uh.get(e);if(t)return t;const s=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",(new TextEncoder).encode(e)))),n=(s[0]+256*s[1])/65536*360,i=new Fh;return i.hsluv_h=n,i.hsluv_s=100,i.hsluv_l=50,i.hsluvToHex(),Uh.set(e,i.hex),i.hex}const qh=(e,t)=>`<field var="${e}">${t}</field>`,Hh=e=>`<value>${lt.xmlescape(e)}</value>`;function Gh(e){const t=[],s=e?.options;for(let e=0,n=s.length;e<n;e++){const n=s[e];n.selected&&t.push(n.value||n.text)}return t}function Wh(e){const t=e.getAttribute("name");if(!t)return null;let s;return s="checkbox"===e.getAttribute("type")?e.checked?"1":"0":"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?Gh(e):e.value,at(qh(t,Array.isArray(s)?s.map(Hh):Hh(s)))}function Vh(e,t,s){t||(t=e.selectionEnd||void 0);let[n]=e.value.slice(0,t).split(/\s/).slice(-1);return s&&([n]=n.split(s).slice(-1)),n}function Qh(e){return"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e)}function Jh(e,t){const s=e.selectionEnd||void 0,n=e.value.slice(0,s).split(/\s/).pop(),i=e.value,r=Qh(n[0])?n[0]:"";e.value=i.slice(0,s-n.length)+r+`${t} `+i.slice(s);const o=s-n.length+t.length+1;e.selectionEnd=r?o+1:o}function Yh(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),e.scrollTop=999999}function Xh(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s.buffer}function Kh(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function Zh(e){return new TextDecoder("utf-8").decode(e)}function em(e){return(new TextEncoder).encode(e).buffer}function tm(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}function sm(e){const t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return n.buffer}function nm(e){const t=new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16))));return t.buffer}const im=Vd;function rm(e){try{return!!new URL(e)}catch{return!1}}function om(e){try{return e instanceof zh()?e:new(zh())(e)}catch(e){return bt.debug(e),null}}function am(e,t){const s=om(t);if(null===s)throw new Error(`checkFileTypes: could not parse url ${t}`);const n=s.filename().toLowerCase();return!!e.filter((e=>n.endsWith(e))).length}function cm(e){const t=im.get("filter_url_query_params");if(!t)return e;return om(e).removeQuery(t).toString()}function lm(e){return am([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}function dm(e){return am([".gif"],e)}function um(e){return am([".ogg",".mp3",".m4a"],e)}function hm(e){return am([".mp4",".webm"],e)}function mm(e){const t=im.get("image_urls_regex");return t?.test(e)||lm(e)}function fm(e){return e.startsWith("aesgcm://")}function gm(e,t=0){const s=[];if(!e)return{};try{zh().withinString(e,((e,n,i)=>(e.startsWith("_")&&(e=e.slice(1),n+=1),e.endsWith("_")&&(e=e.slice(0,e.length-1),i-=1),s.push({url:e,start:n+t,end:i+t}),e)),Eu)}catch(e){bt.debug(e)}const n=s.map((e=>({end:e.end,is_audio:um(e.url),is_image:mm(e.url),is_video:hm(e.url),is_encrypted:fm(e.url),start:e.start})));return n.length?{media_urls:n}:{}}function pm(e,t,s=0){return e.map((e=>{const n=e.start-s,i=e.end-s;return n<0||n>=t.length?null:Object.assign({},e,{start:n,end:i,url:t.substring(e.start-s,e.end-s)})})).filter((e=>e))}function vm(e){if(location.hash.startsWith("#converse?loglevel=")){e?.preventDefault();const t=location.hash.split("=").pop();Object.keys(vt).includes(t)?bt.setLogLevel(t):bt.error(`Could not set loglevel of ${t}`)}}function _m(e){return e instanceof cd&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message||e.body)}function bm(e){return e instanceof Error}function ym(e,t,s){!function(e){return e.collection&&e.collection.browserStorage}(e)?e.set(t,s):e.save(t,s)}function wm(e){return Math.random()*e|0}function Am(e){const t=crypto.randomUUID?.()??"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=wm(16);return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t}const Sm=Object.assign({...f,...h,...m,...r,...d,...o,...a,...u,...l,...g,getLongestSubstring:function(e,t){return t.reduce((function(t,s){return e.startsWith(s)&&s.length>t.length?s:t}),"")},getOpenPromise:ic,getRandomInt:wm,getUniqueId:Am,isEmptyMessage:_m,isErrorObject:bm,onMultipleEvents:function(e=[],t){let s=[];function n(n){s.push(n),e.length===s.length&&(t(s),s=[])}e.forEach((e=>e.object.on(e.event,n)))},prefixMentions:function(e){let t=e.getMessageText();return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},safeSave:ym,shouldCreateMessage:function(e){return e.retracted||!_m(e)},toStanza:at,triggerEvent:function(e,t,s="Event",n=!0,i=!0){const r=document.createEvent(s);r.initEvent(t,n,i),e.dispatchEvent(r)},waitUntil:dh},{muc:null,mam:null}),xm="array",Em="bit",$m="bits",Cm="byte",km="bytes",Tm="",jm="exponent",Nm="function",Om="iec",Im="Invalid number",Mm="Invalid rounding method",Rm="jedec",Dm="object",Lm=".",zm="round",Pm="s",Fm="si",Um="kbit",Bm="kB",qm=" ",Hm="string",Gm="0",Wm={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function Vm(e,{bits:t=!1,pad:s=!1,base:n=-1,round:i=2,locale:r=Tm,localeOptions:o={},separator:a=Tm,spacer:c=qm,symbols:l={},standard:d=Tm,output:u=Hm,fullform:h=!1,fullforms:m=[],exponent:f=-1,roundingMethod:g=zm,precision:p=0}={}){let v=f,_=Number(e),b=[],y=0,w=Tm;d===Fm?(n=10,d=Rm):d===Om||d===Rm?n=2:2===n?d=Om:(n=10,d=Rm);const A=10===n?1e3:1024,S=!0===h,x=_<0,E=Math[g];if("bigint"!=typeof e&&isNaN(e))throw new TypeError(Im);if(typeof E!==Nm)throw new TypeError(Mm);if(x&&(_=-_),(-1===v||isNaN(v))&&(v=Math.floor(Math.log(_)/Math.log(A)),v<0&&(v=0)),v>8&&(p>0&&(p+=8-v),v=8),u===jm)return v;if(0===_)b[0]=0,w=b[1]=Wm.symbol[d][t?$m:km][v];else{y=_/(2===n?Math.pow(2,10*v):Math.pow(1e3,v)),t&&(y*=8,y>=A&&v<8&&(y/=A,v++));const e=Math.pow(10,v>0?i:0);b[0]=E(y*e)/e,b[0]===A&&v<8&&-1===f&&(b[0]=1,v++),w=b[1]=10===n&&1===v?t?Um:Bm:Wm.symbol[d][t?$m:km][v]}if(x&&(b[0]=-b[0]),p>0&&(b[0]=b[0].toPrecision(p)),b[1]=l[b[1]]||b[1],!0===r?b[0]=b[0].toLocaleString():r.length>0?b[0]=b[0].toLocaleString(r,o):a.length>0&&(b[0]=b[0].toString().replace(Lm,a)),s&&!1===Number.isInteger(b[0])&&i>0){const e=a||Lm,t=b[0].toString().split(e),s=t[1]||Tm,n=s.length,r=i-n;b[0]=`${t[0]}${e}${s.padEnd(n+r,Gm)}`}return S&&(b[1]=m[v]?m[v]:Wm.fullform[d][v]+(t?Em:Cm)+(1===b[0]?Tm:Pm)),u===xm?b:u===Dm?{value:b[0],symbol:b[1],exponent:v,unit:w}:b.join(c)}const Qm=globalThis,Jm=Qm.ShadowRoot&&(void 0===Qm.ShadyCSS||Qm.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Ym=Symbol(),Xm=new WeakMap;class Km{constructor(e,t,s){if(this._$cssResult$=!0,s!==Ym)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Jm&&void 0===e){const s=void 0!==t&&1===t.length;s&&(e=Xm.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&Xm.set(t,e))}return e}toString(){return this.cssText}}const Zm=Jm?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return(e=>new Km("string"==typeof e?e:e+"",void 0,Ym))(t)})(e):e,{is:ef,defineProperty:tf,getOwnPropertyDescriptor:sf,getOwnPropertyNames:nf,getOwnPropertySymbols:rf,getPrototypeOf:of}=Object,af=globalThis,cf=af.trustedTypes,lf=cf?cf.emptyScript:"",df=af.reactiveElementPolyfillSupport,uf=(e,t)=>e,hf={toAttribute(e,t){switch(t){case Boolean:e=e?lf:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(e){s=null}}return s}},mf=(e,t)=>!ef(e,t),ff={attribute:!0,type:String,converter:hf,reflect:!1,hasChanged:mf};Symbol.metadata??=Symbol("metadata"),af.litPropertyMetadata??=new WeakMap;class gf extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=ff){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){const s=Symbol(),n=this.getPropertyDescriptor(e,s,t);void 0!==n&&tf(this.prototype,e,n)}}static getPropertyDescriptor(e,t,s){const{get:n,set:i}=sf(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get(){return n?.call(this)},set(t){const r=n?.call(this);i.call(this,t),this.requestUpdate(e,r,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??ff}static _$Ei(){if(this.hasOwnProperty(uf("elementProperties")))return;const e=of(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(uf("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(uf("properties"))){const e=this.properties,t=[...nf(e),...rf(e)];for(const s of t)this.createProperty(s,e[s])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const s=this._$Eu(e,t);void 0!==s&&this._$Eh.set(s,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(Zm(e))}else void 0!==e&&t.push(Zm(e));return t}static _$Eu(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const s of t.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(Jm)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const s of t){const t=document.createElement("style"),n=Qm.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=s.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$EC(e,t){const s=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,s);if(void 0!==n&&!0===s.reflect){const i=(void 0!==s.converter?.toAttribute?s.converter:hf).toAttribute(t,s.type);this._$Em=e,null==i?this.removeAttribute(n):this.setAttribute(n,i),this._$Em=null}}_$AK(e,t){const s=this.constructor,n=s._$Eh.get(e);if(void 0!==n&&this._$Em!==n){const e=s.getPropertyOptions(n),i="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:hf;this._$Em=n,this[n]=i.fromAttribute(t,e.type),this._$Em=null}}requestUpdate(e,t,s){if(void 0!==e){if(s??=this.constructor.getPropertyOptions(e),!(s.hasChanged??mf)(this[e],t))return;this.P(e,t,s)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(e,t,s){this._$AL.has(e)||this._$AL.set(e,t),!0===s.reflect&&this._$Em!==e&&(this._$Ej??=new Set).add(e)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,s]of e)!0!==s.wrapped||this._$AL.has(t)||void 0===this[t]||this.P(t,this[t],s)}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EU()}catch(t){throw e=!1,this._$EU(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&=this._$Ej.forEach((e=>this._$EC(e,this[e]))),this._$EU()}updated(e){}firstUpdated(e){}}gf.elementStyles=[],gf.shadowRootOptions={mode:"open"},gf[uf("elementProperties")]=new Map,gf[uf("finalized")]=new Map,df?.({ReactiveElement:gf}),(af.reactiveElementVersions??=[]).push("2.0.4");const pf=globalThis,vf=pf.trustedTypes,_f=vf?vf.createPolicy("lit-html",{createHTML:e=>e}):void 0,bf="$lit$",yf=`lit$${Math.random().toFixed(9).slice(2)}$`,wf="?"+yf,Af=`<${wf}>`,Sf=document,xf=()=>Sf.createComment(""),Ef=e=>null===e||"object"!=typeof e&&"function"!=typeof e,$f=Array.isArray,Cf=e=>$f(e)||"function"==typeof e?.[Symbol.iterator],kf="[ \t\n\f\r]",Tf=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,jf=/-->/g,Nf=/>/g,Of=RegExp(`>|${kf}(?:([^\\s"'>=/]+)(${kf}*=${kf}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),If=/'/g,Mf=/"/g,Rf=/^(?:script|style|textarea|title)$/i,Df=e=>(t,...s)=>({_$litType$:e,strings:t,values:s}),Lf=Df(1),zf=(Df(2),Symbol.for("lit-noChange")),Pf=Symbol.for("lit-nothing"),Ff=new WeakMap,Uf=Sf.createTreeWalker(Sf,129);function Bf(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==_f?_f.createHTML(t):t}const qf=(e,t)=>{const s=e.length-1,n=[];let i,r=2===t?"<svg>":"",o=Tf;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(o.lastIndex=d,c=o.exec(s),null!==c);)d=o.lastIndex,o===Tf?"!--"===c[1]?o=jf:void 0!==c[1]?o=Nf:void 0!==c[2]?(Rf.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=Of):void 0!==c[3]&&(o=Of):o===Of?">"===c[0]?(o=i??Tf,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?Of:'"'===c[3]?Mf:If):o===Mf||o===If?o=Of:o===jf||o===Nf?o=Tf:(o=Of,i=void 0);const u=o===Of&&e[t+1].startsWith("/>")?" ":"";r+=o===Tf?s+Af:l>=0?(n.push(a),s.slice(0,l)+bf+s.slice(l)+yf+u):s+yf+(-2===l?t:u)}return[Bf(e,r+(e[s]||"<?>")+(2===t?"</svg>":"")),n]};class Hf{constructor({strings:e,_$litType$:t},s){let n;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=qf(e,t);if(this.el=Hf.createElement(c,s),Uf.currentNode=this.el.content,2===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(n=Uf.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes())for(const e of n.getAttributeNames())if(e.endsWith(bf)){const t=l[r++],s=n.getAttribute(e).split(yf),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:s,ctor:"."===o[1]?Jf:"?"===o[1]?Yf:"@"===o[1]?Xf:Qf}),n.removeAttribute(e)}else e.startsWith(yf)&&(a.push({type:6,index:i}),n.removeAttribute(e));if(Rf.test(n.tagName)){const e=n.textContent.split(yf),t=e.length-1;if(t>0){n.textContent=vf?vf.emptyScript:"";for(let s=0;s<t;s++)n.append(e[s],xf()),Uf.nextNode(),a.push({type:2,index:++i});n.append(e[t],xf())}}}else if(8===n.nodeType)if(n.data===wf)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(yf,e+1));)a.push({type:7,index:i}),e+=yf.length-1}i++}}static createElement(e,t){const s=Sf.createElement("template");return s.innerHTML=e,s}}function Gf(e,t,s=e,n){if(t===zf)return t;let i=void 0!==n?s._$Co?.[n]:s._$Cl;const r=Ef(t)?void 0:t._$litDirective$;return i?.constructor!==r&&(i?._$AO?.(!1),void 0===r?i=void 0:(i=new r(e),i._$AT(e,s,n)),void 0!==n?(s._$Co??=[])[n]=i:s._$Cl=i),void 0!==i&&(t=Gf(e,i._$AS(e,t.values),i,n)),t}class Wf{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,n=(e?.creationScope??Sf).importNode(t,!0);Uf.currentNode=n;let i=Uf.nextNode(),r=0,o=0,a=s[0];for(;void 0!==a;){if(r===a.index){let t;2===a.type?t=new Vf(i,i.nextSibling,this,e):1===a.type?t=new a.ctor(i,a.name,a.strings,this,e):6===a.type&&(t=new Kf(i,this,e)),this._$AV.push(t),a=s[++o]}r!==a?.index&&(i=Uf.nextNode(),r++)}return Uf.currentNode=Sf,n}p(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class Vf{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,s,n){this.type=2,this._$AH=Pf,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Gf(this,e,t),Ef(e)?e===Pf||null==e||""===e?(this._$AH!==Pf&&this._$AR(),this._$AH=Pf):e!==this._$AH&&e!==zf&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):Cf(e)?this.k(e):this._(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}_(e){this._$AH!==Pf&&Ef(this._$AH)?this._$AA.nextSibling.data=e:this.T(Sf.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:s}=e,n="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=Hf.createElement(Bf(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new Wf(n,this),s=e.u(this.options);e.p(t),this.T(s),this._$AH=e}}_$AC(e){let t=Ff.get(e.strings);return void 0===t&&Ff.set(e.strings,t=new Hf(e)),t}k(e){$f(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,n=0;for(const i of e)n===t.length?t.push(s=new Vf(this.S(xf()),this.S(xf()),this,this.options)):s=t[n],s._$AI(i),n++;n<t.length&&(this._$AR(s&&s._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Qf{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,n,i){this.type=1,this._$AH=Pf,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Pf}_$AI(e,t=this,s,n){const i=this.strings;let r=!1;if(void 0===i)e=Gf(this,e,t,0),r=!Ef(e)||e!==this._$AH&&e!==zf,r&&(this._$AH=e);else{const n=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=Gf(this,n[s+o],t,o),a===zf&&(a=this._$AH[o]),r||=!Ef(a)||a!==this._$AH[o],a===Pf?e=Pf:e!==Pf&&(e+=(a??"")+i[o+1]),this._$AH[o]=a}r&&!n&&this.j(e)}j(e){e===Pf?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Jf extends Qf{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Pf?void 0:e}}class Yf extends Qf{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Pf)}}class Xf extends Qf{constructor(e,t,s,n,i){super(e,t,s,n,i),this.type=5}_$AI(e,t=this){if((e=Gf(this,e,t,0)??Pf)===zf)return;const s=this._$AH,n=e===Pf&&s!==Pf||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,i=e!==Pf&&(s===Pf||n);n&&this.element.removeEventListener(this.name,this,s),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class Kf{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Gf(this,e)}}const Zf={P:bf,A:yf,C:wf,M:1,L:qf,R:Wf,D:Cf,V:Gf,I:Vf,H:Qf,N:Yf,U:Xf,B:Jf,F:Kf},eg=pf.litHtmlPolyfillSupport;eg?.(Hf,Vf),(pf.litHtmlVersions??=[]).push("3.1.4");const tg=globalThis,sg=tg.trustedTypes,ng=sg?sg.createPolicy("lit-html",{createHTML:e=>e}):void 0,ig="$lit$",rg=`lit$${Math.random().toFixed(9).slice(2)}$`,og="?"+rg,ag=`<${og}>`,cg=document,lg=()=>cg.createComment(""),dg=e=>null===e||"object"!=typeof e&&"function"!=typeof e,ug=Array.isArray,hg=e=>ug(e)||"function"==typeof e?.[Symbol.iterator],mg="[ \t\n\f\r]",fg=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,gg=/-->/g,pg=/>/g,vg=RegExp(`>|${mg}(?:([^\\s"'>=/]+)(${mg}*=${mg}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),_g=/'/g,bg=/"/g,yg=/^(?:script|style|textarea|title)$/i,wg=e=>(t,...s)=>({_$litType$:e,strings:t,values:s}),Ag=wg(1),Sg=(wg(2),Symbol.for("lit-noChange")),xg=Symbol.for("lit-nothing"),Eg=new WeakMap,$g=cg.createTreeWalker(cg,129);function Cg(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==ng?ng.createHTML(t):t}const kg=(e,t)=>{const s=e.length-1,n=[];let i,r=2===t?"<svg>":"",o=fg;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(o.lastIndex=d,c=o.exec(s),null!==c);)d=o.lastIndex,o===fg?"!--"===c[1]?o=gg:void 0!==c[1]?o=pg:void 0!==c[2]?(yg.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=vg):void 0!==c[3]&&(o=vg):o===vg?">"===c[0]?(o=i??fg,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?vg:'"'===c[3]?bg:_g):o===bg||o===_g?o=vg:o===gg||o===pg?o=fg:(o=vg,i=void 0);const u=o===vg&&e[t+1].startsWith("/>")?" ":"";r+=o===fg?s+ag:l>=0?(n.push(a),s.slice(0,l)+ig+s.slice(l)+rg+u):s+rg+(-2===l?t:u)}return[Cg(e,r+(e[s]||"<?>")+(2===t?"</svg>":"")),n]};class Tg{constructor({strings:e,_$litType$:t},s){let n;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=kg(e,t);if(this.el=Tg.createElement(c,s),$g.currentNode=this.el.content,2===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(n=$g.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes())for(const e of n.getAttributeNames())if(e.endsWith(ig)){const t=l[r++],s=n.getAttribute(e).split(rg),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:s,ctor:"."===o[1]?Mg:"?"===o[1]?Rg:"@"===o[1]?Dg:Ig}),n.removeAttribute(e)}else e.startsWith(rg)&&(a.push({type:6,index:i}),n.removeAttribute(e));if(yg.test(n.tagName)){const e=n.textContent.split(rg),t=e.length-1;if(t>0){n.textContent=sg?sg.emptyScript:"";for(let s=0;s<t;s++)n.append(e[s],lg()),$g.nextNode(),a.push({type:2,index:++i});n.append(e[t],lg())}}}else if(8===n.nodeType)if(n.data===og)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(rg,e+1));)a.push({type:7,index:i}),e+=rg.length-1}i++}}static createElement(e,t){const s=cg.createElement("template");return s.innerHTML=e,s}}function jg(e,t,s=e,n){if(t===Sg)return t;let i=void 0!==n?s._$Co?.[n]:s._$Cl;const r=dg(t)?void 0:t._$litDirective$;return i?.constructor!==r&&(i?._$AO?.(!1),void 0===r?i=void 0:(i=new r(e),i._$AT(e,s,n)),void 0!==n?(s._$Co??=[])[n]=i:s._$Cl=i),void 0!==i&&(t=jg(e,i._$AS(e,t.values),i,n)),t}class Ng{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,n=(e?.creationScope??cg).importNode(t,!0);$g.currentNode=n;let i=$g.nextNode(),r=0,o=0,a=s[0];for(;void 0!==a;){if(r===a.index){let t;2===a.type?t=new Og(i,i.nextSibling,this,e):1===a.type?t=new a.ctor(i,a.name,a.strings,this,e):6===a.type&&(t=new Lg(i,this,e)),this._$AV.push(t),a=s[++o]}r!==a?.index&&(i=$g.nextNode(),r++)}return $g.currentNode=cg,n}p(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class Og{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,s,n){this.type=2,this._$AH=xg,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=jg(this,e,t),dg(e)?e===xg||null==e||""===e?(this._$AH!==xg&&this._$AR(),this._$AH=xg):e!==this._$AH&&e!==Sg&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):hg(e)?this.k(e):this._(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}_(e){this._$AH!==xg&&dg(this._$AH)?this._$AA.nextSibling.data=e:this.T(cg.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:s}=e,n="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=Tg.createElement(Cg(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new Ng(n,this),s=e.u(this.options);e.p(t),this.T(s),this._$AH=e}}_$AC(e){let t=Eg.get(e.strings);return void 0===t&&Eg.set(e.strings,t=new Tg(e)),t}k(e){ug(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,n=0;for(const i of e)n===t.length?t.push(s=new Og(this.S(lg()),this.S(lg()),this,this.options)):s=t[n],s._$AI(i),n++;n<t.length&&(this._$AR(s&&s._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Ig{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,n,i){this.type=1,this._$AH=xg,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=xg}_$AI(e,t=this,s,n){const i=this.strings;let r=!1;if(void 0===i)e=jg(this,e,t,0),r=!dg(e)||e!==this._$AH&&e!==Sg,r&&(this._$AH=e);else{const n=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=jg(this,n[s+o],t,o),a===Sg&&(a=this._$AH[o]),r||=!dg(a)||a!==this._$AH[o],a===xg?e=xg:e!==xg&&(e+=(a??"")+i[o+1]),this._$AH[o]=a}r&&!n&&this.j(e)}j(e){e===xg?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Mg extends Ig{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===xg?void 0:e}}class Rg extends Ig{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==xg)}}class Dg extends Ig{constructor(e,t,s,n,i){super(e,t,s,n,i),this.type=5}_$AI(e,t=this){if((e=jg(this,e,t,0)??xg)===Sg)return;const s=this._$AH,n=e===xg&&s!==xg||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,i=e!==xg&&(s===xg||n);n&&this.element.removeEventListener(this.name,this,s),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class Lg{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){jg(this,e)}}const zg=tg.litHtmlPolyfillSupport;zg?.(Tg,Og),(tg.litHtmlVersions??=[]).push("3.1.4");const Pg=(e,t,s)=>{const n=s?.renderBefore??t;let i=n._$litPart$;if(void 0===i){const e=s?.renderBefore??null;n._$litPart$=i=new Og(t.insertBefore(lg(),e),e,void 0,s??{})}return i._$AI(e),i};class Fg extends gf{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Pg(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Sg}}Fg._$litElement$=!0,Fg.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:Fg});const Ug=globalThis.litElementPolyfillSupport;Ug?.({LitElement:Fg});(globalThis.litElementVersions??=[]).push("4.0.6"),Iu.api=Oh;const Bg=Object.assign(window.converse||{},{CHAT_STATES:$u,keycodes:Cu,async initialize(e){const{api:t}=Iu;if(await async function(e){const{api:t}=e;await t.trigger("cleanup",{synchronous:!0}),function(e){e.api.trigger("unregisteredGlobalEventHandlers")}(e),t.connection.get()?.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&t.promises.add("initialized")}(Iu),function(e){Gd=e,Hd=new Wd;const t=ad(e,Object.keys(Fd));Object.assign(Hd,Fd,t)}(e),Iu.strict_plugin_dependencies=e.strict_plugin_dependencies,bt.setLogLevel(t.settings.get("loglevel")),t.settings.get("authentication")===ru&&t.settings.get("auto_login")&&!t.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");vm(),addEventListener("hashchange",vm);const s=new Ph;Object.assign(Iu,{connfeedback:s}),Object.assign(Iu.state,{connfeedback:s}),await async function(e){await Wc.sessionStorageInitialized,e.storage.session=Wc.localForage.createInstance({name:Yd()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}(Iu),await async function(e){const t="converse.client-config",s=new cd({id:t,trusted:!0});s.browserStorage=qu(t,"session"),Object.assign(e,{config:s}),Object.assign(e.state,{config:s}),await new Promise((e=>s.fetch({success:e,error:e}))),e.api.trigger("clientConfigInitialized")}(Iu),await wt.initialize(),function(e){e.pluggable.initialized_plugins=[];const t=xu.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}(Iu),t.elements?.register(),function(e){e.api.trigger("registeredGlobalEventHandlers")}(Iu);const n=Iu.pluggable.plugins;if((t.settings.get("auto_login")||t.settings.get("keepalive")&&n["converse-bosh"]?.enabled())&&await t.user.login(null,null,!0),t.trigger("initialized"),Yd())return Iu},plugins:{add(e,t){if(t.__name__=e,void 0!==Iu.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);Iu.pluggable.plugins[e]=t}},env:{$build:ke,$iq:je,$msg:Te,$pres:Ne,utils:Sm,Collection:Od,Model:cd,Promise,Strophe:lt,TimeoutError:hh,URI:zh(),VERSION_NAME:nu,dayjs:R(),filesize:Vm,html:Ag,log:bt,sizzle:P(),sprintf:yt.sprintf,stx:function(e,...t){return new ct(e,t)},u:Sm}}),qg=Bg,Hg=qg.env.utils;function Gg(e,t){Oh.send(Te({to:e.getAttribute("from"),type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("not-allowed",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).t(t)),bt.warn(`Rejecting message stanza with the following reason: ${t}`),bt.warn(e)}function Wg(e,t,s,n){const i=Te({from:Oh.connection.get().jid,id:Hg.getUniqueId(),to:e,type:n||"chat"}).c(s,{xmlns:lt.NS.MARKERS,id:t});Oh.send(i)}const{NS:Vg}=lt;class Qg extends Error{constructor(e,t){super(e),this.name="StanzaParseError",this.stanza=t}}function Jg(e,t){const s={},n=P()(`stanza-id[xmlns="${lt.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{});Object.assign(s,n);const i=P()(`message > result[xmlns="${lt.NS.MAM}"]`,t).pop();if(i){const e=Iu.session.get("bare_jid");s[`stanza_id ${t.getAttribute("from")||e}`]=i.getAttribute("id")}const r=P()(`origin-id[xmlns="${lt.NS.SID}"]`,e).pop();return r&&(s.origin_id=r.getAttribute("id")),s}function Yg(e){const t=P()(`encryption[xmlns="${lt.NS.EME}"]`,e).pop(),s=t?.getAttribute("namespace"),n={};return s?(n.is_encrypted=!0,n.encryption_namespace=s):P()(`encrypted[xmlns="${lt.NS.OMEMO}"]`,e).pop()&&(n.is_encrypted=!0,n.encryption_namespace=lt.NS.OMEMO),n}function Xg(e,t){const s=P()(`> apply-to[xmlns="${lt.NS.FASTEN}"]`,e).pop();if(s){const e=s.getAttribute("id");if(P()(`> retract[xmlns="${lt.NS.RETRACT}"]`,s).pop()){const s=P()(`delay[xmlns="${lt.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:s?R()(s.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}else{const t=P()(`> retracted[xmlns="${lt.NS.RETRACT}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp")}}return{}}function Kg(e,t){const s=P()(`replace[xmlns="${lt.NS.MESSAGE_CORRECT}"]`,e).pop();if(s){const e=s.getAttribute("id");if(e){const s=P()(`delay[xmlns="${lt.NS.DELAY}"]`,t).pop();return{replace_id:e,edited:s?R()(s.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function Zg(e){const t=P()(`spoiler[xmlns="${lt.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:t?.textContent}}function ep(e){const t=P()(`x[xmlns="${lt.NS.OUTOFBAND}"]`,e).pop();return t?{oob_url:t.querySelector("url")?.textContent,oob_desc:t.querySelector("desc")?.textContent}:{}}function tp(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),s=P()(`text[xmlns="${lt.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:s?.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName}}return{}}function sp(e){return P()(`reference[xmlns="${lt.NS.REFERENCE}"]`,e).map((t=>{const s=t.getAttribute("anchor"),n=e.querySelector(s?`#${s}`:"body")?.textContent;if(!n)return bt.warn(`Could not find referenced text for ${t}`),null;const i=t.getAttribute("begin"),r=t.getAttribute("end");return{begin:i,end:r,type:t.getAttribute("type"),value:n.slice(i,r),uri:t.getAttribute("uri")}})).filter((e=>e))}function np(e){const t=P()(`received[xmlns="${lt.NS.RECEIPTS}"]`,e).pop();return t?.getAttribute("id")}function ip(e){const t=lt.NS.CARBONS;return P()(`message > received[xmlns="${t}"]`,e).length>0||P()(`message > sent[xmlns="${t}"]`,e).length>0}function rp(e){return P()(`\n        composing[xmlns="${Vg.CHATSTATES}"],\n        paused[xmlns="${Vg.CHATSTATES}"],\n        inactive[xmlns="${Vg.CHATSTATES}"],\n        active[xmlns="${Vg.CHATSTATES}"],\n        gone[xmlns="${Vg.CHATSTATES}"]`,e).pop()?.nodeName}function op(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&P()(`request[xmlns="${lt.NS.RECEIPTS}"]`,e).length}function ap(e){if(P()(`message > forwarded[xmlns="${lt.NS.FORWARD}"]`,e).length){Gg(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new Qg(`Ignoring unencapsulated forwarded message from ${t}`,e)}}function cp(e){return P()(`\n        acknowledged[xmlns="${lt.NS.MARKERS}"],\n        displayed[xmlns="${lt.NS.MARKERS}"],\n        received[xmlns="${lt.NS.MARKERS}"]`,e).pop()}function lp(e){return"headline"===e.getAttribute("type")}function dp(e){if(P()(`mentions[xmlns="${lt.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function up(e){return!!P()(`message > result[xmlns="${lt.NS.MAM}"]`,e).pop()}function hp(e,t,s){const n=e.getAttribute("var"),i=e.getAttribute("label")||"",r=e.getAttribute("type"),o=e.querySelector("desc")?.textContent,a={readonly:t,desc:o};if("list-single"===r||"list-multi"===r){const t=Array.from(e.querySelectorAll(":scope > value")).map((e=>e?.textContent));return{type:r,options:Array.from(e.querySelectorAll(":scope > option")).map((s=>{const n=s.querySelector("value")?.textContent;return{value:n,label:s.getAttribute("label"),selected:t.includes(n),required:!!e.querySelector("required"),...a}})),label:e.getAttribute("label"),var:n,required:!!e.querySelector("required"),...a}}if("fixed"===r){const t=e.querySelector("value")?.textContent;return{text:t,label:i,type:r,var:n,...a}}if("jid-multi"===r)return{type:r,var:n,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),...a};if("boolean"===r){const t=e.querySelector("value")?.textContent;return{type:r,var:n,label:i,checked:"1"===t||"true"===t,...a}}if("url"===n)return{var:n,label:i,value:e.querySelector("value")?.textContent,...a};if("username"===n)return{var:n,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),type:mp(e),...a};if("password"===n)return{var:n,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),...a};if("ocr"===n){const t=e.querySelector("uri"),i=P()('data[cid="'+t.textContent.replace(/^cid:/,"")+'"]',s)[0];return{label:e.getAttribute("label"),var:n,uri:{type:t.getAttribute("type"),data:i?.textContent},required:!!e.querySelector("required"),...a}}return{label:i,var:n,required:!!e.querySelector("required"),value:e.querySelector("value")?.textContent,type:mp(e),...a}}function mp(e){const t=ku[e.getAttribute("type")];if("text"==t){const s=e.getElementsByTagNameNS("http://jabber.org/protocol/xdata-validate","validate");if(1===s.length){const e=s[0].getAttribute("datatype");return Tu[e]||t}}return t}function fp(e){const t=P()(`x[xmlns="${lt.NS.XFORM}"]`,e);if(t.length>1)throw bt.error(e),new Error("Invalid stanza");if(0===t.length)return null;const s=t[0],n=s.getAttribute("type"),i={type:n,title:s.querySelector("title")?.textContent};if("result"===n){const t=s.querySelector(":scope > reported");if(t){const e=t?Array.from(t.querySelectorAll(":scope > field")):[],n=Array.from(s.querySelectorAll(":scope > item"));return{...i,reported:e.map(Dh),items:n.map((e=>Array.from(e.querySelectorAll("field")).map((e=>({...Dh(e),value:e.querySelector("value")?.textContent??""})))))}}return{...i,fields:Array.from(s.querySelectorAll("field")).map((t=>hp(t,!0,e)))}}if("form"===n)return{...i,instructions:s.querySelector("instructions")?.textContent,fields:Array.from(s.querySelectorAll("field")).map((t=>hp(t,!1,e)))};throw new Error(`Invalid type in XForm response stanza: ${n}`)}const gp=class extends cd{defaults(){return{current_category:"smileys",current_skintone:"",scroll_position:0}}},pp={async initialize(){if(!qg.emojis.initialized){qg.emojis.initialized=!0;const e=await s.e(2974).then(s.t.bind(s,7641,19)),t=await Oh.hook("loadEmojis",{},e.default);qg.emojis.json=t,qg.emojis.by_sn=Object.keys(t).reduce(((e,s)=>Object.assign(e,t[s])),{}),qg.emojis.list=Object.values(qg.emojis.by_sn),qg.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),qg.emojis.shortnames=qg.emojis.list.map((e=>e.sn));const n=()=>qg.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");qg.emojis.shortnames_regex=new RegExp(n(),"g"),qg.emojis.initialized_promise.resolve()}return qg.emojis.initialized_promise}},vp={emojis:pp},_p=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Þ|\\:\\-Þ|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Þ|\\:Þ|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),bp=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,{u:yp}=qg.env,wp={},Ap={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Þ":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Þ":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function Sp(e){if(e.indexOf("-")>-1){const t=[],s=e.split("-");for(let e=0;e<s.length;e++){const n=parseInt(s[e],16);if(n>=65536&&n<=1114111){const e=Math.floor((n-65536)/1024)+55296,s=(n-65536)%1024+56320;t.push(String.fromCharCode(e)+String.fromCharCode(s))}else t.push(String.fromCharCode(n))}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function xp(e){return e.replace(_p,((e,t,s,n)=>{if(void 0===n||""===n||!(yp.unescapeHTML(n)in Ap))return e;n=yp.unescapeHTML(n);return s+Sp(Ap[n].toUpperCase())}))}function Ep(e){if(!qg.emojis.initialized)throw new Error("getShortnameReferences called before emojis are initialized. To avoid this problem, first await the converse.emojis.initialized_promise");return[...e.matchAll(qg.emojis.shortnames_regex)].filter((e=>e[0].length>0)).map((e=>{const t=qg.emojis.by_sn[e[0]].cp;return{cp:t,begin:e.index,end:e.index+e[0].length,shortname:e[0],emoji:t?Sp(t):null}}))}function $p(e){const t=[];return function(e,t){const s=/\uFE0F/g,n=String.fromCharCode(8205);String(e).replace(bp,((e,i,r)=>{const o=function(e){const t=[];let s=0,n=0;for(;n<e.length;){const i=e.charCodeAt(n++);s?(t.push((65536+(s-55296<<10)+(i-56320)).toString(16)),s=0):55296<=i&&i<=56319?s=i:t.push(i.toString(16))}return t.join("-")}(e.indexOf(n)<0?e.replace(s,""):e);return o&&t(o,e,r),e}))}(e,((e,s,n)=>{t.push({begin:n,cp:e,emoji:s,end:n+s.length,shortname:kp("cp")[e]?.sn||""})})),t}function Cp(e){const t=e.trim().split(/\s+/);if(0===t.length||t.length>3)return!1;const s=t.filter((e=>{const t=$p(yp.shortnamesToUnicode(e));return 1===t.length&&(e===t[0].shortname||e===t[0].emoji)}));return s.length===t.length}function kp(e){if(wp[e])return wp[e];if("category"===e)return qg.emojis.json;const t=qg.emojis.list.map((t=>t[e])).filter(((e,t,s)=>s.indexOf(e)==t));return wp[e]={},t.forEach((t=>wp[e][t]=qg.emojis.list.find((s=>s[e]===t)))),wp[e]}Object.assign(yp,{getCodePointReferences:$p,getShortnameReferences:Ep,convertASCII2Emoji:xp,getEmojisByAttribute:kp,isOnlyEmojis:Cp,shortnamesToUnicode:function(e){return function(e){let t=[e];return[...Ep(e),...$p(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const s=t.shift(),n=e.emoji||e.shortname;t=[s.slice(0,e.begin)+n+s.slice(e.end),...t]})),t}(xp(e)).pop()}}),qg.emojis={initialized:!1,initialized_promise:ic()},qg.plugins.add("converse-emoji",{initialize(){const{___:e}=Iu;Oh.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}});const t={EmojiPicker:gp};async function s(e,t){return await Oh.emojis.initialize(),{...t,is_only_emojis:!!t.body&&Cp(t.body)}}Object.assign(Iu,t),Object.assign(Iu.exports,t),Object.assign(Oh,vp),Oh.listen.on("getOutgoingMessageAttributes",(async(e,t)=>{await Oh.emojis.initialize();const{original_text:s}=t;return{...t,is_only_emojis:!!s&&Cp(s)}})),Oh.listen.on("parseMUCMessage",s),Oh.listen.on("parseMessage",s)}});const{Strophe:Tp}=qg.env;const jp=class extends cd{get idAttribute(){return"jid"}getDisplayName(){return Tp.xmlunescape(this.get("name"))}},{safeSave:Np,colorize:Op}=Sm;class Ip extends cd{async setColor(){const e=await Op(this.getIdentifier());Np(this,{color:e})}getIdentifier(){return this.get("type")===yu?this.get("jid"):"groupchat"===this.get("type")?this.get("from_real_jid")||this.get("from"):this.get("occupant_id")||this.get("jid")||this.get("from")||this.get("nick")}async getColor(){return this.get("color")||await this.setColor(),this.get("color")}async getAvatarStyle(e=""){try{return`background-color: ${await this.getColor()} !important; ${e}`}catch{return`background-color: gray !important; ${e}`}}}const Mp=class extends Ip{initialize(){super.initialize(),this.rosterContactAdded=ic(),this.contact=null,this.vcard=null}async setModelContact(e){if(this.contact?.get("jid")!==e){if(lt.getBareJidFromJid(e)===Iu.session.get("bare_jid"))this.contact=Iu.state.xmppstatus;else{const t=await Oh.contacts.get(e);t&&(this.contact=t,this.set("nickname",t.get("nickname")))}this.listenTo(this.contact,"change",(e=>{e.nickname&&this.set("nickname",e.nickname),this.trigger("contact:change",e)})),this.rosterContactAdded.resolve(),this.trigger("contactAdded",this.contact)}}};const Rp=class extends Mp{defaults(){return{msgid:Am(),time:(new Date).toISOString(),is_ephemeral:!1}}constructor(e,t){super(e,t),this.file=null}async initialize(){super.initialize(),this.checkValidity()&&(this.initialized=ic(),this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setContact())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),await this.setContact(),this.setTimerForEphemeralMessage(),await Oh.trigger("messageInitialized",this,{Synchronous:!0}),this.initialized.resolve())}setContact(){if(["chat","normal"].includes(this.get("type")))return Mp.prototype.initialize.apply(this,arguments),this.setModelContact(lt.getBareJidFromJid(this.get("from")))}setTimerForEphemeralMessage(){this.ephemeral_timer&&clearTimeout(this.ephemeral_timer);const e=this.isEphemeral();if(e){const t="number"==typeof e?e:1e4;this.ephemeral_timer=setTimeout((()=>this.safeDestroy()),t)}}checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)}mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(Oh.settings.get("allow_message_retraction"))}safeDestroy(){try{this.destroy()}catch(e){bt.warn(`safeDestroy: ${e}`)}}isEphemeral(){return this.get("is_ephemeral")}isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")}isFollowup(){const e=this.collection.models,t=e.indexOf(this),s=t?e[t-1]:null;if(null===s)return!1;const n=R()(this.get("time"));return this.get("from")===s.get("from")&&!this.isMeCommand()&&!s.isMeCommand()&&!!this.get("is_encrypted")==!!s.get("is_encrypted")&&this.get("type")===s.get("type")&&"info"!==this.get("type")&&n.isBefore(R()(s.get("time")).add(10,"minutes"))&&("groupchat"!==this.get("type")||this.get("occupant_id")===s.get("occupant_id"))}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")}getMessageText(){if(this.get("is_encrypted")){const{__:e}=Iu;return this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message")}return["groupchat","chat","normal"].includes(this.get("type"))?this.get("body"):this.get("message")}sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=je({from:Iu.session.get("jid"),to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:lt.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return Oh.sendIQ(e)}getUploadRequestMetadata(e){return{headers:P()(`slot[xmlns="${lt.NS.HTTPUPLOAD}"] put header`,e).map((e=>({name:e.getAttribute("name"),value:e.textContent}))).filter((e=>["Authorization","Expires"].includes(e.name)))}}async getRequestSlotURL(){const{__:e}=Iu;let t;try{t=await this.sendSlotRequestStanza()}catch(t){return bt.error(t),this.save({type:"error",message:e("Sorry, could not determine upload URL."),is_ephemeral:!0})}const s=P()(`slot[xmlns="${lt.NS.HTTPUPLOAD}"]`,t).pop();if(!s)return this.save({type:"error",message:e("Sorry, could not determine file upload URL."),is_ephemeral:!0});this.upload_metadata=this.getUploadRequestMetadata(t),this.save({get:s.querySelector("get").getAttribute("url"),put:s.querySelector("put").getAttribute("url")})}uploadFile(){const e=new XMLHttpRequest;e.onreadystatechange=async t=>{if(e.readyState===XMLHttpRequest.DONE)if(bt.info("Status: "+e.status),200===e.status||201===e.status){let e={upload:hu,oob_url:this.get("get"),message:this.get("get"),body:this.get("get")};e=await Oh.hook("afterFileUploaded",this,e),this.save(e)}else bt.error(t),e.onerror(new ProgressEvent(`Response status: ${e.status}`))},e.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),e.onerror=()=>{const{__:t}=Iu;let s;s=e.responseText?t('Sorry, could not succesfully upload your file. Your server’s response: "%1$s"',e.responseText):t("Sorry, could not succesfully upload your file."),this.save({type:"error",upload:mu,message:s,is_ephemeral:!0})},e.open("PUT",this.get("put"),!0),e.setRequestHeader("Content-type",this.file.type),this.upload_metadata.headers?.forEach((t=>e.setRequestHeader(t.name,t.value))),e.send(this.file)}};const Dp=class extends Rp{async initialize(){this.chatbox=this.collection?.chatbox,this.checkValidity()&&(this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setOccupant())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),this.setTimerForEphemeralMessage(),this.setOccupant(),Oh.trigger("chatRoomMessageInitialized",this))}getDisplayName(){return this.occupant?.getDisplayName()||this.get("nick")}mayBeModerated(){if(void 0!==this.get("from_muc"))return["all","moderator"].includes(Oh.settings.get("allow_message_retraction"))&&this.get(`stanza_id ${this.get("from_muc")}`)&&this.chatbox.canModerateMessages()}checkValidity(){const e=Iu.exports.Message.prototype.checkValidity.call(this);return!e&&this.chatbox.debouncedRejoin(),e}onOccupantRemoved(){this.stopListening(this.occupant),delete this.occupant,this.listenTo(this.chatbox.occupants,"add",this.onOccupantAdded)}onOccupantAdded(e){if(this.get("occupant_id")){if(e.get("occupant_id")!==this.get("occupant_id"))return}else if(e.get("nick")!==lt.getResourceFromJid(this.get("from")))return;this.setOccupant(e)}getOccupant(){return this.occupant||this.setOccupant()}setOccupant(e){if("groupchat"===this.get("type")&&!this.isEphemeral()){if(e)this.occupant=e;else{if(this.occupant)return;const e=lt.getResourceFromJid(this.get("from")),t=this.get("occupant_id");if(this.occupant=e||t?this.chatbox.occupants.findOccupant({nick:e,occupant_id:t}):null,!this.occupant){const s=this.get("from_real_jid");if(!e&&!t&&!s)return;if(this.occupant=this.chatbox.occupants.create({nick:e,occupant_id:t,jid:s}),Oh.settings.get("muc_send_probes")){const t=`${this.chatbox.get("jid")}/${e}`;Oh.user.presence.send("probe",t)}}}return this.get("from_real_jid")!==this.occupant.get("jid")&&this.save("from_real_jid",this.occupant.get("jid")),this.trigger("occupant:add"),this.listenTo(this.occupant,"change",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved),this.stopListening(this.chatbox.occupants,"add",this.onOccupantAdded),this.occupant}}};const Lp=class extends Od{constructor(e,t={}){super(e,Object.assign({comparator:"time"},t)),this.model=Dp}},zp={},Pp=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);zp.escapeCharacters=e=>t=>e.split("").reduce(Pp,t),zp.escapeRegexString=zp.escapeCharacters("[\\^$.?*+(){}|"),zp.findFirstMatchInArray=e=>t=>{for(let s=0;s<e.length;s++)if(0===t.localeCompare(e[s],void 0,{sensitivity:"base"}))return e[s];return null};const Fp=([e,t],s,n)=>{let i=e,{begin:r,end:o}=s;const{value:a}=s;return r-=n,o=o-n-1,i=`${i.slice(0,r)}${a}${i.slice(o+1)}`,[i,[...t,{...s,begin:r,end:o}]]};zp.reduceTextFromReferences=(e,t)=>t.reduce(Fp,[e,[]]);const Up=zp;const Bp=function(e,t){return e===t||Nl(e,t,Il(t))},{u:qp}=qg.env;async function Hp(e,t){if(!t.replace_id||!t.from)return;const s="groupchat"===t.type&&t.occupant_id?({attributes:e})=>e.msgid===t.replace_id&&e.occupant_id==t.occupant_id:({attributes:e})=>e.msgid===t.replace_id&&e.from===t.from&&null==e.occupant_id,n=e.messages.models.find(s);if(!n)return t.older_versions={},await e.createMessage(t);const i=n.get("older_versions")||{};return t.time<n.get("time")&&n.get("edited")?(i[t.time]=t.message,n.save({older_versions:i})):(Object.keys(i).length?i[n.get("edited")]=n.getMessageText():i[n.get("time")]=n.getMessageText(),delete(t=Object.assign(t,{older_versions:i})).msgid,delete t.id,t.time=n.get("time"),n.save(t)),n}const Gp=Lu((function(e){const t=Oh.settings.get("prune_messages_above");if(t&&"number"==typeof t&&e.messages.length>t){const s=e.messages.filter((e=>!qp.isEmptyMessage(e)));if(s.length>t){for(;s.length>t;)s.shift().destroy();Oh.trigger("historyPruned",e)}}}),500,{maxWait:2e3}),{Strophe:Wp,sizzle:Vp}=qg.env;async function Qp(e){ap(e);let t=e.getAttribute("to");const s=Wp.getResourceFromJid(t),n=Iu.session.get("resource");if(Oh.settings.get("filter_by_resource")&&s&&s!==n)return new Qg(`Ignoring incoming message intended for a different resource: ${t}`,e);const i=Iu.session.get("bare_jid"),r=e;let o=e.getAttribute("from")||i;if(ip(e)){if(o!==i)return Gg(e,"Rejecting carbon from invalid JID"),new Qg(`Rejecting carbon from invalid JID ${t}`,e);{const s=`[xmlns="${Wp.NS.CARBONS}"] > forwarded[xmlns="${Wp.NS.FORWARD}"] > message`;t=(e=Vp(s,e).pop()).getAttribute("to"),o=e.getAttribute("from")}}const a=up(e);if(a){if(o!==i)return new Qg(`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`,e);{const s=`[xmlns="${Wp.NS.MAM}"] > forwarded[xmlns="${Wp.NS.FORWARD}"] > message`;t=(e=Vp(s,e).pop()).getAttribute("to"),o=e.getAttribute("from")}}const c=Wp.getBareJidFromJid(o),l=c===i;if(l&&null===t)return new Qg(`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`,e);const d=lp(e),u=dp(e);let h,m;if(!d&&!u&&(m=l?Wp.getBareJidFromJid(t):c,h=await Oh.contacts.get(m),void 0===h&&!Oh.settings.get("allow_non_roster_messaging")))return bt.error(e),new Qg("Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.",e);const f=Vp(`delay[xmlns="${Wp.NS.DELAY}"]`,r).pop(),g=cp(e),p=(new Date).toISOString();let v=Object.assign({contact_jid:m,is_archived:a,is_headline:d,is_server_message:u,body:e.querySelector("body")?.textContent?.trim(),chat_state:rp(e),from:Wp.getBareJidFromJid(e.getAttribute("from")),is_carbon:ip(r),is_delayed:!!f,is_markable:!!Vp(`markable[xmlns="${Wp.NS.MARKERS}"]`,e).length,is_marker:!!g,is_unstyled:!!Vp(`unstyled[xmlns="${Wp.NS.STYLING}"]`,e).length,marker_id:g&&g.getAttribute("id"),msgid:e.getAttribute("id")||r.getAttribute("id"),nick:h?.attributes?.nickname,receipt_id:np(e),received:(new Date).toISOString(),references:sp(e),sender:l?"me":"them",subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:f?R()(f.getAttribute("stamp")).toISOString():p,to:e.getAttribute("to"),type:e.getAttribute("type")||"normal"},tp(e),ep(e),Zg(e),Kg(e,r),Jg(e,r),Xg(e,r),Yg(e));if(v.is_archived){const t=r.getAttribute("from");if(t&&t!==i)return new Qg(`Invalid Stanza: Forged MAM message from ${t}`,e)}return v=Object.assign({message:v.body||v.error,is_valid_receipt_request:op(e,v)},v),v.id=v.origin_id||v[`stanza_id ${v.from}`]||Sm.getUniqueId(),v=await Oh.hook("parseMessage",e,v),Object.assign(v,Sm.getMediaURLsMetadata(v.is_encrypted?v.plaintext:v.body))}const{Strophe:Jp,u:Yp}=qg.env;function Xp(e){if(!location.hash.startsWith("#converse/chat?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!Yp.isValidJID(t))return bt.warn(`Invalid JID "${t}" provided in URL fragment`);Oh.chats.open(t)}async function Kp(){if(Zd(Iu)){const{chatboxes:e}=Iu.state;await Promise.all(e.map((e=>e.messages?.clearStore({silent:!0})))),e.clearStore({silent:!0},(e=>e.get("type")!==Au))}}function Zp(){Oh.settings.get("auto_join_private_chats").forEach((e=>{Iu.state.chatboxes.where({jid:e}).length||("string"==typeof e?Oh.chats.open(e):bt.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),Oh.trigger("privateChatsAutoJoined")}function ev(){Oh.connection.get().addHandler((e=>!!(["groupchat","error"].includes(e.getAttribute("type"))||lp(e)||dp(e)||up(e))||(Iu.exports.handleMessageStanza(e)||!0)),null,"message"),Oh.connection.get().addHandler((e=>(async function(e){const t=Jp.getBareJidFromJid(e.getAttribute("from")),s=Iu.session.get("bare_jid");if(Yp.isSameBareJID(t,s))return;const n=await Oh.chatboxes.get(t);n?.get("type")===bu&&n?.handleErrorMessageStanza(e)}(e),!0)),null,"message","error")}async function tv(e){if(dp(e=e instanceof Element?e:e.tree())){const t=e.getAttribute("from");return bt.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}let t;try{t=await Qp(e)}catch(e){return bt.error(e)}if(Yp.isErrorObject(t))return t.stanza&&bt.error(t.stanza),bt.error(t.message);const s=!(!t.body&&!t.plaintext),n=await Oh.chats.get(t.contact_jid,{nickname:t.nick},s);await(n?.queueMessage(t));const i={stanza:e,attrs:t,chatbox:n};Oh.trigger("message",i)}async function sv(){const e=Iu.session.get("bare_jid"),t=Jp.getDomainFromJid(e);if(!await Oh.disco.supports(Jp.NS.CARBONS,t))return void bt.warn("Not enabling carbons because it's not supported!");const s=new Jp.Builder("iq",{from:Oh.connection.get().jid,type:"set"}).c("enable",{xmlns:Jp.NS.CARBONS}),n=await Oh.sendIQ(s,null,!1);null===n?bt.warn("A timeout occurred while trying to enable carbons"):Yp.isErrorStanza(n)?(bt.warn("An error occurred while trying to enable message carbons."),bt.error(n)):bt.debug("Message carbons have been enabled.")}const{Strophe:nv,$msg:iv,u:rv}=qg.env;const ov=class extends Mp{defaults(){return{bookmarked:!1,hidden:Jd()&&!Oh.settings.get("singleton"),message_type:"chat",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:bu}}constructor(e,t){super(e,t),this.disable_mam=!1}async initialize(){super.initialize(),this.initialized=ic();const e=this.get("jid");if(e){if(this.set({box_id:`box-${e}`}),this.initNotifications(),this.initUI(),this.initMessages(),this.get("type")===bu){const{presences:t}=Iu.state;this.presence=t.get(e)||t.create({jid:e}),await this.setModelContact(e),this.presence.on("change:show",(e=>this.onPresenceChanged(e)))}this.on("change:chat_state",this.sendChatState,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.fetchMessages(),await Oh.trigger("chatBoxInitialized",this,{Synchronous:!0}),this.initialized.resolve()}}getMessagesCollection(){return new Iu.exports.Messages}getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${Iu.session.get("bare_jid")}`}initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=ic(),this.messages.chatbox=this,Hu(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"change:upload",(e=>this.onMessageUploadChanged(e))),this.listenTo(this.messages,"add",(e=>this.onMessageAdded(e)))}initUI(){this.ui=new cd}initNotifications(){this.notifications=new cd}getNotificationsText(){const{__:e}=Iu;return this.notifications?.get("chat_state")===pu?e("%1$s is typing",this.getDisplayName()):this.notifications?.get("chat_state")===vu?e("%1$s has stopped typing",this.getDisplayName()):this.notifications?.get("chat_state")===_u?e("%1$s has gone away",this.getDisplayName()):""}afterMessagesFetched(){this.pruneHistoryWhenScrolledDown(),Oh.trigger("afterMessagesFetched",this)}fetchMessages(){if(this.messages.fetched_flag)return void bt.info(`Not re-fetching messages for ${this.get("jid")}`);this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:()=>{this.afterMessagesFetched(),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched}async handleErrorMessageStanza(e){const{__:t}=Iu,s=await Qp(e);if(!await this.shouldShowErrorMessage(s))return;const n=this.getMessageReferencedByError(s);if(n){const e={error:s.error,error_condition:s.error_condition,error_text:s.error_text,error_type:s.error_type,editable:!1};s.msgid===n.get("retraction_id")?(e.retraction_id=void 0,s.error||("forbidden"===s.error_condition?e.error=t("You're not allowed to retract your message."):e.error=t("Sorry, an error occurred while trying to retract your message."))):s.error||("forbidden"===s.error_condition?e.error=t("You're not allowed to send a message."):e.error=t("Sorry, an error occurred while trying to send your message.")),n.save(e)}else this.createMessage(s)}queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>bt.error(e))),this.msg_chain}async onMessage(e){const t=await e;if(rv.isErrorObject(t))return t.stanza&&bt.error(t.stanza),bt.error(t.message);const s=this.getDuplicateMessage(t);if(s)this.updateMessage(s,t);else if(!this.handleReceipt(t)&&!this.handleChatMarker(t)&&!await this.handleRetraction(t)&&(this.setEditable(t,t.time),t.chat_state&&"them"===t.sender&&this.notifications.set("chat_state",t.chat_state),rv.shouldCreateMessage(t))){const e=await Hp(this,t)||await this.createMessage(t);this.notifications.set({chat_state:null}),this.handleUnreadMessage(e)}}async onMessageUploadChanged(e){if(e.get("upload")===hu){const t={body:e.get("body"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};await this.sendMessage(t),e.destroy()}}onMessageAdded(e){!Oh.settings.get("prune_messages_above")||"scrolled"!==Oh.settings.get("pruning_behavior")&&this.ui.get("scrolled")||_m(e)||Gp(this)}async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),bt.error(e)}finally{this.messages.fetched.resolve()}}async close(e){Oh.connection.connected()&&(this.setChatState(fu),this.sendChatState());try{await new Promise(((e,t)=>this.destroy({success:e,error:(e,s)=>t(s)})))}catch(e){bt.debug(e)}finally{Oh.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}Oh.trigger("chatBoxClosed",this)}announceReconnection(){Oh.trigger("chatReconnected",this)}async onReconnection(){Oh.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()}onPresenceChanged(e){const{__:t}=Iu,s=e.get("show"),n=this.getDisplayName();let i;"offline"===s?i=t("%1$s has gone offline",n):"away"===s?i=t("%1$s has gone away",n):"dnd"===s?i=t("%1$s is busy",n):"online"===s&&(i=t("%1$s is online",n)),i&&this.createMessage({message:i,type:"info"})}onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())}pruneHistoryWhenScrolledDown(){Oh.settings.get("prune_messages_above")&&"unscrolled"===Oh.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&Gp(this)}validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=Oh.settings.get("auto_join_rooms").map((e=>e instanceof Object?e.jid:e)),s=Oh.settings.get("auto_join_private_chats").concat(t);if(Oh.settings.get("singleton")&&!s.includes(e.jid)&&!Oh.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return bt.warn(t),t}}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("jid")}async createMessageFromError(e){if(e instanceof hh){(await this.createMessage({type:"error",message:e.message,retry_event_id:e.retry_event_id,is_ephemeral:3e4})).error=e}}editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const s=this.messages.at(t);if(s.get("editable")){e=s;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),e&&e.save("correcting",!0)}editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const s=this.messages.at(t);if(s.get("editable")){e=s,e.save("correcting",!0);break}}return e}getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}}getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}}getUpdatedMessageAttributes(e,t){return t.error_type||"Decryption"!==e.get("error_type")?{is_archived:t.is_archived}:Object.assign({},t,{error_condition:void 0,error_message:void 0,error_text:void 0,error_type:void 0,is_archived:t.is_archived,is_ephemeral:!1,is_error:!1})}updateMessage(e,t){const s=this.getUpdatedMessageAttributes(e,t);s&&e.save(s)}setChatState(e,t){return void 0!==this.chat_state_timeout&&(clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===pu?this.chat_state_timeout=setTimeout(this.setChatState.bind(this),Iu.TIMEOUTS.PAUSED,vu):e===vu&&(this.chat_state_timeout=setTimeout(this.setChatState.bind(this),Iu.TIMEOUTS.INACTIVE,fu)),this.set("chat_state",e,t),this}getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))}shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||!e.chat_state)return Promise.resolve(!0)}isSameUser(e,t){return rv.isSameBareJID(e,t)}findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((({attributes:t})=>t.retracted_id===e.origin_id&&t.from===e.from&&!t.moderated_by))}}async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;const s=this.messages.findWhere({origin_id:e.retracted_id,from:e.from});return s?(s.save(ad(e,t)),!0):(e.dangling_retraction=!0,await this.createMessage(e),!0)}{const s=this.findDanglingRetraction(e);if(s){const n=ad(s.attributes,t),i=Object.assign({dangling_retraction:!1},e,n);return delete i.id,s.save(i),!0}}return!1}getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.reduce(((t,s)=>t||Bp(e.attributes,s)),!1)))}getOriginIdQueryAttrs(e){return e.origin_id&&{origin_id:e.origin_id,from:e.from}}getStanzaIdQueryAttrs(e){const t=Object.keys(e).filter((e=>e.startsWith("stanza_id ")));return t.map((t=>{const s={};return s[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],s}))}getMessageBodyQueryAttrs(e){if(e.msgid){const t={from:e.from,msgid:e.msgid};return!e.is_encrypted&&e.body&&(t.body=e.body),t}}retractOwnMessage(e){this.sendRetractionMessage(e),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:e.get("id"),is_ephemeral:!0,editable:!1})}sendRetractionMessage(e){const t=e.get("origin_id");if(!t)throw new Error("Can't retract message without a XEP-0359 Origin ID");const s=iv({id:rv.getUniqueId(),to:this.get("jid"),type:"chat"}).c("store",{xmlns:nv.NS.HINTS}).up().c("apply-to",{id:t,xmlns:nv.NS.FASTEN}).c("retract",{xmlns:nv.NS.RETRACT});return Oh.connection.get().send(s)}sendMarkerForLastMessage(e="displayed",t=!1){const s=Array.from(this.messages.models);s.reverse();const n=s.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));n&&this.sendMarkerForMessage(n,e,t)}sendMarkerForMessage(e,t="displayed",s=!1){if(e&&Oh.settings.get("send_chat_markers").includes(t)&&(e?.get("is_markable")||s)){Wg(nv.getBareJidFromJid(e.get("from")),e.get("msgid"),t,e.get("type"))}}handleChatMarker(e){if(nv.getBareJidFromJid(e.to)!==Iu.session.get("bare_jid"))return!1;if(e.is_markable)return!this.contact||e.is_archived||e.is_carbon||Wg(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),s=`marker_${e.marker}`;return t&&!t.get(s)&&t.save({field_name:(new Date).toISOString()}),!0}}sendReceiptStanza(e,t){const s=iv({from:Oh.connection.get().jid,id:rv.getUniqueId(),to:e,type:"chat"}).c("received",{xmlns:nv.NS.RECEIPTS,id:t}).up().c("store",{xmlns:nv.NS.HINTS}).up();Oh.send(s)}handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)this.sendReceiptStanza(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1}async createMessageStanza(e){const t=iv({from:Oh.connection.get().jid,to:this.get("jid"),type:this.get("message_type"),id:e.get("edited")&&rv.getUniqueId()||e.get("msgid")}).c("body").t(e.get("body")).up().c(gu,{xmlns:nv.NS.CHATSTATES}).root();"chat"===e.get("type")&&t.c("request",{xmlns:nv.NS.RECEIPTS}).root(),e.get("is_encrypted")||(e.get("is_spoiler")&&(e.get("spoiler_hint")?t.c("spoiler",{xmlns:nv.NS.SPOILER},e.get("spoiler_hint")).root():t.c("spoiler",{xmlns:nv.NS.SPOILER}).root()),(e.get("references")||[]).forEach((e=>{const s={xmlns:nv.NS.REFERENCE,begin:e.begin,end:e.end,type:e.type};e.uri&&(s.uri=e.uri),t.c("reference",s).root()})),e.get("oob_url")&&t.c("x",{xmlns:nv.NS.OUTOFBAND}).c("url").t(e.get("oob_url")).root()),e.get("edited")&&t.c("replace",{xmlns:nv.NS.MESSAGE_CORRECT,id:e.get("msgid")}).root(),e.get("origin_id")&&t.c("origin-id",{xmlns:nv.NS.SID,id:e.get("origin_id")}).root(),t.root();return(await Oh.hook("createMessageStanza",this,{message:e,stanza:t})).stanza}async getOutgoingMessageAttributes(e){const t=!!this.get("composing_spoiler"),s=rv.getUniqueId(),n=e?.body,i=n?rv.shortnamesToUnicode(n):void 0;return e=Object.assign({},e,{from:Iu.session.get("bare_jid"),fullname:Iu.state.xmppstatus.get("fullname"),id:s,jid:this.get("jid"),message:i,msgid:s,nickname:this.get("nickname"),sender:"me",time:(new Date).toISOString(),type:this.get("message_type"),body:i,is_spoiler:t,origin_id:s},rv.getMediaURLsMetadata(n)),e=await Oh.hook("getOutgoingMessageAttributes",this,e)}setEditable(e,t){e.is_headline||_m(e)||"me"!==e.sender||("all"===Oh.settings.get("allow_message_corrections")?e.editable=!(e.file||e.retracted||"oob_url"in e):"last"===Oh.settings.get("allow_message_corrections")&&t>this.get("time_sent")&&(this.set({time_sent:t}),this.messages.findWhere({editable:!0})?.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)))}async createMessage(e,t){return e.time=e.time||(new Date).toISOString(),await this.messages.fetched,this.messages.create(e,t)}async sendMessage(e){e=await this.getOutgoingMessageAttributes(e);let t=this.messages.findWhere("correcting");if(t){const s=t.get("older_versions")||{};s[t.get("edited")||t.get("time")]=t.getMessageText(),t.save({...ad(e,["body","is_only_emojis","media_urls","references","is_encrypted"]),correcting:!1,edited:(new Date).toISOString(),message:e.body,ogp_metadata:[],origin_id:rv.getUniqueId(),received:void 0,older_versions:s,plaintext:e.is_encrypted?e.message:void 0})}else this.setEditable(e,(new Date).toISOString()),t=await this.createMessage(e);try{const e=await this.createMessageStanza(t);Oh.send(e)}catch(e){return t.destroy(),void bt.error(e)}return Oh.trigger("sendMessage",{chatbox:this,message:t}),t}sendChatState(){if(Oh.settings.get("send_chat_state_notifications")&&this.get("chat_state")){const e=Oh.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;Oh.send(iv({id:rv.getUniqueId(),to:this.get("jid"),type:"chat"}).c(this.get("chat_state"),{xmlns:nv.NS.CHATSTATES}).up().c("no-store",{xmlns:nv.NS.HINTS}).up().c("no-permanent-store",{xmlns:nv.NS.HINTS}))}}async sendFiles(e){const{__:t,session:s}=Iu,n=(await Oh.disco.features.get(nv.NS.HTTPUPLOAD,s.get("domain"))).pop();if(!n)return void this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const i=n.dataforms.where({FORM_TYPE:{value:nv.NS.HTTPUPLOAD,type:"hidden"}}).pop(),r=parseInt((i?.attributes||{})["max-file-size"]?.value,10),o=n?.id;o?Array.from(e).forEach((async e=>{if(e=await Oh.hook("beforeFileUpload",this,e),!isNaN(r)&&e.size>r){const s=Vm(r),n=Array.isArray(s)?t("The size of your file, %1$s, exceeds the maximum allowed by your server.",e.name):t("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,s);return this.createMessage({message:n,type:"error",is_ephemeral:!0})}{const t=await this.getOutgoingMessageAttributes(),s=Object.assign(t,{file:!0,progress:0,slot_request_url:o});this.setEditable(s,(new Date).toISOString());const n=await this.createMessage(s,{silent:!0});n.file=e,this.messages.trigger("add",n),n.getRequestSlotURL()}})):this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})}maybeShow(e){if(!Jd())return rv.safeSave(this,{hidden:!1}),this.trigger("show"),this;{const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),s=Iu.state.chatboxes.filter(t);(e||0===s.length)&&(s.forEach((e=>rv.safeSave(e,{hidden:!0}))),rv.safeSave(this,{hidden:!1}))}}isHidden(){return this.get("hidden")||this.isScrolledUp()||document.hidden}handleUnreadMessage(e){e?.get("body")&&function(e){return e instanceof Element?!(P()(`result[xmlns="${Jp.NS.MAM}"]`,e).length&&P()(`delay[xmlns="${Jp.NS.DELAY}"]`,e).length):(e instanceof cd&&(e=e.attributes),!(e.is_delayed&&e.is_archived))}(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))}incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)}clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),rv.safeSave(this,{num_unread:0})}isScrolledUp(){return this.ui.get("scrolled")}canPostMessages(){return!0}},av=["moderator","participant","visitor"],cv=["owner","admin","member","outcast","none"],lv={moderator:1,participant:2,visitor:3,none:2},dv={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},uv=Object.values(dv),hv={ENTERED:"entered",EXITED:"exited"},mv=Object.values(hv),fv={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},gv=Object.values(fv),pv={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...uv],join_leave_events:[...mv],role_changes:[...gv]},vv={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7,CLOSING:8},_v=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled","vcard-temp"],bv="303",{Strophe:yv,sizzle:wv,u:Av}=qg.env,{NS:Sv}=yv;function xv(e){const t=wv(`items[node="${yv.NS.CONFINFO}"]`,e).pop();if(!t)return null;const s=e.getAttribute("from"),n=e.getAttribute("id"),i=`item conference-info[xmlns="${yv.NS.CONFINFO}"] activity[xmlns="${yv.NS.ACTIVITY}"]`;return wv(i,t).map((t=>{const i=t.querySelector("text")?.textContent;if(i){const r=sp(e),o=t.querySelector("reason")?.textContent;return{from:s,msgid:n,message:i,reason:o,references:r,type:"mep"}}return{}}))}function Ev(e,t){if(t.features.get(yv.NS.OCCUPANTID))return wv(`occupant-id[xmlns="${yv.NS.OCCUPANTID}"]`,e).pop()?.getAttribute("id")}function $v(e,t){let s;const n=t.get("occupant_id");if(n)s=e.occupant_id===n;else if(e.from_real_jid){const t=Iu.session.get("bare_jid");s=yv.getBareJidFromJid(e.from_real_jid)===t}else s=e.nick===t.get("nick");return s?"me":"them"}async function Cv(e,t){ap(e);const s=`[xmlns="${Sv.MAM}"] > forwarded[xmlns="${Sv.FORWARD}"] > message`,n=e;if(e=wv(s,e).pop()||e,wv(`message > forwarded[xmlns="${yv.NS.FORWARD}"]`,e).length)return new Qg(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e);const i=wv(`delay[xmlns="${yv.NS.DELAY}"]`,n).pop(),r=e.getAttribute("from"),o=cp(e);let a=Object.assign({from:r,activities:xv(e),body:e.querySelector(":scope > body")?.textContent?.trim(),chat_state:rp(e),from_muc:yv.getBareJidFromJid(r),is_archived:up(n),is_carbon:ip(n),is_delayed:!!i,is_forwarded:!!e.querySelector("forwarded"),is_headline:lp(e),is_markable:!!wv(`markable[xmlns="${yv.NS.MARKERS}"]`,e).length,is_marker:!!o,is_unstyled:!!wv(`unstyled[xmlns="${yv.NS.STYLING}"]`,e).length,marker_id:o&&o.getAttribute("id"),msgid:e.getAttribute("id")||n.getAttribute("id"),nick:yv.unescapeNode(yv.getResourceFromJid(r)),occupant_id:Ev(e,t),receipt_id:np(e),received:(new Date).toISOString(),references:sp(e),subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:i?R()(i.getAttribute("stamp")).toISOString():(new Date).toISOString(),to:e.getAttribute("to"),type:e.getAttribute("type")},tp(e),ep(e),Zg(e),Kg(e,n),Jg(e,n),function(e){const t=P()(`> apply-to[xmlns="${lt.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),s=P()(`> meta[xmlns="${lt.NS.XHTML}"]`,t);if(s.length){const t=Oh.settings.get("message_limit"),n=s.reduce(((e,s)=>{const n=s.getAttribute("property");if(n){let i=pt(s.getAttribute("content")||"");t&&"og:description"===n&&i.length>=t&&(i=`${i.slice(0,t)}${pt("&#8230;")}`),e[n]=i}return e}),{ogp_for_id:e});if("og:description"in n||"og:title"in n||"og:image"in n)return n}}return{}}(e),Xg(e,n),function(e){const t=wv(`apply-to[xmlns="${yv.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),s=wv(`moderated[xmlns="${yv.NS.MODERATE}"]`,t).pop();if(s&&wv(`retract[xmlns="${yv.NS.RETRACT}"]`,s).pop())return{editable:!1,moderated:"retracted",moderated_by:s.getAttribute("by"),moderated_id:e,moderation_reason:s.querySelector("reason")?.textContent}}else{const t=wv(`> moderated[xmlns="${yv.NS.MODERATE}"]`,e).pop();if(t&&wv(`retracted[xmlns="${yv.NS.RETRACT}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:t.querySelector("reason")?.textContent}}return{}}(e),Yg(e));return a.from_real_jid=a.is_archived&&function(e){const t=wv(`x[xmlns="${yv.NS.MUC_USER}"] item`,e).pop();return t?.getAttribute("jid")}(e)||t.occupants.findOccupant(a)?.get("jid"),a=Object.assign({is_valid_receipt_request:op(e,a),message:a.body||a.error,sender:$v(a,t)},a),a.is_archived&&n.getAttribute("from")!==a.from_muc?new Qg(`Invalid Stanza: Forged MAM message from ${n.getAttribute("from")}`,e):a.is_archived&&n.getAttribute("from")!==t.get("jid")?new Qg(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e):a.is_carbon?new Qg("Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied",e):(a.id=a.origin_id||a[`stanza_id ${a.from_muc||a.from}`]||Av.getUniqueId(),a=await Oh.hook("parseMUCMessage",e,a),Object.assign(a,Av.getMediaURLsMetadata(a.is_encrypted?a.plaintext:a.body)))}const{Strophe:kv,$iq:Tv,u:jv}=qg.env;async function Nv(e,t){const{__:s}=Iu,n=Tv({to:t,type:"get"}).c("query",{xmlns:kv.NS.MUC_ADMIN}).c("item",{affiliation:e}),i=await Oh.sendIQ(n,null,!1);if(null===i){const n=s("Error: timeout while fetching %1s list for MUC %2s",e,t),i=new Error(n);return bt.warn(n),i}if(jv.isErrorStanza(i)){const n=s("Error: not allowed to fetch %1s list for MUC %2s",e,t),r=new Error(n);return bt.warn(n),bt.warn(i),r}return function(e){return wv(`query[xmlns="${yv.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},s=e.getAttribute("jid");Av.isValidJID(s)?t.jid=s:t.nick=s;const n=e.getAttribute("nick");return n&&(t.nick=n),e.getAttribute("role")&&(t.role=n),t}))}(i).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))}function Ov(e,t){const s=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(s.map((s=>Iv(s,e,t))))}function Iv(e,t,s){return Array.isArray(t)||(t=[t]),s=s.filter((t=>[void 0,e].includes(t.affiliation))),Promise.all(t.reduce(((t,n)=>[...t,...s.map((t=>function(e,t,s){const n=Tv({to:t,type:"set"}).c("query",{xmlns:kv.NS.MUC_ADMIN}).c("item",{affiliation:s.affiliation||e,nick:s.nick,jid:s.jid});void 0!==s.reason&&n.c("reason",s.reason);return Oh.sendIQ(n)}(e,n,t)))]),[]))}function Mv(e,t,s,n){const i=s.map((e=>e.jid)),r=n.map((e=>e.jid));let o=i.filter((e=>!r.includes(e))).map((e=>s[i.indexOf(e)]));return e||(o=o.concat(s.filter((e=>{const t=r.indexOf(e.jid);return t>=0&&e.affiliation!==n[t].affiliation})))),t&&(o=o.concat(r.filter((e=>!i.includes(e))).map((e=>({jid:e,affiliation:"none"}))))),o}const{Strophe:Rv,sizzle:Dv,u:Lv}=qg.env;function zv(e,t){const s=e.get("role")||"none",n=t.get("role")||"none";if(lv[s]===lv[n]){const s=e.getDisplayName().toLowerCase(),n=t.getDisplayName().toLowerCase();return s<n?-1:s>n?1:0}return lv[s]<lv[n]?-1:1}function Pv(){Oh.connection.get().addHandler((e=>(Iu.exports.onDirectMUCInvitation(e),!0)),"jabber:x:conference","message")}function Fv(){return Iu.state.chatboxes.filter((e=>e.get("type")===yu)).forEach((e=>e.session.save({connection_status:qg.ROOMSTATUS.DISCONNECTED})))}async function Uv(){if(!document.hidden&&Oh.connection.connected()){(await Oh.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}}async function Bv(e){if(!location.hash.startsWith("#converse/room?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!Lv.isValidMUCJID(t))return bt.warn(`invalid jid "${t}" provided in url fragment`);await Oh.waitUntil("roomsAutoJoined"),Oh.settings.get("allow_bookmarks")&&await Oh.waitUntil("bookmarksInitialized"),Oh.rooms.open(t,{},!0)}async function qv(e){const t=Dv('x[xmlns="jabber:x:conference"]',e).pop(),s=Rv.getBareJidFromJid(e.getAttribute("from")),n=t.getAttribute("jid"),i=t.getAttribute("reason");let r;if(Oh.settings.get("auto_join_on_invite"))r=!0;else{const e=Iu.state.roster.get(s)?.getDisplayName()??s;r=await Oh.hook("confirmDirectMUCInvitation",{contact:e,reason:i,jid:n},!1)}if(r){const e=await async function(e,t){t.type=yu,t.id=e;const s=await Oh.rooms.get(e,t,!0);return s.maybeShow(!0),s}(n,{password:t.getAttribute("password")});e.session.get("connection_status")===qg.ROOMSTATUS.DISCONNECTED&&Iu.state.chatboxes.get(n).rejoin()}}function Hv(){const{xmppstatus:e}=Iu.state;if(!e)return bt.error("Called getDefaultMUCNickname before statusInitialized has been fired."),"";const t=e.getNickname();if(t)return t;if(Oh.settings.get("muc_nickname_from_jid")){const e=Iu.session.get("bare_jid");return Rv.unescapeNode(Rv.getNodeFromJid(e))}}function Gv(e){return!!Oh.settings.get("muc_show_info_messages").includes(e)}async function Wv(){await Promise.all(Oh.settings.get("auto_join_rooms").map((e=>"string"==typeof e?Iu.state.chatboxes.where({jid:e}).length?Promise.resolve():Oh.rooms.open(e):e instanceof Object?Oh.rooms.open(e.jid,{...e}):(bt.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),Oh.trigger("roomsAutoJoined")}function Vv(){Oh.disco.own.features.add(Rv.NS.MUC),Oh.settings.get("allow_muc_invitations")&&Oh.disco.own.features.add("jabber:x:conference")}function Qv(){Iu.state.chatboxes.where({type:yu}).forEach((e=>ym(e.session,{connection_status:qg.ROOMSTATUS.DISCONNECTED})))}function Jv(){window.addEventListener(Xd(),(()=>{!Oh.connection.isType("websocket")||Oh.settings.get("enable_smacks")&&Iu.session.get("smacks_stream_id")||Fv()}))}function Yv(){Oh.connection.get().addHandler((e=>{const t=Rv.getBareJidFromJid(e.getAttribute("from"));return Iu.state.chatboxes.get(t)||Oh.waitUntil("chatBoxesFetched").then((async()=>{const s=Iu.state.chatboxes.get(t);s&&(await s.initialized,s.message_handler.run(e))})),!0}),null,"message","groupchat")}const{u:Xv}=qg.env,Kv=["owner"],Zv=["admin","ban","deop","destroy","member","op","revoke"],e_=["kick","mute","voice","modtools"],t_=["nick"],s_=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],n_=["301","303","333","307","321","322"];class i_ extends cd{defaults(){return{connection_status:vv.DISCONNECTED}}}const r_=class extends ov{defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:Jd()&&!Oh.settings.get("singleton"),hidden_occupants:!!Oh.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:yu}}async initialize(){this.initialized=ic(),this.debouncedRejoin=Lu(this.rejoin,250),this.set("box_id",`box-${this.get("jid")}`),this.initNotifications(),this.initMessages(),this.initUI(),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:show",this.onOccupantShowChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage);await this.restoreFromCache()||this.join(),await Oh.trigger("chatRoomInitialized",this,{Synchronous:!0}),this.initialized.resolve()}isEntered(){return this.session.get("connection_status")===vv.ENTERED}isRAICandidate(){return this.get("hidden")&&Oh.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()}async restoreFromCache(){if(this.isEntered()){if(await this.fetchOccupants().catch((e=>bt.error(e))),this.isRAICandidate())return this.session.save("connection_status",vv.DISCONNECTED),this.enableRAI(),!0;if(await this.isJoined())return await new Promise((e=>this.config.fetch({success:e,error:e}))),await new Promise((e=>this.features.fetch({success:e,error:e}))),await this.fetchMessages().catch((e=>bt.error(e))),!0}return this.session.save("connection_status",vv.DISCONNECTED),this.clearOccupantsCache(),!1}async join(e,t){return this.isEntered()?this:(this.session.save("connection_status",vv.CONNECTING),await this.refreshDiscoInfo(),(e=await this.getAndPersistNickname(e))?(Oh.send(await this.constructJoinPresence(t)),this):(ym(this.session,{connection_status:vv.NICKNAME_REQUIRED}),Oh.settings.get("muc_show_logs_before_join")&&await this.fetchMessages(),this))}rejoin(){return this.session.save("connection_status",vv.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()}async constructJoinPresence(e){let t=Ne({id:Am(),from:Oh.connection.get().jid,to:this.getRoomJIDAndNick()}).c("x",{xmlns:lt.NS.MUC}).c("history",{maxstanzas:this.features.get("mam_enabled")?0:Oh.settings.get("muc_history_max_stanzas")}).up();return(e=e||this.get("password"))&&t.cnode(lt.xmlElement("password",[],e)),t.up(),t=await Oh.hook("constructedMUCPresence",this,t),t}clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()}sendMarkerForMessage(e,t="displayed",s=!1){if(e&&Oh.settings.get("send_chat_markers").includes(t)&&"groupchat"===e?.get("type")&&(e?.get("is_markable")||s)){const s=`stanza_id ${this.get("jid")}`,n=e.get(s);if(!n)return void bt.error(`Can't send marker for message without stanza ID: ${s}`);Wg(lt.getBareJidFromJid(e.get("from")),n,t,e.get("type"))}}enableRAI(){if(Oh.settings.get("muc_subscribe_to_rai")){const e=lt.getDomainFromJid(this.get("jid"));Oh.user.presence.send(null,e,null,ke("rai",{xmlns:lt.NS.RAI}))}}async onHiddenChange(){const e=vv,t=this.session.get("connection_status");this.get("hidden")?t===e.ENTERED&&this.isRAICandidate()&&(this.sendMarkerForLastMessage("received",!0),await this.leave(),this.enableRAI()):(t===e.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())}onOccupantAdded(e){Gv(qg.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===vv.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),qg.MUC_TRAFFIC_STATES.ENTERED)}onOccupantRemoved(e){Gv(qg.MUC_TRAFFIC_STATES.EXITED)&&this.isEntered()&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),qg.MUC_TRAFFIC_STATES.EXITED)}onOccupantShowChanged(e){e.get("states").includes("303")||("offline"===e.get("show")&&Gv(qg.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),qg.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("show")&&Gv(qg.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),qg.MUC_TRAFFIC_STATES.ENTERED))}async onRoomEntered(){await this.occupants.fetchMembers(),Oh.settings.get("clear_messages_on_reconnection")?await this.clearMessages():await this.fetchMessages(),Oh.trigger("enteredNewRoom",this),Oh.settings.get("auto_register_muc_nickname")&&await Oh.disco.supports(lt.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname()}async onConnectionStatusChanged(){if(this.isEntered())if(this.isRAICandidate()){try{await this.leave()}catch(e){bt.error(e)}this.enableRAI()}else await this.onRoomEntered()}async onReconnection(){await this.rejoin(),this.announceReconnection()}getMessagesCollection(){return new Iu.exports.MUCMessages}restoreSession(){const e=`muc.session-${Iu.session.get("bare_jid")}-${this.get("jid")}`;return this.session=new i_({id:e}),Hu(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))}initDiscoModels(){const e=Iu.session.get("bare_jid");let t=`converse.muc-features-${e}-${this.get("jid")}`;this.features=new cd(Object.assign({id:t},qg.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{}))),this.features.browserStorage=qu(t,"session"),this.features.listenTo(Iu,"beforeLogout",(()=>this.features.browserStorage.flush())),t=`converse.muc-config-${e}-${this.get("jid")}`,this.config=new cd({id:t}),this.config.browserStorage=qu(t,"session"),this.config.listenTo(Iu,"beforeLogout",(()=>this.config.browserStorage.flush()))}initOccupants(){this.occupants=new Iu.exports.MUCOccupants;const e=`converse.occupants-${Iu.session.get("bare_jid")}${this.get("jid")}`;this.occupants.browserStorage=qu(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(Iu,"beforeLogout",(()=>this.occupants.browserStorage.flush()))}fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched}handleAffiliationChangedMessage(e){const t=P()(`x[xmlns="${lt.NS.MUC_USER}"] item`,e).pop();if(t){const s=e.getAttribute("from"),n=e.getAttribute("type"),i=t.getAttribute("affiliation"),r=t.getAttribute("jid"),o={from:s,type:n,affiliation:i,states:[],show:"unavailable"==n?"offline":"online",role:t.getAttribute("role"),jid:lt.getBareJidFromJid(r),resource:lt.getResourceFromJid(r)},a=this.occupants.findOccupant({jid:o.jid});a?a.save(o):this.occupants.create(o)}}async handleErrorMessageStanza(e){const{__:t}=Iu,s=await Cv(e,this);if(!await this.shouldShowErrorMessage(s))return;const n=this.getMessageReferencedByError(s);if(n){const e={error:s.error,error_condition:s.error_condition,error_text:s.error_text,error_type:s.error_type,editable:!1};s.msgid===n.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,s.error||("forbidden"===s.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===s.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):s.error||("forbidden"===s.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===s.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),n.save(e)}else this.createMessage(s)}handleMessageFromMUCHost(e){if(this.isEntered())return;const t=P()(`rai[xmlns="${lt.NS.RAI}"]`,e).pop(),s=Array.from(t?.querySelectorAll("activity")||[]).map((e=>e.textContent));s.includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})}handleForwardedMentions(e){if(this.isEntered())return;const t=P()(`mentions[xmlns="${lt.NS.MENTIONS}"] forwarded[xmlns="${lt.NS.FORWARD}"] message[type="groupchat"]`,e),s=this.get("jid"),n=t.filter((e=>lt.getBareJidFromJid(e.getAttribute("from"))===s));n.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+n.length}),n.forEach((async e=>{const t={stanza:e,attrs:await Cv(e,this),chatbox:this};Oh.trigger("message",t)})))}async handleMessageStanza(e){const t=(e=e.tree?.()??e).getAttribute("type");if("error"===t)return this.handleErrorMessageStanza(e);if("groupchat"===t){if(up(e))return bt.warn('Received a MAM message with type "groupchat"');this.createInfoMessages(e),this.fetchFeaturesIfConfigurationChanged(e)}else if(!t)return this.handleForwardedMentions(e);let s;try{s=await Cv(e,this)}catch(e){return bt.error(e)}const n={stanza:e,attrs:s,chatbox:this};return Oh.trigger("message",n),s&&this.queueMessage(s)}registerHandlers(){const e=this.get("jid"),t=lt.getDomainFromJid(e);this.removeHandlers();const s=Oh.connection.get();this.presence_handler=s.addHandler((e=>(this.onPresence(e),!0)),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=s.addHandler((e=>(this.onPresenceFromMUCHost(e),!0)),null,"presence",null,null,t),this.message_handler=s.addHandler((e=>(this.handleMessageStanza(e),!0)),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=s.addHandler((e=>(this.handleMessageFromMUCHost(e),!0)),null,"message",null,null,t),this.affiliation_message_handler=s.addHandler((e=>(this.handleAffiliationChangedMessage(e),!0)),lt.NS.MUC_USER,"message",null,null,e)}removeHandlers(){const e=Oh.connection.get();return this.message_handler&&(e?.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(e?.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(e?.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(e?.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(e?.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this}invitesAllowed(){return Oh.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())}getDisplayName(){const e=this.get("name");return e?e.trim():"hidden"===Oh.settings.get("locked_muc_domain")?lt.getNodeFromJid(this.get("jid")):this.get("jid")}sendTimedMessage(e){const t=e instanceof Element?e:e.tree();let s=t.getAttribute("id");s||(s=Am("sendIQ"),t.setAttribute("id",s));const n=ic(),i=Oh.settings.get("stanza_timeout"),r=Oh.connection.get(),o=r.addTimedHandler(i,(()=>{r.deleteHandler(a);const e=new hh("Timeout Error: No response from server");return n.resolve(e),!1})),a=r.addHandler((e=>{o&&r.deleteTimedHandler(o),n.resolve(e)}),null,"message",["error","groupchat"],s);return Oh.send(t),n}async retractOwnMessage(e){const t=Iu.__,s=e.get("origin_id");if(!s)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=e.get("editable"),i=Te({id:Am(),to:this.get("jid"),type:"groupchat"}).c("store",{xmlns:lt.NS.HINTS}).up().c("apply-to",{id:s,xmlns:lt.NS.FASTEN}).c("retract",{xmlns:lt.NS.RETRACT});e.set({retracted:(new Date).toISOString(),retracted_id:s,retraction_id:i.tree().getAttribute("id"),editable:!1});const r=await this.sendTimedMessage(i);Xv.isErrorStanza(r)?bt.error(r):r instanceof hh&&(bt.error(r),e.save({editable:n,error_type:"timeout",error:t("A timeout happened while while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))}async retractOtherMessage(e,t){const s=e.get("editable"),n=Iu.session.get("bare_jid");e.save({moderated:"retracted",moderated_by:n,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const i=await this.sendRetractionIQ(e,t);return(null===i||Xv.isErrorStanza(i))&&e.save({editable:s,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),i}sendRetractionIQ(e,t){const s=je({to:this.get("jid"),type:"set"}).c("apply-to",{id:e.get(`stanza_id ${this.get("jid")}`),xmlns:lt.NS.FASTEN}).c("moderate",{xmlns:lt.NS.MODERATE}).c("retract",{xmlns:lt.NS.RETRACT}).up().c("reason").t(t||"");return Oh.sendIQ(s,null,!1)}sendDestroyIQ(e,t){const s=ke("destroy");t&&s.attrs({jid:t});const n=je({to:this.get("jid"),type:"set"}).c("query",{xmlns:lt.NS.MUC_OWNER}).cnode(s.node);return e&&e.length>0&&n.c("reason",e),Oh.sendIQ(n)}async leave(e){Oh.connection.connected()&&Oh.user.presence.send("unavailable",this.getRoomJIDAndNick(),e),this.features&&await new Promise((e=>this.features.destroy({success:e,error:(t,s)=>{bt.error(s),e()}})));const t=Iu.state.disco_entities?.get(this.get("jid"));t&&await new Promise((e=>t.destroy({success:e,error:(t,s)=>{bt.error(s),e()}}))),ym(this.session,{connection_status:vv.DISCONNECTED})}async close(e){const{ENTERED:t,CLOSING:s}=vv,n=this.session.get("connection_status")===t;return ym(this.session,{connection_status:s}),n&&this.sendMarkerForLastMessage("received",!0),await this.unregisterNickname(),await this.leave(),this.occupants.clearStore(),"closeAllChatBoxes"!==e?.name&&Oh.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),await new Promise((e=>this.session.destroy({success:e,error:(t,s)=>{bt.error(s),e()}}))),Iu.exports.ChatBox.prototype.close.call(this)}canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&Oh.disco.supports(lt.NS.MODERATE,this.get("jid"))}canPostMessages(){return this.isEntered()&&!(this.features.get("moderated")&&"visitor"===this.getOwnRole())}getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))}getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>Up.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")}getOccupantByJID(e){return this.occupants.findOccupant({jid:e})}getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})}getReferenceURIFromNickname(e){const t=this.get("jid"),s=this.getOccupant(e),n=this.features.get("nonanonymous")&&s?.get("jid")||`${t}/${e}`;return encodeURI(`xmpp:${n}`)}parseTextForReferences(e){if(!e||!/(\p{P}|\p{Z}|^)([@][\w_-]+(?:\.\w+)*)/giu.test(e))return[e,[]];const t=Up.findFirstMatchInArray(this.getAllKnownNicknames()),s=this.getAllKnownNicknamesRegex(),n=[...e.matchAll(s)].filter((e=>!e[0].startsWith("/"))),i=n.map((e=>{let s=e[0].indexOf("@");"@"===e[0][s+1]&&(s+=1);const n=e.index+s,i=n+e[0].length-s,r=t(e[1]);return{begin:n,end:i,value:r,type:"mention",uri:this.getReferenceURIFromNickname(r)}})),[r,o]=Up.reduceTextFromReferences(e,i);return[r,o]}async getOutgoingMessageAttributes(e){const t=this.get("composing_spoiler");let s,n="";e?.body&&([n,s]=this.parseTextForReferences(e.body));const i=Am(),r=n?Xv.shortnamesToUnicode(n):void 0;return e=Object.assign({},e,{body:r,is_spoiler:t,origin_id:i,references:s,id:i,msgid:i,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),message:r,nick:this.get("nick"),sender:"me",type:"groupchat",original_text:n},Xv.getMediaURLsMetadata(n)),e=await Oh.hook("getOutgoingMessageAttributes",this,e)}getRoomJIDAndNick(){const e=this.get("nick");return lt.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")}sendChatState(){if(!Oh.settings.get("send_chat_state_notifications")||!this.get("chat_state")||!this.isEntered()||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=Oh.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==_u&&Oh.send(Te({to:this.get("jid"),type:"groupchat"}).c(t,{xmlns:lt.NS.CHATSTATES}).up().c("no-store",{xmlns:lt.NS.HINTS}).up().c("no-permanent-store",{xmlns:lt.NS.HINTS}))}directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const s={xmlns:"jabber:x:conference",jid:this.get("jid")};null!==t&&(s.reason=t),this.get("password")&&(s.password=this.get("password"));const n=Te({from:Oh.connection.get().jid,to:e,id:Am()}).c("x",s);Oh.send(n),Oh.trigger("roomInviteSent",{room:this,recipient:e,reason:t})}refreshDiscoInfo(){return Oh.disco.refresh(this.get("jid")).then((()=>this.getDiscoInfo())).catch((e=>bt.error(e)))}getDiscoInfo(){return Oh.disco.getIdentity("conference","text",this.get("jid")).then((e=>this.save({name:e?.get("name")}))).then((()=>this.getDiscoInfoFields())).then((()=>this.getDiscoInfoFeatures())).catch((e=>bt.error(e)))}async getDiscoInfoFields(){const e=(await Oh.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const s=t.get("var");return s?.startsWith("muc#roominfo_")&&(e[s.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e)}async getDiscoInfoFeatures(){const e=await Oh.disco.getFeatures(this.get("jid")),t=qg.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{fetched:(new Date).toISOString()});e.each((e=>{const s=e.get("var");s.startsWith("muc_")?t[s.replace("muc_","")]=!0:s===lt.NS.MAM?t.mam_enabled=!0:t[s]=!0})),this.features.save(t)}addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const s=e.getAttribute("var").replace("muc#roomconfig_",""),n=this.get("roomconfig");if(s in n){let i;switch(t){case"boolean":i=[n[s]?1:0];break;case"list-multi":i=n[s];break;default:i=[n[s]]}e.innerHTML=i.map((e=>ke("value").t(e))).join("")}return e}async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=P()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)}fetchRoomConfiguration(){return Oh.sendIQ(je({to:this.get("jid"),type:"get"}).c("query",{xmlns:lt.NS.MUC_OWNER}))}sendConfiguration(e=[]){const t=je({to:this.get("jid"),type:"set"}).c("query",{xmlns:lt.NS.MUC_OWNER}).c("x",{xmlns:lt.NS.XFORM,type:"submit"});return e.forEach((e=>t.cnode(e).up())),Oh.sendIQ(t)}onCommandError(e){const{__:t}=Iu;bt.fatal(e);const s=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:s,type:"error"})}getNickOrJIDFromCommandArgs(e){const{__:t}=Iu;if(Xv.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const s=this.parseTextForReferences(e)[1];if(!s.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(s.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const n=s.pop().value,i=e.split(n,2)[1];if(!i||i.startsWith(" "))return n;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}}validateRoleOrAffiliationChangeArgs(e,t){const{__:s}=Iu;if(!t){const t=s('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0}getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=Iu.session.get("bare_jid"),s=this.occupants.findWhere({jid:t});return this.verifyAffiliations(["owner"],s,!1)?e=e.concat(Kv).concat(Zv):this.verifyAffiliations(["admin"],s,!1)&&(e=e.concat(Zv)),this.verifyRoles(["moderator"],s,!1)?e=e.concat(e_).concat(t_):this.verifyRoles(["visitor","participant","moderator"],s,!1)||(e=e.concat(t_)),e.sort(),Array.isArray(Oh.settings.get("muc_disable_slash_commands"))?e.filter((e=>!Oh.settings.get("muc_disable_slash_commands").includes(e))):e}verifyAffiliations(e,t,s=!0){const{__:n}=Iu;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;const i=Iu.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const s=t.get("affiliation");if(e.includes(s))return!0}if(s){const e=n("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1}verifyRoles(e,t,s=!0){const{__:n}=Iu;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;const i=Iu.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const s=t.get("role");if(e.includes(s))return!0}if(s){const e=n("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error",is_ephemeral:2e4})}return!1}getOwnRole(){return this.getOwnOccupant()?.get("role")}getOwnAffiliation(){return this.getOwnOccupant()?.get("affiliation")||"none"}getOwnOccupant(){return this.occupants.getOwnOccupant()}async setNickname(e){if(Oh.settings.get("auto_register_muc_nickname")&&await Oh.disco.supports(lt.NS.MUC_REGISTER,this.get("jid"))){const t=this.get("nick");this.set({nick:e});try{await this.registerNickname()}catch(e){const{__:s}=Iu;bt.error(e);const n=s("Error: couldn't register new nickname in members only room");return this.createMessage({message:n,type:"error",is_ephemeral:!0}),void this.set({nick:t})}}const t=lt.getBareJidFromJid(this.get("jid"));Oh.send(Ne({from:Oh.connection.get().jid,to:`${t}/${e}`,id:Am()}).tree())}setRole(e,t,s,n,i){const r=ke("item",{nick:e.get("nick"),role:t}),o=je({to:this.get("jid"),type:"set"}).c("query",{xmlns:lt.NS.MUC_ADMIN}).cnode(r.node);return null!==s&&o.c("reason",s),Oh.sendIQ(o).then(n).catch(i)}getOccupant(e){return Xv.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)}getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))}getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))}getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,s)=>t.get(e)<s.get(e)?-1:t.get(e)>s.get(e)?1:0))}async updateMemberLists(e){const t=this.get("jid"),s=await Promise.all(["member","admin","owner"].map((e=>Nv(e,t)))),n=s.reduce(((e,t)=>t instanceof Error?(bt.error(t),e):[...t,...e]),[]);await Ov(t,Mv(!0,!1,e,n)),await this.occupants.fetchMembers()}async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||Iu.exports.getDefaultMUCNickname())&&ym(this,{nick:e},{silent:!0}),e}async getReservedNick(){const e=je({to:this.get("jid"),from:Oh.connection.get().jid,type:"get"}).c("query",{xmlns:lt.NS.DISCO_INFO,node:"x-roomuser-item"}),t=await Oh.sendIQ(e,null,!1);if(bm(t))throw t;const s=t?.querySelector('query[node="x-roomuser-item"] identity');return s?s.getAttribute("name"):null}async registerNickname(){const{__:e}=Iu,t=this.get("nick"),s=this.get("jid");let n,i;try{n=await Oh.sendIQ(je({to:s,type:"get"}).c("query",{xmlns:lt.NS.MUC_REGISTER}))}catch(t){return P()(`not-allowed[xmlns="${lt.NS.STANZAS}"]`,t).length?i=e("You're not allowed to register yourself in this groupchat."):P()(`registration-required[xmlns="${lt.NS.STANZAS}"]`,t).length&&(i=e("You're not allowed to register in this groupchat because it's members-only.")),bt.error(t),i}const r=P()("field required",n).map((e=>e.parentElement));if(r.length>1&&"muc#register_roomnick"!==r[0].getAttribute("var"))return bt.error(`Can't register the user register in the groupchat ${s} due to the required fields`);try{await Oh.sendIQ(je({to:s,type:"set"}).c("query",{xmlns:lt.NS.MUC_REGISTER}).c("x",{xmlns:lt.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up().c("field",{var:"muc#register_roomnick"}).c("value").t(t))}catch(t){return P()(`service-unavailable[xmlns="${lt.NS.STANZAS}"]`,t).length?i=e("Can't register your nickname in this groupchat, it doesn't support registration."):P()(`bad-request[xmlns="${lt.NS.STANZAS}"]`,t).length&&(i=e("Can't register your nickname in this groupchat, invalid data form supplied.")),bt.error(i),bt.error(t),i}}async unregisterNickname(){if("unregister"===Oh.settings.get("auto_register_muc_nickname"))try{await Oh.disco.supports(lt.NS.MUC_REGISTER,this.get("jid"))&&await this.sendUnregistrationIQ()}catch(e){bt.error(e)}}sendUnregistrationIQ(){const e=je({to:this.get("jid"),type:"set"}).c("query",{xmlns:lt.NS.MUC_REGISTER}).c("remove");return Oh.sendIQ(e).catch((e=>bt.error(e)))}updateOccupantsOnPresence(e){const t=function(e,t){const s=e.getAttribute("from"),n=e.getAttribute("type"),i={is_me:!!e.querySelector("status[code='110']"),from:s,occupant_id:Ev(e,t),nick:yv.getResourceFromJid(s),type:n,states:[],hats:[],show:"unavailable"!==n?"online":"offline"};return Array.from(e.children).forEach((e=>{e.matches("status")?i.status=e.textContent||null:e.matches("show")?i.show=e.textContent||"online":e.matches("x")&&e.getAttribute("xmlns")===yv.NS.MUC_USER?Array.from(e.children).forEach((e=>{"item"===e.nodeName?(i.affiliation=e.getAttribute("affiliation"),i.role=e.getAttribute("role"),i.jid=e.getAttribute("jid"),i.nick=e.getAttribute("nick")||i.nick):"status"==e.nodeName&&e.getAttribute("code")&&i.states.push(e.getAttribute("code"))})):e.matches("x")&&e.getAttribute("xmlns")===yv.NS.VCARDUPDATE?i.image_hash=e.querySelector("photo")?.textContent:e.matches("hats")&&e.getAttribute("xmlns")===yv.NS.MUC_HATS&&(i.hats=Array.from(e.children).map((e=>e.matches("hat")&&{title:e.getAttribute("title"),uri:e.getAttribute("uri")})))})),i}(e,this);if("error"===t.type||!t.jid&&!t.nick&&!t.occupant_id)return!0;const s=this.occupants.findOccupant(t);if("unavailable"===t.type&&s&&!t.states.includes(qg.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(t.affiliation))return s.set(t),void s.destroy();const n=t.jid||"",i={...t,jid:lt.getBareJidFromJid(n)||s?.attributes?.jid,resource:lt.getResourceFromJid(n)||s?.attributes?.resource};if(t.is_me){let e=!1;t.states.includes(qg.MUC_NICK_CHANGED_CODE)&&(e=!0,this.set("nick",t.nick)),this.features.get(lt.NS.OCCUPANTID)&&this.get("occupant-id")!==t.occupant_id&&(e=!0,this.set("occupant_id",t.occupant_id)),e&&this.save()}s?s.save(i):this.occupants.create(i)}fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];P()("status",e).filter((e=>t.includes(e.getAttribute("code")))).length&&this.refreshDiscoInfo()}isSameUser(e,t){const s=lt.getBareJidFromJid(e),n=lt.getBareJidFromJid(t),i=lt.getResourceFromJid(e),r=lt.getResourceFromJid(t);if(Xv.isSameBareJID(e,t))return s!==this.get("jid")||i===r;return(s===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:s}))===(n===this.get("jid")?this.occupants.findOccupant({nick:r}):this.occupants.findOccupant({jid:n}))}async isSubjectHidden(){return(await Oh.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))}async toggleSubjectHiddenState(){const e=this.get("jid"),t=await Oh.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?Oh.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):Oh.user.settings.set("mucs_with_hidden_subject",[...t,e])}async handleSubjectChange(e){const t=Iu.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const s=e.subject,n=e.nick;if(ym(this,{subject:{author:n,text:e.subject||""}}),!e.is_delayed&&n){const i=t(s?"Topic set by %1$s":"Topic cleared by %1$s",n),r=this.messages.last();r?.get("nick")===e.nick&&"info"===r?.get("type")&&r?.get("message")===i||this.createMessage({message:i,nick:e.nick,type:"info",is_ephemeral:!0}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1}setSubject(e=""){Oh.send(Te({to:this.get("jid"),from:Oh.connection.get().jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e).tree())}ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))}isOwnMessage(e){let t;return t=e instanceof Element?e.getAttribute("from"):e instanceof Iu.exports.MUCMessage?e.get("from"):e.from,lt.getResourceFromJid(t)==this.get("nick")}getUpdatedMessageAttributes(e,t){const s={...Iu.exports.ChatBox.prototype.getUpdatedMessageAttributes.call(this,e,t),...ad(t,["from_muc","occupant_id"])};if(this.isOwnMessage(t)){const n=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(s,ad(t,n)),e.get("received")||(s.received=(new Date).toISOString())}return s}async isJoined(){return this.isEntered()?(Oh.connection.connected()||await new Promise((e=>Oh.listen.once("reconnected",e))),Oh.ping(`${this.get("jid")}/${this.get("nick")}`)):(bt.info(`isJoined: not pinging MUC ${this.get("jid")} since we're not entered`),!1)}async sendStatusPresence(e,t,s){if(this.session.get("connection_status")===vv.ENTERED){const n=await Iu.state.xmppstatus.constructPresence(e,this.getRoomJIDAndNick(),t);s?.map((e=>e?.tree()??e)).forEach((e=>n.cnode(e).up())),Oh.send(n)}}async rejoinIfNecessary(){return this.isRAICandidate()?(bt.debug(`rejoinIfNecessary: not rejoining hidden MUC "${this.get("jid")}" since we're using RAI`),!0):await this.isJoined()?void 0:(this.rejoin(),!0)}async shouldShowErrorMessage(e){if("Decryption"===e.error_type){if("Message key not found. The counter was repeated or the key was not filled."===e.error_message)return!1;if("not-encrypted-for-this-device"===e.error_condition)return!1}else if("not-acceptable"===e.error_condition&&await this.rejoinIfNecessary())return!1;return Iu.exports.ChatBox.prototype.shouldShowErrorMessage.call(this,e)}findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),s=e[`stanza_id ${this.get("jid")}`];return s?(t.reverse(),t.find((({attributes:e})=>"retracted"===e.moderated&&e.moderated_id===s&&e.moderated_by))):null}}async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_id","moderation_reason"];if("retracted"===e.moderated){const s={};s[`stanza_id ${this.get("jid")}`]=e.moderated_id;const n=this.messages.findWhere(s);return n?(n.save(ad(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const s=this.findDanglingModeration(e);if(s){const n=ad(s.attributes,t),i=Object.assign({dangling_moderation:!1},e,n);return delete i.id,s.save(i),!0}}return!1}getNotificationsText(){const{__:e}=Iu,t=this.notifications.toJSON(),s=Oh.settings.get("muc_show_info_messages").filter((e=>qg.MUC_ROLE_CHANGES_LIST.includes(e))),n=Oh.settings.get("muc_show_info_messages").filter((e=>qg.MUC_TRAFFIC_STATES_LIST.includes(e)));return[...qg.CHAT_STATES,...n,...s].reduce(((s,n)=>{const i=t[n];if(!i?.length)return s;const r=i.map((e=>this.getOccupant(e)?.getDisplayName()||e));if(1===r.length){if("composing"===n)return`${s}${e("%1$s is typing",r[0])}\n`;if("paused"===n)return`${s}${e("%1$s has stopped typing",r[0])}\n`;if(n===_u)return`${s}${e("%1$s has gone away",r[0])}\n`;if("entered"===n)return`${s}${e("%1$s has entered the groupchat",r[0])}\n`;if("exited"===n)return`${s}${e("%1$s has left the groupchat",r[0])}\n`;if("op"===n)return`${s}${e("%1$s is now a moderator",r[0])}\n`;if("deop"===n)return`${s}${e("%1$s is no longer a moderator",r[0])}\n`;if("voice"===n)return`${s}${e("%1$s has been given a voice",r[0])}\n`;if("mute"===n)return`${s}${e("%1$s has been muted",r[0])}\n`}else if(r.length>1){let t;if(r.length>3)t=`${Array.from(r).slice(0,2).join(", ")} and others`;else{const s=r.pop();t=e("%1$s and %2$s",r.join(", "),s)}if("composing"===n)return`${s}${e("%1$s are typing",t)}\n`;if("paused"===n)return`${s}${e("%1$s have stopped typing",t)}\n`;if(n===_u)return`${s}${e("%1$s have gone away",t)}\n`;if("entered"===n)return`${s}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===n)return`${s}${e("%1$s have left the groupchat",t)}\n`;if("op"===n)return`${s}${e("%1$s are now moderators",r[0])}\n`;if("deop"===n)return`${s}${e("%1$s are no longer moderators",r[0])}\n`;if("voice"===n)return`${s}${e("%1$s have been given voices",r[0])}\n`;if("mute"===n)return`${s}${e("%1$s have been muted",r[0])}\n`}return s}),"")}removeNotification(e,t){const s=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const n=Array.from(s[t]||[]);if(n.includes(e)){const s=n.indexOf(e);n.splice(s,1),this.notifications.set(t,Array.from(n))}}))}updateNotifications(e,t){const s=this.notifications.toJSON(),n=s[t]||[];if(n.includes(e))return;const i=(i,r)=>(i[r]=r===t?[...n,e]:(s[r]||[]).filter((t=>t!==e)),i),r=qg.CHAT_STATES.reduce(i,{}),o=qg.MUC_TRAFFIC_STATES_LIST.reduce(i,{}),a=qg.MUC_ROLE_CHANGES_LIST.reduce(i,{});this.notifications.set(Object.assign(r,o,a)),setTimeout((()=>this.removeNotification(e,t)),1e4)}handleMetadataFastening(e){if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const s=t.get("ogp_metadata")||[];if(s.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const n=[...s,ad(e,s_)];return t.save("ogp_metadata",n),!0}}return!1}handleMEPNotification(e){return!(e.from!==this.get("jid")||!e.activities)&&(e.activities?.forEach((t=>{const s=Object.assign(e,t);this.createMessage(s),Oh.trigger("message",{attrs:s,chatbox:this})})),!!e.activities.length)}getDuplicateMessage(e){return e.activities?.length?this.messages.findWhere({type:"mep",msgid:e.msgid}):Iu.exports.ChatBox.prototype.getDuplicateMessage.call(this,e)}async onMessage(e){if(bm(e=await e))return bt.error(e.message);if("error"===e.type&&!await this.shouldShowErrorMessage(e))return;const t=this.getDuplicateMessage(e);if(t)"groupchat"===t.get("type")&&this.updateMessage(t,e);else if(!(e.receipt_id||e.is_marker||this.ignorableCSN(e)))if(this.handleMetadataFastening(e)||this.handleMEPNotification(e)||await this.handleRetraction(e)||await this.handleModeration(e)||await this.handleSubjectChange(e))e.nick&&this.removeNotification(e.nick,["composing","paused"]);else if(this.setEditable(e,e.time),e.chat_state&&this.updateNotifications(e.nick,e.chat_state),function(e){return e.nick&&(Lv.shouldCreateMessage(e)||e.is_tombstone)}(e)){const t=await Hp(this,e)||await this.createMessage(e);this.removeNotification(e.nick,["composing","paused"]),this.handleUnreadMessage(t)}}handleModifyError(e){const t=e.querySelector("error text")?.textContent;if(t)if(this.session.get("connection_status")===vv.CONNECTING)this.setDisconnectionState(t);else{const e={type:"error",message:t,is_ephemeral:!0};this.createMessage(e)}}handleDisconnection(e){const t=null!==e.querySelector("status[code='110']"),s=P()(`x[xmlns="${lt.NS.MUC_USER}"]`,e).pop();if(!s)return;const n=Iu.labels.muc,i=Object.keys(n.disconnect_messages),r=P()("status",s).map((e=>e.getAttribute("code"))).filter((e=>i.includes(e)));if(!(t&&r.length>0))return;const o=s.querySelector("item"),a=o?o.querySelector("reason")?.textContent:void 0,c=o?o.querySelector("actor")?.getAttribute("nick"):void 0,l=n.disconnect_messages[r[0]],d=r.includes("301")?vv.BANNED:vv.DISCONNECTED;this.setDisconnectionState(l,a,c,d)}getActionInfoMessage(e,t,s){const n=Iu.__;return"301"===e?s?n("%1$s has been banned by %2$s",t,s):n("%1$s has been banned",t):"303"===e?n("%1$s's nickname has changed",t):"307"===e?s?n("%1$s has been kicked out by %2$s",t,s):n("%1$s has been kicked out",t):"321"===e?n("%1$s has been removed because of an affiliation change",t):"322"===e?n("%1$s has been removed for not being a member",t):void 0}createAffiliationChangeMessage(e){const t=Iu.__,s=e._previousAttributes.affiliation;if(!s)return;const n=e.get("affiliation");"admin"===s&&Gv(qg.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===s&&Gv(qg.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===s&&Gv(qg.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===n&&"member"===s&&Gv(qg.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===n&&Gv(qg.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===n&&Gv(qg.AFFILIATION_CHANGES.ADMIN)||"owner"==n&&Gv(qg.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),n)})}createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const s=e._previousAttributes.role;"moderator"===s&&Gv(qg.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),qg.MUC_ROLE_CHANGES.DEOP):"visitor"===s&&Gv(qg.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),qg.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&Gv(qg.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),qg.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&Gv(qg.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),qg.MUC_ROLE_CHANGES.OP)}createInfoMessage(e,t,s){const n=Iu.__,i={type:"info",is_ephemeral:!0},{info_messages:r,new_nickname_messages:o}=Iu.labels.muc;if(Gv(e)&&"110"!==e&&("100"!==e||s)){if(e in r)i.message=r[e];else if(!s&&n_.includes(e)){const s=lt.getResourceFromJid(t.getAttribute("from")),n=P()(`x[xmlns="${lt.NS.MUC_USER}"] item`,t).pop();i.actor=n?n.querySelector("actor")?.getAttribute("nick"):void 0,i.reason=n?n.querySelector("reason")?.textContent:void 0,i.message=this.getActionInfoMessage(e,s,i.actor)}else if(s&&e in o){let s;"210"===e?s=lt.getResourceFromJid(t.getAttribute("from")):"303"===e&&(s=P()(`x[xmlns="${lt.NS.MUC_USER}"] item`,t).pop().getAttribute("nick")),this.save("nick",s),i.message=n(o[e],s)}if(i.message){if("201"===e&&this.messages.findWhere(i))return;this.createMessage(i)}}}createInfoMessages(e){const t=P()(`x[xmlns="${lt.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code")));t.includes("333")&&t.includes("307")&&t.splice(t.indexOf("307"),1);const s=t.includes("110");t.forEach((t=>this.createInfoMessage(t,e,s)))}setDisconnectionState(e,t,s,n=vv.DISCONNECTED){this.session.save({connection_status:n,disconnection_actor:s,disconnection_message:e,disconnection_reason:t})}onNicknameClash(e){const t=Iu.__;if(Oh.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===Iu.exports.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),s=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(s)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:vv.NICKNAME_REQUIRED})}onErrorPresence(e){const t=Iu.__,s=Iu.labels.muc,n=e.querySelector("error"),i=n.getAttribute("type"),r=P()(`text[xmlns="${lt.NS.STANZAS}"]`,n).pop()?.textContent;if("modify"===i)this.handleModifyError(e);else if("auth"===i)if(P()(`not-authorized[xmlns="${lt.NS.STANZAS}"]`,n).length&&(this.save({password_validation_message:r||t("Password incorrect")}),this.session.save({connection_status:vv.PASSWORD_REQUIRED})),n.querySelector("registration-required")){const e=t("You are not on the member list of this groupchat.");this.setDisconnectionState(e,r)}else n.querySelector("forbidden")&&this.setDisconnectionState(s.disconnect_messages[301],r,null,vv.BANNED);else if("cancel"===i)if(n.querySelector("not-allowed")){const e=t("You are not allowed to create new groupchats.");this.setDisconnectionState(e,r)}else if(n.querySelector("not-acceptable")){const e=t("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,r)}else if(P()(`gone[xmlns="${lt.NS.STANZAS}"]`,n).length){const e=P()(`gone[xmlns="${lt.NS.STANZAS}"]`,n).pop()?.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:r}),this.session.save({connection_status:vv.DESTROYED})}else if(n.querySelector("conflict"))this.onNicknameClash(e);else if(n.querySelector("item-not-found")){const e=t("This groupchat does not (yet) exist.");this.setDisconnectionState(e,r)}else if(n.querySelector("service-unavailable")){const e=t("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,r)}else if(n.querySelector("remote-server-not-found")){const e=t("Remote server not found");this.setDisconnectionState(e,r)}else if(n.querySelector("forbidden")){const e=t("You're not allowed to enter this groupchat");this.setDisconnectionState(e,r)}else{const e=t("An error happened while trying to enter this groupchat");this.setDisconnectionState(e,r)}}onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===t?.getAttribute("type")&&t?.querySelector("resource-constraint")&&this.session.get("connection_status")===vv.DISCONNECTED&&this.rejoin()}}onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);this.createInfoMessages(e),e.querySelector("status[code='110']")?(this.onOwnPresence(e),"none"!==this.getOwnRole()&&this.session.get("connection_status")===vv.CONNECTING&&this.session.save("connection_status",vv.CONNECTED)):this.updateOccupantsOnPresence(e)}async onOwnPresence(e){if(await this.occupants.fetched,"unavailable"===e.getAttribute("type"))return void this.handleDisconnection(e);const t=this.session.get("connection_status");t!==vv.ENTERED&&t!==vv.CLOSING?(this.session.save("connection_status",vv.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e);e.querySelector("status[code='201']")&&(this.get("auto_configure")?await this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):Oh.settings.get("muc_instant_rooms")?await this.sendConfiguration().then((()=>this.refreshDiscoInfo())):Oh.modal.show("converse-muc-config-modal",{model:this}))}isUserMentioned(e){const t=this.get("nick");if(e.get("references").length){return e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t)}return new RegExp(`\\b${t}\\b`).test(e.get("body"))}incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)}clearUnreadMsgCounter(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&this.sendMarkerForMessage(this.messages.last()),ym(this,{has_activity:!1,num_unread:0,num_unread_general:0})}};const o_=class extends Ip{constructor(e,t){super(e,t),this.vcard=null}initialize(){this.on("change:nick",(()=>this.setColor())),this.on("change:jid",(()=>this.setColor()))}defaults(){return{hats:[],show:"offline",states:[]}}save(e,t,s){let n;return null==e?super.save(e,t,s):("object"==typeof e?(n=e,s=t):(n={})[e]=t,n.occupant_id&&(n.id=n.occupant_id),super.save(n,s))}getDisplayName(){return this.get("nick")||this.get("jid")}getAssignableRoles(){let e=Oh.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?av:[]),"moderator"===this.get("role")?av.filter((t=>!e.includes(t))):[]}getAssignableAffiliations(){let e=Oh.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?cv:[]),"owner"===this.get("affiliation")?cv.filter((t=>!e.includes(t))):"admin"===this.get("affiliation")?cv.filter((t=>!["owner","admin",...e].includes(t))):[]}isMember(){return["admin","owner","member"].includes(this.get("affiliation"))}isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")}isSelf(){return this.get("states").includes("110")}},{u:a_}=qg.env;class c_ extends Od{constructor(e,t){super(e,Object.assign({comparator:zv},t)),this.chatroom=null}get model(){return o_}initialize(){this.on("change:nick",(()=>this.sort())),this.on("change:role",(()=>this.sort()))}static getAutoFetchedAffiliationLists(){const e=Oh.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]}create(e,t){return e.id||e instanceof cd||(e.id=e.occupant_id||Am()),super.create(e,t)}async fetchMembers(){if(!["member","admin","owner"].includes(this.getOwnOccupant()?.get("affiliation")))return;const e=c_.getAutoFetchedAffiliationLists();if(0===e.length)return;const t=this.chatroom.get("jid"),s=await Promise.all(e.map((e=>Nv(e,t)))),n=s.reduce(((e,t)=>t instanceof Error?(bt.error(t),e):[...t,...e]),[]),i=e.filter((t=>!a_.isErrorObject(s[e.indexOf(t)]))),r=n.map((e=>e.jid)).filter((e=>void 0!==e)),o=n.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e)),a=this.filter((e=>i.includes(e.get("affiliation"))&&!o.includes(e.get("nick"))&&!r.includes(e.get("jid")))),c=Iu.session.get("bare_jid");a.forEach((e=>{e.get("jid")!==c&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),n.forEach((e=>{const t=this.findOccupant(e);t?t.save(e):this.create(e)})),Oh.trigger("membersFetched")}findOccupant(e){if(e.occupant_id)return this.get(e.occupant_id);const t=e.jid&&lt.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||e.nick&&this.findWhere({nick:e.nick})}getOwnOccupant(){const e=Iu.session.get("bare_jid");return this.findOccupant({jid:e,occupant_id:this.chatroom.get("occupant_id")})}}const l_=c_;const d_=class extends Od{constructor(){super(),this.comparator="time",this.model=Rp,this.fetched=null,this.chatbox=null}},u_={chats:{async create(e,t){if("string"==typeof e){if(t&&!t?.fullname){const s=await Oh.contacts.get(e);t.fullname=s?.attributes?.fullname}const s=Oh.chats.get(e,t,!0);return s||void bt.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.map((async s=>{const n=await Oh.contacts.get(e);return t.fullname=n?.attributes?.fullname,Oh.chats.get(s,t,!0).maybeShow()}))):(bt.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,s){if("string"==typeof e){const n=await Oh.chats.get(e,t,!0);return n?n.maybeShow(s):n}if(Array.isArray(e))return Promise.all(e.map((e=>Oh.chats.get(e,t,!0).then((e=>e&&e.maybeShow(s))))).filter((e=>e)));const n="chats.open: You need to provide at least one JID";throw bt.error(n),new Error(n)},async get(e,t={},s=!1){async function n(e){let n=await Oh.chatboxes.get(e);return!n&&s?n=await Oh.chatboxes.create(e,t,Iu.exports.ChatBox):(n=n&&n.get("type")===bu?n:null,n&&Object.keys(t).length&&n.save(t)),n}if(await Oh.waitUntil("chatBoxesFetched"),void 0===e){return(await Oh.chatboxes.get()).filter((e=>e.get("type")===bu))}return"string"==typeof e?n(e):Promise.all(e.map((e=>n(e))))}}};qg.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){Oh.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0});const e={ChatBox:ov,Message:Rp,Messages:d_,handleMessageStanza:tv};Object.assign(Iu,e),Object.assign(Iu.exports,e),Object.assign(Oh,u_),vh.registry.add(bu,ov),Xp(),addEventListener("hashchange",Xp),Oh.listen.on("chatBoxesFetched",Zp),Oh.listen.on("presencesInitialized",ev),Oh.listen.on("clearSession",Kp),Oh.listen.on("connected",(()=>sv())),Oh.listen.on("reconnected",(()=>sv()))}});const{Strophe:h_}=qg.env;const m_=class extends cd{get idAttribute(){return"jid"}initialize(e,t){super.initialize(),this.waitUntilFeaturesDiscovered=ic(),this.dataforms=new Od;let s=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=qu(s,"session"),this.features=new Od,s=`converse.features-${this.get("jid")}`,this.features.browserStorage=qu(s,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new Od,s=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=qu(s,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.identities=new Od,s=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=qu(s,"session"),this.fetchFeatures(t)}async getIdentity(e,t){return await this.waitUntilFeaturesDiscovered,this.identities.findWhere({category:e,type:t})}async getFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this}onFeatureAdded(e){e.entity=this,Oh.trigger("serviceDiscovered",e)}onFieldAdded(e){e.entity=this,Oh.trigger("discoExtensionFieldDiscovered",e)}async fetchFeatures(e){if(e.ignore_cache)this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);t&&0===t.length||null===t?this.queryInfo():(this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),this.identities.fetch({add:!0}))}}async queryInfo(){let e;try{e=await Oh.disco.info(this.get("jid"),null)}catch(e){return null===e?bt.error(`Timeout for disco#info query for ${this.get("jid")}`):bt.error(e),void this.waitUntilFeaturesDiscovered.resolve(this)}this.onInfo(e)}onDiscoItems(e){P()(`query[xmlns="${h_.NS.DISCO_ITEMS}"] item`,e).forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid"),s=Iu.state.disco_entities.get(t);s?s.set({parent_jids:[this.get("jid")]}):Oh.disco.entities.create({jid:t,parent_jids:[this.get("jid")],name:e.getAttribute("name")})}))}async queryForItems(){if(0===this.identities.where({category:"server"}).length)return;const e=await Oh.disco.items(this.get("jid"));this.onDiscoItems(e)}async onInfo(e){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),P()(`x[type="result"][xmlns="${h_.NS.XFORM}"]`,e).forEach((e=>{const t={};P()("field",e).forEach((e=>{t[e.getAttribute("var")]={value:e.querySelector("value")?.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${h_.NS.DISCO_ITEMS}"]`)&&await this.queryForItems(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),P()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{this.fields.create({var:t.getAttribute("var"),value:t.querySelector("value")?.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}};const f_=class extends Od{constructor(){super(),this.model=m_}fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,s){bt.error(s),t(new Error("Could not fetch disco entities"))}})}))}},{Strophe:g_,$iq:p_}=qg.env,v_={disco:{stream:{async getFeature(e,t){await Oh.waitUntil("streamFeaturesAdded");const s=Iu.state.stream_features;if(!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==s||Oh.connection.connected())return s.findWhere({name:e,xmlns:t});{const s=`Tried to get feature ${e} ${t} but stream_features has been torn down`;bt.warn(s)}}},own:{identities:{add(e,t,s,n){const i=Iu.state.disco;for(var r=0;r<i._identities.length;r++)if(i._identities[r].category==e&&i._identities[r].type==t&&i._identities[r].name==s&&i._identities[r].lang==n)return!1;i._identities.push({category:e,type:t,name:s,lang:n})},clear(){Iu.state.disco._identities=[]},get:()=>Iu.state.disco._identities},features:{add(e){const t=Iu.state.disco;for(let s=0;s<t._features.length;s++)if(t._features[s]==e)return!1;t._features.push(e)},clear(){Iu.state.disco._features=[]},get:()=>Iu.state.disco._features}},info(e,t){const s={xmlns:g_.NS.DISCO_INFO};t&&(s.node=t);const n=p_({from:Oh.connection.get().jid,to:e,type:"get"}).c("query",s);return Oh.sendIQ(n)},items(e,t){const s={xmlns:g_.NS.DISCO_ITEMS};return t&&(s.node=t),Oh.sendIQ(p_({from:Oh.connection.get().jid,to:e,type:"get"}).c("query",s))},entities:{async get(e,t=!1){await Oh.waitUntil("discoInitialized");const s=Iu.state.disco_entities;if(!e)return s;if(void 0===s)return void bt.warn(`Tried to look up entity ${e} but disco_entities has been torn down`);const n=s.get(e);return n||!t?n:Oh.disco.entities.create({jid:e})},items:e=>Iu.state.disco_entities.filter((t=>t.get("parent_jids")?.includes(e))),create:(e,t)=>Iu.state.disco_entities.create(e,t)},features:{async get(e,t){if(!t)throw new TypeError("You need to provide an entity JID");const s=await Oh.disco.entities.get(t,!0);if(void 0===Iu.state.disco_entities&&!Oh.connection.connected())return bt.warn(`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`),[];const n=[s.getFeature(e),...Oh.disco.entities.items(t).map((t=>t.getFeature(e)))];return(await Promise.all(n)).filter((e=>e instanceof Object))},async has(e,t){if(!t)throw new TypeError("You need to provide an entity JID");const s=await Oh.disco.entities.get(t,!0);if(void 0===Iu.state.disco_entities&&!Oh.connection.connected())return bt.warn(`Tried to check if ${t} supports feature ${e}`),!1;if(await s.getFeature(e))return!0;const n=await Promise.all(Oh.disco.entities.items(t).map((t=>t.getFeature(e))));return n.map((e=>e instanceof Object)).includes(!0)}},supports:(e,t)=>Oh.disco.features.has(e,t),async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await Oh.waitUntil("discoInitialized");let t=await Oh.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=ic()),t.queryInfo()):t=await Oh.disco.entities.create({jid:e},{ignore_cache:!0}),t.waitUntilFeaturesDiscovered},refreshFeatures:e=>Oh.refresh(e),async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await Oh.waitUntil("discoInitialized");let t=await Oh.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await Oh.waitUntil("discoInitialized");let t=await Oh.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,s){const n=await Oh.disco.entities.get(s,!0);if(void 0!==n||Oh.connection.connected())return n.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${s} but _converse.disco_entities has been torn down`;bt.warn(t)}}}},{Strophe:__,$iq:b_}=qg.env;async function y_(){Oh.disco.own.identities.add("client","web","Converse"),Oh.disco.own.features.add(__.NS.CHATSTATES),Oh.disco.own.features.add(__.NS.DISCO_INFO),Oh.disco.own.features.add(__.NS.ROSTERX),Oh.disco.own.features.add(__.NS.CARBONS),Oh.trigger("addClientFeatures"),Oh.connection.get().addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),s={xmlns:__.NS.DISCO_INFO};t&&(s.node=t);const n=b_({type:"result",id:e.getAttribute("id")}),i=e.getAttribute("from");return null!==i&&n.attrs({to:i}),n.c("query",s),Iu.state.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),n.c("identity",t).up()})),Iu.state.disco._features.forEach((e=>n.c("feature",{var:e}).up())),Oh.send(n.tree()),!0}(e)),__.NS.DISCO_INFO,"iq","get",null,null);const e=new Iu.exports.DiscoEntities;Object.assign(Iu,{disco_entities:e}),Object.assign(Iu.state,{disco_entities:e});const t=`converse.disco-entities-${Iu.session.get("bare_jid")}`;e.browserStorage=qu(t,"session");const s=await e.fetchEntities(),n=Iu.session.get("domain");0!==s.length&&s.get(n)||Oh.disco.entities.create({jid:n},{ignore_cache:!0}),Oh.trigger("discoInitialized")}function w_(){if(!Iu.state.stream_features){const e=`converse.stream-features-${Iu.session.get("bare_jid")}`;Oh.promises.add("streamFeaturesAdded");const t=new Od;t.browserStorage=qu(e,"session"),Object.assign(Iu,{stream_features:t}),Object.assign(Iu.state,{stream_features:t})}}function A_(){Oh.trigger("streamFeaturesAdded")}function S_(){w_(),Array.from(Oh.connection.get().features.childNodes).forEach((e=>{Iu.state.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),A_()}function x_(){const{disco_entities:e}=Iu.state;e?.forEach((e=>e.features.clearStore())),e?.forEach((e=>e.identities.clearStore())),e?.forEach((e=>e.dataforms.clearStore())),e?.forEach((e=>e.fields.clearStore())),e?.clearStore(),delete Iu.state.disco_entities,Object.assign(Iu,{disco_entities:void 0})}const{Strophe:E_}=qg.env;qg.plugins.add("converse-disco",{initialize(){Object.assign(Oh,v_),Oh.promises.add("discoInitialized"),Oh.promises.add("streamFeaturesAdded");const e={DiscoEntity:m_,DiscoEntities:f_};Object.assign(Iu,e),Object.assign(Iu.exports,e);const t={_identities:[],_features:[]};Object.assign(Iu,{disco:t}),Object.assign(Iu.state,{disco:t}),Oh.listen.on("userSessionInitialized",(async()=>{w_(),Iu.state.connfeedback.get("connection_status")===E_.Status.ATTACHED&&(await new Promise(((e,t)=>Iu.state.stream_features.fetch({success:e,error:t}))),A_())})),Oh.listen.on("beforeResourceBinding",S_),Oh.listen.on("reconnected",y_),Oh.listen.on("connected",y_),Oh.listen.on("beforeTearDown",(async()=>{Oh.promises.add("streamFeaturesAdded");const{stream_features:e}=Iu.state;e&&(await e.clearStore(),delete Iu.state.stream_features,Object.assign(Iu,{stream_features:void 0}))})),Oh.listen.on("will-reconnect",x_),Oh.listen.on("clearSession",x_)}});const $_={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],Ov(e=Array.isArray(e)?e:[e],t)),get:(e,t)=>Nv(e,t)}};qg.AFFILIATION_CHANGES=dv,qg.AFFILIATION_CHANGES_LIST=uv,qg.MUC_TRAFFIC_STATES=hv,qg.MUC_TRAFFIC_STATES_LIST=mv,qg.MUC_ROLE_CHANGES=fv,qg.MUC_ROLE_CHANGES_LIST=gv,qg.MUC={INFO_CODES:pv},qg.MUC_NICK_CHANGED_CODE=bv,qg.ROOM_FEATURES=_v,qg.ROOMSTATUS=vv;const{Strophe:C_}=qg.env;C_.addNamespace("MUC_ADMIN",C_.NS.MUC+"#admin"),C_.addNamespace("MUC_OWNER",C_.NS.MUC+"#owner"),C_.addNamespace("MUC_REGISTER","jabber:iq:register"),C_.addNamespace("MUC_ROOMCONF",C_.NS.MUC+"#roomconfig"),C_.addNamespace("MUC_USER",C_.NS.MUC+"#user"),C_.addNamespace("MUC_HATS","xmpp:prosody.im/protocol/hats:1"),C_.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),qg.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco"],initialize(){const{__:e,___:t}=Iu;if(Oh.settings.extend({allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!1,colorize_username:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[...qg.MUC.INFO_CODES.visibility_changes,...qg.MUC.INFO_CODES.self,...qg.MUC.INFO_CODES.non_privacy_changes,...qg.MUC.INFO_CODES.muc_logging_changes,...qg.MUC.INFO_CODES.nickname_changes,...qg.MUC.INFO_CODES.disconnected,...qg.MUC.INFO_CODES.affiliation_changes,...qg.MUC.INFO_CODES.join_leave_events,...qg.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_subscribe_to_rai:!1}),Oh.promises.add(["roomsAutoJoined"]),Oh.settings.get("locked_muc_domain")&&"string"!=typeof Oh.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");qg.env.muc_utils={computeAffiliationsDelta:Mv},Object.assign(Oh,yh),Object.assign(Oh.rooms,$_);const s={muc:{info_messages:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created")},new_nickname_messages:{210:t("Your nickname has been automatically set to %1$s"),303:t("Your nickname has been changed to %1$s")},disconnect_messages:{301:e("You have been banned from this groupchat"),333:e("You have exited this groupchat due to a technical problem"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because the groupchat has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down")}}};Object.assign(Iu.labels,s),Object.assign(Iu,s),Bv(),addEventListener("hashchange",Bv);const n={ChatRoom:r_,ChatRoomMessage:Dp,ChatRoomMessages:Lp,ChatRoomOccupant:o_,ChatRoomOccupants:l_};Object.assign(Iu,n);const i={MUC:r_,MUCMessage:Dp,MUCMessages:Lp,MUCOccupant:o_,MUCOccupants:l_,getDefaultMUCNickname:Hv,isInfoVisible:Gv,onDirectMUCInvitation:qv};Object.assign(Iu.exports,i),Object.assign(Iu,i),Oh.chatboxes.registry.add(yu,r_),Oh.settings.get("allow_muc_invitations")&&(Oh.listen.on("connected",Pv),Oh.listen.on("reconnected",Pv)),Oh.listen.on("addClientFeatures",(()=>Oh.disco.own.features.add(`${C_.NS.CONFINFO}+notify`))),Oh.listen.on("addClientFeatures",Vv),Oh.listen.on("beforeResourceBinding",Yv),Oh.listen.on("beforeTearDown",Qv),Oh.listen.on("chatBoxesFetched",Wv),Oh.listen.on("disconnected",Fv),Oh.listen.on("statusInitialized",Jv),document.addEventListener("visibilitychange",Uv)}}),Object.assign(Sm,{muc:{isChatRoom:function(e){return"chatroom"===e?.get("type")},setAffiliation:Iv}});const{Strophe:k_,$iq:T_,sizzle:j_}=qg.env;const N_=class extends Od{async initialize(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>bt.fatal(e))))),this.on("remove",this.markRoomAsUnbookmarked,this),this.on("remove",this.sendBookmarkStanza,this);const{session:e}=Iu,t=`converse.room-bookmarks${e.get("bare_jid")}`;this.fetched_flag=t+"fetched",Hu(this,t),await this.fetchBookmarks(),Oh.trigger("bookmarksInitialized",this)}static async checkBookmarksSupport(){const e=Iu.session.get("bare_jid");if(!e)return!1;const t=await Oh.disco.getIdentity("pubsub","pep",e);return Oh.settings.get("allow_public_bookmarks")?!!t:Oh.disco.supports(k_.NS.PUBSUB+"#publish-options",e)}constructor(){super([],{comparator:e=>e.get("name").toLowerCase()}),this.model=jp}async openBookmarkedRoom(e){if(Oh.settings.get("muc_respect_autojoin")&&e.get("autojoin")){(await Oh.rooms.create(e.get("jid"),{nick:e.get("nick")})).maybeShow()}return e}fetchBookmarks(){const e=ic();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e}createBookmark(e){this.create(e),this.sendBookmarkStanza().catch((t=>this.onBookmarkError(t,e)))}sendBookmarkStanza(){const e=T_({type:"set",from:Oh.connection.get().jid}).c("pubsub",{xmlns:k_.NS.PUBSUB}).c("publish",{node:k_.NS.BOOKMARKS}).c("item",{id:"current"}).c("storage",{xmlns:k_.NS.BOOKMARKS});return this.forEach((t=>{e.c("conference",{name:t.get("name"),autojoin:t.get("autojoin"),jid:t.get("jid")});const s=t.get("nick");s?e.c("nick").t(s).up().up():e.up()})),e.up().up().up(),e.c("publish-options").c("x",{xmlns:k_.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("http://jabber.org/protocol/pubsub#publish-options").up().up().c("field",{var:"pubsub#persist_items"}).c("value").t("true").up().up().c("field",{var:"pubsub#access_model"}).c("value").t("whitelist"),Oh.sendIQ(e)}onBookmarkError(e,t){const{__:s}=Iu;bt.error("Error while trying to add bookmark"),bt.error(e),Oh.alert("error",s("Error"),[s("Sorry, something went wrong while trying to save your bookmark.")]),this.get(t.jid)?.destroy()}fetchBookmarksFromServer(e){const t=T_({from:Oh.connection.get().jid,type:"get"}).c("pubsub",{xmlns:k_.NS.PUBSUB}).c("items",{node:k_.NS.BOOKMARKS});Oh.sendIQ(t).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))}markRoomAsBookmarked(e){const{chatboxes:t}=Iu.state,s=t.get(e.get("jid"));s?.save("bookmarked",!0)}markRoomAsUnbookmarked(e){const{chatboxes:t}=Iu.state,s=t.get(e.get("jid"));s?.save("bookmarked",!1)}createBookmarksFromStanza(e){const t=k_.NS.BOOKMARKS;j_(`items[node="${t}"] item storage[xmlns="${t}"] conference`,e).forEach((e=>{const t=e.getAttribute("jid"),s=this.get(t),n={jid:t,name:e.getAttribute("name")||t,autojoin:"true"===e.getAttribute("autojoin"),nick:e.querySelector("nick")?.textContent||""};s?s.save(n):this.create(n)}))}onBookmarksReceived(e,t){if(this.createBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,"true"),void 0!==e)return e.resolve()}onBookmarksReceivedError(e,t){const{__:s}=Iu;if(null===t)bt.error("Error: timeout while fetching bookmarks"),Oh.alert("error",s("Timeout Error"),[s("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]);else{if(e)return t.querySelector('error[type="cancel"] item-not-found')?(window.sessionStorage.setItem(this.fetched_flag,"true"),e.resolve()):(bt.error("Error while fetching bookmarks"),bt.error(t),e.reject(new Error("Could not fetch bookmarks")));bt.error("Error while fetching bookmarks"),bt.error(t)}}async getUnopenedBookmarks(){await Oh.waitUntil("bookmarksInitialized"),await Oh.waitUntil("chatBoxesFetched");const{chatboxes:e}=Iu.state;return this.filter((t=>!e.get(t.get("jid"))))}},{Strophe:O_,sizzle:I_}=qg.env;function M_(e){return I_(`event[xmlns="${O_.NS.PUBSUB}#event"] items[node="${O_.NS.BOOKMARKS}"]`,e).length&&Oh.waitUntil("bookmarksInitialized").then((()=>Iu.state.bookmarks.createBookmarksFromStanza(e))).catch((e=>bt.fatal(e))),!0}const{Strophe:R_}=qg.env;R_.addNamespace("BOOKMARKS","storage:bookmarks"),qg.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],overrides:{ChatRoom:{getDisplayName(){const{_converse:e,getDisplayName:t}=this.__super__,{bookmarks:s}=e.state,n=this.get("bookmarked")?s?.get(this.get("jid")):null;return n?.get("name")||t.apply(this,arguments)},getAndPersistNickname(e){var t;return e=e||(t=this.get("jid"),Oh.settings.get("allow_bookmarks")?Iu.state.bookmarks?.get(t)?.get("nick"):null),this.__super__.getAndPersistNickname.call(this,e)}}},initialize(){Oh.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),Oh.promises.add("bookmarksInitialized");const e={Bookmark:jp,Bookmarks:N_};Object.assign(Iu,e),Object.assign(Iu.exports,e),Oh.listen.on("addClientFeatures",(()=>{Oh.settings.get("allow_bookmarks")&&Oh.disco.own.features.add(R_.NS.BOOKMARKS+"+notify")})),Oh.listen.on("clearSession",(()=>{const{state:e}=Iu;e.bookmarks&&(e.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(e.bookmarks.fetched_flag),delete e.bookmarks)})),Oh.listen.on("connected",(async()=>{const e=Iu.session.get("bare_jid");Oh.connection.get().addHandler(M_,null,"message","headline",null,e),await Promise.all([Oh.waitUntil("chatBoxesFetched")]),async function(){Oh.settings.get("allow_bookmarks")&&await N_.checkBookmarksSupport()&&(Iu.state.bookmarks=new Iu.exports.Bookmarks,Object.assign(Iu,{bookmarks:Iu.state.bookmarks}))}()}))}});const D_={tokens:{get(e){const t=Oh.connection.get();return t?"rid"===e.toLowerCase()?t.rid||t._proto.rid:"sid"===e.toLowerCase()?t.sid||t._proto.sid:void 0:null}}},L_="converse.bosh-session";let z_;async function P_(e,t){if(t.success)return t;const{automatic:s}=t;return await async function(){const e=(await async function(){const e=L_;z_||(z_=new cd({id:e}),z_.browserStorage=qu(e,"session"),await new Promise((e=>z_.fetch({success:e,error:e}))));let t=Iu.session.get("jid");if(t)z_.get("jid")!==t&&(t=await Ku(t),z_.clear({silent:!0}),z_.save({jid:t}));else{const e=z_.get("jid");e&&await Ku(e)}return z_}()).get("jid"),t=Oh.connection.get();if(e&&t._proto instanceof lt.Bosh)try{return t.restore(e,t.onConnectStatusChanged),!0}catch(t){return!Yd()&&bt.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1}()?{...t,success:!0}:Oh.settings.get("authentication")!==uu||s&&!Oh.settings.get("auto_login")?t:(function(){if(!Oh.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=Oh.connection.get(),t=new XMLHttpRequest;t.open("GET",Oh.settings.get("prebind_url"),!0),t.setRequestHeader("Accept","application/json, text/javascript"),t.onload=async function(s){if(t.status>=200&&t.status<400){const s=JSON.parse(t.responseText),n=await Ku(s.jid);e.attach(n,s.sid,s.rid,e.onConnectStatusChanged,su)}else t.onerror(s)},t.onerror=function(){Oh.connection.destroy(),Oh.trigger("noResumeableBOSHSession",Iu)},t.send()}(),{...t,success:!0})}function F_(){void 0!==z_&&z_.save({jid:Iu.session.get("jid")})}function U_(){if(void 0===z_){const e=L_;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else z_.destroy(),z_=void 0}qg.plugins.add("converse-bosh",{enabled:()=>!Iu.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){Oh.settings.extend({bosh_service_url:void 0,prebind_url:null}),Object.assign(Oh,D_),Oh.listen.on("clearSession",U_),Oh.listen.on("setUserJID",F_),Oh.listen.on("login",P_),Oh.listen.on("addClientFeatures",(()=>Oh.disco.own.features.add(lt.NS.BOSH)))}});const{Strophe:B_,$build:q_}=qg.env;function H_(e,t){return e.sort(((e,s)=>e[t]>s[t]?-1:1))}async function G_(){const e=Iu.api.disco.own.identities.get(),t=Iu.api.disco.own.features.get();e.length>1&&(H_(e,"category"),H_(e,"type"),H_(e,"lang"));let s=e.reduce(((e,t)=>`${e}${t.category}/${t.type}/${t?.lang??""}/${t.name}<`),"");t.sort(),s=t.reduce(((e,t)=>`${e}${t}<`),s);return tm(await crypto.subtle.digest("SHA-1",em(s)))}async function W_(e){const t=await async function(){return q_("c",{xmlns:B_.NS.CAPS,hash:"sha-1",node:"https://conversejs.org",ver:await G_()}).tree()}();return e.root().cnode(t).up(),e}const{Strophe:V_}=qg.env;V_.addNamespace("CAPS","http://jabber.org/protocol/caps"),qg.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){Oh.listen.on("constructedPresence",((e,t)=>W_(t))),Oh.listen.on("constructedMUCPresence",((e,t)=>W_(t)))}});const Q_=class extends Od{constructor(e,t){super(e,Object.assign({comparator:"time_opened"},t))}onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),Oh.trigger("chatBoxesFetched")}onConnected(e){if(e)return;Hu(this,`converse.chatboxes-${Iu.session.get("bare_jid")}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)})}createModel(e,t){if(!e.type)throw new Error("You need to specify a type of chatbox to be created");return new(Oh.chatboxes.registry.get(e.type))(e,t)}},{Strophe:J_}=qg.env;qg.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){let e;Oh.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(Oh,{chatboxes:vh}),Object.assign(Iu,{ChatBoxes:Q_}),Object.assign(Iu.exports,{ChatBoxes:Q_}),Oh.listen.on("addClientFeatures",(()=>{Oh.disco.own.features.add(J_.NS.MESSAGE_CORRECT),Oh.disco.own.features.add(J_.NS.HTTPUPLOAD),Oh.disco.own.features.add(J_.NS.OUTOFBAND)})),Oh.listen.on("pluginsInitialized",(()=>{e=new Iu.exports.ChatBoxes,Object.assign(Iu,{chatboxes:e}),Object.assign(Iu.state,{chatboxes:e}),Oh.trigger("chatBoxesInitialized")})),Oh.listen.on("presencesInitialized",(t=>e.onConnected(t))),Oh.listen.on("reconnected",(()=>e.forEach((e=>e.onReconnection()))))}});const{Strophe:Y_,u:X_}=qg.env;function K_(e){const t=P()(`command[xmlns="${Y_.NS.ADHOC}"]`,e).pop(),s=t.querySelector("note");return{...fp(e),sessionid:t.getAttribute("sessionid"),note:s?{text:s.textContent,type:s.getAttribute("type")}:null,actions:Array.from(t.querySelector("actions")?.children??[]).map((e=>e.nodeName.toLowerCase()))}}const{Strophe:Z_,$iq:eb,u:tb,stx:sb}=qg.env,nb={adhoc:{async getCommands(e){try{return t=await Oh.disco.items(e,Z_.NS.ADHOC),P()(`query[xmlns="${Y_.NS.DISCO_ITEMS}"][node="${Y_.NS.ADHOC}"] item`,t).map(X_.getAttributes)}catch(t){return null===t?bt.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(bt.error(`Error while fetching ad-hoc commands for ${e}`),bt.error(t)),[]}var t},async fetchCommandForm(e,t){const s=eb({type:"set",to:e}).c("command",{xmlns:Z_.NS.ADHOC,action:"execute",node:t});return K_(await Oh.sendIQ(s))},async runCommand(e,t,s,n,i){const r=sb`<iq type="set" to="${e}" xmlns="jabber:client">
                    <command sessionid="${t}" node="${s}" action="${n}" xmlns="${Z_.NS.ADHOC}">
                        ${["cancel","prev"].includes(n)?"":sb`
                            <x xmlns="${Z_.NS.XFORM}" type="submit">
                                ${i.reduce(((e,{name:t,value:s})=>e+`<field var="${t}"><value>${s}</value></field>`),"")}
                            </x>`}
                    </command>
                </iq>`,o=await Oh.sendIQ(r,null,!1);if(null===o){bt.warn("A timeout occurred while trying to run an ad-hoc command");const{__:e}=Iu;return{status:"error",note:e("A timeout occurred")}}tb.isErrorStanza(o)&&(bt.error("Error while trying to execute an ad-hoc command"),bt.error(o));const a=o.querySelector("command"),c=a?.getAttribute("status");return{status:c,..."executing"===c?K_(o):{},note:o.querySelector("note")?.textContent}}}},{Strophe:ib}=qg.env;ib.addNamespace("ADHOC","http://jabber.org/protocol/commands"),qg.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){Object.assign(this._converse.api,nb)}});class rb extends ov{defaults(){return{bookmarked:!1,hidden:Jd()&&!Oh.settings.get("singleton"),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:void 0,type:wu}}constructor(e,t){super(e,t),this.disable_mam=!0}async initialize(){super.initialize(),this.set({box_id:`box-${this.get("jid")}`}),this.initUI(),this.initMessages(),await this.fetchMessages(),Oh.trigger("headlinesFeedInitialized",this)}}const ob={headlines:{async get(e,t={},s=!1){async function n(e){let n=await Oh.chatboxes.get(e);if(!n&&s){const{HeadlinesFeed:s}=Iu.exports;n=await Oh.chatboxes.create(e,t,s)}else n=n&&n.get("type")===wu?n:null,n&&Object.keys(t).length&&n.save(t);return n}if(void 0===e){return(await Oh.chatboxes.get()).filter((e=>e.get("type")===wu))}return"string"==typeof e?n(e):Promise.all(e.map((e=>n(e))))}}};qg.plugins.add("converse-headlines",{dependencies:["converse-chat"],initialize(){const e={HeadlinesFeed:rb};function t(){Oh.connection.get()?.addHandler((e=>(async function(e){if(lp(e)||dp(e)){const t=e.getAttribute("from");if(await Oh.waitUntil("rosterInitialized"),t.includes("@")&&!Iu.state.roster.get(t)&&!Oh.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const s=await Oh.chatboxes.create(t,{id:t,jid:t,type:wu,from:t},rb),n=await Qp(e);await s.createMessage(n),Oh.trigger("message",{chatbox:s,stanza:e,attrs:n})}}(e),!0)),null,"message")}Object.assign(Iu,e),Object.assign(Iu.exports,e),Oh.listen.on("connected",t),Oh.listen.on("reconnected",t),Object.assign(Oh,ob),Oh.chatboxes.registry.add(wu,rb)}});class ab extends cd{defaults(){return{msgid:Am(),is_ephemeral:!1}}}const{NS:cb}=lt,lb=qg.env.utils;function db(e){e?.querySelectorAll("feature-not-implemented").length?bt.warn(`Message Archive Management (XEP-0313) not supported by ${e.getAttribute("from")}`):(bt.error(`Error while trying to set archiving preferences for ${e.getAttribute("from")}.`),bt.error(e))}function ub(e,t){const s=P()(`prefs[xmlns="${cb.MAM}"]`,e).pop();if(s.getAttribute("default")!==Oh.settings.get("message_archiving")){const e=je({type:"set"}).c("prefs",{xmlns:cb.MAM,default:Oh.settings.get("message_archiving")});Array.from(s.children).forEach((t=>e.cnode(t).up())),Oh.sendIQ(e).then((()=>t.save({preferences:{default:Oh.settings.get("message_archiving")}}))).catch(Iu.exports.onMAMError)}else t.save({preferences:{default:Oh.settings.get("message_archiving")}})}function hb(e){const t=e.get("preferences")||{};e.get("var")===cb.MAM&&void 0!==Oh.settings.get("message_archiving")&&t.default!==Oh.settings.get("message_archiving")&&Oh.sendIQ(je({type:"get"}).c("prefs",{xmlns:cb.MAM})).then((t=>Iu.exports.onMAMPreferences(t,e))).catch(Iu.exports.onMAMError)}function mb(e){Oh.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(pb(e),e.save({prejoin_mam_fetched:!0}))}async function fb(e,t,s,n,i){const r=e.get("type")===yu,o=await Promise.all(t.messages.map((t=>r?Cv(t,e):Qp(t))));t.messages=o;const a={query:s,chatbox:e,messages:o};if(await Oh.trigger("MAMResult",a,{synchronous:!0}),o.forEach((t=>e.queueMessage(t))),t.error){const s=t.error.retry_event_id=lb.getUniqueId();Oh.listen.once(s,(()=>gb(e,n,i))),e.createMessageFromError(t.error)}}async function gb(e,t={},s=null){if(e.disable_mam)return;const n=e.get("type")===yu,i=Iu.session.get("bare_jid"),r=n?e.get("jid"):i;if(!await Oh.disco.supports(cb.MAM,r))return;const o=Oh.settings.get("archived_messages_page_size"),a=Object.assign({groupchat:n,max:o,with:e.get("jid")},t),c=await Oh.archive.query(a);if(await fb(e,c,a,t,s),c.rsm&&!c.complete){if(s)return"forwards"===s?t=c.rsm.next(o,t.before).query:"backwards"===s&&(t=c.rsm.previous(o,t.after).query),gb(e,t,s);!async function(e,t,s){if(""==t.before&&(0===e.messages.length||!t.start))return;if(t.before&&!t.start)return;if(null==t.before)return;const n=await Promise.all(s.messages),{rsm:i}=s,r=`stanza_id ${e.get("jid")}`,o=n.find((e=>e[r]===i.result.first)),a=new Date(o.time),c={template_hook:"getMessageTemplate",time:new Date(a.getTime()-1).toISOString(),before:i.result.first,start:t.start};e.messages.add(new ab(c))}(e,t,c)}}function pb(e){if(e.disable_mam)return;const t=e.getMostRecentMessage();if(t&&!Oh.settings.get("clear_messages_on_reconnection")){if(Oh.settings.get("mam_request_all_pages")){const s=t.get(`stanza_id ${e.get("jid")}`);gb(e,s?{after:s}:{start:t.get("time")},"forwards")}else gb(e,{before:"",start:t.get("time")})}else gb(e,{before:""})}const{Strophe:vb,$build:_b}=qg.env;vb.addNamespace("RSM","http://jabber.org/protocol/rsm");const bb=["after","before","index","max"],yb=e=>Number(e),wb=e=>e.toString(),Ab={after:wb,before:wb,count:yb,first:wb,index:yb,last:wb,max:yb},Sb=e=>void 0===e,xb=Object.keys(Ab);class Eb{static getQueryParameters(e={}){return ad(e,bb)}static parseXMLResult(e){const t={};for(var s=0;s<xb.length;s++){const n=xb[s],i=e.getElementsByTagName(n)[0];Sb(i)||null===i||(t[n]=Ab[n](vb.getText(i)),"first"==n&&(t.index=Ab.index(i.getAttribute("index"))))}return t}constructor(e={}){this.query=Eb.getQueryParameters(e),this.result=e.xml?Eb.parseXMLResult(e.xml):{}}toXML(){const e=_b("set",{xmlns:vb.NS.RSM});return bb.reduce(((e,t)=>Sb(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}next(e,t){const s=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new Eb(s)}previous(e,t){const s=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new Eb(s)}}const{NS:$b}=lt,Cb=qg.env.utils,kb={archive:{async query(e){if(!Oh.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");const t={type:"set"};if(e&&e.groupchat){if(!e.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');t.to=e.with}const s=Iu.session.get("bare_jid"),n=t.to||s;if(!await Oh.disco.supports($b.MAM,n))return bt.warn(`Did not fetch MAM archive for ${n} because it doesn't support ${$b.MAM}`),{messages:[]};const i=Cb.getUniqueId(),r=je(t).c("query",{xmlns:$b.MAM,queryid:i});if(e){r.c("x",{xmlns:$b.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t($b.MAM).up().up(),e.with&&!e.groupchat&&r.c("field",{var:"with"}).c("value").t(e.with).up().up(),["start","end"].forEach((t=>{if(e[t]){const s=R()(e[t]);if(!s.isValid())throw new TypeError(`archive.query: invalid date provided for: ${t}`);r.c("field",{var:t}).c("value").t(s.toISOString()).up().up()}})),r.up();const t=new Eb(e);Object.keys(t.query).length&&r.cnode(t.toXML())}const o=Oh.connection.get(),a=[],c=o.addHandler((t=>{const n=P()(`message > result[xmlns="${$b.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==i)return!0;const r=t.getAttribute("from")||s;if(e.groupchat){if(r!==e.with)return bt.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(r!==s)return bt.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return a.push(t),!0}),$b.MAM);let l;const d=Oh.settings.get("message_archiving_timeout"),u=await Oh.sendIQ(r,d,!1);if(null===u){const{__:e}=Iu,t=e("Timeout while trying to fetch archived messages.");return bt.error(t),l=new hh(t),{messages:a,error:l}}if(Cb.isErrorStanza(u)){const{__:e}=Iu,t=e("An error occurred while querying for archived messages.");return bt.error(t),bt.error(u),l=new Error(t),{messages:a,error:l}}let h;o.deleteHandler(c);const m=u&&P()(`fin[xmlns="${$b.MAM}"]`,u).pop(),f="true"===m?.getAttribute("complete"),g=P()(`set[xmlns="${$b.RSM}"]`,m).pop();return g&&(h=new Eb({...e,xml:g})),{messages:a,rsm:h,complete:f}}}},{NS:Tb}=lt;qg.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){Oh.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!0,message_archiving:void 0,message_archiving_timeout:6e4}),Object.assign(Oh,kb);const e={onMAMError:db,onMAMPreferences:ub,handleMAMResult:fb,MAMPlaceholderMessage:ab};Object.assign(Iu,e),Object.assign(Iu.exports,e),Oh.listen.on("addClientFeatures",(()=>Oh.disco.own.features.add(Tb.MAM))),Oh.listen.on("serviceDiscovered",hb),Oh.listen.on("chatRoomViewInitialized",(e=>{Oh.settings.get("muc_show_logs_before_join")&&(mb(e.model),e.model.features.on("change:mam_enabled",(()=>mb(e.model))))})),Oh.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&pb(e))),Oh.listen.on("chatReconnected",(e=>{e.get("type")===bu&&pb(e)})),Oh.listen.on("afterMessagesFetched",(e=>{e.get("type")===bu&&pb(e)}))}}),Object.assign(Sm,{mam:{fetchArchivedMessages:gb}});const{Strophe:jb,$iq:Nb}=qg.env;let Ob,Ib;function Mb(){document.hidden||Oh.ping(null,5e3)}function Rb(e){Ob=new Date;const t=e.getAttribute("from"),s=e.getAttribute("id"),n=Nb({type:"result",to:t,id:s});return Oh.sendIQ(n),!0}function Db(){!function(){const e=Oh.connection.get();e.disco&&Oh.disco.own.features.add(jb.NS.PING),e.addHandler(Rb,jb.NS.PING,"iq","get")}(),Oh.connection.get()?.addHandler((()=>{if(Oh.settings.get("ping_interval")>0)return Ob=new Date,!0})),clearInterval(Ib),Ib=setInterval(zb,1e3)}function Lb(){clearInterval(Ib)}function zb(){if(Yd()||!Oh.connection.authenticated())return;const e=Oh.settings.get("ping_interval");if(e>0){const t=new Date;Ob=Ob??t,(t.valueOf()-Ob.valueOf())/1e3>e&&Oh.ping()}}const{Strophe:Pb,$iq:Fb,u:Ub}=qg.env,Bb={async ping(e,t){if(!Oh.connection.authenticated())return bt.warn("Not pinging when we know we're not authenticated"),null;var s;s=new Date,Ob=s;const n=Iu.session.get("bare_jid");e=e||Pb.getDomainFromJid(n);const i=Fb({type:"get",to:e,id:Ub.getUniqueId("ping")}).c("ping",{xmlns:Pb.NS.PING}),r=await Oh.sendIQ(i,t||1e4,!1);return null===r?(bt.warn(`Timeout while pinging ${e}`),e===Pb.getDomainFromJid(n)&&Oh.connection.reconnect(),!1):!Ub.isErrorStanza(r)||(bt.error(`Error while pinging ${e}`),bt.error(r),!1)}},{Strophe:qb}=qg.env;qb.addNamespace("PING","urn:xmpp:ping"),qg.plugins.add("converse-ping",{initialize(){Oh.settings.extend({ping_interval:60}),Object.assign(Oh,Bb),Oh.listen.on("connected",Db),Oh.listen.on("reconnected",Db),Oh.listen.on("disconnected",Lb),document.addEventListener("visibilitychange",Mb)}});const{Strophe:Hb,$iq:Gb}=qg.env;Hb.addNamespace("PUBSUB_ERROR",Hb.NS.PUBSUB+"#errors"),qg.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){Object.assign(Iu.api,{pubsub:{async publish(e,t,s,n,i=!0){const r=Iu.session.get("bare_jid"),o=Gb({from:r,type:"set",to:e}).c("pubsub",{xmlns:Hb.NS.PUBSUB}).c("publish",{node:t}).cnode(s.tree()).up().up();n&&(e=e||r,await Oh.disco.supports(Hb.NS.PUBSUB+"#publish-options",e)?(o.c("publish-options").c("x",{xmlns:Hb.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(`${Hb.NS.PUBSUB}#publish-options`).up().up(),Object.keys(n).forEach((e=>o.c("field",{var:e}).c("value").t(n[e]).up().up()))):bt.warn(`_converse.api.publish: ${e} does not support #publish-options, so we didn't set them even though they were provided.`));try{await Oh.sendIQ(o)}catch(e){if(!(e instanceof Element&&i&&e.querySelector(`precondition-not-met[xmlns="${Hb.NS.PUBSUB_ERROR}"]`)))throw e;{const e=o.tree();e.querySelector("publish-options").outerHTML="",bt.warn(`PubSub: Republishing without publish options. ${e.outerHTML}`),await Oh.sendIQ(e)}}}}})}});const Wb={status:{get:async()=>(await Oh.waitUntil("statusInitialized"),Iu.state.xmppstatus.get("status")),async set(e,t){const s={status:e};if(!Object.keys(iu).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof t&&(s.status_message=t),await Oh.waitUntil("statusInitialized"),Iu.state.xmppstatus.save(s)},message:{get:async()=>(await Oh.waitUntil("statusInitialized"),Iu.state.xmppstatus.get("status_message")),async set(e){await Oh.waitUntil("statusInitialized"),Iu.state.xmppstatus.save({status_message:e})}}}};class Vb extends cd{initialize(){super.initialize(),this.set({text:"",type:"items",state:"online"})}}const{$pres:Qb}=qg.env;function Jb(e){const t=Iu.state.roster,s=t?.get(e.get("jid"));s?.save({num_unread:e.get("num_unread")})}let Yb;function Xb(){if(Yb){Oh.connection.get().deleteHandler(Yb),Yb=null}}async function Kb(){await(Iu.state.presences?.clearStore())}async function Zb(){if(await Kb(),Zd(Iu)){const e=Iu.state.roster;e&&(e.data?.destroy(),await e.clearStore(),delete Iu.state.roster,Object.assign(Iu,{roster:void 0}))}}function ey(e){e?Oh.trigger("rosterReadyAfterReconnection"):function(){const e=new Iu.exports.RosterContacts;Object.assign(Iu,{roster:e}),Object.assign(Iu.state,{roster:e});const t=Iu.session.get("bare_jid");let s=`converse.contacts-${t}`;Hu(e,s);const n=new Vb;Object.assign(Iu,{roster_filter:n}),Object.assign(Iu.state,{roster_filter:n}),n.id=`_converse.rosterfilter-${t}`,Hu(n,n.id),n.fetch(),s=`converse-roster-model-${t}`,e.data=new cd,e.data.id=s,Hu(e.data,s),e.data.fetch(),Oh.trigger("rosterInitialized")}();Iu.state.roster.onConnected(),function(){Xb();const e=Oh.connection.get();Yb=e.addHandler((e=>(Iu.state.roster.presenceHandler(e),!0)),null,"presence",null)}(),async function(e=!1){const t=Oh.connection.get();e&&(t.send_initial_presence=!0);const s=Iu.state.roster;try{await s.fetchRosterContacts(),Oh.trigger("rosterContactsFetched")}catch(e){bt.error(e)}finally{t.send_initial_presence&&Oh.user.presence.send()}}(!Oh.connection.get().restored)}async function ty(e){if(e)!Oh.connection.get().hasResumed()&&await Kb();else{const e=new Iu.exports.Presences;Object.assign(Iu,{presences:e}),Object.assign(Iu.state,{presences:e});Hu(e,`converse.presences-${Iu.session.get("bare_jid")}`,"session"),e.fetch()}Oh.trigger("presencesInitialized",e)}function sy(){const{chatboxes:e}=Iu.state;e.on("change:num_unread",Jb),e.on("add",(e=>{e.get("type")===bu&&e.setModelContact(e.get("jid"))}))}function ny(){Iu.state.roster.on("add",(e=>{const t=Iu.state.chatboxes.findWhere({jid:e.get("jid")});t?.setModelContact(e.get("jid"))}))}function iy(e,t){const s=Qb({to:e,type:"unsubscribed"});t&&""!==t&&s.c("status").t(t),Oh.send(s)}const{Strophe:ry,$iq:oy,$pres:ay}=qg.env;const cy=class extends Ip{get idAttribute(){return"jid"}defaults(){return{chat_state:void 0,groups:[],num_unread:0,status:void 0}}async initialize(e){super.initialize(),this.initialized=ic(),this.setPresence();const{jid:t}=e;this.set({...e,jid:ry.getBareJidFromJid(t).toLowerCase(),user_id:ry.getNodeFromJid(t)}),this.listenTo(this.presence,"change:show",(()=>Oh.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presenceChanged"))),await Oh.trigger("rosterContactInitialized",this,{Synchronous:!0}),this.initialized.resolve()}setPresence(){const e=this.get("jid"),{presences:t}=Iu.state;this.presence=t.findWhere(e)||t.create({jid:e})}openChat(){Oh.chats.open(this.get("jid"),this.attributes,!0)}getFilterCriteria(){const e=this.get("nickname"),t=this.get("jid");let s=this.getDisplayName();return s=s.includes(t)?s:s.concat(`   ${t}`),s=s.includes(e)?s:s.concat(`   ${e}`),s.toLowerCase()}getDisplayName(){return this.get("nickname")?this.get("nickname"):this.get("jid")}getFullname(){return this.get("jid")}subscribe(e){return Oh.user.presence.send("subscribe",this.get("jid"),e),this.save("ask","subscribe"),this}ackSubscribe(){Oh.send(ay({type:"subscribe",to:this.get("jid")}))}ackUnsubscribe(){Oh.send(ay({type:"unsubscribe",to:this.get("jid")})),this.removeFromRoster(),this.destroy()}unauthorize(e){return iy(this.get("jid"),e),this}authorize(e){const t=ay({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),Oh.send(t),this}removeFromRoster(){const e=oy({type:"set"}).c("query",{xmlns:ry.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return Oh.sendIQ(e)}},{Strophe:ly,$iq:dy,sizzle:uy,u:hy}=qg.env;const my=class extends Od{constructor(){super(),this.model=cy,this.data=null}initialize(){const e=`roster.state-${Iu.session.get("bare_jid")}-${this.get("jid")}`;this.state=new cd({id:e,collapsed_groups:[]}),Hu(this.state,e),this.state.fetch()}onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()}registerRosterHandler(){Oh.connection.get().addHandler((e=>(Iu.state.roster.onRosterPush(e),!0)),ly.NS.ROSTER,"iq","set")}registerRosterXHandler(){let e=0;Oh.connection.get().addHandler((t=>(setTimeout((()=>{const{roster:e}=Iu.state;Oh.connection.get().flush(),e.subscribeToSuggestedItems(t)}),e),e+=250*t.querySelectorAll("item").length,!0)),ly.NS.ROSTERX,"message",null)}async fetchRosterContacts(){const e=await new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,s)=>t(s)})}));if(hy.isErrorObject(e)&&(bt.error(e),Iu.session.save("roster_cached",!1),this.data.save("version",void 0)),!Iu.session.get("roster_cached"))return Oh.connection.get().send_initial_presence=!0,Iu.state.roster.fetchFromServer();Oh.trigger("cachedRoster",e)}subscribeToSuggestedItems(e){const{xmppstatus:t}=Iu.state;return Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&Iu.state.roster.addAndSubscribe(e.getAttribute("jid"),t.getNickname()||t.getFullname())})),!0}isSelf(e){return hy.isSameBareJID(e,Oh.connection.get().jid)}async addAndSubscribe(e,t,s,n,i){const r=await this.addContactToRoster(e,t,s,i);r instanceof Iu.exports.RosterContact&&r.subscribe(n)}sendContactAddIQ(e,t,s){t=t||null;const n=dy({type:"set"}).c("query",{xmlns:ly.NS.ROSTER}).c("item",{jid:e,name:t});return s.forEach((e=>n.c("group").t(e).up())),Oh.sendIQ(n)}async addContactToRoster(e,t,s,n){await Oh.waitUntil("rosterContactsFetched"),s=s||[];try{await this.sendContactAddIQ(e,t,s)}catch(s){const{__:n}=Iu;return bt.error(s),alert(n("Sorry, there was an error while trying to add %1$s as a contact.",t||e)),s}return this.create(Object.assign({ask:void 0,nickname:t,groups:s,jid:e,requesting:!1,subscription:"none"},n),{sort:!1})}async subscribeBack(e,t){const s=this.get(e),{RosterContact:n}=Iu.exports;if(s instanceof n)s.authorize().subscribe();else{const s=uy(`nick[xmlns="${ly.NS.NICK}"]`,t).pop()?.textContent||null,i=await this.addContactToRoster(e,s,[],{subscription:"from"});i instanceof n&&i.authorize().subscribe()}}onRosterPush(e){const t=e.getAttribute("id"),s=e.getAttribute("from"),n=Iu.session.get("bare_jid");if(s&&s!==n)return void bt.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);Oh.send(dy({type:"result",id:t,from:Oh.connection.get().jid}));const i=uy(`query[xmlns="${ly.NS.ROSTER}"]`,e).pop();this.data.save("version",i.getAttribute("ver"));const r=uy("item",i);if(r.length>1)throw bt.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===r.length)return bt.warn(e),void bt.warn('Received a roster push stanza without an "item" element.');this.updateContact(r.pop()),Oh.trigger("rosterPush",e)}rosterVersioningSupported(){return Oh.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")&&this.data.get("version")}async fetchFromServer(){const e=dy({type:"get",id:hy.getUniqueId("roster")}).c("query",{xmlns:ly.NS.ROSTER});this.rosterVersioningSupported()&&e.attrs({ver:this.data.get("version")});const t=await Oh.sendIQ(e,null,!1);if("result"===t.getAttribute("type")){const e=uy(`query[xmlns="${ly.NS.ROSTER}"]`,t).pop();if(e){const t=uy("item",e);if(!this.data.get("version")&&this.models.length){const e=t.map((e=>e.getAttribute("jid")));this.forEach((t=>!t.get("requesting")&&!e.includes(t.get("jid"))&&t.destroy()))}t.forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver"))}}else if(!hy.isServiceUnavailableError(t))return bt.error(t),void bt.error("Error while trying to fetch roster from the server");Iu.session.save("roster_cached",!0),Oh.trigger("roster",t)}updateContact(e){const t=e.getAttribute("jid"),s=this.get(t),n=e.getAttribute("subscription");if("remove"===n)return s?.destroy();const i=e.getAttribute("ask"),r=e.getAttribute("name"),o=[...new Set(uy("group",e).map((e=>e.textContent)))];s?s.save({subscription:n,ask:i,nickname:r,groups:o,requesting:null}):this.create({nickname:r,ask:i,groups:o,jid:t,subscription:n},{sort:!1})}createRequestingContact(e){const t={jid:ly.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:uy(`nick[xmlns="${ly.NS.NICK}"]`,e).pop()?.textContent||null};Oh.trigger("contactRequest",this.create(t))}handleIncomingSubscription(e){const t=e.getAttribute("from"),s=ly.getBareJidFromJid(t),n=this.get(s);if(!Oh.settings.get("allow_contact_requests")){const{__:e}=Iu;iy(t,e("This client does not allow presence subscriptions"))}Oh.settings.get("auto_subscribe")?n&&"to"===n.get("subscription")?n.authorize():this.subscribeBack(s,e):n?("none"!==n.get("subscription")||"subscribe"===n.get("ask"))&&n.authorize():this.createRequestingContact(e)}handleOwnPresence(e){const t=e.getAttribute("from"),s=ly.getResourceFromJid(t),n=e.getAttribute("type"),{xmppstatus:i}=Iu.state;if(Oh.connection.get().jid!==t&&"unavailable"!==n&&(!0===Oh.settings.get("synchronize_availability")||Oh.settings.get("synchronize_availability")===s)){const t=e.querySelector("show")?.textContent||"online";i.save({status:t},{silent:!0});const s=e.querySelector("status")?.textContent;s&&i.save({status_message:s})}Iu.session.get("jid")===t&&"unavailable"===n&&Oh.user.presence.send()}presenceHandler(e){const t=e.getAttribute("type");if("error"===t)return!0;const s=e.getAttribute("from"),n=ly.getBareJidFromJid(s);if(this.isSelf(n))return this.handleOwnPresence(e);if(uy(`query[xmlns="${ly.NS.MUC}"]`,e).length)return;const i=this.get(n);if(i){const t=e.querySelector("status")?.textContent;i.get("status")!==t&&i.save({status:t})}if("subscribed"===t&&i)i.ackSubscribe();else if("unsubscribed"===t&&i)i.ackUnsubscribe();else{if("unsubscribe"===t)return;if("subscribe"===t)this.handleIncomingSubscription(e);else if("unavailable"===t&&i){const e=ly.getResourceFromJid(s);i.presence.removeResource(e)}else i&&i.presence.addResource(e)}}};const fy=class extends cd{get idAttribute(){return"name"}};const gy=class extends Od{constructor(){super(),this.model=fy}},{Strophe:py,dayjs:vy,sizzle:_y}=qg.env;const by=class extends cd{get idAttribute(){return"jid"}defaults(){return{show:"offline"}}initialize(){super.initialize(),this.resources=new gy;const e=`converse.identities-${this.get("jid")}`;Hu(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)}onResourcesChanged(){const e=this.getHighestPriorityResource(),t=e?.attributes?.show||"offline";this.get("show")!==t&&this.save({show:t})}getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]}addResource(e){const t=e.getAttribute("from"),s=py.getResourceFromJid(t),n=_y(`delay[xmlns="${py.NS.DELAY}"]`,e).pop(),i=e.querySelector("priority")?.textContent,r=this.resources.get(s),o={name:s,priority:Number.isNaN(parseInt(i,10))?0:parseInt(i,10),show:e.querySelector("show")?.textContent??"online",timestamp:n?vy(n.getAttribute("stamp")).toISOString():(new Date).toISOString()};r?r.save(o):this.resources.create(o)}removeResource(e){const t=this.resources.get(e);t?.destroy()}};const yy=class extends Od{constructor(){super(),this.model=by}},{Strophe:wy,$build:Ay}=qg.env;function Sy(e){Oh.trigger("statusInitialized",e)}function xy(e){if(e=void 0!==Iu.state.xmppstatus&&e)Sy(e);else{const t=`converse.xmppstatus-${Iu.session.get("bare_jid")}`;Iu.state.xmppstatus=new Iu.exports.XMPPStatus({id:t}),Object.assign(Iu,{xmppstatus:Iu.state.xmppstatus}),Hu(Iu.state.xmppstatus,t,"session"),Iu.state.xmppstatus.fetch({success:()=>Sy(e),error:()=>Sy(e),silent:!0})}}let Ey,$y=0,Cy=!1,ky=!1,Ty=!1;function jy(){$y>0&&($y=0),Oh.connection.get()?.authenticated&&(Ty&&Oy(gu),Cy&&(Cy=!1,Oh.user.presence.send()),!0===ky&&(ky=!1,Iu.state.xmppstatus.set("status",Oh.settings.get("default_state"))))}function Ny(){if(!Oh.connection.get()?.authenticated)return;const{xmppstatus:e}=Iu.state,t=e.get("status");$y++,Oh.settings.get("csi_waiting_time")>0&&$y>Oh.settings.get("csi_waiting_time")&&!Ty&&Oy(fu),Oh.settings.get("idle_presence_timeout")>0&&$y>Oh.settings.get("idle_presence_timeout")&&!Cy&&(Cy=!0,Oh.user.presence.send()),Oh.settings.get("auto_away")>0&&$y>Oh.settings.get("auto_away")&&"away"!==t&&"xa"!==t&&"dnd"!==t?(ky=!0,e.set("status","away")):Oh.settings.get("auto_xa")>0&&$y>Oh.settings.get("auto_xa")&&"xa"!==t&&"dnd"!==t&&(ky=!0,e.set("status","xa"))}function Oy(e){Oh.send(Ay(e,{xmlns:wy.NS.CSI})),Ty=e===fu}function Iy(){if(Oh.settings.get("auto_away")<1&&Oh.settings.get("auto_xa")<1&&Oh.settings.get("csi_waiting_time")<1&&Oh.settings.get("idle_presence_timeout")<1)return;$y=0,ky=!1;const{onUserActivity:e,onEverySecond:t}=Iu.exports;window.addEventListener("click",e),window.addEventListener("focus",e),window.addEventListener("keypress",e),window.addEventListener("mousemove",e),window.addEventListener(Xd(),e,{once:!0,passive:!0}),Ey=setInterval(t,1e3)}function My(){const{onUserActivity:e}=Iu.exports;window.removeEventListener("click",e),window.removeEventListener("focus",e),window.removeEventListener("keypress",e),window.removeEventListener("mousemove",e),window.removeEventListener(Xd(),e),Ey&&(clearInterval(Ey),Ey=null)}function Ry(e,t){const{xmppstatus:s}=Iu.state,n=s.get("status");["away","chat","dnd","xa"].includes(n)&&t.c("show").t(n).up();const i=s.get("status_message");return i&&t.c("status").t(i).up(),t}const{Strophe:Dy,$pres:Ly}=qg.env;class zy extends Ip{constructor(e,t){super(e,t),this.vcard=null}defaults(){return{status:Oh.settings.get("default_state")}}get(e){return"jid"===e?Iu.session.get("bare_jid"):"nickname"===e?Oh.settings.get("nickname"):Ip.prototype.get.call(this,e)}set(e,t,s){if("jid"===e||"nickname"===e)throw new Error("Readonly property");return Ip.prototype.set.call(this,e,t,s)}initialize(){this.on("change",(e=>{e.changed instanceof Object&&("status"in e.changed||"status_message"in e.changed)&&Oh.user.presence.send(this.get("status"),null,this.get("status_message"))}))}getDisplayName(){return this.getFullname()||this.getNickname()||this.get("jid")}getNickname(){return Oh.settings.get("nickname")}getFullname(){return""}async constructPresence(e,t=null,s){let n;if(e="string"==typeof e?e:this.get("status")||Oh.settings.get("default_state"),s="string"==typeof s?s:this.get("status_message"),"subscribe"===e){n=Ly({to:t,type:e});const{xmppstatus:s}=Iu.state,i=s.getNickname();i&&n.c("nick",{xmlns:Dy.NS.NICK}).t(i).up()}else n="unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribed"===e?Ly({to:t,type:e}):"offline"===e?Ly({to:t,type:"unavailable"}):"online"===e?Ly({to:t}):Ly({to:t}).c("show").t(e).up();s&&n.c("status").t(s).up();const i=Oh.settings.get("priority");if(n.c("priority").t(Number.isNaN(Number(i))?0:i).up(),Cy){const e=new Date;e.setSeconds(e.getSeconds()-$y),n.c("idle",{xmlns:Dy.NS.IDLE,since:e.toISOString()})}return n=await Oh.hook("constructedPresence",null,n),n}}const{Strophe:Py}=qg.env;Py.addNamespace("IDLE","urn:xmpp:idle:1"),qg.plugins.add("converse-status",{initialize(){Oh.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,default_state:"online",idle_presence_timeout:300,priority:0}),Oh.promises.add(["statusInitialized"]);const e={XMPPStatus:zy,onUserActivity:jy,onEverySecond:Ny,sendCSI:Oy,registerIntervalHandler:Iy};Object.assign(Iu,e),Object.assign(Iu.exports,e),Object.assign(Iu.api.user,Wb),Oh.settings.get("idle_presence_timeout")>0&&Oh.listen.on("addClientFeatures",(()=>Oh.disco.own.features.add(Py.NS.IDLE))),Oh.listen.on("presencesInitialized",(e=>!e&&Iy())),Oh.listen.on("beforeTearDown",My),Oh.listen.on("clearSession",(()=>{Zd(Iu)&&Iu.state.xmppstatus&&(Iu.state.xmppstatus.destroy(),delete Iu.state.xmppstatus,Object.assign(Iu,{xmppstatus:void 0}),Oh.promises.add(["statusInitialized"]))})),Oh.listen.on("connected",(()=>xy(!1))),Oh.listen.on("reconnected",(()=>xy(!0))),Oh.listen.on("constructedMUCPresence",Ry)}});const{Strophe:Fy}=qg.env,Uy={contacts:{async get(e){await Oh.waitUntil("rosterContactsFetched");const{roster:t}=Iu.state,s=e=>t.get(Fy.getBareJidFromJid(e));if(void 0===e)e=t.pluck("jid");else if("string"==typeof e)return s(e);return e.map(s)},async add(e,t){if(await Oh.waitUntil("rosterContactsFetched"),"string"!=typeof e||!e.includes("@"))throw new TypeError("contacts.add: invalid jid");return Iu.state.roster.addAndSubscribe(e,t)}}};qg.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){Oh.settings.extend({allow_contact_requests:!0,auto_subscribe:!1,synchronize_availability:!0}),Oh.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized"]),Object.assign(Iu.api,Uy);const{__:e}=Iu,t={HEADER_CURRENT_CONTACTS:e("My contacts"),HEADER_PENDING_CONTACTS:e("Pending contacts"),HEADER_REQUESTING_CONTACTS:e("Contact requests"),HEADER_UNGROUPED:e("Ungrouped"),HEADER_UNREAD:e("New messages")};Object.assign(Iu,t),Object.assign(Iu.labels,t);const s={Presence:by,Presences:yy,RosterContact:cy,RosterContacts:my};Object.assign(Iu,s),Object.assign(Iu.exports,s),Oh.listen.on("beforeTearDown",(()=>Xb())),Oh.listen.on("chatBoxesInitialized",sy),Oh.listen.on("clearSession",Zb),Oh.listen.on("presencesInitialized",ey),Oh.listen.on("statusInitialized",ty),Oh.listen.on("streamResumptionFailed",(()=>Iu.session.set("roster_cached",!1))),Oh.waitUntil("rosterContactsFetched").then(ny)}});const{Strophe:By}=qg.env,qy=qg.env.utils;function Hy(){return!(Oh.connection.isType("bosh")&&!Yd())&&Oh.disco.stream.getFeature("sm",By.NS.SM)}function Gy(e){if(!Iu.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),s=Iu.session.get("num_stanzas_handled_by_server"),n=t-s;if(n<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${s}`;bt.error(e)}const i=Iu.session.get("unacked_stanzas");if(n>i.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${n} -Unacknowledged Stanza Count: ${i.length} -New: ${t} - Previous: ${s}`;bt.error(e)}return Iu.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:i.slice(n)}),!0}function Wy(){if(Iu.session.get("smacks_enabled")){const e=Iu.session.get("num_stanzas_handled"),t=qy.toStanza(`<a xmlns="${By.NS.SM}" h="${e}"/>`);Oh.send(t)}return!0}function Vy(e){if(Iu.session.get("smacks_enabled")&&(qy.isTagEqual(e,"iq")||qy.isTagEqual(e,"presence")||qy.isTagEqual(e,"message"))){const e=Iu.session.get("num_stanzas_handled");Iu.session.save("num_stanzas_handled",e+1)}return!0}function Qy(){Iu.session.save({smacks_enabled:Iu.session.get("smacks_enabled")||!1,num_stanzas_handled:Iu.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:Iu.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:Iu.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:Iu.session.get("unacked_stanzas")||[]})}function Jy(){Iu.session?.save({smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function Yy(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),Iu.session.save(t),!0}function Xy(e){if(Jy(),Oh.trigger("streamResumptionFailed"),e.querySelector("item-not-found"))bt.warn("Could not resume previous SMACKS session, session id not found. A new session will be established.");else{bt.error("Failed to enable stream management"),bt.error(e.outerHTML);Oh.connection.get()._changeConnectStatus(By.Status.DISCONNECTED,null)}return!0}function Ky(e){Yy(e),Gy(e),function(){const e=Iu.session.get("unacked_stanzas");Iu.session.save("unacked_stanzas",[]),e.forEach((e=>Oh.send(e)))}();const t=Oh.connection.get();t.do_bind=!1,t.authenticated=!0,t.restored=!0,t._changeConnectStatus(By.Status.CONNECTED,null)}async function Zy(){if(Oh.settings.get("enable_smacks")&&!Iu.session.get("smacks_enabled")&&await Hy()){const e=ic(),t=Oh.connection.get();t._addSysHandler((t=>e.resolve(Yy(t))),By.NS.SM,"enabled"),t._addSysHandler((t=>e.resolve(Xy(t))),By.NS.SM,"failed");const s=Oh.connection.isType("websocket")||Yd(),n=qy.toStanza(`<enable xmlns="${By.NS.SM}" resume="${s}"/>`);Oh.send(n),t.flush(),await e}}const ew=[];async function tw(){if(!Oh.settings.get("enable_smacks"))return;if(!await Hy())return;const e=Oh.connection.get();for(;ew.length;)e.deleteHandler(ew.pop());ew.push(e.addHandler(Vy)),ew.push(e.addHandler(Wy,By.NS.SM,"r")),ew.push(e.addHandler(Gy,By.NS.SM,"a")),Iu.session?.get("smacks_stream_id")?await async function(){const e=ic(),t=Oh.connection.get();t._addSysHandler((t=>e.resolve(Ky(t))),By.NS.SM,"resumed"),t._addSysHandler((t=>e.resolve(Xy(t))),By.NS.SM,"failed");const s=Iu.session.get("smacks_stream_id"),n=Iu.session.get("num_stanzas_handled"),i=qy.toStanza(`<resume xmlns="${By.NS.SM}" h="${n}" previd="${s}"/>`);Oh.send(i),t.flush(),await e}():Jy()}function sw(e){if(Iu.session){if(Iu.session.get("smacks_enabled")&&(qy.isTagEqual(e,"iq")||qy.isTagEqual(e,"presence")||qy.isTagEqual(e,"message"))){const t=By.serialize(e);Iu.session.save("unacked_stanzas",(Iu.session.get("unacked_stanzas")||[]).concat([t]));const s=Oh.settings.get("smacks_max_unacked_stanzas");if(s>0){const e=Iu.session.get("num_stanzas_since_last_ack")+1;e%s==0&&Oh.send(qy.toStanza(`<r xmlns="${By.NS.SM}"/>`)),Iu.session.save({num_stanzas_since_last_ack:e})}}}else bt.warn("No _converse.session!")}const{Strophe:nw}=qg.env;nw.addNamespace("SM","urn:xmpp:sm:3"),qg.plugins.add("converse-smacks",{initialize(){Oh.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),Oh.listen.on("afterResourceBinding",Zy),Oh.listen.on("beforeResourceBinding",tw),Oh.listen.on("send",sw),Oh.listen.on("userSessionInitialized",Qy)}});const iw=class extends cd{get idAttribute(){return"jid"}getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}},{Strophe:rw,$iq:ow,u:aw}=qg.env;function cw(e,t,s){const n=ow(t?{type:e,to:t}:{type:e});return s?n.cnode(s):n.c("vCard",{xmlns:rw.NS.VCARD}),n}function lw(e){const t=e.get("image_hash"),s=[];e.get("jid")&&s.push(Iu.state.vcards.get(e.get("jid"))),s.push(Iu.state.vcards.get(e.get("from"))),s.forEach((e=>t&&e&&e?.get("image_hash")!==t&&Oh.vcard.update(e,!0)))}async function dw(e){let t;if(e instanceof Iu.exports.Message){if(["error","info"].includes(e.get("type")))return;t=e.get("from")}else t=e.get("jid");if(!t)return void bt.warn("Could not set VCard on model because no JID found!");await Oh.waitUntil("VCardsInitialized");const{vcards:s}=Iu.state;e.vcard=s.get(t)||s.create({jid:t}),e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")}async function uw(e){await Oh.waitUntil("VCardsInitialized"),e.vcard=function(e){const{vcards:t,xmppstatus:s}=Iu.state,n=e?.collection?.chatroom,i=e.get("nick");if(i&&n?.get("nick")===i)return s.vcard;{const s=e.get("jid")||e.get("from");return s?t.get(s)||t.create({jid:s}):void bt.warn("Could not get VCard for occupant because no JID found!")}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add"))}async function hw(e){["error","info"].includes(e.get("type"))||(await Oh.waitUntil("VCardsInitialized"),e.vcard=function(e){const{vcards:t,xmppstatus:s}=Iu.state,n=e?.collection?.chatbox,i=rw.getResourceFromJid(e.get("from"));if(i&&n?.get("nick")===i)return s.vcard;{const s=e.occupant?.get("jid")||e.get("from");return s?t.get(s)||t.create({jid:s}):void bt.warn(`Could not get VCard for message because no JID found! msgid: ${e.get("msgid")}`)}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")))}async function mw(){const e=new Iu.exports.VCards;Iu.state.vcards=e,Object.assign(Iu,{vcards:e});const t=Iu.session.get("bare_jid");Hu(e,`${t}-converse.vcards`),await new Promise((t=>{e.fetch({success:t,error:t},{silent:!0})}));const{xmppstatus:s}=Iu.state;s.vcard=e.get(t)||e.create({jid:t}),s.vcard&&(s.vcard.on("change",(()=>s.trigger("vcard:change"))),s.trigger("vcard:add")),Oh.trigger("VCardsInitialized")}async function fw(e){const t=Iu.session.get("bare_jid"),s=rw.getBareJidFromJid(e)===t?null:e;let n;try{n=await Oh.sendIQ(cw("get",s))}catch(t){return{jid:e,stanza:dt(t)?t:null,error:dt(t)?null:t,vcard_error:(new Date).toISOString()}}return async function(e){const t=e.querySelector("vCard");let s={};if(null!==t&&(s={stanza:e,fullname:t.querySelector("FN")?.textContent,nickname:t.querySelector("NICKNAME")?.textContent,image:t.querySelector("PHOTO BINVAL")?.textContent,image_type:t.querySelector("PHOTO TYPE")?.textContent,url:t.querySelector("URL")?.textContent,role:t.querySelector("ROLE")?.textContent,email:t.querySelector("EMAIL USERID")?.textContent,vcard_updated:(new Date).toISOString(),vcard_error:void 0,image_hash:void 0}),s.image){const e=aw.base64ToArrayBuffer(s.image),t=await crypto.subtle.digest("SHA-1",e);s.image_hash=aw.arrayBufferToHex(t)}return s}(n)}const{dayjs:gw,u:pw}=qg.env,vw={vcard:{async set(e,t){if(!e)throw Error("No jid provided for the VCard data");const s=document.createElement("div"),n=pw.toStanza(`\n                <vCard xmlns="vcard-temp">\n                    <FN>${t.fn}</FN>\n                    <NICKNAME>${t.nickname}</NICKNAME>\n                    <URL>${t.url}</URL>\n                    <ROLE>${t.role}</ROLE>\n                    <EMAIL><INTERNET/><PREF/><USERID>${t.email}</USERID></EMAIL>\n                    <PHOTO>\n                        <TYPE>${t.image_type}</TYPE>\n                        <BINVAL>${t.image}</BINVAL>\n                    </PHOTO>\n                </vCard>`,s);let i;try{i=await Oh.sendIQ(cw("set",e,n))}catch(e){throw e}return await Oh.vcard.update(e,!0),i},get(e,t){if("string"==typeof e)return fw(e);const s=e.get("vcard_error"),n=s&&gw(s).isSame(new Date,"day");if(t||!e.get("vcard_updated")&&!n){const t=e.get("jid");return t||bt.error("No JID to get vcard for"),fw(t)}return Promise.resolve({})},async update(e,t){const s=await this.get(e,t);(e="string"==typeof e?Iu.state.vcards.get(e):e)?Object.keys(s).length&&(delete s.stanza,e.save(s)):bt.error(`Could not find a VCard model for ${e}`)}}};const _w=class extends Od{constructor(){super(),this.model=iw}initialize(){this.on("add",(e=>e.get("jid")&&vw.vcard.update(e)))}},{Strophe:bw}=qg.env;qg.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],overrides:{XMPPStatus:{getNickname(){const{_converse:e}=this.__super__,t=this.__super__.getNickname.apply(this);return!t&&e.state.xmppstatus.vcard?e.state.xmppstatus.vcard.get("nickname"):t},getFullname(){const{_converse:e}=this.__super__,t=this.__super__.getFullname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("fullname"):t}},RosterContact:{getDisplayName(){return!this.get("nickname")&&this.vcard?this.vcard.getDisplayName():this.__super__.getDisplayName.apply(this)},getFullname(){return this.vcard?this.vcard.get("fullname"):this.__super__.getFullname.apply(this)}}},initialize(){Oh.promises.add("VCardsInitialized");const e={VCard:iw,VCards:_w};Object.assign(Iu,e),Object.assign(Iu.exports,e),Oh.listen.on("chatRoomInitialized",(e=>{dw(e),e.occupants.forEach(uw),e.listenTo(e.occupants,"add",uw),e.listenTo(e.occupants,"change:image_hash",(e=>lw(e)))})),Oh.listen.on("chatBoxInitialized",(e=>dw(e))),Oh.listen.on("chatRoomMessageInitialized",(e=>hw(e))),Oh.listen.on("addClientFeatures",(()=>Oh.disco.own.features.add(bw.NS.VCARD))),Oh.listen.on("clearSession",(()=>{Zd(Iu)&&(Oh.promises.add("VCardsInitialized"),Iu.state.vcards&&(Iu.state.vcards.clearStore(),Object.assign(Iu,{vcards:void 0}),delete Iu.state.vcards))})),Oh.listen.on("messageInitialized",(e=>dw(e))),Oh.listen.on("rosterContactInitialized",(e=>dw(e))),Oh.listen.on("statusInitialized",mw),Object.assign(Iu.api,vw)}}),R().extend(L());const yw=Object.assign({},c,p);Object.assign(Iu.constants,yw);const{dayjs:ww}=qg.env;let Aw,Sw="en";function xw(e,t){return t.includes(e)}function Ew(e,t){if("en"===e||t(e))return e;const{languages:s}=window.navigator;let n;for(let e=0;e<s.length&&!n;e++)n=$w(s[e],t);return n||"en"}function $w(e,t){if(t(e))return e;var s=e.split("-")[0];return s!==e&&t(s)?s:void 0}const Cw=Object.assign(wt,{getLocale:()=>Sw,translate(e,t){if(!Aw)return I().sprintf.apply(I(),arguments);const s=Aw.translate(e);return arguments.length>1?s.fetch.apply(s,t):s.fetch()},async initialize(){if(Sm.isTestEnv())Sw="en";else try{const e=Oh.settings.get("i18n"),t=Oh.settings.get("locales");Sw=Ew(e,(e=>xw(e,t))),Aw=await async function(){const e=function(e){const t=e.toLowerCase().replace("_","-");return"ug"===t?"ug-cn":t}(Sw);if(!xw(Sw,Oh.settings.get("locales"))||"en"===Sw)return;const{default:t}=await s(3883)(`./${Sw}/LC_MESSAGES/converse.po`);return await s(9499)(`./${e}.js`),ww.locale(Ew(e,(e=>ww.locale(e)))),new(I())(t)}()}catch(e){bt.fatal(e.message),Sw="en"}},__:(e,...t)=>Cw.translate(e,t)}),kw=Cw.__,Tw={},jw={registry:Tw,define(e,t){this.registry[e]=t},register(){Object.keys(Tw).forEach((e=>{customElements.get(e)||customElements.define(e,Tw[e])}))}};Object.assign(Oh,{elements:jw});class Nw extends(_i(Fg)){createRenderRoot(){return this}initialize(){return null}connectedCallback(){return super.connectedCallback(),this.initialize()}disconnectedCallback(){super.disconnectedCallback(),this.stopListening()}}const Ow=["converse-adhoc-views","converse-bookmark-views","converse-chatboxviews","converse-chatview","converse-controlbox","converse-dragresize","converse-fullscreen","converse-headlines-view","converse-mam-views","converse-minimize","converse-modal","converse-muc-views","converse-notification","converse-omemo","converse-profile","converse-push","converse-register","converse-roomslist","converse-rootview","converse-rosterview","converse-singleton"];var Iw="top",Mw="bottom",Rw="right",Dw="left",Lw="auto",zw=[Iw,Mw,Rw,Dw],Pw="start",Fw="end",Uw="clippingParents",Bw="viewport",qw="popper",Hw="reference",Gw=zw.reduce((function(e,t){return e.concat([t+"-"+Pw,t+"-"+Fw])}),[]),Ww=[].concat(zw,[Lw]).reduce((function(e,t){return e.concat([t,t+"-"+Pw,t+"-"+Fw])}),[]),Vw="beforeRead",Qw="read",Jw="afterRead",Yw="beforeMain",Xw="main",Kw="afterMain",Zw="beforeWrite",eA="write",tA="afterWrite",sA=[Vw,Qw,Jw,Yw,Xw,Kw,Zw,eA,tA];function nA(e){return e?(e.nodeName||"").toLowerCase():null}function iA(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function rA(e){return e instanceof iA(e).Element||e instanceof Element}function oA(e){return e instanceof iA(e).HTMLElement||e instanceof HTMLElement}function aA(e){return"undefined"!=typeof ShadowRoot&&(e instanceof iA(e).ShadowRoot||e instanceof ShadowRoot)}const cA={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var s=t.styles[e]||{},n=t.attributes[e]||{},i=t.elements[e];oA(i)&&nA(i)&&(Object.assign(i.style,s),Object.keys(n).forEach((function(e){var t=n[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach((function(e){var n=t.elements[e],i=t.attributes[e]||{},r=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:s[e]).reduce((function(e,t){return e[t]="",e}),{});oA(n)&&nA(n)&&(Object.assign(n.style,r),Object.keys(i).forEach((function(e){n.removeAttribute(e)})))}))}},requires:["computeStyles"]};function lA(e){return e.split("-")[0]}var dA=Math.max,uA=Math.min,hA=Math.round;function mA(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function fA(){return!/^((?!chrome|android).)*safari/i.test(mA())}function gA(e,t,s){void 0===t&&(t=!1),void 0===s&&(s=!1);var n=e.getBoundingClientRect(),i=1,r=1;t&&oA(e)&&(i=e.offsetWidth>0&&hA(n.width)/e.offsetWidth||1,r=e.offsetHeight>0&&hA(n.height)/e.offsetHeight||1);var o=(rA(e)?iA(e):window).visualViewport,a=!fA()&&s,c=(n.left+(a&&o?o.offsetLeft:0))/i,l=(n.top+(a&&o?o.offsetTop:0))/r,d=n.width/i,u=n.height/r;return{width:d,height:u,top:l,right:c+d,bottom:l+u,left:c,x:c,y:l}}function pA(e){var t=gA(e),s=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:s,height:n}}function vA(e,t){var s=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(s&&aA(s)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function _A(e){return iA(e).getComputedStyle(e)}function bA(e){return["table","td","th"].indexOf(nA(e))>=0}function yA(e){return((rA(e)?e.ownerDocument:e.document)||window.document).documentElement}function wA(e){return"html"===nA(e)?e:e.assignedSlot||e.parentNode||(aA(e)?e.host:null)||yA(e)}function AA(e){return oA(e)&&"fixed"!==_A(e).position?e.offsetParent:null}function SA(e){for(var t=iA(e),s=AA(e);s&&bA(s)&&"static"===_A(s).position;)s=AA(s);return s&&("html"===nA(s)||"body"===nA(s)&&"static"===_A(s).position)?t:s||function(e){var t=/firefox/i.test(mA());if(/Trident/i.test(mA())&&oA(e)&&"fixed"===_A(e).position)return null;var s=wA(e);for(aA(s)&&(s=s.host);oA(s)&&["html","body"].indexOf(nA(s))<0;){var n=_A(s);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||t&&"filter"===n.willChange||t&&n.filter&&"none"!==n.filter)return s;s=s.parentNode}return null}(e)||t}function xA(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function EA(e,t,s){return dA(e,uA(t,s))}function $A(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function CA(e,t){return t.reduce((function(t,s){return t[s]=e,t}),{})}const kA={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,s=e.state,n=e.name,i=e.options,r=s.elements.arrow,o=s.modifiersData.popperOffsets,a=lA(s.placement),c=xA(a),l=[Dw,Rw].indexOf(a)>=0?"height":"width";if(r&&o){var d=function(e,t){return $A("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:CA(e,zw))}(i.padding,s),u=pA(r),h="y"===c?Iw:Dw,m="y"===c?Mw:Rw,f=s.rects.reference[l]+s.rects.reference[c]-o[c]-s.rects.popper[l],g=o[c]-s.rects.reference[c],p=SA(r),v=p?"y"===c?p.clientHeight||0:p.clientWidth||0:0,_=f/2-g/2,b=d[h],y=v-u[l]-d[m],w=v/2-u[l]/2+_,A=EA(b,w,y),S=c;s.modifiersData[n]=((t={})[S]=A,t.centerOffset=A-w,t)}},effect:function(e){var t=e.state,s=e.options.element,n=void 0===s?"[data-popper-arrow]":s;null!=n&&("string"!=typeof n||(n=t.elements.popper.querySelector(n)))&&vA(t.elements.popper,n)&&(t.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function TA(e){return e.split("-")[1]}var jA={top:"auto",right:"auto",bottom:"auto",left:"auto"};function NA(e){var t,s=e.popper,n=e.popperRect,i=e.placement,r=e.variation,o=e.offsets,a=e.position,c=e.gpuAcceleration,l=e.adaptive,d=e.roundOffsets,u=e.isFixed,h=o.x,m=void 0===h?0:h,f=o.y,g=void 0===f?0:f,p="function"==typeof d?d({x:m,y:g}):{x:m,y:g};m=p.x,g=p.y;var v=o.hasOwnProperty("x"),_=o.hasOwnProperty("y"),b=Dw,y=Iw,w=window;if(l){var A=SA(s),S="clientHeight",x="clientWidth";if(A===iA(s)&&"static"!==_A(A=yA(s)).position&&"absolute"===a&&(S="scrollHeight",x="scrollWidth"),i===Iw||(i===Dw||i===Rw)&&r===Fw)y=Mw,g-=(u&&A===w&&w.visualViewport?w.visualViewport.height:A[S])-n.height,g*=c?1:-1;if(i===Dw||(i===Iw||i===Mw)&&r===Fw)b=Rw,m-=(u&&A===w&&w.visualViewport?w.visualViewport.width:A[x])-n.width,m*=c?1:-1}var E,$=Object.assign({position:a},l&&jA),C=!0===d?function(e,t){var s=e.x,n=e.y,i=t.devicePixelRatio||1;return{x:hA(s*i)/i||0,y:hA(n*i)/i||0}}({x:m,y:g},iA(s)):{x:m,y:g};return m=C.x,g=C.y,c?Object.assign({},$,((E={})[y]=_?"0":"",E[b]=v?"0":"",E.transform=(w.devicePixelRatio||1)<=1?"translate("+m+"px, "+g+"px)":"translate3d("+m+"px, "+g+"px, 0)",E)):Object.assign({},$,((t={})[y]=_?g+"px":"",t[b]=v?m+"px":"",t.transform="",t))}const OA={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,s=e.options,n=s.gpuAcceleration,i=void 0===n||n,r=s.adaptive,o=void 0===r||r,a=s.roundOffsets,c=void 0===a||a,l={placement:lA(t.placement),variation:TA(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,NA(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,NA(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var IA={passive:!0};const MA={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,s=e.instance,n=e.options,i=n.scroll,r=void 0===i||i,o=n.resize,a=void 0===o||o,c=iA(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&l.forEach((function(e){e.addEventListener("scroll",s.update,IA)})),a&&c.addEventListener("resize",s.update,IA),function(){r&&l.forEach((function(e){e.removeEventListener("scroll",s.update,IA)})),a&&c.removeEventListener("resize",s.update,IA)}},data:{}};var RA={left:"right",right:"left",bottom:"top",top:"bottom"};function DA(e){return e.replace(/left|right|bottom|top/g,(function(e){return RA[e]}))}var LA={start:"end",end:"start"};function zA(e){return e.replace(/start|end/g,(function(e){return LA[e]}))}function PA(e){var t=iA(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function FA(e){return gA(yA(e)).left+PA(e).scrollLeft}function UA(e){var t=_A(e),s=t.overflow,n=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+i+n)}function BA(e){return["html","body","#document"].indexOf(nA(e))>=0?e.ownerDocument.body:oA(e)&&UA(e)?e:BA(wA(e))}function qA(e,t){var s;void 0===t&&(t=[]);var n=BA(e),i=n===(null==(s=e.ownerDocument)?void 0:s.body),r=iA(n),o=i?[r].concat(r.visualViewport||[],UA(n)?n:[]):n,a=t.concat(o);return i?a:a.concat(qA(wA(o)))}function HA(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function GA(e,t,s){return t===Bw?HA(function(e,t){var s=iA(e),n=yA(e),i=s.visualViewport,r=n.clientWidth,o=n.clientHeight,a=0,c=0;if(i){r=i.width,o=i.height;var l=fA();(l||!l&&"fixed"===t)&&(a=i.offsetLeft,c=i.offsetTop)}return{width:r,height:o,x:a+FA(e),y:c}}(e,s)):rA(t)?function(e,t){var s=gA(e,!1,"fixed"===t);return s.top=s.top+e.clientTop,s.left=s.left+e.clientLeft,s.bottom=s.top+e.clientHeight,s.right=s.left+e.clientWidth,s.width=e.clientWidth,s.height=e.clientHeight,s.x=s.left,s.y=s.top,s}(t,s):HA(function(e){var t,s=yA(e),n=PA(e),i=null==(t=e.ownerDocument)?void 0:t.body,r=dA(s.scrollWidth,s.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=dA(s.scrollHeight,s.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-n.scrollLeft+FA(e),c=-n.scrollTop;return"rtl"===_A(i||s).direction&&(a+=dA(s.clientWidth,i?i.clientWidth:0)-r),{width:r,height:o,x:a,y:c}}(yA(e)))}function WA(e,t,s,n){var i="clippingParents"===t?function(e){var t=qA(wA(e)),s=["absolute","fixed"].indexOf(_A(e).position)>=0&&oA(e)?SA(e):e;return rA(s)?t.filter((function(e){return rA(e)&&vA(e,s)&&"body"!==nA(e)})):[]}(e):[].concat(t),r=[].concat(i,[s]),o=r[0],a=r.reduce((function(t,s){var i=GA(e,s,n);return t.top=dA(i.top,t.top),t.right=uA(i.right,t.right),t.bottom=uA(i.bottom,t.bottom),t.left=dA(i.left,t.left),t}),GA(e,o,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function VA(e){var t,s=e.reference,n=e.element,i=e.placement,r=i?lA(i):null,o=i?TA(i):null,a=s.x+s.width/2-n.width/2,c=s.y+s.height/2-n.height/2;switch(r){case Iw:t={x:a,y:s.y-n.height};break;case Mw:t={x:a,y:s.y+s.height};break;case Rw:t={x:s.x+s.width,y:c};break;case Dw:t={x:s.x-n.width,y:c};break;default:t={x:s.x,y:s.y}}var l=r?xA(r):null;if(null!=l){var d="y"===l?"height":"width";switch(o){case Pw:t[l]=t[l]-(s[d]/2-n[d]/2);break;case Fw:t[l]=t[l]+(s[d]/2-n[d]/2)}}return t}function QA(e,t){void 0===t&&(t={});var s=t,n=s.placement,i=void 0===n?e.placement:n,r=s.strategy,o=void 0===r?e.strategy:r,a=s.boundary,c=void 0===a?Uw:a,l=s.rootBoundary,d=void 0===l?Bw:l,u=s.elementContext,h=void 0===u?qw:u,m=s.altBoundary,f=void 0!==m&&m,g=s.padding,p=void 0===g?0:g,v=$A("number"!=typeof p?p:CA(p,zw)),_=h===qw?Hw:qw,b=e.rects.popper,y=e.elements[f?_:h],w=WA(rA(y)?y:y.contextElement||yA(e.elements.popper),c,d,o),A=gA(e.elements.reference),S=VA({reference:A,element:b,strategy:"absolute",placement:i}),x=HA(Object.assign({},b,S)),E=h===qw?x:A,$={top:w.top-E.top+v.top,bottom:E.bottom-w.bottom+v.bottom,left:w.left-E.left+v.left,right:E.right-w.right+v.right},C=e.modifiersData.offset;if(h===qw&&C){var k=C[i];Object.keys($).forEach((function(e){var t=[Rw,Mw].indexOf(e)>=0?1:-1,s=[Iw,Mw].indexOf(e)>=0?"y":"x";$[e]+=k[s]*t}))}return $}const JA={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,s=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var i=s.mainAxis,r=void 0===i||i,o=s.altAxis,a=void 0===o||o,c=s.fallbackPlacements,l=s.padding,d=s.boundary,u=s.rootBoundary,h=s.altBoundary,m=s.flipVariations,f=void 0===m||m,g=s.allowedAutoPlacements,p=t.options.placement,v=lA(p),_=c||(v===p||!f?[DA(p)]:function(e){if(lA(e)===Lw)return[];var t=DA(e);return[zA(e),t,zA(t)]}(p)),b=[p].concat(_).reduce((function(e,s){return e.concat(lA(s)===Lw?function(e,t){void 0===t&&(t={});var s=t,n=s.placement,i=s.boundary,r=s.rootBoundary,o=s.padding,a=s.flipVariations,c=s.allowedAutoPlacements,l=void 0===c?Ww:c,d=TA(n),u=d?a?Gw:Gw.filter((function(e){return TA(e)===d})):zw,h=u.filter((function(e){return l.indexOf(e)>=0}));0===h.length&&(h=u);var m=h.reduce((function(t,s){return t[s]=QA(e,{placement:s,boundary:i,rootBoundary:r,padding:o})[lA(s)],t}),{});return Object.keys(m).sort((function(e,t){return m[e]-m[t]}))}(t,{placement:s,boundary:d,rootBoundary:u,padding:l,flipVariations:f,allowedAutoPlacements:g}):s)}),[]),y=t.rects.reference,w=t.rects.popper,A=new Map,S=!0,x=b[0],E=0;E<b.length;E++){var $=b[E],C=lA($),k=TA($)===Pw,T=[Iw,Mw].indexOf(C)>=0,j=T?"width":"height",N=QA(t,{placement:$,boundary:d,rootBoundary:u,altBoundary:h,padding:l}),O=T?k?Rw:Dw:k?Mw:Iw;y[j]>w[j]&&(O=DA(O));var I=DA(O),M=[];if(r&&M.push(N[C]<=0),a&&M.push(N[O]<=0,N[I]<=0),M.every((function(e){return e}))){x=$,S=!1;break}A.set($,M)}if(S)for(var R=function(e){var t=b.find((function(t){var s=A.get(t);if(s)return s.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},D=f?3:1;D>0;D--){if("break"===R(D))break}t.placement!==x&&(t.modifiersData[n]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function YA(e,t,s){return void 0===s&&(s={x:0,y:0}),{top:e.top-t.height-s.y,right:e.right-t.width+s.x,bottom:e.bottom-t.height+s.y,left:e.left-t.width-s.x}}function XA(e){return[Iw,Rw,Mw,Dw].some((function(t){return e[t]>=0}))}const KA={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,s=e.name,n=t.rects.reference,i=t.rects.popper,r=t.modifiersData.preventOverflow,o=QA(t,{elementContext:"reference"}),a=QA(t,{altBoundary:!0}),c=YA(o,n),l=YA(a,i,r),d=XA(c),u=XA(l);t.modifiersData[s]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}};const ZA={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,s=e.options,n=e.name,i=s.offset,r=void 0===i?[0,0]:i,o=Ww.reduce((function(e,s){return e[s]=function(e,t,s){var n=lA(e),i=[Dw,Iw].indexOf(n)>=0?-1:1,r="function"==typeof s?s(Object.assign({},t,{placement:e})):s,o=r[0],a=r[1];return o=o||0,a=(a||0)*i,[Dw,Rw].indexOf(n)>=0?{x:a,y:o}:{x:o,y:a}}(s,t.rects,r),e}),{}),a=o[t.placement],c=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[n]=o}};const eS={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,s=e.name;t.modifiersData[s]=VA({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};const tS={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,s=e.options,n=e.name,i=s.mainAxis,r=void 0===i||i,o=s.altAxis,a=void 0!==o&&o,c=s.boundary,l=s.rootBoundary,d=s.altBoundary,u=s.padding,h=s.tether,m=void 0===h||h,f=s.tetherOffset,g=void 0===f?0:f,p=QA(t,{boundary:c,rootBoundary:l,padding:u,altBoundary:d}),v=lA(t.placement),_=TA(t.placement),b=!_,y=xA(v),w="x"===y?"y":"x",A=t.modifiersData.popperOffsets,S=t.rects.reference,x=t.rects.popper,E="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,$="number"==typeof E?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,k={x:0,y:0};if(A){if(r){var T,j="y"===y?Iw:Dw,N="y"===y?Mw:Rw,O="y"===y?"height":"width",I=A[y],M=I+p[j],R=I-p[N],D=m?-x[O]/2:0,L=_===Pw?S[O]:x[O],z=_===Pw?-x[O]:-S[O],P=t.elements.arrow,F=m&&P?pA(P):{width:0,height:0},U=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},B=U[j],q=U[N],H=EA(0,S[O],F[O]),G=b?S[O]/2-D-H-B-$.mainAxis:L-H-B-$.mainAxis,W=b?-S[O]/2+D+H+q+$.mainAxis:z+H+q+$.mainAxis,V=t.elements.arrow&&SA(t.elements.arrow),Q=V?"y"===y?V.clientTop||0:V.clientLeft||0:0,J=null!=(T=null==C?void 0:C[y])?T:0,Y=I+W-J,X=EA(m?uA(M,I+G-J-Q):M,I,m?dA(R,Y):R);A[y]=X,k[y]=X-I}if(a){var K,Z="x"===y?Iw:Dw,ee="x"===y?Mw:Rw,te=A[w],se="y"===w?"height":"width",ne=te+p[Z],ie=te-p[ee],re=-1!==[Iw,Dw].indexOf(v),oe=null!=(K=null==C?void 0:C[w])?K:0,ae=re?ne:te-S[se]-x[se]-oe+$.altAxis,ce=re?te+S[se]+x[se]-oe-$.altAxis:ie,le=m&&re?function(e,t,s){var n=EA(e,t,s);return n>s?s:n}(ae,te,ce):EA(m?ae:ne,te,m?ce:ie);A[w]=le,k[w]=le-te}t.modifiersData[n]=k}},requiresIfExists:["offset"]};function sS(e,t,s){void 0===s&&(s=!1);var n,i,r=oA(t),o=oA(t)&&function(e){var t=e.getBoundingClientRect(),s=hA(t.width)/e.offsetWidth||1,n=hA(t.height)/e.offsetHeight||1;return 1!==s||1!==n}(t),a=yA(t),c=gA(e,o,s),l={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(r||!r&&!s)&&(("body"!==nA(t)||UA(a))&&(l=(n=t)!==iA(n)&&oA(n)?{scrollLeft:(i=n).scrollLeft,scrollTop:i.scrollTop}:PA(n)),oA(t)?((d=gA(t,!0)).x+=t.clientLeft,d.y+=t.clientTop):a&&(d.x=FA(a))),{x:c.left+l.scrollLeft-d.x,y:c.top+l.scrollTop-d.y,width:c.width,height:c.height}}function nS(e){var t=new Map,s=new Set,n=[];function i(e){s.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!s.has(e)){var n=t.get(e);n&&i(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){s.has(e.name)||i(e)})),n}var iS={placement:"bottom",modifiers:[],strategy:"absolute"};function rS(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function oS(e){void 0===e&&(e={});var t=e,s=t.defaultModifiers,n=void 0===s?[]:s,i=t.defaultOptions,r=void 0===i?iS:i;return function(e,t,s){void 0===s&&(s=r);var i,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},iS,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,d={state:a,setOptions:function(s){var i="function"==typeof s?s(a.options):s;u(),a.options=Object.assign({},r,a.options,i),a.scrollParents={reference:rA(e)?qA(e):e.contextElement?qA(e.contextElement):[],popper:qA(t)};var o,l,h=function(e){var t=nS(e);return sA.reduce((function(e,s){return e.concat(t.filter((function(e){return e.phase===s})))}),[])}((o=[].concat(n,a.options.modifiers),l=o.reduce((function(e,t){var s=e[t.name];return e[t.name]=s?Object.assign({},s,t,{options:Object.assign({},s.options,t.options),data:Object.assign({},s.data,t.data)}):t,e}),{}),Object.keys(l).map((function(e){return l[e]}))));return a.orderedModifiers=h.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,s=e.options,n=void 0===s?{}:s,i=e.effect;if("function"==typeof i){var r=i({state:a,name:t,instance:d,options:n}),o=function(){};c.push(r||o)}})),d.update()},forceUpdate:function(){if(!l){var e=a.elements,t=e.reference,s=e.popper;if(rS(t,s)){a.rects={reference:sS(t,SA(s),"fixed"===a.options.strategy),popper:pA(s)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0;n<a.orderedModifiers.length;n++)if(!0!==a.reset){var i=a.orderedModifiers[n],r=i.fn,o=i.options,c=void 0===o?{}:o,u=i.name;"function"==typeof r&&(a=r({state:a,options:c,name:u,instance:d})||a)}else a.reset=!1,n=-1}}},update:(i=function(){return new Promise((function(e){d.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(i())}))}))),o}),destroy:function(){u(),l=!0}};if(!rS(e,t))return d;function u(){c.forEach((function(e){return e()})),c=[]}return d.setOptions(s).then((function(e){!l&&s.onFirstUpdate&&s.onFirstUpdate(e)})),d}}var aS=oS(),cS=oS({defaultModifiers:[MA,eS,OA,cA,ZA,JA,tS,kA,KA]}),lS=oS({defaultModifiers:[MA,eS,OA,cA]});const dS=new Map,uS={set(e,t,s){dS.has(e)||dS.set(e,new Map);const n=dS.get(e);n.has(t)||0===n.size?n.set(t,s):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(n.keys())[0]}.`)},get:(e,t)=>dS.has(e)&&dS.get(e).get(t)||null,remove(e,t){if(!dS.has(e))return;const s=dS.get(e);s.delete(t),0===s.size&&dS.delete(e)}},hS="transitionend",mS=e=>(e&&window.CSS&&window.CSS.escape&&(e=e.replace(/#([^\s"#']+)/g,((e,t)=>`#${CSS.escape(t)}`))),e),fS=e=>{e.dispatchEvent(new Event(hS))},gS=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),pS=e=>gS(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(mS(e)):null,vS=e=>{if(!gS(e)||0===e.getClientRects().length)return!1;const t="visible"===getComputedStyle(e).getPropertyValue("visibility"),s=e.closest("details:not([open])");if(!s)return t;if(s!==e){const t=e.closest("summary");if(t&&t.parentNode!==s)return!1;if(null===t)return!1}return t},_S=e=>!e||e.nodeType!==Node.ELEMENT_NODE||(!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled"))),bS=e=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof e.getRootNode){const t=e.getRootNode();return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?bS(e.parentNode):null},yS=()=>{},wS=e=>{e.offsetHeight},AS=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,SS=[],xS=()=>"rtl"===document.documentElement.dir,ES=e=>{var t;t=()=>{const t=AS();if(t){const s=e.NAME,n=t.fn[s];t.fn[s]=e.jQueryInterface,t.fn[s].Constructor=e,t.fn[s].noConflict=()=>(t.fn[s]=n,e.jQueryInterface)}},"loading"===document.readyState?(SS.length||document.addEventListener("DOMContentLoaded",(()=>{for(const e of SS)e()})),SS.push(t)):t()},$S=(e,t=[],s=e)=>"function"==typeof e?e(...t):s,CS=(e,t,s=!0)=>{if(!s)return void $S(e);const n=(e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:s}=window.getComputedStyle(e);const n=Number.parseFloat(t),i=Number.parseFloat(s);return n||i?(t=t.split(",")[0],s=s.split(",")[0],1e3*(Number.parseFloat(t)+Number.parseFloat(s))):0})(t)+5;let i=!1;const r=({target:s})=>{s===t&&(i=!0,t.removeEventListener(hS,r),$S(e))};t.addEventListener(hS,r),setTimeout((()=>{i||fS(t)}),n)},kS=(e,t,s,n)=>{const i=e.length;let r=e.indexOf(t);return-1===r?!s&&n?e[i-1]:e[0]:(r+=s?1:-1,n&&(r=(r+i)%i),e[Math.max(0,Math.min(r,i-1))])},TS=/[^.]*(?=\..*)\.|.*/,jS=/\..*/,NS=/::\d+$/,OS={};let IS=1;const MS={mouseenter:"mouseover",mouseleave:"mouseout"},RS=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function DS(e,t){return t&&`${t}::${IS++}`||e.uidEvent||IS++}function LS(e){const t=DS(e);return e.uidEvent=t,OS[t]=OS[t]||{},OS[t]}function zS(e,t,s=null){return Object.values(e).find((e=>e.callable===t&&e.delegationSelector===s))}function PS(e,t,s){const n="string"==typeof t,i=n?s:t||s;let r=qS(e);return RS.has(r)||(r=e),[n,i,r]}function FS(e,t,s,n,i){if("string"!=typeof t||!e)return;let[r,o,a]=PS(t,s,n);if(t in MS){const e=e=>function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)};o=e(o)}const c=LS(e),l=c[a]||(c[a]={}),d=zS(l,o,r?s:null);if(d)return void(d.oneOff=d.oneOff&&i);const u=DS(o,t.replace(TS,"")),h=r?function(e,t,s){return function n(i){const r=e.querySelectorAll(t);for(let{target:o}=i;o&&o!==this;o=o.parentNode)for(const a of r)if(a===o)return GS(i,{delegateTarget:o}),n.oneOff&&HS.off(e,i.type,t,s),s.apply(o,[i])}}(e,s,o):function(e,t){return function s(n){return GS(n,{delegateTarget:e}),s.oneOff&&HS.off(e,n.type,t),t.apply(e,[n])}}(e,o);h.delegationSelector=r?s:null,h.callable=o,h.oneOff=i,h.uidEvent=u,l[u]=h,e.addEventListener(a,h,r)}function US(e,t,s,n,i){const r=zS(t[s],n,i);r&&(e.removeEventListener(s,r,Boolean(i)),delete t[s][r.uidEvent])}function BS(e,t,s,n){const i=t[s]||{};for(const[r,o]of Object.entries(i))r.includes(n)&&US(e,t,s,o.callable,o.delegationSelector)}function qS(e){return e=e.replace(jS,""),MS[e]||e}const HS={on(e,t,s,n){FS(e,t,s,n,!1)},one(e,t,s,n){FS(e,t,s,n,!0)},off(e,t,s,n){if("string"!=typeof t||!e)return;const[i,r,o]=PS(t,s,n),a=o!==t,c=LS(e),l=c[o]||{},d=t.startsWith(".");if(void 0===r){if(d)for(const s of Object.keys(c))BS(e,c,s,t.slice(1));for(const[s,n]of Object.entries(l)){const i=s.replace(NS,"");a&&!t.includes(i)||US(e,c,o,n.callable,n.delegationSelector)}}else{if(!Object.keys(l).length)return;US(e,c,o,r,i?s:null)}},trigger(e,t,s){if("string"!=typeof t||!e)return null;const n=AS();let i=null,r=!0,o=!0,a=!1;t!==qS(t)&&n&&(i=n.Event(t,s),n(e).trigger(i),r=!i.isPropagationStopped(),o=!i.isImmediatePropagationStopped(),a=i.isDefaultPrevented());const c=GS(new Event(t,{bubbles:r,cancelable:!0}),s);return a&&c.preventDefault(),o&&e.dispatchEvent(c),c.defaultPrevented&&i&&i.preventDefault(),c}};function GS(e,t={}){for(const[s,n]of Object.entries(t))try{e[s]=n}catch(t){Object.defineProperty(e,s,{configurable:!0,get:()=>n})}return e}function WS(e){if("true"===e)return!0;if("false"===e)return!1;if(e===Number(e).toString())return Number(e);if(""===e||"null"===e)return null;if("string"!=typeof e)return e;try{return JSON.parse(decodeURIComponent(e))}catch(t){return e}}function VS(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}const QS={setDataAttribute(e,t,s){e.setAttribute(`data-bs-${VS(t)}`,s)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${VS(t)}`)},getDataAttributes(e){if(!e)return{};const t={},s=Object.keys(e.dataset).filter((e=>e.startsWith("bs")&&!e.startsWith("bsConfig")));for(const n of s){let s=n.replace(/^bs/,"");s=s.charAt(0).toLowerCase()+s.slice(1,s.length),t[s]=WS(e.dataset[n])}return t},getDataAttribute:(e,t)=>WS(e.getAttribute(`data-bs-${VS(t)}`))};class JS{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const s=gS(t)?QS.getDataAttribute(t,"config"):{};return{...this.constructor.Default,..."object"==typeof s?s:{},...gS(t)?QS.getDataAttributes(t):{},..."object"==typeof e?e:{}}}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[n,i]of Object.entries(t)){const t=e[n],r=gS(t)?"element":null==(s=t)?`${s}`:Object.prototype.toString.call(s).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(i).test(r))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${n}" provided type "${r}" but expected type "${i}".`)}var s}}class YS extends JS{constructor(e,t){super(),(e=pS(e))&&(this._element=e,this._config=this._getConfig(t),uS.set(this._element,this.constructor.DATA_KEY,this))}dispose(){uS.remove(this._element,this.constructor.DATA_KEY),HS.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,s=!0){CS(e,t,s)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return uS.get(pS(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,"object"==typeof t?t:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const XS=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let s=e.getAttribute("href");if(!s||!s.includes("#")&&!s.startsWith("."))return null;s.includes("#")&&!s.startsWith("#")&&(s=`#${s.split("#")[1]}`),t=s&&"#"!==s?s.trim():null}return t?t.split(",").map((e=>mS(e))).join(","):null},KS={find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter((e=>e.matches(t))),parents(e,t){const s=[];let n=e.parentNode.closest(t);for(;n;)s.push(n),n=n.parentNode.closest(t);return s},prev(e,t){let s=e.previousElementSibling;for(;s;){if(s.matches(t))return[s];s=s.previousElementSibling}return[]},next(e,t){let s=e.nextElementSibling;for(;s;){if(s.matches(t))return[s];s=s.nextElementSibling}return[]},focusableChildren(e){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((e=>`${e}:not([tabindex^="-"])`)).join(",");return this.find(t,e).filter((e=>!_S(e)&&vS(e)))},getSelectorFromElement(e){const t=XS(e);return t&&KS.findOne(t)?t:null},getElementFromSelector(e){const t=XS(e);return t?KS.findOne(t):null},getMultipleElementsFromSelector(e){const t=XS(e);return t?KS.find(t):[]}},ZS=(e,t="hide")=>{const s=`click.dismiss${e.EVENT_KEY}`,n=e.NAME;HS.on(document,s,`[data-bs-dismiss="${n}"]`,(function(s){if(["A","AREA"].includes(this.tagName)&&s.preventDefault(),_S(this))return;const i=KS.getElementFromSelector(this)||this.closest(`.${n}`);e.getOrCreateInstance(i)[t]()}))},ex=".bs.alert",tx=`close${ex}`,sx=`closed${ex}`;class nx extends YS{static get NAME(){return"alert"}close(){if(HS.trigger(this._element,tx).defaultPrevented)return;this._element.classList.remove("show");const e=this._element.classList.contains("fade");this._queueCallback((()=>this._destroyElement()),this._element,e)}_destroyElement(){this._element.remove(),HS.trigger(this._element,sx),this.dispose()}static jQueryInterface(e){return this.each((function(){const t=nx.getOrCreateInstance(this);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e](this)}}))}}ZS(nx,"close"),ES(nx);const ix='[data-bs-toggle="button"]';class rx extends YS{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(e){return this.each((function(){const t=rx.getOrCreateInstance(this);"toggle"===e&&t[e]()}))}}HS.on(document,"click.bs.button.data-api",ix,(e=>{e.preventDefault();const t=e.target.closest(ix);rx.getOrCreateInstance(t).toggle()})),ES(rx);const ox=".bs.swipe",ax=`touchstart${ox}`,cx=`touchmove${ox}`,lx=`touchend${ox}`,dx=`pointerdown${ox}`,ux=`pointerup${ox}`,hx={endCallback:null,leftCallback:null,rightCallback:null},mx={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class fx extends JS{constructor(e,t){super(),this._element=e,e&&fx.isSupported()&&(this._config=this._getConfig(t),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return hx}static get DefaultType(){return mx}static get NAME(){return"swipe"}dispose(){HS.off(this._element,ox)}_start(e){this._supportPointerEvents?this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX):this._deltaX=e.touches[0].clientX}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),$S(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX);if(e<=40)return;const t=e/this._deltaX;this._deltaX=0,t&&$S(t>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(HS.on(this._element,dx,(e=>this._start(e))),HS.on(this._element,ux,(e=>this._end(e))),this._element.classList.add("pointer-event")):(HS.on(this._element,ax,(e=>this._start(e))),HS.on(this._element,cx,(e=>this._move(e))),HS.on(this._element,lx,(e=>this._end(e))))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&("pen"===e.pointerType||"touch"===e.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const gx=".bs.carousel",px=".data-api",vx="ArrowLeft",_x="ArrowRight",bx="next",yx="prev",wx="left",Ax="right",Sx=`slide${gx}`,xx=`slid${gx}`,Ex=`keydown${gx}`,$x=`mouseenter${gx}`,Cx=`mouseleave${gx}`,kx=`dragstart${gx}`,Tx=`load${gx}${px}`,jx=`click${gx}${px}`,Nx="carousel",Ox="active",Ix=".active",Mx=".carousel-item",Rx=Ix+Mx,Dx={[vx]:Ax,[_x]:wx},Lx={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},zx={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Px extends YS{constructor(e,t){super(e,t),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=KS.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===Nx&&this.cycle()}static get Default(){return Lx}static get DefaultType(){return zx}static get NAME(){return"carousel"}next(){this._slide(bx)}nextWhenVisible(){!document.hidden&&vS(this._element)&&this.next()}prev(){this._slide(yx)}pause(){this._isSliding&&fS(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval((()=>this.nextWhenVisible()),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?HS.one(this._element,xx,(()=>this.cycle())):this.cycle())}to(e){const t=this._getItems();if(e>t.length-1||e<0)return;if(this._isSliding)return void HS.one(this._element,xx,(()=>this.to(e)));const s=this._getItemIndex(this._getActive());if(s===e)return;const n=e>s?bx:yx;this._slide(n,t[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&HS.on(this._element,Ex,(e=>this._keydown(e))),"hover"===this._config.pause&&(HS.on(this._element,$x,(()=>this.pause())),HS.on(this._element,Cx,(()=>this._maybeEnableCycle()))),this._config.touch&&fx.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const e of KS.find(".carousel-item img",this._element))HS.on(e,kx,(e=>e.preventDefault()));const e={leftCallback:()=>this._slide(this._directionToOrder(wx)),rightCallback:()=>this._slide(this._directionToOrder(Ax)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((()=>this._maybeEnableCycle()),500+this._config.interval))}};this._swipeHelper=new fx(this._element,e)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const t=Dx[e.key];t&&(e.preventDefault(),this._slide(this._directionToOrder(t)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return;const t=KS.findOne(Ix,this._indicatorsElement);t.classList.remove(Ox),t.removeAttribute("aria-current");const s=KS.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement);s&&(s.classList.add(Ox),s.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive();if(!e)return;const t=Number.parseInt(e.getAttribute("data-bs-interval"),10);this._config.interval=t||this._config.defaultInterval}_slide(e,t=null){if(this._isSliding)return;const s=this._getActive(),n=e===bx,i=t||kS(this._getItems(),s,n,this._config.wrap);if(i===s)return;const r=this._getItemIndex(i),o=t=>HS.trigger(this._element,t,{relatedTarget:i,direction:this._orderToDirection(e),from:this._getItemIndex(s),to:r});if(o(Sx).defaultPrevented)return;if(!s||!i)return;const a=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(r),this._activeElement=i;const c=n?"carousel-item-start":"carousel-item-end",l=n?"carousel-item-next":"carousel-item-prev";i.classList.add(l),wS(i),s.classList.add(c),i.classList.add(c);this._queueCallback((()=>{i.classList.remove(c,l),i.classList.add(Ox),s.classList.remove(Ox,l,c),this._isSliding=!1,o(xx)}),s,this._isAnimated()),a&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return KS.findOne(Rx,this._element)}_getItems(){return KS.find(Mx,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return xS()?e===wx?yx:bx:e===wx?bx:yx}_orderToDirection(e){return xS()?e===yx?wx:Ax:e===yx?Ax:wx}static jQueryInterface(e){return this.each((function(){const t=Px.getOrCreateInstance(this,e);if("number"!=typeof e){if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}}else t.to(e)}))}}HS.on(document,jx,"[data-bs-slide], [data-bs-slide-to]",(function(e){const t=KS.getElementFromSelector(this);if(!t||!t.classList.contains(Nx))return;e.preventDefault();const s=Px.getOrCreateInstance(t),n=this.getAttribute("data-bs-slide-to");return n?(s.to(n),void s._maybeEnableCycle()):"next"===QS.getDataAttribute(this,"slide")?(s.next(),void s._maybeEnableCycle()):(s.prev(),void s._maybeEnableCycle())})),HS.on(window,Tx,(()=>{const e=KS.find('[data-bs-ride="carousel"]');for(const t of e)Px.getOrCreateInstance(t)})),ES(Px);const Fx=".bs.collapse",Ux=`show${Fx}`,Bx=`shown${Fx}`,qx=`hide${Fx}`,Hx=`hidden${Fx}`,Gx=`click${Fx}.data-api`,Wx="show",Vx="collapse",Qx="collapsing",Jx=`:scope .${Vx} .${Vx}`,Yx='[data-bs-toggle="collapse"]',Xx={parent:null,toggle:!0},Kx={parent:"(null|element)",toggle:"boolean"};class Zx extends YS{constructor(e,t){super(e,t),this._isTransitioning=!1,this._triggerArray=[];const s=KS.find(Yx);for(const e of s){const t=KS.getSelectorFromElement(e),s=KS.find(t).filter((e=>e===this._element));null!==t&&s.length&&this._triggerArray.push(e)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Xx}static get DefaultType(){return Kx}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[];if(this._config.parent&&(e=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter((e=>e!==this._element)).map((e=>Zx.getOrCreateInstance(e,{toggle:!1})))),e.length&&e[0]._isTransitioning)return;if(HS.trigger(this._element,Ux).defaultPrevented)return;for(const t of e)t.hide();const t=this._getDimension();this._element.classList.remove(Vx),this._element.classList.add(Qx),this._element.style[t]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const s=`scroll${t[0].toUpperCase()+t.slice(1)}`;this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(Qx),this._element.classList.add(Vx,Wx),this._element.style[t]="",HS.trigger(this._element,Bx)}),this._element,!0),this._element.style[t]=`${this._element[s]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(HS.trigger(this._element,qx).defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,wS(this._element),this._element.classList.add(Qx),this._element.classList.remove(Vx,Wx);for(const e of this._triggerArray){const t=KS.getElementFromSelector(e);t&&!this._isShown(t)&&this._addAriaAndCollapsedClass([e],!1)}this._isTransitioning=!0;this._element.style[e]="",this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(Qx),this._element.classList.add(Vx),HS.trigger(this._element,Hx)}),this._element,!0)}_isShown(e=this._element){return e.classList.contains(Wx)}_configAfterMerge(e){return e.toggle=Boolean(e.toggle),e.parent=pS(e.parent),e}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const e=this._getFirstLevelChildren(Yx);for(const t of e){const e=KS.getElementFromSelector(t);e&&this._addAriaAndCollapsedClass([t],this._isShown(e))}}_getFirstLevelChildren(e){const t=KS.find(Jx,this._config.parent);return KS.find(e,this._config.parent).filter((e=>!t.includes(e)))}_addAriaAndCollapsedClass(e,t){if(e.length)for(const s of e)s.classList.toggle("collapsed",!t),s.setAttribute("aria-expanded",t)}static jQueryInterface(e){const t={};return"string"==typeof e&&/show|hide/.test(e)&&(t.toggle=!1),this.each((function(){const s=Zx.getOrCreateInstance(this,t);if("string"==typeof e){if(void 0===s[e])throw new TypeError(`No method named "${e}"`);s[e]()}}))}}HS.on(document,Gx,Yx,(function(e){("A"===e.target.tagName||e.delegateTarget&&"A"===e.delegateTarget.tagName)&&e.preventDefault();for(const e of KS.getMultipleElementsFromSelector(this))Zx.getOrCreateInstance(e,{toggle:!1}).toggle()})),ES(Zx);const eE="dropdown",tE=".bs.dropdown",sE=".data-api",nE="ArrowUp",iE="ArrowDown",rE=`hide${tE}`,oE=`hidden${tE}`,aE=`show${tE}`,cE=`shown${tE}`,lE=`click${tE}${sE}`,dE=`keydown${tE}${sE}`,uE=`keyup${tE}${sE}`,hE="show",mE='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',fE=`${mE}.${hE}`,gE=".dropdown-menu",pE=xS()?"top-end":"top-start",vE=xS()?"top-start":"top-end",_E=xS()?"bottom-end":"bottom-start",bE=xS()?"bottom-start":"bottom-end",yE=xS()?"left-start":"right-start",wE=xS()?"right-start":"left-start",AE={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},SE={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class xE extends YS{constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=KS.next(this._element,gE)[0]||KS.prev(this._element,gE)[0]||KS.findOne(gE,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return AE}static get DefaultType(){return SE}static get NAME(){return eE}toggle(){return this._isShown()?this.hide():this.show()}show(){if(_S(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!HS.trigger(this._element,aE,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const e of[].concat(...document.body.children))HS.on(e,"mouseover",yS);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(hE),this._element.classList.add(hE),HS.trigger(this._element,cE,e)}}hide(){if(_S(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!HS.trigger(this._element,rE,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))HS.off(e,"mouseover",yS);this._popper&&this._popper.destroy(),this._menu.classList.remove(hE),this._element.classList.remove(hE),this._element.setAttribute("aria-expanded","false"),QS.removeDataAttribute(this._menu,"popper"),HS.trigger(this._element,oE,e)}}_getConfig(e){if("object"==typeof(e=super._getConfig(e)).reference&&!gS(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${eE.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){if(void 0===v)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;"parent"===this._config.reference?e=this._parent:gS(this._config.reference)?e=pS(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference);const t=this._getPopperConfig();this._popper=cS(e,this._menu,t)}_isShown(){return this._menu.classList.contains(hE)}_getPlacement(){const e=this._parent;if(e.classList.contains("dropend"))return yE;if(e.classList.contains("dropstart"))return wE;if(e.classList.contains("dropup-center"))return"top";if(e.classList.contains("dropdown-center"))return"bottom";const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return e.classList.contains("dropup")?t?vE:pE:t?bE:_E}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(QS.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...$S(this._config.popperConfig,[e])}}_selectMenuItem({key:e,target:t}){const s=KS.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((e=>vS(e)));s.length&&kS(s,t,e===iE,!s.includes(t)).focus()}static jQueryInterface(e){return this.each((function(){const t=xE.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}static clearMenus(e){if(2===e.button||"keyup"===e.type&&"Tab"!==e.key)return;const t=KS.find(fE);for(const s of t){const t=xE.getInstance(s);if(!t||!1===t._config.autoClose)continue;const n=e.composedPath(),i=n.includes(t._menu);if(n.includes(t._element)||"inside"===t._config.autoClose&&!i||"outside"===t._config.autoClose&&i)continue;if(t._menu.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const r={relatedTarget:t._element};"click"===e.type&&(r.clickEvent=e),t._completeHide(r)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),s="Escape"===e.key,n=[nE,iE].includes(e.key);if(!n&&!s)return;if(t&&!s)return;e.preventDefault();const i=this.matches(mE)?this:KS.prev(this,mE)[0]||KS.next(this,mE)[0]||KS.findOne(mE,e.delegateTarget.parentNode),r=xE.getOrCreateInstance(i);if(n)return e.stopPropagation(),r.show(),void r._selectMenuItem(e);r._isShown()&&(e.stopPropagation(),r.hide(),i.focus())}}HS.on(document,dE,mE,xE.dataApiKeydownHandler),HS.on(document,dE,gE,xE.dataApiKeydownHandler),HS.on(document,lE,xE.clearMenus),HS.on(document,uE,xE.clearMenus),HS.on(document,lE,mE,(function(e){e.preventDefault(),xE.getOrCreateInstance(this).toggle()})),ES(xE);const EE="backdrop",$E="show",CE=`mousedown.bs.${EE}`,kE={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},TE={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class jE extends JS{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return kE}static get DefaultType(){return TE}static get NAME(){return EE}show(e){if(!this._config.isVisible)return void $S(e);this._append();const t=this._getElement();this._config.isAnimated&&wS(t),t.classList.add($E),this._emulateAnimation((()=>{$S(e)}))}hide(e){this._config.isVisible?(this._getElement().classList.remove($E),this._emulateAnimation((()=>{this.dispose(),$S(e)}))):$S(e)}dispose(){this._isAppended&&(HS.off(this._element,CE),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add("fade"),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=pS(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),HS.on(e,CE,(()=>{$S(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(e){CS(e,this._getElement(),this._config.isAnimated)}}const NE=".bs.focustrap",OE=`focusin${NE}`,IE=`keydown.tab${NE}`,ME="backward",RE={autofocus:!0,trapElement:null},DE={autofocus:"boolean",trapElement:"element"};class LE extends JS{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return RE}static get DefaultType(){return DE}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),HS.off(document,NE),HS.on(document,OE,(e=>this._handleFocusin(e))),HS.on(document,IE,(e=>this._handleKeydown(e))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,HS.off(document,NE))}_handleFocusin(e){const{trapElement:t}=this._config;if(e.target===document||e.target===t||t.contains(e.target))return;const s=KS.focusableChildren(t);0===s.length?t.focus():this._lastTabNavDirection===ME?s[s.length-1].focus():s[0].focus()}_handleKeydown(e){"Tab"===e.key&&(this._lastTabNavDirection=e.shiftKey?ME:"forward")}}const zE=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",PE=".sticky-top",FE="padding-right",UE="margin-right";class BE{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,FE,(t=>t+e)),this._setElementAttributes(zE,FE,(t=>t+e)),this._setElementAttributes(PE,UE,(t=>t-e))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,FE),this._resetElementAttributes(zE,FE),this._resetElementAttributes(PE,UE)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,s){const n=this.getWidth();this._applyManipulationCallback(e,(e=>{if(e!==this._element&&window.innerWidth>e.clientWidth+n)return;this._saveInitialAttribute(e,t);const i=window.getComputedStyle(e).getPropertyValue(t);e.style.setProperty(t,`${s(Number.parseFloat(i))}px`)}))}_saveInitialAttribute(e,t){const s=e.style.getPropertyValue(t);s&&QS.setDataAttribute(e,t,s)}_resetElementAttributes(e,t){this._applyManipulationCallback(e,(e=>{const s=QS.getDataAttribute(e,t);null!==s?(QS.removeDataAttribute(e,t),e.style.setProperty(t,s)):e.style.removeProperty(t)}))}_applyManipulationCallback(e,t){if(gS(e))t(e);else for(const s of KS.find(e,this._element))t(s)}}const qE=".bs.modal",HE=`hide${qE}`,GE=`hidePrevented${qE}`,WE=`hidden${qE}`,VE=`show${qE}`,QE=`shown${qE}`,JE=`resize${qE}`,YE=`click.dismiss${qE}`,XE=`mousedown.dismiss${qE}`,KE=`keydown.dismiss${qE}`,ZE=`click${qE}.data-api`,e$="modal-open",t$="show",s$="modal-static",n$={backdrop:!0,focus:!0,keyboard:!0},i$={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class r$ extends YS{constructor(e,t){super(e,t),this._dialog=KS.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new BE,this._addEventListeners()}static get Default(){return n$}static get DefaultType(){return i$}static get NAME(){return"modal"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||this._isTransitioning)return;HS.trigger(this._element,VE,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(e$),this._adjustDialog(),this._backdrop.show((()=>this._showElement(e))))}hide(){if(!this._isShown||this._isTransitioning)return;HS.trigger(this._element,HE).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(t$),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated()))}dispose(){HS.off(window,qE),HS.off(this._dialog,qE),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new jE({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new LE({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=KS.findOne(".modal-body",this._dialog);t&&(t.scrollTop=0),wS(this._element),this._element.classList.add(t$);this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,HS.trigger(this._element,QE,{relatedTarget:e})}),this._dialog,this._isAnimated())}_addEventListeners(){HS.on(this._element,KE,(e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),HS.on(window,JE,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),HS.on(this._element,XE,(e=>{HS.one(this._element,YE,(t=>{this._element===e.target&&this._element===t.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(e$),this._resetAdjustments(),this._scrollBar.reset(),HS.trigger(this._element,WE)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(HS.trigger(this._element,GE).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._element.style.overflowY;"hidden"===t||this._element.classList.contains(s$)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(s$),this._queueCallback((()=>{this._element.classList.remove(s$),this._queueCallback((()=>{this._element.style.overflowY=t}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),s=t>0;if(s&&!e){const e=xS()?"paddingLeft":"paddingRight";this._element.style[e]=`${t}px`}if(!s&&e){const e=xS()?"paddingRight":"paddingLeft";this._element.style[e]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each((function(){const s=r$.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===s[e])throw new TypeError(`No method named "${e}"`);s[e](t)}}))}}HS.on(document,ZE,'[data-bs-toggle="modal"]',(function(e){const t=KS.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),HS.one(t,VE,(e=>{e.defaultPrevented||HS.one(t,WE,(()=>{vS(this)&&this.focus()}))}));const s=KS.findOne(".modal.show");s&&r$.getInstance(s).hide();r$.getOrCreateInstance(t).toggle(this)})),ZS(r$),ES(r$);const o$=".bs.offcanvas",a$=".data-api",c$=`load${o$}${a$}`,l$="show",d$="showing",u$="hiding",h$=".offcanvas.show",m$=`show${o$}`,f$=`shown${o$}`,g$=`hide${o$}`,p$=`hidePrevented${o$}`,v$=`hidden${o$}`,_$=`resize${o$}`,b$=`click${o$}${a$}`,y$=`keydown.dismiss${o$}`,w$={backdrop:!0,keyboard:!0,scroll:!1},A$={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class S$ extends YS{constructor(e,t){super(e,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return w$}static get DefaultType(){return A$}static get NAME(){return"offcanvas"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown)return;if(HS.trigger(this._element,m$,{relatedTarget:e}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||(new BE).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(d$);this._queueCallback((()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(l$),this._element.classList.remove(d$),HS.trigger(this._element,f$,{relatedTarget:e})}),this._element,!0)}hide(){if(!this._isShown)return;if(HS.trigger(this._element,g$).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(u$),this._backdrop.hide();this._queueCallback((()=>{this._element.classList.remove(l$,u$),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new BE).reset(),HS.trigger(this._element,v$)}),this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=Boolean(this._config.backdrop);return new jE({className:"offcanvas-backdrop",isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?()=>{"static"!==this._config.backdrop?this.hide():HS.trigger(this._element,p$)}:null})}_initializeFocusTrap(){return new LE({trapElement:this._element})}_addEventListeners(){HS.on(this._element,y$,(e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():HS.trigger(this._element,p$))}))}static jQueryInterface(e){return this.each((function(){const t=S$.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e](this)}}))}}HS.on(document,b$,'[data-bs-toggle="offcanvas"]',(function(e){const t=KS.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&e.preventDefault(),_S(this))return;HS.one(t,v$,(()=>{vS(this)&&this.focus()}));const s=KS.findOne(h$);s&&s!==t&&S$.getInstance(s).hide();S$.getOrCreateInstance(t).toggle(this)})),HS.on(window,c$,(()=>{for(const e of KS.find(h$))S$.getOrCreateInstance(e).show()})),HS.on(window,_$,(()=>{for(const e of KS.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(e).position&&S$.getOrCreateInstance(e).hide()})),ZS(S$),ES(S$);const x$={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},E$=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),$$=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,C$=(e,t)=>{const s=e.nodeName.toLowerCase();return t.includes(s)?!E$.has(s)||Boolean($$.test(e.nodeValue)):t.filter((e=>e instanceof RegExp)).some((e=>e.test(s)))};const k$={allowList:x$,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},T$={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},j$={entry:"(string|element|function|null)",selector:"(string|element)"};class N$ extends JS{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return k$}static get DefaultType(){return T$}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((e=>this._resolvePossibleFunction(e))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[t,s]of Object.entries(this._config.content))this._setContent(e,s,t);const t=e.children[0],s=this._resolvePossibleFunction(this._config.extraClass);return s&&t.classList.add(...s.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,s]of Object.entries(e))super._typeCheckConfig({selector:t,entry:s},j$)}_setContent(e,t,s){const n=KS.findOne(s,e);n&&((t=this._resolvePossibleFunction(t))?gS(t)?this._putElementInTemplate(pS(t),n):this._config.html?n.innerHTML=this._maybeSanitize(t):n.textContent=t:n.remove())}_maybeSanitize(e){return this._config.sanitize?function(e,t,s){if(!e.length)return e;if(s&&"function"==typeof s)return s(e);const n=(new window.DOMParser).parseFromString(e,"text/html"),i=[].concat(...n.body.querySelectorAll("*"));for(const e of i){const s=e.nodeName.toLowerCase();if(!Object.keys(t).includes(s)){e.remove();continue}const n=[].concat(...e.attributes),i=[].concat(t["*"]||[],t[s]||[]);for(const t of n)C$(t,i)||e.removeAttribute(t.nodeName)}return n.body.innerHTML}(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return $S(e,[this])}_putElementInTemplate(e,t){if(this._config.html)return t.innerHTML="",void t.append(e);t.textContent=e.textContent}}const O$=new Set(["sanitize","allowList","sanitizeFn"]),I$="fade",M$="show",R$=".tooltip-inner",D$=".modal",L$="hide.bs.modal",z$="hover",P$="focus",F$={AUTO:"auto",TOP:"top",RIGHT:xS()?"left":"right",BOTTOM:"bottom",LEFT:xS()?"right":"left"},U$={allowList:x$,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},B$={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class q$ extends YS{constructor(e,t){if(void 0===v)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return U$}static get DefaultType(){return B$}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),HS.off(this._element.closest(D$),L$,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const e=HS.trigger(this._element,this.constructor.eventName("show")),t=(bS(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!t)return;this._disposePopper();const s=this._getTipElement();this._element.setAttribute("aria-describedby",s.getAttribute("id"));const{container:n}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(n.append(s),HS.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(s),s.classList.add(M$),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))HS.on(e,"mouseover",yS);this._queueCallback((()=>{HS.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(HS.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented)return;if(this._getTipElement().classList.remove(M$),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))HS.off(e,"mouseover",yS);this._activeTrigger.click=!1,this._activeTrigger[P$]=!1,this._activeTrigger[z$]=!1,this._isHovered=null;this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),HS.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml();if(!t)return null;t.classList.remove(I$,M$),t.classList.add(`bs-${this.constructor.NAME}-auto`);const s=(e=>{do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e})(this.constructor.NAME).toString();return t.setAttribute("id",s),this._isAnimated()&&t.classList.add(I$),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new N$({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[R$]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(I$)}_isShown(){return this.tip&&this.tip.classList.contains(M$)}_createPopper(e){const t=$S(this._config.placement,[this,e,this._element]),s=F$[t.toUpperCase()];return cS(this._element,e,this._getPopperConfig(s))}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_resolvePossibleFunction(e){return $S(e,[this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:e=>{this._getTipElement().setAttribute("data-popper-placement",e.state.placement)}}]};return{...t,...$S(this._config.popperConfig,[t])}}_setListeners(){const e=this._config.trigger.split(" ");for(const t of e)if("click"===t)HS.on(this._element,this.constructor.eventName("click"),this._config.selector,(e=>{this._initializeOnDelegatedTarget(e).toggle()}));else if("manual"!==t){const e=t===z$?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),s=t===z$?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");HS.on(this._element,e,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusin"===e.type?P$:z$]=!0,t._enter()})),HS.on(this._element,s,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusout"===e.type?P$:z$]=t._element.contains(e.relatedTarget),t._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},HS.on(this._element.closest(D$),L$,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=QS.getDataAttributes(this._element);for(const e of Object.keys(t))O$.has(e)&&delete t[e];return e={...t,..."object"==typeof e&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=!1===e.container?document.body:pS(e.container),"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),"number"==typeof e.title&&(e.title=e.title.toString()),"number"==typeof e.content&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[t,s]of Object.entries(this._config))this.constructor.Default[t]!==s&&(e[t]=s);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each((function(){const t=q$.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}}ES(q$);const H$=".popover-header",G$=".popover-body",W$={...q$.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},V$={...q$.DefaultType,content:"(null|string|element|function)"};class Q$ extends q${static get Default(){return W$}static get DefaultType(){return V$}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[H$]:this._getTitle(),[G$]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each((function(){const t=Q$.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}}ES(Q$);const J$=".bs.scrollspy",Y$=`activate${J$}`,X$=`click${J$}`,K$=`load${J$}.data-api`,Z$="active",eC="[href]",tC=".nav-link",sC=`${tC}, .nav-item > ${tC}, .list-group-item`,nC={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},iC={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class rC extends YS{constructor(e,t){super(e,t),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return nC}static get DefaultType(){return iC}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=pS(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,"string"==typeof e.threshold&&(e.threshold=e.threshold.split(",").map((e=>Number.parseFloat(e)))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(HS.off(this._config.target,X$),HS.on(this._config.target,X$,eC,(e=>{const t=this._observableSections.get(e.target.hash);if(t){e.preventDefault();const s=this._rootElement||window,n=t.offsetTop-this._element.offsetTop;if(s.scrollTo)return void s.scrollTo({top:n,behavior:"smooth"});s.scrollTop=n}})))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((e=>this._observerCallback(e)),e)}_observerCallback(e){const t=e=>this._targetLinks.get(`#${e.target.id}`),s=e=>{this._previousScrollData.visibleEntryTop=e.target.offsetTop,this._process(t(e))},n=(this._rootElement||document.documentElement).scrollTop,i=n>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=n;for(const r of e){if(!r.isIntersecting){this._activeTarget=null,this._clearActiveClass(t(r));continue}const e=r.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(i&&e){if(s(r),!n)return}else i||e||s(r)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const e=KS.find(eC,this._config.target);for(const t of e){if(!t.hash||_S(t))continue;const e=KS.findOne(decodeURI(t.hash),this._element);vS(e)&&(this._targetLinks.set(decodeURI(t.hash),t),this._observableSections.set(t.hash,e))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(Z$),this._activateParents(e),HS.trigger(this._element,Y$,{relatedTarget:e}))}_activateParents(e){if(e.classList.contains("dropdown-item"))KS.findOne(".dropdown-toggle",e.closest(".dropdown")).classList.add(Z$);else for(const t of KS.parents(e,".nav, .list-group"))for(const e of KS.prev(t,sC))e.classList.add(Z$)}_clearActiveClass(e){e.classList.remove(Z$);const t=KS.find(`${eC}.${Z$}`,e);for(const e of t)e.classList.remove(Z$)}static jQueryInterface(e){return this.each((function(){const t=rC.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}}))}}HS.on(window,K$,(()=>{for(const e of KS.find('[data-bs-spy="scroll"]'))rC.getOrCreateInstance(e)})),ES(rC);const oC=".bs.tab",aC=`hide${oC}`,cC=`hidden${oC}`,lC=`show${oC}`,dC=`shown${oC}`,uC=`click${oC}`,hC=`keydown${oC}`,mC=`load${oC}`,fC="ArrowLeft",gC="ArrowRight",pC="ArrowUp",vC="ArrowDown",_C="Home",bC="End",yC="active",wC="fade",AC="show",SC=".dropdown-toggle",xC=`:not(${SC})`,EC='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',$C=`${`.nav-link${xC}, .list-group-item${xC}, [role="tab"]${xC}`}, ${EC}`,CC=`.${yC}[data-bs-toggle="tab"], .${yC}[data-bs-toggle="pill"], .${yC}[data-bs-toggle="list"]`;class kC extends YS{constructor(e){super(e),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),HS.on(this._element,hC,(e=>this._keydown(e))))}static get NAME(){return"tab"}show(){const e=this._element;if(this._elemIsActive(e))return;const t=this._getActiveElem(),s=t?HS.trigger(t,aC,{relatedTarget:e}):null;HS.trigger(e,lC,{relatedTarget:t}).defaultPrevented||s&&s.defaultPrevented||(this._deactivate(t,e),this._activate(e,t))}_activate(e,t){if(!e)return;e.classList.add(yC),this._activate(KS.getElementFromSelector(e));this._queueCallback((()=>{"tab"===e.getAttribute("role")?(e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),HS.trigger(e,dC,{relatedTarget:t})):e.classList.add(AC)}),e,e.classList.contains(wC))}_deactivate(e,t){if(!e)return;e.classList.remove(yC),e.blur(),this._deactivate(KS.getElementFromSelector(e));this._queueCallback((()=>{"tab"===e.getAttribute("role")?(e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),HS.trigger(e,cC,{relatedTarget:t})):e.classList.remove(AC)}),e,e.classList.contains(wC))}_keydown(e){if(![fC,gC,pC,vC,_C,bC].includes(e.key))return;e.stopPropagation(),e.preventDefault();const t=this._getChildren().filter((e=>!_S(e)));let s;if([_C,bC].includes(e.key))s=t[e.key===_C?0:t.length-1];else{const n=[gC,vC].includes(e.key);s=kS(t,e.target,n,!0)}s&&(s.focus({preventScroll:!0}),kC.getOrCreateInstance(s).show())}_getChildren(){return KS.find($C,this._parent)}_getActiveElem(){return this._getChildren().find((e=>this._elemIsActive(e)))||null}_setInitialAttributes(e,t){this._setAttributeIfNotExists(e,"role","tablist");for(const e of t)this._setInitialAttributesOnChild(e)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);const t=this._elemIsActive(e),s=this._getOuterElement(e);e.setAttribute("aria-selected",t),s!==e&&this._setAttributeIfNotExists(s,"role","presentation"),t||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const t=KS.getElementFromSelector(e);t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,t){const s=this._getOuterElement(e);if(!s.classList.contains("dropdown"))return;const n=(e,n)=>{const i=KS.findOne(e,s);i&&i.classList.toggle(n,t)};n(SC,yC),n(".dropdown-menu",AC),s.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(e,t,s){e.hasAttribute(t)||e.setAttribute(t,s)}_elemIsActive(e){return e.classList.contains(yC)}_getInnerElement(e){return e.matches($C)?e:KS.findOne($C,e)}_getOuterElement(e){return e.closest(".nav-item, .list-group-item")||e}static jQueryInterface(e){return this.each((function(){const t=kC.getOrCreateInstance(this);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}}))}}HS.on(document,uC,EC,(function(e){["A","AREA"].includes(this.tagName)&&e.preventDefault(),_S(this)||kC.getOrCreateInstance(this).show()})),HS.on(window,mC,(()=>{for(const e of KS.find(CC))kC.getOrCreateInstance(e)})),ES(kC);const TC=".bs.toast",jC=`mouseover${TC}`,NC=`mouseout${TC}`,OC=`focusin${TC}`,IC=`focusout${TC}`,MC=`hide${TC}`,RC=`hidden${TC}`,DC=`show${TC}`,LC=`shown${TC}`,zC="hide",PC="show",FC="showing",UC={animation:"boolean",autohide:"boolean",delay:"number"},BC={animation:!0,autohide:!0,delay:5e3};class qC extends YS{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return BC}static get DefaultType(){return UC}static get NAME(){return"toast"}show(){if(HS.trigger(this._element,DC).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add("fade");this._element.classList.remove(zC),wS(this._element),this._element.classList.add(PC,FC),this._queueCallback((()=>{this._element.classList.remove(FC),HS.trigger(this._element,LC),this._maybeScheduleHide()}),this._element,this._config.animation)}hide(){if(!this.isShown())return;if(HS.trigger(this._element,MC).defaultPrevented)return;this._element.classList.add(FC),this._queueCallback((()=>{this._element.classList.add(zC),this._element.classList.remove(FC,PC),HS.trigger(this._element,RC)}),this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(PC),super.dispose()}isShown(){return this._element.classList.contains(PC)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":this._hasMouseInteraction=t;break;case"focusin":case"focusout":this._hasKeyboardInteraction=t}if(t)return void this._clearTimeout();const s=e.relatedTarget;this._element===s||this._element.contains(s)||this._maybeScheduleHide()}_setListeners(){HS.on(this._element,jC,(e=>this._onInteraction(e,!0))),HS.on(this._element,NC,(e=>this._onInteraction(e,!1))),HS.on(this._element,OC,(e=>this._onInteraction(e,!0))),HS.on(this._element,IC,(e=>this._onInteraction(e,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each((function(){const t=qC.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e](this)}}))}}ZS(qC),ES(qC);const HC=Ag`<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">${kw("Close")}</button>`,GC=Ag`<button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="${kw("Close")}"></button>`,WC=e=>{const t=e.model?.get("alert"),s=e.model?.get("level")??"";return Ag`<div class="modal-dialog" role="document" role="dialog"><div class="modal-content"><div class="modal-header ${s}"><h5 class="modal-title">${e.getModalTitle()}</h5>${GC}</div><div class="modal-body"><span class="modal-alert">${t?(e=>Ag`<div class="alert ${e.type}" role="alert"><p>${e.message}</p></div>`)({type:`alert-${t.type}`,message:t.message}):""} </span>${e.renderModal()}</div>${e.renderModalFooter()}</div></div>`};var VC=s(8610),QC={};QC.styleTagTransform=T(),QC.setAttributes=E(),QC.insert=S().bind(null,"head"),QC.domAPI=w(),QC.insertStyleElement=C();b()(VC.A,QC);VC.A&&VC.A.locals&&VC.A.locals;const JC=class extends wi{constructor(e){super(),this.model=null,this.className=Sm.isTestEnv()?"modal":"modal fade",this.tabIndex=-1,this.ariaHidden="true",this.initialized=ic(),Object.assign(this,e),setTimeout((()=>this.insertIntoDOM())),this.addEventListener("shown.bs.modal",(()=>{this.ariaHidden="false"})),this.addEventListener("hidden.bs.modal",(()=>{this.ariaHidden="true"}))}initialize(){this.render(),this.modal=new r$(this,{backdrop:!Sm.isTestEnv(),keyboard:!0}),this.initialized.resolve()}renderModal(){return""}renderModalFooter(){return Ag`<div class="modal-footer">${HC}</div>`}toHTML(){return WC(this)}getModalTitle(){return""}switchTab(e){e?.stopPropagation(),e?.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.render()}close(){this.modal.hide()}insertIntoDOM(){document.querySelector("#converse-modals").insertAdjacentElement("beforeend",this)}alert(e,t="primary"){this.model.set("alert",{message:e,type:t}),setTimeout((()=>{this.model.set("alert",void 0)}),5e3)}async show(){await this.initialized,this.modal.show(),this.render()}};Oh.elements.define("converse-alert-modal",class extends JC{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.addEventListener("hide.bs.modal",(()=>this.remove()),!1)}renderModal(){return(e=>Ag`<div class="modal-body"><span class="modal-alert"></span> ${e.messages.map((e=>Ag`<p>${e}</p>`))}</div>`)(this.model.toJSON())}getModalTitle(){return this.model.get("title")}});const YC=e=>Ag`<form class="converse-form converse-form--modal confirm" action="#" @submit="${t=>e.onConfimation(t)}"><div>${e.model.get("messages")?.map((e=>Ag`<p>${e}</p>`))}</div>${e.model.get("fields")?.map((e=>(e=>Ag`<div><label class="form-label">${e.label||""} <input type="text" name="${e.name}" class="${e.challenge_failed?"error":""} form-control form-control--labeled" ?required="${e.required}" placeholder="${e.placeholder}"></label></div>`)(e)))}<div><button type="submit" class="btn btn-primary">${kw("OK")}</button> <input type="button" class="btn btn-secondary" data-bs-dismiss="modal" value="${kw("Cancel")}"></div></form>`;class XC extends JC{constructor(e){super(e),this.confirmation=ic()}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.addEventListener("hide.bs.modal",(()=>{this.confirmation.isResolved||this.confirmation.reject()}),!1)}renderModal(){return YC(this)}getModalTitle(){return this.model.get("title")}onConfimation(e){e.preventDefault();const t=new FormData(e.target),s=(this.model.get("fields")||[]).map((e=>{const s=t.get(e.name).trim();return e.value=s,e.challenge&&(e.challenge_failed=s!==e.challenge),e}));if(s.filter((e=>e.challenge_failed)).length)return this.model.set("fields",s),void this.model.trigger("change");this.confirmation.resolve(s),this.modal.hide()}renderModalFooter(){return""}}Oh.elements.define("converse-confirm-modal",XC);let KC=[],ZC={};const ek={modal:{show(e,t,s){let n;if("string"==typeof e)n=this.get(e)??this.create(e,t),Object.assign(n,t);else{const s=e,i=s.id??t.id;n=this.get(i)??this.create(s,t)}return n.show(s),n},get:e=>ZC[e]??KC.filter((t=>t.id==e)).pop(),create(e,t){const s=customElements.get(e);return ZC[e]=new s(t)},remove(e){let t;"string"==typeof e?(t=ZC[e],delete ZC[e]):(t=e,KC=KC.filter((e=>e!==t))),t?.remove()},removeAll(){KC.forEach((e=>e.remove())),KC=[],ZC={}}},async confirm(e,t=[],s=[]){"string"==typeof t&&(t=[t]);const n=new cd({title:e,messages:t,fields:s,type:"confirm"}),i=new XC({model:n});let r;i.show();try{r=await i.confirmation}catch(e){r=!1}return i.remove(),r},async prompt(e,t=[],s=""){"string"==typeof t&&(t=[t]);const n=new cd({title:e,messages:t,fields:[{name:"reason",placeholder:s}],type:"prompt"}),i=new XC({model:n});let r;i.show();try{r=(await i.confirmation).pop()?.value}catch(e){r=!1}return i.remove(),r},alert(e,t,s){let n;"string"==typeof s&&(s=[s]),"error"===e?n="alert-danger":"info"===e?n="alert-info":"warn"===e&&(n="alert-warning");const i=new cd({title:t,messages:s,level:n,type:"alert"});ek.modal.show("converse-alert-modal",{model:i})}},tk=ek;Object.assign(qg.env,{BaseModal:JC}),qg.plugins.add("converse-modal",{initialize(){Oh.listen.on("disconnect",(()=>{const e=document.querySelector("#converse-modals");e&&(e.innerHTML="")})),Oh.listen.on("clearSession",(()=>Oh.modal.removeAll())),Object.assign(Iu.api,tk)}});const sk=class extends String{constructor(e,t){super();const s=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=s.label||s.value,this.value=s.value,this.query=t}get lenth(){return this.label.length}toString(){return""+this.label}valueOf(){return this.toString()}},nk=qg.env.utils,ik={getElement:(e,t)=>"string"==typeof e?(t||document).querySelector(e):e||null,bind(e,t){if(e)for(var s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const n=t[s];s.split(/\s+/).forEach((t=>e.addEventListener(t,n)))}},unbind(e,t){if(e)for(var s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const n=t[s];s.split(/\s+/).forEach((t=>e.removeEventListener(t,n)))}},regExpEscape:e=>e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),isMention:(e,t)=>t.includes(e[0])||nk.isMentionBoundary(e[0])&&t.includes(e[1])},rk=function(e,t){return RegExp(ik.regExpEscape(t.trim()),"i").test(e)},ok=function(e,t){return RegExp("^"+ik.regExpEscape(t.trim()),"i").test(e)},ak=function(e,t){const s=e.query.toLowerCase(),n=e.label.toLowerCase().indexOf(s),i=t.label.toLowerCase().indexOf(s);return n===i?function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1}(e,t):(-1===n?1/0:n)<(-1===i?1/0:i)?-1:1},ck=(e,t)=>{t=t.trim();const s=document.createElement("li");s.setAttribute("aria-selected","false");const n=new RegExp("("+t+")","ig");return(t?e.split(n):[e]).forEach((e=>{if(t&&e.match(n)){const t=document.createElement("mark");t.textContent=e,s.appendChild(t)}else s.appendChild(document.createTextNode(e))})),s},{siblingIndex:lk}=Sm;class dk extends(_i(Object)){constructor(e,t={}){super(),this.suggestions=[],this.is_opened=!1,this.auto_evaluate=!0,this.match_current_word=!1,this.sort=!1===t.sort?null:ak,this.filter=rk,this.ac_triggers=[],this.include_triggers=[],this.min_chars=2,this.max_items=10,this.auto_first=!1,this.data=(e,t)=>e,this.item=ck,Sm.hasClass("suggestion-box",e)?this.container=e:this.container=e.querySelector(".suggestion-box"),this.input=this.container.querySelector(".suggestion-box__input"),this.input.setAttribute("aria-autocomplete","list"),this.ul=this.container.querySelector(".suggestion-box__results"),this.status=this.container.querySelector(".suggestion-box__additions"),Object.assign(this,t),this.index=-1,this.bindEvents(),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||t.list||[]}bindEvents(){const e={blur:()=>this.close({reason:"blur"})};this.auto_evaluate&&(e.input=e=>this.evaluate(e)),this._events={input:e,form:{submit:()=>this.close({reason:"submit"})},ul:{mousedown:e=>this.onMouseDown(e),mouseover:e=>this.onMouseOver(e)}},ik.bind(this.input,this._events.input),ik.bind(this.input.form,this._events.form),ik.bind(this.ul,this._events.ul)}set list(e){if(Array.isArray(e)||"function"==typeof e)this._list=e;else if("string"==typeof e&&e.includes(","))this._list=e.split(/\s*,\s*/);else{const t=ik.getElement(e)?.children||[];this._list=Array.from(t).filter((e=>!e.disabled)).map((e=>{const t=e.textContent.trim(),s=e.value||t,n=e.label||t;return""!==s?{label:n,value:s}:null})).filter((e=>e))}document.activeElement===this.input&&this.evaluate()}get list(){return this._list}get selected(){return this.index>-1}get opened(){return this.is_opened}close(e){this.opened&&(this.ul.setAttribute("hidden",""),this.is_opened=!1,this.index=-1,this.trigger("suggestion-box-close",e||{}))}insertValue(e){this.match_current_word?Sm.replaceCurrentWord(this.input,e.value):this.input.value=e.value}open(){this.ul.removeAttribute("hidden"),this.is_opened=!0,this.auto_first&&-1===this.index&&this.goto(0),this.trigger("suggestion-box-open")}destroy(){ik.unbind(this.input,this._events.input),ik.unbind(this.input.form,this._events.form),this.input.removeAttribute("aria-autocomplete")}next(){const e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)}previous(){const e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)}goto(e,t=!0){const s=Array.from(this.ul.children).filter((e=>e instanceof HTMLElement));this.selected&&s[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&s.length>0&&(s[e].setAttribute("aria-selected","true"),s[e].focus(),this.status.textContent=s[e].textContent,t&&(this.ul.scrollTop=s[e].offsetTop-this.ul.clientHeight+s[e].clientHeight),this.trigger("suggestion-box-highlight",{text:this.suggestions[this.index]}))}select(e){if(e?this.index=lk(e):e=this.ul.children[this.index],e){const e=this.suggestions[this.index];this.insertValue(e),this.close({reason:"select"}),this.auto_completing=!1,this.trigger("suggestion-box-selectcomplete",{text:e})}}onMouseOver(e){const t=Sm.ancestor(e.target,"li");if(t){const e=Array.prototype.slice.call(this.ul.children).indexOf(t);this.goto(e,!1)}}onMouseDown(e){if(0!==e.button)return;const t=Sm.ancestor(e.target,"li");t&&(e.preventDefault(),this.select(t))}onKeyDown(e){if(this.opened){if([qg.keycodes.ENTER,qg.keycodes.TAB].includes(e.keyCode)&&this.selected)return e.preventDefault(),e.stopPropagation(),this.select(),!0;if(e.keyCode===qg.keycodes.ESCAPE)return this.close({reason:"esc"}),!0;if([qg.keycodes.UP_ARROW,qg.keycodes.DOWN_ARROW].includes(e.keyCode))return e.preventDefault(),e.stopPropagation(),this[e.keyCode===qg.keycodes.UP_ARROW?"previous":"next"](),!0}if(![qg.keycodes.SHIFT,qg.keycodes.META,qg.keycodes.META_RIGHT,qg.keycodes.ESCAPE,qg.keycodes.ALT].includes(e.keyCode))if(this.ac_triggers.includes(e.key)){if("Tab"===e.key){if(e.shiftKey)return;if(this.min_chars>0&&""===this.input.value)return;e.preventDefault()}this.auto_completing=!0}else if("Backspace"===e.key){const t=Sm.getCurrentWord(e.target,e.target.selectionEnd-1);ik.isMention(t,this.ac_triggers)&&(this.auto_completing=!0)}}async evaluate(e){const t=this.selected&&e&&(e.keyCode===qg.keycodes.UP_ARROW||e.keyCode===qg.keycodes.DOWN_ARROW);if(!this.auto_evaluate&&!this.auto_completing||t)return;let s=this.match_current_word?Sm.getCurrentWord(this.input):this.input.value;const n=ik.isMention(s,this.ac_triggers);n&&!this.include_triggers.includes(e.key)&&(s=Sm.isMentionBoundary(s[0])?s.slice(2):s.slice(1));const i=s.length&&s.length>=this.min_chars;if(n||i){this.auto_completing=!0;const e="function"==typeof this._list?await this._list(s):this._list;if(0===e.length||!this.auto_completing)return void this.close({reason:"nomatches"});this.index=-1,this.ul.innerHTML="",this.suggestions=e.map((e=>new sk(this.data(e,s),s))).filter((e=>this.filter(e,s))),this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.max_items),this.suggestions.forEach((e=>this.ul.appendChild(this.item(e,s)))),0===this.ul.children.length?this.close({reason:"nomatches"}):this.open()}else this.close({reason:"nomatches"}),n||(this.auto_completing=!1)}}const uk=dk;Oh.elements.define("converse-autocomplete",class extends Nw{static get properties(){return{position:{type:String},autofocus:{type:Boolean},getAutoCompleteList:{type:Function},data:{type:Function},list:{type:Array},auto_evaluate:{type:Boolean},auto_first:{type:Boolean},filter:{type:String},include_triggers:{type:String},min_chars:{type:Number},name:{type:String},placeholder:{type:String},value:{type:String},triggers:{type:String},required:{type:Boolean}}}constructor(){super(),this.data=e=>e,this.value="",this.position="above",this.auto_evaluate=!0,this.auto_first=!1,this.filter="contains",this.include_triggers="",this.match_current_word=!1,this.max_items=10,this.min_chars=1,this.triggers="",this.getAutoCompleteList=null,this.list=null,this.name="",this.placeholder="",this.required=!1}render(){const e=`suggestion-box__results--${this.position}`;return Ag`<div class="suggestion-box suggestion-box__name"><ul class="suggestion-box__results ${e}" hidden=""></ul><input ?autofocus="${this.autofocus}" ?required="${this.required}" type="text" name="${this.name}" autocomplete="off" @keydown="${this.onKeyDown}" @keyup="${this.onKeyUp}" class="form-control suggestion-box__input" value="${this.value}" placeholder="${this.placeholder}"> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div>`}firstUpdated(){this.auto_complete=new uk(this.firstElementChild,{ac_triggers:this.triggers.split(" "),auto_evaluate:this.auto_evaluate,auto_first:this.auto_first,filter:"contains"==this.filter?rk:ok,include_triggers:[],list:this.list??(e=>this.getAutoCompleteList(e)),data:this.data,match_current_word:!0,max_items:this.max_items,min_chars:this.min_chars}),this.auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}onKeyDown(e){this.auto_complete.onKeyDown(e)}onKeyUp(e){this.auto_complete.evaluate(e)}});var hk=s(593),mk={};mk.styleTagTransform=T(),mk.setAttributes=E(),mk.insert=S().bind(null,"head"),mk.domAPI=w(),mk.insertStyleElement=C();b()(hk.A,mk);hk.A&&hk.A.locals&&hk.A.locals;const fk={AutoComplete:uk};Object.assign(Iu,fk),Object.assign(Iu.exports,fk);const gk=(e,t)=>Ag`<audio controls src="${e}"></audio>${t?"":Ag`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,pk=(e,t)=>{const s=kw('Download file "%1$s"',t);return Ag`<a target="_blank" rel="noopener" href="${e}">${s}</a>`},vk=e=>Ag`<div class="pb-2">${"hidden"!==e.type?Ag`<label for="${e.id}" class="form-label">${e.label} ${e.desc?Ag`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""} ${"password"===e.type&&e.fixed_username?Ag`<input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.fixed_username}">`:""} <input autocomplete="${e.autocomplete||""}" class="form-control" id="${e.id}" name="${e.name}" placeholder="${e.placeholder||""}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`,_k=e=>Ag`<div class="pb-2"><label for="${e.id}" class="form-label">${e.label}</label> <select class="form-control" id="${e.id}" name="${e.name}" ?multiple="${e.multiple}">${e.options?.map((e=>(e=>Ag`<option value="${e.value}" ?selected="${e.selected}">${e.label}</option>`)(e)))}</select></div>`,bk=e=>Ag`<div class="pb-2"><label for="${e.id}" class="form-label">${e.label} ${e.desc?Ag`<small id="o.id" class="form-text text-muted">${e.desc}</small>`:""}</label><div><a class="form-url" target="_blank" rel="noopener" id="${e.id}" href="${e.value}">${e.value}</a></div></div>`,yk=e=>Ag`<div class="pb-2">${"hidden"!==e.type?Ag`<label for="${e.id}" class="form-label">${e.label} ${e.desc?Ag`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""}<div class="input-group"><input name="${e.name}" class="form-control" id="${e.id}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"> ${e.domain?Ag`<div class="input-group-append"><div class="input-group-text" title="${e.domain}">${e.domain}</div></div>`:""}</div></div>`;function wk(e){e.preventDefault(),Oh.rooms.open(e.target.href)}const Ak=(e,t)=>{let s=e.normalizePath().toString();return e._parts.protocol||t.startsWith("http://")||t.startsWith("https://")||(s="http://"+s),"xmpp"===e._parts.protocol&&"join"===e._parts.query?Ag`<a target="_blank" rel="noopener" @click="${wk}" href="${s}">${t}</a>`:Ag`<a target="_blank" rel="noopener" href="${s}">${t}</a>`},Sk=(e,t)=>Ag`<video controls preload="metadata" src="${e}"></video>${t?"":Ag`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,{sizzle:xk,Strophe:Ek,dayjs:$k}=qg.env,{getURI:Ck,isAudioURL:kk,isImageURL:Tk,isVideoURL:jk,isValidURL:Nk}=Sm,Ok=["http","https","xmpp","mailto"],Ik=/\s*\n\s*/;function Mk(e){let t;(e instanceof Ie||e instanceof ct)&&(e=e.tree());const s=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,(e=>"body"===e.parentElement.nodeName.toLowerCase()?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT));for(;t=n.nextNode();)s.push(t);return s.forEach((e=>Ik.test(e.data)&&e.parentElement.removeChild(e))),e}function Rk(e,t){return{"muc#roomconfig_lang":"language","muc#roomconfig_roomsecret":t?.new_password?"new-password":"current-password"}[e]}const Dk=new XMLSerializer;function Lk(e){const t=e.getAttribute("name");if(!t)return null;let s;return s="checkbox"===e.getAttribute("type")?e.checked?1:0:"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?Sm.getSelectValues(e):e.value,{name:t,value:s}}function zk(e){const t=Ck(e);try{return decodeURI(t.filename())}catch(e){return bt.debug(e),t.filename()}}function Pk(e){const t=Ck(e);return null===t?e:jk(t)?Sk(e):kk(t)?gk(e):(Tk(t),pk(t.toString(),zk(t)))}function Fk(e){return Array.from(e.children).reduce(((e,t)=>t instanceof HTMLElement?e+t.offsetHeight:e),0)}function Uk(e,t){return t instanceof Element&&t.classList.contains(e)}function Bk(e,t){return t instanceof Element&&t.classList.remove(e),t}function qk(e){const t=RegExp("^w{3}.","ig").test(e)?`http://${e}`:e,s=Ck(e);return null===s||!Nk(t)||!function(e,t=Ok){return!!t.includes(e)}(s._parts.protocol)&&s._parts.protocol?e:Ak(s,e)}function Hk(e,t=200){return new Promise(((s,n)=>{if(!e){const e="An element needs to be passed in to slideOut";return bt.warn(e),void n(new Error(e))}const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const r=Fk(e);if(Oh.settings.get("disable_effects"))return e.style.height=r+"px",function(e){e.removeAttribute("data-slider-marker"),e.classList.remove("collapsed"),e.style.overflow="",e.style.height=""}(e),void s();if(!Uk("collapsed",e)&&!Uk("hidden",e))return void s();const o=t/17;let a=0;e.style.height="0",e.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("collapsed"),e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a+=r/o,a<r?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.style.height=Fk(e)+"px",e.style.overflow="",e.style.height="",s())})).toString())}))}function Gk(e,t=200){return new Promise(((s,n)=>{if(!e){const e="An element needs to be passed in to slideIn";return bt.warn(e),n(new Error(e))}if(Uk("collapsed",e))return s(e);if(Oh.settings.get("disable_effects"))return e.classList.add("collapsed"),e.style.height="",s(e);const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const r=e.offsetHeight,o=t/17;let a=r;e.style.overflow="hidden",e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a-=r/o,a>0?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.classList.add("collapsed"),e.style.height="",s(e))})).toString())}))}function Wk(e,t={}){const s={id:Sm.getUniqueId(),name:e.var};if("list-single"===e.type||"list-multi"===e.type)return _k({...s,...e,multiple:"list-multi"===e.type});if("fixed"===e.type)return(e=>Ag`<p>${e.text}</p>`)(e);if("jid-multi"===e.type)return(e=>{const t=Sm.getUniqueId();return Ag`<div class="pb-2"><label class="form-label label-ta" for="${e.id}">${e.label} ${e.desc?Ag`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <textarea name="${e.name}" id="${t}" ?readonly="${e.readonly}" ?required="${e.required}" class="form-control">${e.value}</textarea></div>`})({...s,...e});if("boolean"===e.type)return(e=>Ag`<fieldset class="pb-2 form-check"><input id="${e.id}" name="${e.name}" type="checkbox" class="form-check-input" ?readonly="${e.readonly}" ?checked="${e.checked}" ?required="${e.required}"> <label class="form-check-label" for="${e.id}">${e.label} ${e.desc?Ag`<small class="form-text text-muted">${e.desc}</small>`:""}</label></fieldset>`)({...s,...e});if("username"===e.var)return yk({...s,domain:t.domain?" @"+t.domain:"",...e});if("password"===e.var)return vk({...s,...e,autocomplete:Rk(e.var,t),fixed_username:t?.fixed_username,type:"password"});if("ocr"===e.var)return(e=>Ag`<fieldset class="pb-2">${e.label?Ag`<label class="form-label">${e.label}</label>`:""} <img src="data:${e.type};base64,${e.data}"> <input name="${e.name}" type="text" ?required="${e.required}"></fieldset>`)({...s,...e,data:e.uri.data,type:e.uri.type});if("hidden"===e.type||"url"!==e.var&&"uri"!==e.var&&!Nk(e.value)){if("datetime"===e.type||"date"===e.type){const t=e.value?$k(e.value):null,n=t?.isValid()?"datetime"===e.type?t.format("YYYY-MM-DDTHH:mm:ss"):t.format("YYYY-MM-DD"):null;return(e=>Ag`<div class="pb-2"><label for="${e.id}" class="form-label">${e.label} ${e.desc?Ag`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <input class="form-control" id="${e.id}" name="${e.name}" type="datetime-local" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`)({...s,...e,value:n})}return vk({...s,...e,autocomplete:Rk(e.var,t),placeholder:null})}return bk(e)}Object.assign(Sm,{addClass:function(e,t){return t instanceof Element&&t.classList.add(e),t},ancestor:function(e,t){let s=e;for(;null!==s&&!xk.matchesSelector(s,t);)s=s.parentElement;return s},calculateElementHeight:Fk,escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getElementFromTemplateResult:function(e){const t=document.createElement("div");return Pg(e,t),t.firstElementChild},getNextElement:function(e,t="*"){let s=e.nextElementSibling;for(;null!==s&&!xk.matchesSelector(s,t);)s=s.nextElementSibling;return s},getOOBURLMarkup:Pk,getOuterWidth:function(e,t=!1){let s=e.offsetWidth;if(!t)return s;const n=window.getComputedStyle(e);return s+=parseInt(n.marginLeft?n.marginLeft:"0",10)+parseInt(n.marginRight?n.marginRight:"0",10),s},hasClass:Uk,hideElement:function(e){return e instanceof Element&&e.classList.add("hidden"),e},isEqualNode:function(e,t){if(!Sm.isElement(e))throw new Error("Element being compared must be an Element!");e=Mk(e),t=Mk(t);let s=e.isEqualNode(t);if(!s){const{xmlHtmlNode:n}=Ek,i=Dk.serializeToString(e),r=Dk.serializeToString(t);s=i===r||n(i).isEqualNode(n(r))}return s},isInDOM:function(e){return document.querySelector("body").contains(e)},isVisible:function(e){return null!==e&&(!Uk("hidden",e)&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0))},nextUntil:function(e,t){const s=[];let n=e.nextElementSibling;for(;null!==n&&!n.matches(t);)s.push(n),n=n.nextElementSibling;return s},removeClass:Bk,removeElement:function(e){return e instanceof Element&&e.parentNode&&e.parentNode.removeChild(e),e},showElement:function(e){Bk("collapsed",e),Bk("hidden",e)},slideIn:Gk,slideOut:Hk,unescapeHTML:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText},xFormField2TemplateResult:Wk});const Vk=Sm,Qk={execute:kw("Execute"),prev:kw("Previous"),next:kw("Next"),complete:kw("Complete")},Jk={info:"primary",warn:"secondary",error:"danger"};const Yk=(e,t)=>{const s=kw("Cancel");return Ag`<span><form class="converse-form">${t.alert?Ag`<div class="alert alert-${t.alert_type}" role="alert">${t.alert}</div>`:""} ${t.note?Ag`<div class="alert alert-${Jk[t.note.type||"info"]}" role="alert">${t.note.text}</div>`:""} ${"result"===t.type&&t.title?Ag`<div class="alert alert-info">${t.title}</div>`:""} ${"form"===t.type&&t.title?Ag`<h6>${t.title}</h6>`:""}<fieldset><input type="hidden" name="command_node" value="${t.node}"> <input type="hidden" name="command_jid" value="${t.jid}"> ${t.instructions?Ag`<p class="form-instructions">${t.instructions}</p>`:""} ${"result"===t.type?function(e){return Ag`<table class="table"><thead class="thead-light">${e.reported?.map((e=>Ag`<th scope="col" data-var="${e.var}">${e.label}</th>`))}</thead><tbody>${e.items?.map((e=>Ag`<tr>${e.map((e=>Ag`<td data-var="${e.var}">${e.value}</td>`))}</tr>`))}</tbody></table>`}(t):""} ${t.fields?.map((e=>Wk(e)),{domain:t.jid})??""}</fieldset>${t.actions?.length?Ag`<fieldset>${t.actions?.map((t=>Ag`<input data-action="${t}" @click="${t=>e.executeAction(t)}" type="button" class="btn btn-primary" value="${Qk[t]}">`))} <input type="button" class="btn btn-secondary button-cancel" value="${s}" @click="${t=>e.cancel(t)}"></fieldset>`:""}</form></span>`};var Xk=s(2470),Kk={};Kk.styleTagTransform=T(),Kk.setAttributes=E(),Kk.insert=S().bind(null,"head"),Kk.domAPI=w(),Kk.insertStyleElement=C();b()(Xk.A,Kk);Xk.A&&Xk.A.locals&&Xk.A.locals;const Zk=(e={})=>Ag`<div class="d-flex justify-content-center ${e.class}"><div class="spinner-grow" role="status"><span class="visually-hidden">Loading...</span></div></div>`,{I:eT}=Zf,tT=()=>document.createComment(""),sT=(e,t,s)=>{const n=e._$AA.parentNode,i=void 0===t?e._$AB:t._$AA;if(void 0===s){const t=n.insertBefore(tT(),i),r=n.insertBefore(tT(),i);s=new eT(t,r,e,e.options)}else{const t=s._$AB.nextSibling,r=s._$AM,o=r!==e;if(o){let t;s._$AQ?.(e),s._$AM=e,void 0!==s._$AP&&(t=e._$AU)!==r._$AU&&s._$AP(t)}if(t!==i||o){let e=s._$AA;for(;e!==t;){const t=e.nextSibling;n.insertBefore(e,i),e=t}}}return s},nT=(e,t,s=e)=>(e._$AI(t,s),e),iT={},rT=e=>{e._$AP?.(!1,!0);let t=e._$AA;const s=e._$AB.nextSibling;for(;t!==s;){const e=t.nextSibling;t.remove(),t=e}},oT=2,aT=e=>(...t)=>({_$litDirective$:e,values:t});class cT{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const lT=(e,t)=>{const s=e._$AN;if(void 0===s)return!1;for(const e of s)e._$AO?.(t,!1),lT(e,t);return!0},dT=e=>{let t,s;do{if(void 0===(t=e._$AM))break;s=t._$AN,s.delete(e),e=t}while(0===s?.size)},uT=e=>{for(let t;t=e._$AM;e=t){let s=t._$AN;if(void 0===s)t._$AN=s=new Set;else if(s.has(e))break;s.add(e),fT(t)}};function hT(e){void 0!==this._$AN?(dT(this),this._$AM=e,uT(this)):this._$AM=e}function mT(e,t=!1,s=0){const n=this._$AH,i=this._$AN;if(void 0!==i&&0!==i.size)if(t)if(Array.isArray(n))for(let e=s;e<n.length;e++)lT(n[e],!1),dT(n[e]);else null!=n&&(lT(n,!1),dT(n));else lT(this,e)}const fT=e=>{e.type==oT&&(e._$AP??=mT,e._$AQ??=hT)};class gT extends cT{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,s){super._$AT(e,t,s),uT(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(lT(this,e),dT(this))}setValue(e){if((e=>void 0===e.strings)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}class pT{constructor(e){this.Y=e}disconnect(){this.Y=void 0}reconnect(e){this.Y=e}deref(){return this.Y}}class vT{constructor(){this.Z=void 0,this.q=void 0}get(){return this.Z}pause(){this.Z??=new Promise((e=>this.q=e))}resume(){this.q?.(),this.Z=this.q=void 0}}const _T=e=>!(e=>null===e||"object"!=typeof e&&"function"!=typeof e)(e)&&"function"==typeof e.then,bT=1073741823;const yT=aT(class extends gT{constructor(){super(...arguments),this._$Cwt=bT,this._$Cbt=[],this._$CK=new pT(this),this._$CX=new vT}render(...e){return e.find((e=>!_T(e)))??zf}update(e,t){const s=this._$Cbt;let n=s.length;this._$Cbt=t;const i=this._$CK,r=this._$CX;this.isConnected||this.disconnected();for(let e=0;e<t.length&&!(e>this._$Cwt);e++){const o=t[e];if(!_T(o))return this._$Cwt=e,o;e<n&&o===s[e]||(this._$Cwt=bT,n=0,Promise.resolve(o).then((async e=>{for(;r.get();)await r.get();const t=i.deref();if(void 0!==t){const s=t._$Cbt.indexOf(o);s>-1&&s<t._$Cwt&&(t._$Cwt=s,t.setValue(e))}})))}return zf}disconnected(){this._$CK.disconnect(),this._$CX.pause()}reconnected(){this._$CK.reconnect(this),this._$CX.resume()}}),wT=e=>{return e.image?Ag`<svg xmlns="http://www.w3.org/2000/svg" class="avatar ${e.classes}" width="${e.width}" height="${e.height}" aria-label="${e.alt_text}" role="${e.alt_text?xg:"presentation"}"><image width="${e.width}" height="${e.height}" preserveAspectRatio="xMidYMid meet" href="${t=e.image,s=e.image_type,t.startsWith("data:")?t:`data:${s};base64,${t}`}"/></svg>`:"";var t,s};var AT=s(7983),ST={};ST.styleTagTransform=T(),ST.setAttributes=E(),ST.insert=S().bind(null,"head"),ST.domAPI=w(),ST.insertStyleElement=C();b()(AT.A,ST);AT.A&&AT.A.locals&&AT.A.locals;Oh.elements.define("converse-avatar",class extends Nw{static get properties(){return{model:{type:Object},pickerdata:{type:Object},name:{type:String},width:{type:String},height:{type:String},nonce:{type:String}}}constructor(){super(),this.model=null,this.pickerdata=null,this.width=36,this.height=36,this.name=""}render(){const{image_type:e,image:t,data_uri:s}=Object.assign({},this.pickerdata?.attributes,this.model?.vcard?.attributes);if(e&&(t||s))return wT({classes:this.getAttribute("class"),height:this.height,width:this.width,image:s||`data:${e};base64,${t}`,image_type:e,alt_text:this.name});const n=`\n            width: ${this.width}px;\n            height: ${this.height}px;\n            font: ${this.width/2}px Arial;\n            line-height: ${this.height}px;`,i=this.model.getAvatarStyle(n);return Ag`<div class="avatar-initials" style="${yT(i,"background-color: gray;"+n)}" aria-label="${this.name}">${this.getInitials(this.name)}</div>`}getInitials(e){const t=e?.split(" ");return t?.length>1?t[0].charAt(0).toUpperCase()+t[t.length-1].charAt(0).toUpperCase():1===t?.length?t[0].charAt(0).toUpperCase():""}});const{u:xT}=qg.env;function ET(e){return"moderator"===e?kw("Moderators are privileged users who can change the roles of other users (except those with admin or owner affiliations."):"participant"===e?kw("The default role, implies that you can read and write messages."):"visitor"==e?kw("Visitors aren't allowed to write messages in a moderated multi-user chat."):void 0}function $T(e){return"owner"===e?kw("Owner is the highest affiliation. Owners can modify roles and affiliations of all other users."):"admin"===e?kw("Admin is the 2nd highest affiliation. Admins can modify roles and affiliations of all other users except owners."):"outcast"===e?kw('To ban a user, you give them the affiliation of "outcast".'):void 0}Oh.elements.define("converse-muc-occupant-modal",class extends JC{constructor(e){super(),this.message=e.message,this.addEventListener("affiliationChanged",(()=>this.alert(kw("Affiliation changed")))),this.addEventListener("roleChanged",(()=>this.alert(kw("role changed"))))}initialize(){super.initialize();const e=this.model??this.message;this.listenTo(e,"change",(()=>this.render())),Oh.trigger("occupantModalInitialized",{model:this.model,message:this.message})}getVcard(){const e=this.model??this.message;if(e.vcard)return e.vcard;const t=e?.get("jid")||e?.get("from");return t?Iu.state.vcards.get(t):null}renderModal(){return(e=>{const t=e.model??e.message,s=t?.get("jid"),n=e.getVcard(),i=t.get("nick"),r=t.get("occupant_id"),o=e.model?.get("role"),a=e.model?.get("affiliation"),c=e.model?.get("hats")?.length?e.model.get("hats"):null,l=e.model.collection.chatroom,d=l.getAllowedCommands().includes("modtools"),u=kw("Add to Contacts"),h=l.features.get("nonanonymous")||"moderator"===l.getOwnRole(),m=s!=Iu.session.get("bare_jid"),f=Oh.settings.get("singleton")?"":Oh.contacts.get(s).then((e=>!e&&m&&h)).then((t=>t?Ag`<li><button class="btn btn-primary" type="button" @click="${()=>e.addToContacts()}">${u}</button></li>`:""));return Ag`<div class="row"><div class="col-auto"><converse-avatar .model="${e.model}" class="avatar modal-avatar" name="${e.model.getDisplayName()}" nonce="${n?.get("vcard_updated")}" height="120" width="120"></converse-avatar></div><div class="col"><ul class="occupant-details"><li>${i?Ag`<div class="row"><strong class="g-0">${kw("Nickname")}:</strong></div><div class="row">${i}</div>`:""}</li><li>${s?Ag`<div class="row"><strong class="g-0">${kw("XMPP Address")}:</strong></div><div class="row">${s}</div>`:""}</li><li><div class="row"><strong class="g-0">${kw("Affiliation")}:</strong></div><div class="row">${a}  ${d?Ag`<a href="#" data-form="affiliation-form" class="toggle-form right" color="var(--subdued-color)" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>${e.show_affiliation_form?Ag`<converse-muc-affiliation-form jid="${s}" .muc="${l}" affiliation="${a}"></converse-muc-affiliation-form>`:""}`:""}</div></li><li><div class="row"><strong class="g-0">${kw("Role")}:</strong></div><div class="row">${o}  ${d&&o?Ag`<a href="#" data-form="row-form" class="toggle-form right" color="var(--subdued-color)" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>${e.show_role_form?Ag`<converse-muc-role-form jid="${s}" .muc="${l}" role="${o}"></converse-muc-role-form>`:""}`:""}</div></li><li>${c?Ag`<div class="row"><strong class="g-0">${kw("Hats")}:</strong></div><div class="row">${c}</div>`:""}</li><li>${r?Ag`<div class="row"><strong class="g-0">${kw("Occupant Id")}:</strong></div><div class="row">${r}</div>`:""}</li>${yT(f,"")}</ul></div></div>`})(this)}getModalTitle(){const e=this.model??this.message;return e?.getDisplayName()}addToContacts(){const e=(this.model??this.message).get("jid");e&&Oh.modal.show("converse-add-contact-modal",{model:new cd({jid:e})})}toggleForm(e){"row-form"===xT.ancestor(e.target,".toggle-form").getAttribute("data-form")?this.show_role_form=!this.show_role_form:this.show_affiliation_form=!this.show_affiliation_form,this.render()}});const CT=(e,t)=>Ag`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Role:</strong> ${t.item.role} ${t.assignable_roles.length?(e=>Ag`<a href="#" data-form="converse-muc-role-form" class="toggle-form right" color="var(--subdued-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_roles.length?Ag`<converse-muc-role-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" role="${t.item.role}"></converse-muc-role-form>`:""}</li></ul></li>`,kT=(e,t)=>Ag`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Affiliation:</strong> ${t.item.affiliation} ${t.assignable_affiliations.length?(e=>Ag`<a href="#" data-form="converse-muc-affiliation-form" class="toggle-form right" color="var(--subdued-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_affiliations.length?Ag`<converse-muc-affiliation-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" affiliation="${t.item.affiliation}"></converse-muc-affiliation-form>`:""}</li></ul></li>`,TT=(e,t)=>{const s=kw("Affiliation"),n=kw("No users with that affiliation found."),i=kw("No users with that role found."),r=kw("Type here to filter the search results"),o=kw("Role"),a=kw("Show users"),c=kw("Roles are assigned to users to grant or deny them certain abilities in a multi-user chat. They're assigned either explicitly or implicitly as part of an affiliation. A role that's not due to an affiliation, is only valid for the duration of the user's session."),l=kw("An affiliation is a long-lived entitlement which typically implies a certain role and which grants privileges and responsibilities. For example admins and owners automatically have the moderator role."),d=t.queryable_roles.length&&t.queryable_affiliations.length;return Ag`${t.alert_message?Ag`<div class="alert alert-${t.alert_type}" role="alert">${t.alert_message}</div>`:""} ${d?(e=>Ag`<ul class="nav nav-pills justify-content-center"><li role="presentation" class="nav-item"><a class="nav-link ${"affiliations"===e.tab?"active":""}" id="affiliations-tab" href="#affiliations-tabpanel" aria-controls="affiliations-tabpanel" role="tab" data-name="affiliations" @click="${e.switchTab}">Affiliations</a></li><li role="presentation" class="nav-item"><a class="nav-link ${"roles"===e.tab?"active":""}" id="roles-tab" href="#roles-tabpanel" aria-controls="roles-tabpanel" role="tab" data-name="roles" @click="${e.switchTab}">Roles</a></li></ul>`)(t):""}<div class="tab-content">${t.queryable_affiliations.length?Ag`<div class="tab-pane tab-pane--columns ${"affiliations"===t.tab?"active":""}" id="affiliations-tabpanel" role="tabpanel" aria-labelledby="affiliations-tab"><form class="converse-form query-affiliation" @submit="${t.queryAffiliation}"><p class="helptext pb-3">${l}</p><div><label class="form-label" for="affiliation"><strong>${s}:</strong></label><div class="row"><div class="col"><select class="form-select select-affiliation" name="affiliation">${t.queryable_affiliations.map((e=>(e=>Ag`<option value="${e.item||""}" ?selected="${e.item===e.affiliation}" title="${$T(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_affiliation" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_affiliation)&&t.users_with_affiliation.length>5?Ag`<input class="form-control" .value="${t.affiliations_filter}" @keyup="${t.filterAffiliationResults}" type="text" name="filter" placeholder="${r}">`:""}</div></div>${$T(t.affiliation)?Ag`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${$T(t.affiliation)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_affiliation?Ag`<li class="list-group-item">${Zk()}</li>`:""} ${Array.isArray(t.users_with_affiliation)&&0===t.users_with_affiliation.length?Ag`<li class="list-group-item">${n}</li>`:""} ${t.users_with_affiliation instanceof Error?Ag`<li class="list-group-item">${t.users_with_affiliation.message}</li>`:(t.users_with_affiliation||[]).map((s=>(s.nick||s.jid).match(new RegExp(t.affiliations_filter,"i"))?kT(e,Object.assign({item:s},t)):""))}</ul></div></div>`:""} ${t.queryable_roles.length?Ag`<div class="tab-pane tab-pane--columns ${"roles"===t.tab?"active":""}" id="roles-tabpanel" role="tabpanel" aria-labelledby="roles-tab"><form class="converse-form query-role" @submit="${t.queryRole}"><p class="helptext pb-3">${c}</p><div><label class="form-label" for="role"><strong>${o}:</strong></label><div class="row"><div class="col"><select class="form-select select-role" name="role">${t.queryable_roles.map((e=>(e=>Ag`<option value="${e.item||""}" ?selected="${e.item===e.role}" title="${ET(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_role" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_role)&&t.users_with_role.length>5?Ag`<input class="form-control" .value="${t.roles_filter}" @keyup="${t.filterRoleResults}" type="text" name="filter" placeholder="${r}">`:""}</div></div>${ET(t.role)?Ag`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${ET(t.role)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_role?Ag`<li class="list-group-item">${Zk()}</li>`:""} ${t.users_with_role&&0===t.users_with_role.length?Ag`<li class="list-group-item">${i}</li>`:""} ${(t.users_with_role||[]).map((s=>s.nick.match(t.roles_filter)?CT(e,Object.assign({item:s},t)):""))}</ul></div></div>`:""}</div>`};var jT=s(1946),NT={};NT.styleTagTransform=T(),NT.setAttributes=E(),NT.insert=S().bind(null,"head"),NT.domAPI=w(),NT.insertStyleElement=C();b()(jT.A,NT);jT.A&&jT.A.locals&&jT.A.locals;const{u:OT}=qg.env,{AFFILIATIONS:IT,ROLES:MT}=yw;Oh.elements.define("converse-modtools",class extends Nw{static get properties(){return{affiliation:{type:String},affiliations_filter:{type:String,attribute:!1},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1},jid:{type:String},muc:{type:Object,attribute:!1},role:{type:String},roles_filter:{type:String,attribute:!1},tab:{type:String},users_with_affiliation:{type:Array,attribute:!1},users_with_role:{type:Array,attribute:!1}}}constructor(){super(),this.jid=null,this.tab="affiliations",this.affiliation=null,this.affiliations_filter="",this.role="",this.roles_filter="",this.addEventListener("affiliationChanged",(()=>{this.alert(kw("Affiliation changed"),"primary"),this.onSearchAffiliationChange(),this.requestUpdate()})),this.addEventListener("roleChanged",(()=>{this.alert(kw("Role changed"),"primary"),this.requestUpdate()}))}updated(e){e.has("role")&&this.onSearchRoleChange(),e.has("affiliation")&&this.onSearchAffiliationChange(),e.has("jid")&&e.get("jid")&&this.initialize()}async initialize(){this.initialized=ic();const e=await Oh.rooms.get(this.jid);await e.initialized,this.muc=e,this.initialized.resolve()}render(){if(this.muc?.occupants){const e=this.muc.occupants.getOwnOccupant();return TT(this,{affiliations_filter:this.affiliations_filter,alert_message:this.alert_message,alert_type:this.alert_type,assignable_affiliations:e.getAssignableAffiliations(),assignable_roles:e.getAssignableRoles(),filterAffiliationResults:e=>this.filterAffiliationResults(e),filterRoleResults:e=>this.filterRoleResults(e),loading_users_with_affiliation:this.loading_users_with_affiliation,queryAffiliation:e=>this.queryAffiliation(e),queryRole:e=>this.queryRole(e),queryable_affiliations:IT.filter((e=>!Oh.settings.get("modtools_disable_query").includes(e))),queryable_roles:MT.filter((e=>!Oh.settings.get("modtools_disable_query").includes(e))),roles_filter:this.roles_filter,switchTab:e=>this.switchTab(e),tab:this.tab,toggleForm:e=>this.toggleForm(e),users_with_affiliation:this.users_with_affiliation,users_with_role:this.users_with_role})}return""}switchTab(e){e.stopPropagation(),e.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.requestUpdate()}async onSearchAffiliationChange(){if(this.affiliation){if(await this.initialized,this.clearAlert(),this.loading_users_with_affiliation=!0,this.users_with_affiliation=null,this.shouldFetchAffiliationsList()){const e=await Oh.rooms.affiliations.get(this.affiliation,this.jid);e instanceof Error?(this.alert(e.message,"danger"),this.users_with_affiliation=[]):this.users_with_affiliation=e}else this.users_with_affiliation=this.muc.getOccupantsWithAffiliation(this.affiliation);this.loading_users_with_affiliation=!1}}async onSearchRoleChange(){this.role&&(await this.initialized,this.clearAlert(),this.users_with_role=this.muc.getOccupantsWithRole(this.role))}shouldFetchAffiliationsList(){const e=this.affiliation;if("none"===e)return!1;return!l_.getAutoFetchedAffiliationLists().includes(e)}toggleForm(e){e.stopPropagation(),e.preventDefault();const t=OT.ancestor(e.target,".toggle-form"),s=t.getAttribute("data-form"),n=OT.ancestor(t,".list-group-item").querySelector(s);OT.hasClass("hidden",n)?OT.removeClass("hidden",n):OT.addClass("hidden",n)}filterRoleResults(e){this.roles_filter=e.target.value,this.render()}filterAffiliationResults(e){this.affiliations_filter=e.target.value}queryRole(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("role");this.role=null,this.role=t}queryAffiliation(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("affiliation");this.affiliation=null,this.affiliation=t}alert(e,t){this.alert_message=e,this.alert_type=t}clearAlert(){this.alert_message=void 0,this.alert_type=void 0}});Oh.elements.define("converse-modtools-modal",class extends JC{constructor(e){super(e),this.id="converse-modtools-modal",this.affiliation=e.affiliation,this.jid=e.jid}renderModal(){return Ag`<converse-modtools jid="${this.jid}" affiliation="${this.affiliation}"></converse-modtools>`}getModalTitle(){return kw("Moderator Tools")}});const{Strophe:RT,u:DT}=qg.env,{CHATROOMS_TYPE:LT}=yw,zT={admin:"admin",ban:"outcast",member:"member",owner:"owner",revoke:"none"},PT={deop:"participant",kick:"none",mute:"visitor",op:"moderator",voice:"participant"};function FT({contact:e,jid:t,reason:s}){return s?Oh.confirm(kw('%1$s has invited you to join a groupchat: %2$s, and left the following reason: "%3$s"',e,t,s)):Oh.confirm(kw("%1$s has invited you to join a groupchat: %2$s",e,t))}async function UT(e){const t=[kw("Are you sure you want to destroy this groupchat?")];let s=[{name:"challenge",label:kw("Please enter the XMPP address of this groupchat to confirm"),challenge:e.get("jid"),placeholder:kw("name@example.org"),required:!0},{name:"reason",label:kw("Optional reason for destroying this groupchat"),placeholder:kw("Reason")},{name:"newjid",label:kw("Optional XMPP address for a new groupchat that replaces this one"),placeholder:kw("replacement@example.org")}];try{s=await Oh.confirm(kw("Confirm"),t,s);const n=s.filter((e=>"reason"===e.name)).pop()?.value,i=s.filter((e=>"newjid"===e.name)).pop()?.value;return e.sendDestroyIQ(n,i).then((()=>e.close()))}catch(e){bt.error(e)}}function BT(e){const t=e.model.session.get("view"),s=e.model.get("jid"),n=qg.ROOMSTATUS,i=e.model.session.get("connection_status");return t===qg.MUC.VIEWS.CONFIG?Ag`<converse-muc-config-form class="muc-form-container" jid="${s}"></converse-muc-config-form>`:Ag`${i==n.PASSWORD_REQUIRED?Ag`<converse-muc-password-form class="muc-form-container" jid="${s}"></converse-muc-password-form>`:""} ${i==n.ENTERED?Ag`<converse-muc-chatarea class="row g-0" jid="${s}"></converse-muc-chatarea>`:""} ${i==n.CONNECTING?Zk({class:"vertically-centered"}):""} ${i==n.NICKNAME_REQUIRED?function(e){const t=e.get("jid");return Oh.settings.get("muc_show_logs_before_join")?Ag`<converse-muc-chatarea class="row g-0" jid="${t}"></converse-muc-chatarea>`:Ag`<converse-muc-nickname-form jid="${t}"></converse-muc-nickname-form>`}(e.model):""} ${i==n.DISCONNECTED?Ag`<converse-muc-disconnected jid="${s}"></converse-muc-disconnected>`:""} ${i==n.BANNED?Ag`<converse-muc-disconnected jid="${s}"></converse-muc-disconnected>`:""} ${i==n.DESTROYED?Ag`<converse-muc-destroyed jid="${s}"></converse-muc-destroyed>`:""}`}async function qT(){const e=[...await Oh.rooms.get(),...await Oh.contacts.get()],t=[...new Set(e.map((e=>RT.getDomainFromJid(e.get("jid")))))];return t}function HT(e,t,s,n=[],i=[]){const r=PT[t];if(!r)throw Error(`ChatRoomView#setRole called with invalid command: ${t}`);if(!e.verifyAffiliations(n)||!e.verifyRoles(i))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,s))return!1;const o=e.getNickOrJIDFromCommandArgs(s);if(!o)return!1;const a=s.split(o,2)[1].trim(),c=e.getOccupant(o);return e.setRole(c,r,a,void 0,(t=>e.onCommandError(t))),!0}function GT(e,t,s,n){const i=zT[t];if(!i)throw Error(`verifyAffiliations called with invalid command: ${t}`);if(!e.verifyAffiliations(n))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,s))return!1;const r=e.getNickOrJIDFromCommandArgs(s);if(!r)return!1;let o;const a=s.split(r,2)[1].trim(),c=e.getOccupant(r);if(c)o=c.get("jid");else{if(!DT.isValidJID(r)){const t=kw("Couldn't find a participant with that nickname. They might have left the groupchat.");return void e.createMessage({message:t,type:"error"})}o=r}const l={jid:o,reason:a};c&&Oh.settings.get("auto_register_muc_nickname")&&(l.nick=c.get("nick")),DT.muc.setAffiliation(i,e.get("jid"),[l]).then((()=>e.occupants.fetchMembers())).catch((t=>e.onCommandError(t)))}function WT(e,t){if(!e.verifyRoles(["moderator"]))return;let s=Oh.modal.get("converse-modtools-modal");s?(s.affiliation=t,s.render()):s=Oh.modal.create("converse-modtools-modal",{affiliation:t,jid:e.get("jid")}),s.show()}function VT(e,t){const s=e.model;if(t||s.get("type")!==LT||Oh.settings.get("muc_disable_slash_commands")&&!Array.isArray(Oh.settings.get("muc_disable_slash_commands")))return t;let n=e.text;n=n.replace(/^\s*/,"");const i=(n.match(/^\/([a-zA-Z]*) ?/)||[""]).pop().toLowerCase();if(!i)return!1;const r=n.slice(("/"+i).length+1).trim(),o=s.getAllowedCommands()??[];if("admin"===i&&o.includes(i))return GT(s,i,r,["owner"]),!0;if("ban"===i&&o.includes(i))return GT(s,i,r,["admin","owner"]),!0;if("modtools"===i&&o.includes(i))return WT(s,r),!0;if("deop"===i&&o.includes(i))return HT(s,i,r,["admin","owner"]),!0;if("destroy"===i&&o.includes(i))return!s.verifyAffiliations(["owner"])||(UT(s).catch((e=>s.onCommandError(e))),!0);if("help"===i&&o.includes(i))return s.set({show_help_messages:!1},{silent:!0}),s.set({show_help_messages:!0}),!0;if("kick"===i&&o.includes(i))return HT(s,i,r,[],["moderator"]),!0;if("mute"===i&&o.includes(i))return HT(s,i,r,[],["moderator"]),!0;if("member"===i&&o.includes(i))return GT(s,i,r,["admin","owner"]),!0;if("nick"===i&&o.includes(i)){if(!s.verifyRoles(["visitor","participant","moderator"]))return!0;if(0===r.length){const e=kw('Your nickname is "%1$s"',s.get("nick"));s.createMessage({message:e,type:"error"})}else s.setNickname(r);return!0}return"owner"===i&&o.includes(i)?(GT(s,i,r,["owner"]),!0):"op"===i&&o.includes(i)?(HT(s,i,r,["admin","owner"]),!0):"register"===i&&o.includes(i)?(r.length>1?s.createMessage({message:kw("Error: invalid number of arguments"),type:"error"}):s.registerNickname().then((e=>{e&&s.createMessage({message:e,type:"error"})})),!0):"revoke"===i&&o.includes(i)?(GT(s,i,r,["admin","owner"]),!0):"topic"===i&&o.includes(i)||"subject"===i&&o.includes(i)?(s.setSubject(r),!0):!("voice"!==i||!o.includes(i))&&(HT(s,i,r,[],["moderator"]),!0)}const QT=e=>{const t=kw("On which entity do you want to run commands?"),s=kw("Certain XMPP services and entities allow privileged users to execute ad-hoc commands on them."),n=kw("Commands found"),i=kw("List available commands"),r=kw("XMPP Address"),o=kw("No commands found");return Ag`${e.alert?Ag`<div class="alert alert-${e.alert_type}" role="alert">${e.alert}</div>`:""} ${e.note?Ag`<p class="form-help">${e.note}</p>`:""}<form class="converse-form" @submit="${e.fetchCommands}"><fieldset><label class="form-label">${t}<p class="form-help">${s}</p><converse-autocomplete .getAutoCompleteList="${qT}" required placeholder="${r}" name="jid"></converse-autocomplete></label></fieldset><fieldset>${e.fetching?Zk():Ag`<input type="submit" class="btn btn-primary" value="${i}">`}</fieldset>${"list-commands"===e.view?Ag`<fieldset><ul class="list-group"><li class="list-group-item active">${e.commands.length?n:o}:</li>${e.commands.map((t=>((e,t)=>Ag`<li class="room-item list-group-item"><div class="available-chatroom d-flex flex-row"><a class="open-room available-room w-100" @click="${t=>e.toggleCommandForm(t)}" data-command-node="${t.node}" data-command-jid="${t.jid}" data-command-name="${t.name}" title="${t.name}" href="#">${t.name||t.jid}</a></div>${t.node===e.showform?Yk(e,t):""}</li>`)(e,t)))}</ul></fieldset>`:""}</form>`},{Strophe:JT,sizzle:YT}=qg.env;Oh.elements.define("converse-adhoc-commands",class extends Nw{static get properties(){return{alert:{type:String},alert_type:{type:String},commands:{type:Array},fetching:{type:Boolean},showform:{type:String},view:{type:String}}}constructor(){super(),this.view="choose-service",this.fetching=!1,this.showform="",this.commands=[]}render(){return QT(this)}async fetchCommands(e){if(e.preventDefault(),!(e.target instanceof HTMLFormElement))return this.alert_type="danger",void(this.alert="Form could not be submitted");this.fetching=!0,delete this.alert_type,delete this.alert;const t=new FormData(e.target).get("jid").trim();let s;try{s=await Oh.disco.supports(JT.NS.ADHOC,t)}catch(e){bt.error(e)}finally{this.fetching=!1}if(s)try{this.commands=await Oh.adhoc.getCommands(t),this.view="list-commands"}catch(e){return bt.error(e),this.alert_type="danger",this.alert=kw("Sorry, an error occurred while looking for commands on that entity."),this.commands=[],void bt.error(e)}else this.commands=[],this.alert_type="danger",this.alert=kw("The specified entity doesn't support ad-hoc commands")}async toggleCommandForm(e){e.preventDefault();const t=e.target.getAttribute("data-command-node"),s=this.commands.filter((e=>e.node===t))[0],{jid:n}=s;if(this.showform===t)this.showform="",this.requestUpdate();else{try{const e=await Oh.adhoc.fetchCommandForm(n,t);Object.assign(s,e)}catch(e){null===e?bt.error(`Error: timeout while trying to execute command for ${n}`):(bt.error(`Error while trying to execute command for ${n}`),bt.error(e)),s.alert=kw("An error occurred while trying to fetch the command form"),s.alert_type="danger"}this.showform=t}}executeAction(e){e.preventDefault();const t=e.target,s=t.getAttribute("data-action");["execute","next","prev","complete"].includes(s)?this.runCommand(t.form,s):bt.error(`Unknown action: ${s}`)}clearCommand(e){delete e.alert,delete e.instructions,delete e.sessionid,delete e.alert_type,delete e.status,e.fields=[],e.actions=[],this.showform=""}async runCommand(e,t){const s=new FormData(e),n=s.get("command_jid").trim(),i=s.get("command_node").trim(),r=this.commands.filter((e=>e.node===i))[0];delete r.alert,this.requestUpdate();const o="prev"===t?[]:YT(":input:not([type=button]):not([type=submit])",e).filter((e=>!["command_jid","command_node"].includes(e.getAttribute("name")))).map(Lk).filter((e=>e)),a=await Oh.adhoc.runCommand(n,r.sessionid,r.node,t,o),{fields:c,status:l,note:d,instructions:u,actions:h}=a;if("error"===l)return r.status=l,r.alert_type="danger",r.alert=kw("Sorry, an error occurred while trying to execute the command. See the developer console for details"),this.requestUpdate();"executing"===l?(Object.assign(r,{fields:c,instructions:u,actions:h,status:l}),r.alert=kw("Executing"),r.alert_type="primary"):"completed"===l?(this.alert_type="primary",this.alert=kw("Completed"),this.note=d,this.clearCommand(r)):(bt.error(`Unexpected status for ad-hoc command: ${l}`),r.alert=kw("Completed"),r.alert_type="primary"),this.requestUpdate()}async cancel(e){e.preventDefault(),this.showform="",this.requestUpdate();const t=new FormData(e.target.form),s=t.get("command_jid").trim(),n=t.get("command_node").trim(),i=this.commands.filter((e=>e.node===n))[0];delete i.alert,this.requestUpdate();const{status:r}=await Oh.adhoc.runCommand(s,i.sessionid,i.node,"cancel",[]);"error"===r?(i.alert_type="danger",i.alert=kw("An error occurred while trying to cancel the command. See the developer console for details")):"canceled"===r?(this.alert_type="",this.alert="",this.clearCommand(i)):(bt.error(`Unexpected status for ad-hoc command: ${r}`),i.alert=kw("Error: unexpected result"),i.alert_type="danger"),this.requestUpdate()}}),qg.plugins.add("converse-adhoc-views",{dependencies:["converse-controlbox","converse-muc"],initialize(){Oh.settings.extend({allow_adhoc_commands:!0})}});const{CHATROOMS_TYPE:XT}=yw;function KT(e,t){if(Oh.settings.get("allow_bookmarks")&&e.model.get("type")===XT){const s={i18n_title:kw("Bookmark this groupchat"),i18n_text:kw("Bookmark"),handler:t=>e.showBookmarkModal(t),a_class:"toggle-bookmark",icon_class:"fa-bookmark",name:"bookmark"},n=t.map((e=>e.name)),i=n.indexOf("details"),r=N_.checkBookmarksSupport().then((e=>e?s:null));return i>-1?[...t.slice(0,i+1),r,...t.slice(i+1)]:[r,...t]}return t}async function ZT(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-bookmark-name"),s=e.currentTarget.getAttribute("data-room-jid");await Oh.confirm(kw('Are you sure you want to remove the bookmark "%1$s"?',t))&&Iu.state.bookmarks.where({jid:s}).forEach((e=>e.destroy()))}function ej(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-room-jid");Oh.modal.show("converse-bookmark-form-modal",{jid:t},e)}function tj(e){e.preventDefault();const{Strophe:t}=qg.env,s=e.target.textContent,n=e.target.getAttribute("data-room-jid"),i={name:s||t.unescapeNode(t.getNodeFromJid(n))||n};Oh.rooms.open(n,i,!0)}const sj=e=>{const t=e.get("jid"),s=kw("Unbookmark this groupchat"),n=kw("Click to open this groupchat");return Ag`<div class="list-item room-item available-chatroom d-flex flex-row" data-room-jid="${t}"><a class="list-item-link open-room w-100" data-room-jid="${t}" title="${n}" @click="${tj}">${e.getDisplayName()}</a> <a class="list-item-action remove-bookmark align-self-center ${e.get("bookmarked")?"button-on":""}" tabindex="0" data-room-jid="${t}" data-bookmark-name="${e.getDisplayName()}" title="${s}" @click="${ZT}"><converse-icon class="fa fa-bookmark" size="1em"></converse-icon></a></div>`};var nj=s(1205),ij={};ij.styleTagTransform=T(),ij.setAttributes=E(),ij.insert=S().bind(null,"head"),ij.domAPI=w(),ij.insertStyleElement=C();b()(nj.A,ij);nj.A&&nj.A.locals&&nj.A.locals;const{initStorage:rj}=Sm;class oj extends Nw{async initialize(){await Oh.waitUntil("bookmarksInitialized");const{bookmarks:e,chatboxes:t}=Iu.state;this.liveFilter=Lu((e=>this.model.set({text:e.target.value})),100),this.listenTo(e,"add",(()=>this.requestUpdate())),this.listenTo(e,"remove",(()=>this.requestUpdate())),this.listenTo(t,"add",(()=>this.requestUpdate())),this.listenTo(t,"remove",(()=>this.requestUpdate()));const s=`converse.bookmarks-list-model-${Iu.session.get("bare_jid")}`;this.model=new cd({id:s}),rj(this.model,s),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.model.fetch({success:()=>this.requestUpdate(),error:()=>this.requestUpdate()})}render(){return Iu.state.bookmarks&&this.model?(e=>{const t=kw("Filter"),s=e.model.get("text"),{bookmarks:n}=Iu.state,i=s?n.filter((e=>((e,t)=>e.get("name")?.includes(t)||e.get("jid")?.includes(t))(e,s))):n;return Ag`<form class="converse-form bookmarks-filter"><div class="btn-group w-100"><input .value="${s??""}" @keydown="${t=>e.liveFilter(t)}" class="form-control" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${s?"":"hidden"}" @click="${e.clearFilter}"></converse-icon></div></form><div class="list-container list-container--bookmarks"><div class="items-list bookmarks rooms-list">${i.map((e=>sj(e)))}</div></div>`})(this):Zk()}clearFilter(e){e?.stopPropagation?.(),this.model.set("text","")}}Oh.elements.define("converse-bookmarks",oj);Oh.elements.define("converse-bookmark-list-modal",class extends JC{renderModal(){return Ag`<converse-bookmarks></converse-bookmarks>`}getModalTitle(){return kw("Bookmarks")}});class aj extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}willUpdate(e){const{chatboxes:t,bookmarks:s}=Iu.state;e.has("jid")&&(this.model=t.get(this.jid),this.bookmark=s.get(this.jid))}render(){return(e=>{const t=e.model.getDisplayName(),s=e.bookmark?.get("nick")??e.model.get("nick"),n=kw('Bookmark for "%1$s"',t),i=kw("Would you like this groupchat to be automatically joined upon startup?"),r=kw("Remove"),o=kw("The name for this bookmark:"),a=kw("What should your nickname for this groupchat be?"),c=e.bookmark?kw("Update"):kw("Save");return Ag`<form class="converse-form chatroom-form" @submit="${t=>e.onBookmarkFormSubmitted(t)}"><legend>${n}</legend><fieldset><label class="form-label" for="converse_muc_bookmark_name">${o}</label> <input class="form-control" type="text" value="${t}" name="name" required="required" id="converse_muc_bookmark_name"></fieldset><fieldset><label class="form-label" for="converse_muc_bookmark_nick">${a}</label> <input class="form-control" type="text" name="nick" value="${s||""}" id="converse_muc_bookmark_nick"></fieldset><fieldset class="form-group form-check"><input class="form-check-input" id="converse_muc_bookmark_autojoin" type="checkbox" ?checked="${e.bookmark?.get("autojoin")}" name="autojoin"> <label class="form-check-label" for="converse_muc_bookmark_autojoin">${i}</label></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${c}"> ${e.bookmark?Ag`<input class="btn btn-secondary button-remove" type="button" value="${r}" @click="${t=>e.removeBookmark(t)}">`:""}</fieldset></form>`})(this)}onBookmarkFormSubmitted(e){e.preventDefault();const{bookmarks:t}=Iu.state,s=e.target;t.createBookmark({jid:this.jid,autojoin:s.querySelector('input[name="autojoin"]')?.checked||!1,name:s.querySelector("input[name=name]")?.value,nick:s.querySelector("input[name=nick]")?.value}),this.closeBookmarkForm(e)}removeBookmark(e){this.bookmark?.destroy(),this.closeBookmarkForm(e)}closeBookmarkForm(e){e.preventDefault(),this.dispatchEvent(new Event("hide.bs.modal",{bubbles:!0,cancelable:!0}))}}Oh.elements.define("converse-muc-bookmark-form",aj);const cj=aj;Oh.elements.define("converse-bookmark-form-modal",class extends JC{constructor(e){super(e),this.jid=null}renderModal(){return Ag`<converse-muc-bookmark-form class="muc-form-container" jid="${this.jid}"></converse-muc-bookmark-form>`}getModalTitle(){return kw("Bookmark")}});const{u:lj}=qg.env,dj={setBookmarkState(){const{bookmarks:e}=Iu.state;if(e){e.where({jid:this.model.get("jid")}).length?this.model.save("bookmarked",!0):this.model.save("bookmarked",!1)}},renderBookmarkForm(){if(!this.bookmark_form){this.bookmark_form=new Iu.state.MUCBookmarkForm({model:this.model,chatroomview:this});this.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.bookmark_form.el)}lj.showElement(this.bookmark_form.el)},showBookmarkModal(e){e?.preventDefault();const t=this.model.get("jid");Oh.modal.show("converse-bookmark-form-modal",{jid:t},e)}};qg.plugins.add("converse-bookmark-views",{dependencies:["converse-chatboxes","converse-muc","converse-muc-views"],initialize(){Oh.settings.extend({hide_open_bookmarks:!0});const e={removeBookmarkViaEvent:ZT,addBookmarkViaEvent:ej,MUCBookmarkForm:cj,BookmarksView:oj};Object.assign(Iu,e),Object.assign(Iu.exports,e),Object.assign(Iu.exports.ChatRoomView.prototype,dj),Oh.listen.on("getHeadingButtons",KT),Oh.listen.on("chatRoomViewInitialized",(e=>e.setBookmarkState()))}});const uj=(e,t,s)=>{const n=new Map;for(let i=t;i<=s;i++)n.set(e[i],i);return n},hj=aT(class extends cT{constructor(e){if(super(e),e.type!==oT)throw Error("repeat() can only be used in text expressions")}dt(e,t,s){let n;void 0===s?s=t:void 0!==t&&(n=t);const i=[],r=[];let o=0;for(const t of e)i[o]=n?n(t,o):o,r[o]=s(t,o),o++;return{values:r,keys:i}}render(e,t,s){return this.dt(e,t,s).values}update(e,[t,s,n]){const i=(e=>e._$AH)(e),{values:r,keys:o}=this.dt(t,s,n);if(!Array.isArray(i))return this.ut=o,r;const a=this.ut??=[],c=[];let l,d,u=0,h=i.length-1,m=0,f=r.length-1;for(;u<=h&&m<=f;)if(null===i[u])u++;else if(null===i[h])h--;else if(a[u]===o[m])c[m]=nT(i[u],r[m]),u++,m++;else if(a[h]===o[f])c[f]=nT(i[h],r[f]),h--,f--;else if(a[u]===o[f])c[f]=nT(i[u],r[f]),sT(e,c[f+1],i[u]),u++,f--;else if(a[h]===o[m])c[m]=nT(i[h],r[m]),sT(e,i[u],i[h]),h--,m++;else if(void 0===l&&(l=uj(o,m,f),d=uj(a,u,h)),l.has(a[u]))if(l.has(a[h])){const t=d.get(o[m]),s=void 0!==t?i[t]:null;if(null===s){const t=sT(e,i[u]);nT(t,r[m]),c[m]=t}else c[m]=nT(s,r[m]),sT(e,i[u],s),i[t]=null;m++}else rT(i[h]),h--;else rT(i[u]),u++;for(;m<=f;){const t=sT(e,c[f+1]);nT(t,r[m]),c[m++]=t}for(;u<=h;){const e=i[u++];null!==e&&rT(e)}return this.ut=o,((e,t=iT)=>{e._$AH=t})(e,c),zf}}),{CONTROLBOX_TYPE:mj,CHATROOMS_TYPE:fj,HEADLINES_TYPE:gj}=yw;function pj(e){const t="overlayed"===Oh.settings.get("view_mode")&&e.get("minimized");return e.get("type")===mj||!(e.get("hidden")||t)}Oh.elements.define("converse-chats",class extends Nw{initialize(){this.model=Iu.state.chatboxes,this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>this.requestUpdate())),this.listenTo(this.model,"change:jid",(()=>this.requestUpdate())),this.listenTo(this.model,"change:minimized",(()=>this.requestUpdate())),this.listenTo(this.model,"destroy",(()=>this.requestUpdate())),this.listenTo(Iu,"connected",(()=>this.requestUpdate())),this.listenTo(Iu,"reconnected",(()=>this.requestUpdate())),this.listenTo(Iu,"disconnected",(()=>this.requestUpdate()));const e=Oh.settings.get();this.listenTo(e,"change:view_mode",(()=>this.requestUpdate())),this.listenTo(e,"change:singleton",(()=>this.requestUpdate()));document.querySelector("body").classList.add(`converse-${Oh.settings.get("view_mode")}`),Oh.trigger("chatBoxViewsInitialized")}render(){return(()=>{const{chatboxes:e}=Iu.state,t=Oh.settings.get("view_mode"),s=Oh.connection.get(),n=!s?.connected||!s?.authenticated||s?.disconnecting;return Ag`${n||"overlayed"!==t?"":Ag`<converse-minimized-chats class="col-auto"></converse-minimized-chats>`} ${hj(e.filter(pj),(e=>e.get("jid")),(e=>e.get("type")===mj?Ag`${"overlayed"===t?Ag`<converse-controlbox-toggle class="${e.get("closed")?"col-auto":"hidden"}"></converse-controlbox-toggle>`:""}<converse-controlbox id="controlbox" class="col-auto chatbox ${"overlayed"===t&&e.get("closed")?"hidden":""} ${n?"logged-out":""}" style="${e.get("width")?`width: ${e.get("width")}`:""}"></converse-controlbox>`:e.get("type")===fj?Ag`<converse-muc jid="${e.get("jid")}" class="col-auto chatbox chatroom"></converse-muc>`:e.get("type")===gj?Ag`<converse-headlines jid="${e.get("jid")}" class="col-auto chatbox headlines"></converse-headlines>`:Ag`<converse-chat jid="${e.get("jid")}" class="col-auto chatbox"></converse-chat>`))}`})()}});const vj=class{constructor(){this.views={},this.el=null}add(e,t){this.views[e]=t}get(e){return this.views[e]}xget(e){return this.keys().filter((t=>t!==e)).reduce(((e,t)=>(e[t]=this.views[t],e)),{})}getAll(){return Object.values(this.views)}keys(){return Object.keys(this.views)}remove(e){delete this.views[e]}map(e){return Object.values(this.views).map(e)}forEach(e){return Object.values(this.views).forEach(e)}filter(e){return Object.values(this.views).filter(e)}closeAllChatBoxes(){return Promise.all(Object.values(this.views).map((e=>e.close({name:"closeAllChatBoxes"}))))}};function _j(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}var bj=s(3403),yj={};yj.styleTagTransform=T(),yj.setAttributes=E(),yj.insert=S().bind(null,"head"),yj.domAPI=w(),yj.insertStyleElement=C();b()(bj.A,yj);bj.A&&bj.A.locals&&bj.A.locals;qg.plugins.add("converse-chatboxviews",{dependencies:["converse-chatboxes","converse-vcard"],initialize(){Oh.promises.add(["chatBoxViewsInitialized"]),Oh.settings.extend({animate:!0});const e=new vj;Object.assign(Iu,{chatboxviews:e}),Object.assign(Iu.state,{chatboxviews:e}),Oh.listen.on("chatBoxesInitialized",(()=>{Iu.state.chatboxes.on("destroy",(t=>e.remove(t.get("jid"))))})),Oh.listen.on("cleanup",(()=>Object.assign(Iu,{chatboxviews:null}))),Oh.listen.on("cleanup",(()=>delete Iu.state.chatboxviews)),Oh.listen.on("clearSession",(()=>e.closeAllChatBoxes())),Oh.listen.on("chatBoxViewsInitialized",_j),window.addEventListener("resize",_j),Object.assign(qg,{insertInto(t){const s=e.el;if(s&&!t.contains(s))t.insertAdjacentElement("afterbegin",s);else if(!s)throw new Error("Cannot insert non-existing #conversejs element into the DOM")}})}});const{getURI:wj}=Sm;function Aj(e,t){const s=wj(t),n=s.subdomain(),i=s.domain(),r=`${n?`${n}.`:""}${i}`;return e.includes(i)||e.includes(r)}function Sj(e,t){const s=Oh.settings.get(t);if(!Array.isArray(s))return!0;try{return Aj(s,e)}catch(e){return bt.debug(e),!1}}function xj(e){return e.is_audio&&Sj(e.url,"allowed_audio_domains")||e.is_video&&Sj(e.url,"allowed_video_domains")||e.is_image&&Sj(e.url,"allowed_image_domains")}function Ej(e,t){if(!function(e){const t=wj(e),{protocol:s}=window.location;return!!["chrome-extension:","file:"].includes(s)||"http:"===s||"https:"===s&&["https","aesgcm"].includes(t.protocol().toLowerCase())}(e))return!1;const s=Oh.settings.get("render_media"),n=Sj(e,`allowed_${t}_domains`);return Array.isArray(s)?n&&Aj(s,e):n&&s}var $j=s(7187),Cj={};Cj.styleTagTransform=T(),Cj.setAttributes=E(),Cj.insert=S().bind(null,"head"),Cj.domAPI=w(),Cj.insertStyleElement=C();b()($j.A,Cj);$j.A&&$j.A.locals&&$j.A.locals;const{getMediaURLs:kj}=Sm,{CHATROOMS_TYPE:Tj}=yw;class jj extends Nw{static get properties(){return{is_retracted:{type:Boolean},model:{type:Object}}}constructor(){super(),this.model=null,this.is_retracted=null}initialize(){const e=Oh.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.collection.chatbox.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.collection.chatbox.occupants,"add",this.updateIfOwnOccupant),this.listenTo(this.model.collection.chatbox.occupants,"change:role",this.updateIfOwnOccupant),this.listenTo(this.model.collection.chatbox.session,"change:connection_status",(()=>this.requestUpdate()))}updateIfOwnOccupant(e){const t=Iu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}render(){return Ag`${yT(this.renderActions(),"")}`}async renderActions(){if(!this.model.collection)return"";const e=(await this.getActionButtons()).map((e=>jj.getActionsDropdownItem(e)));return e.length?Ag`<converse-dropdown class="chat-msg__actions btn-group dropstart" .items="${e}"></converse-dropdown>`:""}static getActionsDropdownItem(e){return Ag`<button type="button" class="dropdown-item chat-msg__action ${e.button_class}" @click="${e.handler}"><converse-icon class="${e.icon_class}" color="var(--inverse-link-color)" size="1em"></converse-icon> ${e.i18n_text}</button>`}async onMessageEditButtonClicked(e){e.preventDefault();const t=this.model.collection.findWhere("correcting"),s=Sm.ancestor(this,".chatbox")?.querySelector(".chat-textarea")?.value;if(s&&(!t||t.getMessageText()!==s)){if(!await Oh.confirm(kw("You have an unsent message which will be lost if you continue. Are you sure?")))return}t!==this.model?(t?.save("correcting",!1),this.model.save("correcting",!0)):this.model.save("correcting",!1)}async onDirectMessageRetractButtonClicked(){if("me"!==this.model.get("sender"))return bt.error("onMessageRetractButtonClicked called for someone else's message!");const e=kw("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere."),t=[kw("Are you sure you want to retract this message?")];Oh.settings.get("show_retraction_warning")&&(t[1]=e);if(await Oh.confirm(kw("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}}async retractOtherMessage(e){const t=this.model.collection.chatbox,s=await t.retractOtherMessage(this.model,e);if(null===s){const e=kw("A timeout occurred while trying to retract the message");Oh.alert("error",kw("Error"),e),bt.warn(e)}else if(Sm.isErrorStanza(s)){const e=kw("Sorry, you're not allowed to retract this message.");Oh.alert("error",kw("Error"),e),bt.warn(e),bt.error(s)}}async onMUCMessageRetractButtonClicked(){const e=kw("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere.");if(this.model.mayBeRetracted()){const t=[kw("Are you sure you want to retract this message?")];if(Oh.settings.get("show_retraction_warning")&&(t[1]=e),await Oh.confirm(kw("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}}else if(await this.model.mayBeModerated())if("me"===this.model.get("sender")){let t=[kw("Are you sure you want to retract this message?")];Oh.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]),await Oh.confirm(kw("Confirm"),t)&&this.retractOtherMessage()}else{let t=[kw("You are about to retract this message."),kw("You may optionally include a message, explaining the reason for the retraction.")];Oh.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]);const s=await Oh.prompt(kw("Message Retraction"),t,kw("Optional reason"));!1!==s&&this.retractOtherMessage(s)}else{const e=kw("Sorry, you're not allowed to retract this message");Oh.alert("error",kw("Error"),e)}}onMessageRetractButtonClicked(e){e?.preventDefault?.();this.model.collection.chatbox.get("type")===Tj?this.onMUCMessageRetractButtonClicked():this.onDirectMessageRetractButtonClicked()}onMediaToggleClicked(e){if(e?.preventDefault?.(),this.hasHiddenMedia(this.getMediaURLs()))this.model.save({hide_url_previews:!1,url_preview_transition:"fade-in"});else{(this.model.get("ogp_metadata")||[]).length?this.model.set("url_preview_transition","fade-out"):this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}}hasHiddenMedia(e){if("boolean"==typeof this.model.get("hide_url_previews"))return this.model.get("hide_url_previews");const t=Oh.settings.get("render_media");return Array.isArray(t)?e.reduce(((e,s)=>e||!Aj(t,s)),!1):!t}getMediaURLs(){const e=(this.model.get("ogp_metadata")||[]).map((e=>({url:e["og:image"],is_image:!0}))).filter((e=>xj(e))),t=kj(this.model.get("media_urls")||[],this.model.get("body")).filter((e=>xj(e)));return[...new Set([...t.map((e=>e.url)),...e.map((e=>e.url))])]}addMediaRenderingToggle(e){const t=this.getMediaURLs();if(t.length){const s=this.hasHiddenMedia(t);e.push({i18n_text:kw(s?"Show media":"Hide media"),handler:e=>this.onMediaToggleClicked(e),button_class:"chat-msg__action-hide-previews",icon_class:s?"fas fa-eye":"fas fa-eye-slash",name:"hide"})}}async onMessageCopyButtonClicked(e){e?.preventDefault?.(),await navigator.clipboard.writeText(this.model.getMessageText())}onMessageQuoteButtonClicked(e){e?.preventDefault?.();const{chatboxviews:t}=Iu.state,s=t.get(this.model.collection.chatbox.get("jid"));s?.getMessageForm().insertIntoTextArea(this.model.getMessageText().replaceAll(/^/gm,"> "),!1,!1,null,"\n")}async getActionButtons(){const e=[];this.model.get("editable")&&e.push({i18n_text:this.model.get("correcting")?kw("Cancel Editing"):kw("Edit"),handler:e=>this.onMessageEditButtonClicked(e),button_class:"chat-msg__action-edit",icon_class:"fa fa-pencil-alt",name:"edit"});const t=["groupchat","mep"].includes(this.model.get("type"))&&await this.model.mayBeModerated();return!this.is_retracted&&(this.model.mayBeRetracted()||t)&&e.push({i18n_text:kw("Retract"),handler:e=>this.onMessageRetractButtonClicked(e),button_class:"chat-msg__action-retract",icon_class:"fas fa-trash-alt",name:"retract"}),this.model.collection?(this.addMediaRenderingToggle(e),e.push({i18n_text:kw("Copy"),handler:e=>this.onMessageCopyButtonClicked(e),button_class:"chat-msg__action-copy",icon_class:"fas fa-copy",name:"copy"}),this.model.collection.chatbox.canPostMessages()&&e.push({i18n_text:kw("Quote"),handler:e=>this.onMessageQuoteButtonClicked(e),button_class:"chat-msg__action-quote",icon_class:"fas fa-quote-right",name:"quote"}),Oh.hook("getMessageActionButtons",this,e)):[]}}Oh.elements.define("converse-message-actions",jj);var Nj=s(719),Oj={};Oj.styleTagTransform=T(),Oj.setAttributes=E(),Oj.insert=S().bind(null,"head"),Oj.domAPI=w(),Oj.insertStyleElement=C();b()(Nj.A,Oj);Nj.A&&Nj.A.locals&&Nj.A.locals;Oh.elements.define("converse-image-modal",class extends JC{constructor(e){super(e),this.src=e.src}renderModal(){return(e=>Ag`<img class="chat-image chat-image--modal" src="${e.src}">`)({src:this.src})}getModalTitle(){return Ag`${kw("Image: ")}<a target="_blank" rel="noopener" href="${this.src}">${zk(this.src)}</a>`}});var Ij=s(9641);class Mj{constructor(e,t){this.options=Object.assign({width:null,height:null,autoplay:!0,loop:!0,show_progress_bar:!0,progress_bg_color:"rgba(0,0,0,0.4)",progress_color:"rgba(255,0,22,.8)",progress_bar_height:5},t),this.el=e,this.gif_el=e.querySelector("img"),this.canvas=e.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.offscreenCanvas=document.createElement("canvas"),this.patchCanvas=document.createElement("canvas"),this.ctx_scaled=!1,this.frames=[],this.load_error=null,this.playing=this.options.autoplay,this.frame_idx=0,this.iteration_count=0,this.start=null,this.hovering=null,this.frameImageData=null,this.disposal_restore_from_idx=null,this.initialize()}async initialize(){this.options.width&&this.options.height&&this.setSizes(this.options.width,this.options.height);const e=await this.fetchGIF(this.gif_el.src);requestAnimationFrame((()=>this.handleGIFResponse(e)))}initPlayer(){if(!this.load_error&&(this.options.width&&this.options.height||this.ctx.scale(this.getCanvasScale(),this.getCanvasScale()),this.frame_idx=0,this.renderImage(),this.options.autoplay)){const e=this.frames[this.frame_idx]?.delay??0;setTimeout((()=>this.play()),e)}}getNextFrameNo(){return 0===this.frames.length?0:(this.frame_idx+1+this.frames.length)%this.frames.length}onIterationEnd(){return this.iteration_count++,this.options.onIterationEnd?.(this),!this.options.loop&&(this.pause(),!0)}onAnimationFrame(e,t,s){if(!this.playing)return;if(e-t<s)return this.hovering?this.drawPauseIcon():this.renderImage(),void requestAnimationFrame((e=>this.onAnimationFrame(e,t,s)));const n=this.getNextFrameNo();if(0===n&&this.onIterationEnd())return;this.frame_idx=n,this.renderImage();const i=this.frames[this.frame_idx]?.delay||8;requestAnimationFrame((t=>this.onAnimationFrame(t,e,i)))}setSizes(e,t){this.canvas.width=e*this.getCanvasScale(),this.canvas.height=t*this.getCanvasScale(),this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,this.offscreenCanvas.style.width=e+"px",this.offscreenCanvas.style.height=t+"px",this.offscreenCanvas.getContext("2d").setTransform(1,0,0,1,0,0)}doShowProgress(e,t,s){if(s&&this.options.show_progress_bar){let s=this.options.progress_bar_height;const n=(this.canvas.height-s)/(this.ctx_scaled?this.getCanvasScale():1),i=e/t*this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1),r=this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1);s/=this.ctx_scaled?this.getCanvasScale():1,this.ctx.fillStyle=this.options.progress_bg_color,this.ctx.fillRect(i,n,r-i,s),this.ctx.fillStyle=this.options.progress_color,this.ctx.fillRect(0,n,i,s)}}handleGIFResponse(e){try{const t=(0,Ij.O5)(e);this.hdr=t.header,this.lsd=t.lsd,this.setSizes(this.options.width??this.lsd.width,this.options.height??this.lsd.height),this.frames=(0,Ij.Ud)(t,!0)}catch(e){this.showError()}this.initPlayer(),!this.options.autoplay&&this.drawPlayIcon()}drawError(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.options.width,this.options.height),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(this.options.width,this.options.height),this.ctx.moveTo(0,this.options.height),this.ctx.lineTo(this.options.width,0),this.ctx.stroke()}showError(){this.load_error=!0,this.hdr={width:this.gif_el.width,height:this.gif_el.height},this.frames=[],this.drawError(),this.el.requestUpdate()}manageDisposal(e){if(e<=0)return;const t=this.offscreenCanvas.getContext("2d"),s=this.frames[e-1].disposalType;e>1&&(3===s?null!=this.disposal_restore_from_idx&&t.putImageData(this.frames[this.disposal_restore_from_idx].data,0,0):this.disposal_restore_from_idx=e-1),2===s&&t.clearRect(this.last_frame.dims.left,this.last_frame.dims.top,this.last_frame.dims.width,this.last_frame.dims.height)}renderImage(e=!0){if(!this.frames.length)return;let t=this.frame_idx;t=parseInt(t.toString(),10),(t>this.frames.length-1||t<0)&&(t=0),this.manageDisposal(t);const s=this.frames[t],n=this.patchCanvas.getContext("2d"),i=this.offscreenCanvas.getContext("2d"),r=s.dims;this.frameImageData&&r.width==this.frameImageData.width&&r.height==this.frameImageData.height||(this.patchCanvas.width=r.width,this.patchCanvas.height=r.height,this.frameImageData=n.createImageData(r.width,r.height)),this.frameImageData.data.set(s.patch),n.putImageData(this.frameImageData,0,0),i.drawImage(this.patchCanvas,r.left,r.top);const o=i.getImageData(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height);this.ctx.putImageData(o,0,0),this.ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height),e&&this.hovering&&this.drawPauseIcon(),this.last_frame=s}play(){this.playing=!0,requestAnimationFrame((e=>this.onAnimationFrame(e,0,0)))}pause(){this.playing=!1,requestAnimationFrame((()=>this.drawPlayIcon()))}drawPauseIcon(){if(!this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height;this.ctx.lineWidth=.04*this.canvas.height,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2-e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2+e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2+e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,1.5*e,0,2*Math.PI),this.ctx.stroke()}drawPlayIcon(){if(this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height,t=new Path2D;t.moveTo(this.canvas.width/2+e,this.canvas.height/2),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2-e),t.closePath(),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.fill(t);const s=1.5*e;this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,s,0,2*Math.PI),this.ctx.stroke()}getCanvasScale(){let e;return e=this.options.max_width&&this.hdr&&this.lsd.width>this.options.max_width?this.options.max_width/this.lsd.width:1,e}fetchGIF(e){const t=ic(),s=new XMLHttpRequest;return s.open("GET",e,!0),s.responseType="arraybuffer",s?.overrideMimeType("text/plain; charset=x-user-defined"),s.onload=()=>{if(200!=s.status)return this.showError(),t.reject();t.resolve(s.response)},s.onprogress=e=>e.lengthComputable&&this.doShowProgress(e.loaded,e.total,!0),s.onerror=e=>{bt.error(e),this.showError()},s.send(),t}}var Rj=s(1218),Dj={};Dj.styleTagTransform=T(),Dj.setAttributes=E(),Dj.insert=S().bind(null,"head"),Dj.domAPI=w(),Dj.insertStyleElement=C();b()(Rj.A,Dj);Rj.A&&Rj.A.locals&&Rj.A.locals;Oh.elements.define("converse-gif",class extends Nw{static get properties(){return{autoplay:{type:Boolean},noloop:{type:Boolean},progress_color:{type:String},fallback:{type:String},src:{type:String}}}constructor(){super(),this.src=null,this.autoplay=!1,this.noloop=!1,this.fallback="url",this.progress_color=null}initGIF(){const e={autoplay:this.autoplay,loop:!this.noloop};this.progress_color&&(e.progress_color=this.progress_color),this.supergif=new Mj(this,e)}updated(e){this.supergif&&!e.has("src")?(e.has("autoplay")&&(this.supergif.options.autoplay=this.autoplay),e.has("noloop")&&(this.supergif.options.loop=!this.noloop),e.has("progress_color")&&(this.supergif.options.progress_color=this.progress_color)):this.initGIF()}render(){return this.supergif?.load_error&&["url","empty"].includes(this.fallback)?this.renderErrorFallback():Ag`<canvas class="gif-canvas" @mouseover="${()=>this.setHover()}" @mouseleave="${()=>this.unsetHover()}" @click="${e=>this.onControlsClicked(e)}"><img class="gif" src="${this.src}"></canvas>`}renderErrorFallback(){return"url"===this.fallback?qk(this.src):"empty"===this.fallback?"":void 0}setHover(){this.supergif&&(this.supergif.hovering=!0,this.hover_timeout&&clearTimeout(this.hover_timeout),this.hover_timeout=setTimeout((()=>this.unsetHover()),2e3))}unsetHover(){this.supergif&&(this.supergif.hovering=!1)}onControlsClicked(e){e.preventDefault(),this.supergif.playing?this.supergif.pause():this.supergif.frames.length>0&&(this.supergif.options.loop=!0,this.supergif.play())}});const Lj=(e,t)=>Ag`<converse-gif autoplay noloop fallback="empty" src="${e}"></converse-gif>${t?"":Ag`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,{URI:zj}=qg.env,{isURLWithImageExtension:Pj}=Sm;const Fj=aT(class extends gT{render(e,t,s,n){return t?Ag`<a href="${t}" class="chat-image__link" target="_blank" rel="noopener">${this.renderImage(e,t,s,n)}</a>`:this.renderImage(e,t,s,n)}renderImage(e,t,s,n){return Ag`<img class="chat-image img-thumbnail" loading="lazy" src="${e}" @click="${n}" @error="${()=>this.onError(e,t,s,n)}" @load="${s}">`}onError(e,t,s,n){if(Pj(e))t&&this.setValue(qk(t));else{const i=new zj(e),r=i.filename();i.filename(`${r}.png`),this.setValue(Fj(i.toString(),t,s,n))}}}),Uj=e=>Ag`${Fj(e.src||e.url,e.href,e.onLoad,e.onClick)}`,{dayjs:Bj,u:qj}=qg.env,{convertASCII2Emoji:Hj,getShortnameReferences:Gj,getCodePointReferences:Wj}=qj;function Vj(e){return e.then((e=>e.filter((e=>e.standalone)).map((e=>async function(e){const t=await e;return Ag`<button type="button" class="btn chatbox-btn ${t.a_class}" @click="${t.handler}" title="${t.i18n_title}"><converse-icon size="1em" class="fa ${t.icon_class}"></converse-icon></button>`}(e))).reverse().map((e=>yT(e,"")))))}function Qj(e){return e.then((e=>{const t=e.filter((e=>!e.standalone)).map((e=>async function(e){const t=await e;return t?Ag`<a href="#" role="button" class="dropdown-item ${t.a_class}" @click="${t.handler}" title="${t.i18n_title}"><converse-icon size="1em" class="fa ${t.icon_class}"></converse-icon>${t.i18n_text}</a>`:""}(e)));return t.length?Ag`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${t}"></converse-dropdown>`:""}))}function Jj(e){if(!e.isHidden()&&Oh.settings.get("allow_url_history_change")){const t=window.location.hash;t&&e.messages.get(t.slice(1))&&history.pushState(null,"",window.location.pathname)}}const Yj=Lu((e=>function(e){const t=e.target;if("converse-chat-content"!==t.nodeName.toLowerCase())return;let s=!0;const n=0===Math.floor(t.scrollTop),i=Math.ceil(t.clientHeight-t.scrollTop)>=t.scrollHeight-Math.ceil(t.scrollHeight/20);n?(s=!1,Jj(t.model)):i&&Oh.trigger("chatBoxScrolledUp",t),t.model.get("scolled")!==s&&t.model.ui.set({scrolled:s})}(e)),50);function Xj(e){const t=e.collection?.models;if(!t)return;const s=t.indexOf(e),n=t[s-1];if(!n||Bj(e.get("time")).isAfter(Bj(n.get("time")),"day")){const t=Bj(e.get("time")).startOf("day");return(e=>Ag`<div class="message date-separator" data-isodate="${e.time}"><hr class="separator"><time class="separator-text" datetime="${e.time}"><span>${e.datestring}</span></time></div>`)({type:"date",time:t.toISOString(),datestring:t.format("dddd MMM Do YYYY")})}}function Kj(e){if("groupchat"===e.get("type")){const t=Oh.settings.get("muc_hats").filter((e=>e)).map((e=>e.toLowerCase()));let s=[];t.includes("vcard_roles")&&(s=e.vcard?e.vcard.get("role"):null,s=s?s.split(",").filter((e=>e)).map((e=>({title:e}))):[]);const n=[...e.occupant?[e.occupant.get("role")]:[],...e.occupant?[e.occupant.get("affiliation")]:[]].filter((e=>e)).filter((e=>t.includes(e.toLowerCase()))).map((e=>({title:e})));return[...t.includes("xep317")&&e.occupant?.get("hats")||[],...s,...n]}return[]}function Zj(){var e;return qg.emojis.toned||(qg.emojis.toned=(e=Object.values(qg.emojis.json.people).filter((e=>e.sn.includes("_tone"))).map((e=>e.sn.replace(/_tone[1-5]/,""))),[...new Set(e)])),qg.emojis.toned}function eN(e,t={unicode_only:!1,add_title_wrapper:!1}){const s=e.emoji,n=e.shortname;if(s){if(t.unicode_only)return s;if(Oh.settings.get("use_system_emojis"))return t.add_title_wrapper&&n?Ag`<span title="${n}">${s}</span>`:s;{const t=Oh.settings.get("emoji_image_path");return Ag`<img class="emoji" loading="lazy" draggable="false" title="${n}" alt="${s}" src="${t}/72x72/${e.cp}.png">`}}if(t.unicode_only)return n;{const{url:e}=qg.emojis.by_sn[n];return Ag`<img class="emoji" loading="lazy" draggable="false" title="${n}" alt="${n}" src="${e.startsWith(".")?`${Oh.settings.get("assets_path")}/${e}`:e}">`}}Object.assign(qj,{shortnamesToEmojis:function(e,t={unicode_only:!1,add_title_wrapper:!1}){return function(e,t){let s=[e];return[...Gj(e),...Wj(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const n=s.shift(),i=eN(e,t);s="string"==typeof i?[n.slice(0,e.begin)+i+n.slice(e.end),...s]:[n.slice(0,e.begin),i,n.slice(e.end),...s]})),s}(e=Hj(e),t)}});const{convertASCII2Emoji:tN,filterQueryParamsFromURL:sN,getCodePointReferences:nN,getMediaURLs:iN,getMediaURLsMetadata:rN,getShortnameReferences:oN,isAudioURL:aN,isGIFURL:cN,isImageURL:lN,isVideoURL:dN}=Sm;class uN extends String{constructor(e,t=0,s={}){super(e),this.embed_audio=s?.embed_audio,this.embed_videos=s?.embed_videos,this.mentions=s?.mentions||[],this.media_urls=s?.media_urls,this.nick=s?.nick,this.offset=t,this.onImgClick=s?.onImgClick,this.onImgLoad=s?.onImgLoad,this.options=s,this.payload=[],this.references=[],this.render_styling=s?.render_styling,this.show_images=s?.show_images,this.hide_media_urls=s?.hide_media_urls}shouldRenderMedia(e,t){let s;return"image"===t?s=this.show_images:"audio"===t?s=this.embed_audio:"video"===t&&(s=this.embed_videos),"boolean"==typeof s?s:Ej(e,t)}addHyperlinks(e,t){const s=t+this.offset,n=this.media_urls||rN(e,t).media_urls||[];iN(n,e,s).filter((e=>!e.is_encrypted)).forEach((e=>{const s=e.url,n=sN(s);let i;i=cN(s)&&this.shouldRenderMedia(s,"image")?Lj(n,this.hide_media_urls):lN(s)&&this.shouldRenderMedia(s,"image")?Uj({src:n,href:this.hide_media_urls?null:n,onClick:this.onImgClick,onLoad:this.onImgLoad}):dN(s)&&this.shouldRenderMedia(s,"video")?Sk(n,this.hide_media_urls):aN(s)&&this.shouldRenderMedia(s,"audio")?gk(n,this.hide_media_urls):qk(n),this.addTemplateResult(e.start+t,e.end+t,i)}))}addMapURLs(e,t){const s=/geo:([\-0-9.]+),([\-0-9.]+)(?:,([\-0-9.]+))?(?:\?(.*))?/g,n=e.matchAll(s);for(const e of n)this.addTemplateResult(e.index+t,e.index+e[0].length+t,qk(e[0].replace(s,Oh.settings.get("geouri_replacement"))))}addEmojis(e,t){[...oN(e.toString()),...nN(e.toString())].forEach((e=>{this.addTemplateResult(e.begin+t,e.end+t,eN(e,{add_title_wrapper:!0}))}))}addMentions(e,t){const s=t+this.offset;this.mentions?.forEach((n=>{const i=Number(n.begin)-s;if(i<0||i>=s+e.length)return;const r=Number(n.end)-s,o=e.slice(i,r);o===this.nick?this.addTemplateResult(i+t,r+t,fN({...n,mention:o})):this.addTemplateResult(i+t,r+t,gN({...n,mention:o}))}))}addStyling(){if(!function(e){for(let t=0;t<_N.length;t++)if(e.includes(_N[t]))return!0}(this))return;const e=[],t=this.mentions.map((e=>Array.from({length:Number(e.end)},((t,s)=>Number(e.begin)+s))));let s=0;for(;s<this.length;){if(t.filter((e=>e.includes(s))).length){s++;continue}const{d:n,length:i}=SN(this,s);if(n&&i){const t=xN(n),r=s+i,o=t?r:r-n.length;let a="```"===n?s+n.length+1:s+n.length;t&&" "===this[a]&&(a+=1);const c=a,l=this.slice(a,o);e.push({begin:s,template:EN(n,l,c,this.options),end:r}),s=r}s++}e.forEach((e=>this.addTemplateResult(e.begin,e.end,e.template)))}trimMeMessage(){0===this.offset&&this.isMeCommand()&&(this.payload[0]=this.payload[0].substring(4))}addAnnotations(e){const t=this.marshall();let s=0;for(const n of t)n&&(hN(n)?(e.call(this,n,s),s+=n.length):s=n.end)}async addTemplates(){await Oh.trigger("beforeMessageBodyTransformed",this,{Synchronous:!0}),this.render_styling&&this.addStyling(),this.addAnnotations(this.addMentions),this.addAnnotations(this.addHyperlinks),this.addAnnotations(this.addMapURLs),await Oh.emojis.initialize(),this.addAnnotations(this.addEmojis),await Oh.trigger("afterMessageBodyTransformed",this,{Synchronous:!0}),this.payload=this.marshall(),this.options.show_me_message&&this.trimMeMessage(),this.payload=this.payload.map((e=>hN(e)?e:e.template))}addTemplateResult(e,t,s){this.references.push({begin:e,end:t,template:s})}isMeCommand(){const e=this.toString();return!!e&&e.startsWith("/me ")}marshall(){let e=[this.toString()];return this.references.sort(((e,t)=>t.begin-e.begin)).forEach((t=>{const s=e.shift();e=[s.slice(0,t.begin),t,s.slice(t.end),...e]})),e.reduce(((e,t)=>hN(t)?[...e,tN(mN(t))]:[...e,t]),[])}}const hN=e=>"string"==typeof e,mN=e=>e.replace(/\n(\u200B*\n)+/g,(e=>`\n${"​".repeat(e.length-2)}\n`)),fN=e=>Ag`<span class="mention mention--self badge badge-info" data-uri="${e.uri}">${e.mention}</span>`,gN=e=>Ag`<span class="mention" data-uri="${e.uri}">${e.mention}</span>`;const pN=aT(class extends cT{render(e,t,s){const n=new uN(e,t,Object.assign(s,{show_images:!1,embed_videos:!1,embed_audio:!1}));return Ag`${yT(async function(e){try{await e.addTemplates()}catch(e){bt.error(e)}return e.payload}(n),Ag`${n}`)}`}}),vN=["*","_","~","`"],_N=[...vN,"```",">"],bN={"*":{name:"strong",type:"span"},_:{name:"emphasis",type:"span"},"~":{name:"strike",type:"span"},"`":{name:"preformatted",type:"span"},"```":{name:"preformatted_block",type:"block"},">":{name:"quote",type:"block"}},yN=["_",">","`","~"],wN={emphasis:(e,t,s)=>Ag`<span class="styling-directive">_</span><i>${pN(e,t,s)}</i><span class="styling-directive">_</span>`,preformatted:e=>Ag`<span class="styling-directive">\`</span><code>${e}</code><span class="styling-directive">\`</span>`,preformatted_block:e=>Ag`<div class="styling-directive">\`\`\`</div><pre><code class="block">${e}</code></pre><div class="styling-directive">\`\`\`</div>`,quote:(e,t,s)=>Ag`<blockquote>${pN(e,t,s)}</blockquote>`,strike:(e,t,s)=>Ag`<span class="styling-directive">~</span><del>${pN(e,t,s)}</del><span class="styling-directive">~</span>`,strong:(e,t,s)=>Ag`<span class="styling-directive">*</span><b>${pN(e,t,s)}</b><span class="styling-directive">*</span>`};function AN(e,t,s=!0){let n;if(/(^```[\s,\u200B]*\n)|(^```[\s,\u200B]*$)/.test(e.slice(t))&&(0===t||">"===e[t-1]||/\n\u200B{0,2}$/.test(e.slice(0,t))))n=e.slice(t,t+3);else{if(!_N.includes(e.slice(t,t+1)))return null;if(n=e.slice(t,t+1),!function(e,t,s,n){if(n){const n=RegExp(yN.includes(e)?`^(\\p{L}|\\p{N})${e}`:`^(\\p{L}|\\p{N})\\${e}`,"u");if(s>1&&n.test(t.slice(s-1)))return!1;if(xN(e)&&s>0&&"\n"!==t[s-1])return!1;if(vN.includes(e)&&t[s+1]===e)return!1}else{const n=RegExp(yN.includes(e)?`^${e}(\\p{L}|\\p{N})`:`^\\${e}(\\p{L}|\\p{N})`,"u");if(s<t.length-1&&n.test(t.slice(s)))return!1;if(vN.includes(e)&&t[s-1]===e)return!1}return!0}(n,e,t,s))return null}return n}function SN(e,t){const s=AN(e,t),n=s?function(e,t,s){if(!e)return 0;const n=s;if(s+=e.length,xN(e))return(s+=t.slice(s).split(/\n\u200B*[^>\u200B]/).shift().length)-n;if("span"===bN[e].type){const n=t.slice(s).split("\n").shift();let i=0,r=n.indexOf(e);for(;-1!==r;){if(AN(t,s+r,!1)===e)return r+2*e.length;r=n.indexOf(e,i++)}return 0}{const n=t.slice(s+1);let i=0,r=n.indexOf(e);for(;-1!==r;){if(AN(t,s+1+r,!1)===e)return r+1+2*e.length;r=n.indexOf(e,i++)}return 0}}(s,e,t):0;return n>0?{d:s,length:n}:{}}const xN=e=>[">","&gt;"].includes(e);function EN(e,t,s,n){const i=wN[bN[e].name];if(xN(e)){const e=t.replace(/\n\u200B*>[ \f\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]?/g,(e=>`\n${"​".repeat(e.length-1)}`)).replace(/\n$/,"");return i(e,s,n)}return i(t,s,n)}class $N{constructor(e,t,s={}){this.offset=t,this.options=s,this.text=e}async transform(){const e=new uN(this.text,this.offset,this.options);try{await e.addTemplates()}catch(e){bt.error(e)}return e.payload}render(){return Ag`${yT(this.transform(),Ag`${this.text}`)}`}}const CN=aT(class extends cT{render(e,t,s,n){const i=new $N(e,t,s).render();return n?.(),i}}),kN=CN;var TN=s(3796),jN={};jN.styleTagTransform=T(),jN.setAttributes=E(),jN.insert=S().bind(null,"head"),jN.domAPI=w(),jN.insertStyleElement=C();b()(TN.A,jN);TN.A&&TN.A.locals&&TN.A.locals;Oh.elements.define("converse-chat-message-body",class extends Nw{static get properties(){return{hide_url_previews:{type:String},is_me_message:{type:Boolean},model:{type:Object},text:{type:String}}}constructor(){super(),this.text=null,this.model=null,this.hide_url_previews=null}initialize(){const e=Oh.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}onImgClick(e){e.preventDefault(),Oh.modal.show("converse-image-modal",{src:e.target.src},e)}onImgLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}render(){const e={media_urls:this.model.get("media_urls"),mentions:this.model.get("references"),nick:this.model.collection.chatbox.get("nick"),onImgClick:e=>this.onImgClick(e),onImgLoad:()=>this.onImgLoad(),render_styling:!this.model.get("is_unstyled")&&Oh.settings.get("allow_message_styling"),show_me_message:!0};return"false"===this.hide_url_previews?(e.embed_audio=!0,e.embed_videos=!0,e.show_images=!0):"true"===this.hide_url_previews&&(e.embed_audio=!1,e.embed_videos=!1,e.show_images=!1),kN(this.text,0,e,(()=>this.model.collection?.trigger("rendered",this.model)))}});const{keycodes:NN}=qg;function ON(e){let t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}function IN(e){let t=0;do{isNaN(e.offsetLeft)||(t+=e.offsetLeft)}while(e=e.offsetParent);return t}class MN{static get DIRECTION(){return{down:"down",end:"end",home:"home",left:"left",right:"right",up:"up"}}static get DEFAULTS(){return{home:[`${NN.SHIFT}+${NN.UP_ARROW}`],end:[`${NN.SHIFT}+${NN.DOWN_ARROW}`],up:[NN.UP_ARROW],down:[NN.DOWN_ARROW],left:[NN.LEFT_ARROW,`${NN.SHIFT}+${NN.TAB}`],right:[NN.RIGHT_ARROW,NN.TAB],getSelector:null,jump_to_picked:null,jump_to_picked_direction:null,jump_to_picked_selector:"picked",onSelected:null,selected:"selected",selector:"li"}}static getClosestElement(e,t){return e.reduce(((e,s)=>{const n=t(s);return n<e.distance?{distance:n,element:s}:e}),{distance:1/0}).element}constructor(e,t){this.doc=window.document,this.container=e,this.scroll_container=t.scroll_container||e,this.options=Object.assign({},MN.DEFAULTS,t),this.init()}init(){this.selected=null,this.keydownHandler=null,this.elements={},this.keys={},this.options.down.forEach((e=>this.keys[e]=MN.DIRECTION.down)),this.options.end.forEach((e=>this.keys[e]=MN.DIRECTION.end)),this.options.home.forEach((e=>this.keys[e]=MN.DIRECTION.home)),this.options.left.forEach((e=>this.keys[e]=MN.DIRECTION.left)),this.options.right.forEach((e=>this.keys[e]=MN.DIRECTION.right)),this.options.up.forEach((e=>this.keys[e]=MN.DIRECTION.up))}enable(){this.getElements(),this.keydownHandler=e=>this.handleKeydown(e),this.doc.addEventListener("keydown",this.keydownHandler),this.enabled=!0}disable(){this.keydownHandler&&this.doc.removeEventListener("keydown",this.keydownHandler),this.unselect(),this.elements={},this.enabled=!1}destroy(){this.disable()}getNextElement(e){let t;if(e===MN.DIRECTION.home)t=this.getElements(e)[0];else if(e===MN.DIRECTION.end)t=Array.from(this.getElements(e)).pop();else if(this.selected)if(e===MN.DIRECTION.right){const s=this.getElements(e);t=s.slice(s.indexOf(this.selected))[1]}else if(e==MN.DIRECTION.left){const s=this.getElements(e);t=s.slice(0,s.indexOf(this.selected)).pop()||this.selected}else if(e==MN.DIRECTION.down){const e=this.selected.offsetLeft,s=this.selected.offsetTop+this.selected.offsetHeight,n=this.elementsAfter(0,s),i=t=>Math.abs(t.offsetLeft-e)+Math.abs(t.offsetTop-s);t=MN.getClosestElement(n,i)}else{if(e!=MN.DIRECTION.up)throw new Error("getNextElement: invalid direction value");{const e=this.selected.offsetLeft,s=this.selected.offsetTop-1,n=this.elementsBefore(1/0,s),i=t=>Math.abs(e-t.offsetLeft)+Math.abs(s-t.offsetTop);t=MN.getClosestElement(n,i)}}else t=e===MN.DIRECTION.right||e===MN.DIRECTION.down?this.getElements(e)[1]:this.getElements(e)[0];return this.options.jump_to_picked&&t&&t.matches(this.options.jump_to_picked)&&e===this.options.jump_to_picked_direction&&(t=this.container.querySelector(this.options.jump_to_picked_selector)||t),t}select(e,t){e&&e!==this.selected&&(this.unselect(),t&&this.scrollTo(e,t),e.matches("input")?e.focus():Vk.addClass(this.options.selected,e),this.selected=e,this.options.onSelected&&this.options.onSelected(e))}unselect(){this.selected&&(Vk.removeClass(this.options.selected,this.selected),delete this.selected)}scrollTo(e,t){if(this.inScrollContainerViewport(e)){if(!function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(e))switch(t){case MN.DIRECTION.left:document.body.scrollLeft=IN(e)-document.body.offsetLeft;break;case MN.DIRECTION.up:document.body.scrollTop=ON(e)-document.body.offsetTop;break;case MN.DIRECTION.right:document.body.scrollLeft=IN(e)-document.body.offsetLeft-(document.documentElement.clientWidth-e.offsetWidth);break;case MN.DIRECTION.down:document.body.scrollTop=ON(e)-document.body.offsetTop-(document.documentElement.clientHeight-e.offsetHeight)}}else{const s=this.scroll_container;if(!s.contains(e))return;switch(t){case MN.DIRECTION.left:s.scrollLeft=e.offsetLeft-s.offsetLeft,s.scrollTop=e.offsetTop-s.offsetTop;break;case MN.DIRECTION.up:s.scrollTop=e.offsetTop-s.offsetTop;break;case MN.DIRECTION.right:s.scrollLeft=e.offsetLeft-s.offsetLeft-(s.offsetWidth-e.offsetWidth),s.scrollTop=e.offsetTop-s.offsetTop-(s.offsetHeight-e.offsetHeight);break;case MN.DIRECTION.down:s.scrollTop=e.offsetTop-s.offsetTop-(s.offsetHeight-e.offsetHeight)}}}inScrollContainerViewport(e){const t=this.scroll_container;return!(e.offsetLeft-t.scrollLeft<t.offsetLeft)&&(!(e.offsetTop-t.scrollTop<t.offsetTop)&&(!(e.offsetLeft+e.offsetWidth-t.scrollLeft>t.offsetLeft+t.offsetWidth)&&!(e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetTop+t.offsetHeight)))}getElements(e){const t=this.options.getSelector?this.options.getSelector(e):this.options.selector;return this.elements[t]||(this.elements[t]=Array.from(this.container.querySelectorAll(t))),this.elements[t]}elementsAfter(e,t){return this.getElements(MN.DIRECTION.down).filter((s=>s.offsetLeft>=e&&s.offsetTop>=t))}elementsBefore(e,t){return this.getElements(MN.DIRECTION.up).filter((s=>s.offsetLeft<=e&&s.offsetTop<=t))}handleKeydown(e){const t=NN,s=e.shiftKey?this.keys[`${t.SHIFT}+${e.which}`]:this.keys[e.which];if(s){e.preventDefault(),e.stopPropagation();const t=this.getNextElement(s);this.select(t,s)}}}const RN=MN;class DN extends Nw{firstUpdated(e){super.firstUpdated(e),this.menu=this.querySelector(".dropdown-menu"),this.button=this.querySelector("button"),this.dropdown=new xE(this.button)}}var LN=s(1353),zN={};zN.styleTagTransform=T(),zN.setAttributes=E(),zN.insert=S().bind(null,"head"),zN.domAPI=w(),zN.insertStyleElement=C();b()(LN.A,zN);LN.A&&LN.A.locals&&LN.A.locals;Oh.elements.define("converse-icon",class extends Nw{static get properties(){return{color:{type:String},class_name:{attribute:"class"},css:{type:String},size:{type:String}}}constructor(){super(),this.class_name="",this.css="",this.size="",this.color=""}getSource(){return`#icon-${this.class_name.trim().split(" ")[1].replace("fa-","")}`}getStyles(){const e=this.color.match(/var\((--.*)\)/)?.[1],t=e?getComputedStyle(this).getPropertyValue(e):this.color;return`\n            ${this.size?`width: ${this.size};`:""}\n            ${this.size?`height: ${this.size};`:""}\n            ${t?`fill: ${t};`:""}\n            ${this.css}\n        `}render(){return Ag`<svg .style="${this.getStyles()}"><use href="${this.getSource()}"></use></svg>`}});var PN=s(3557),FN={};FN.styleTagTransform=T(),FN.setAttributes=E(),FN.insert=S().bind(null,"head"),FN.domAPI=w(),FN.insertStyleElement=C();b()(PN.A,FN);PN.A&&PN.A.locals&&PN.A.locals;const{KEYCODES:UN}=yw;class BN extends DN{static get properties(){return{icon_classes:{type:String},items:{type:Array}}}constructor(){super(),this.icon_classes="fa fa-bars",this.items=[],this.id=Sm.getUniqueId(),this.addEventListener("hidden.bs.dropdown",(()=>this.onHidden())),this.addEventListener("keyup",(e=>this.handleKeyUp(e)))}render(){return Ag`<button class="btn btn--transparent btn--standalone dropdown-toggle dropdown-toggle--no-caret" id="${this.id}" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="${kw("Menu")}"><converse-icon aria-hidden="true" size="1em" class="${this.icon_classes}"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}">${this.items.map((e=>Ag`<li>${yT(e,"")}</li>`))}</ul>`}firstUpdated(){super.firstUpdated(),this.initArrowNavigation()}onHidden(){this.navigator?.disable()}initArrowNavigation(){if(!this.navigator){const e={selector:".dropdown-item",onSelected:e=>e.focus()};this.navigator=new RN(this.menu,e)}}enableArrowNavigation(e){e&&(e.preventDefault(),e.stopPropagation()),this.navigator.enable(),this.navigator.select(this.menu.firstElementChild)}handleKeyUp(e){e.keyCode!==UN.DOWN_ARROW||this.navigator.enabled||this.enableArrowNavigation(e)}}Oh.elements.define("converse-dropdown",BN);var qN=s(9495),HN={};HN.styleTagTransform=T(),HN.setAttributes=E(),HN.insert=S().bind(null,"head"),HN.domAPI=w(),HN.insertStyleElement=C();b()(qN.A,HN);qN.A&&qN.A.locals&&qN.A.locals;const{dayjs:GN}=qg.env;Oh.elements.define("converse-message-versions",class extends Nw{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}render(){const e=this.model.get("older_versions"),t=Object.keys(e);return Ag`${t.length?Ag`<h4>${kw("Older versions")}</h4>${t.map((t=>((e,t)=>Ag`<p class="older-msg"><time>${GN(e).format("MMM D, YYYY, HH:mm:ss")}</time>: ${t[e]}</p>`)(t,e)))}`:Ag`<h4>${kw("No older versions found")}</h4>`}<hr><h4>${kw("Current version")}</h4><p><time>${GN(this.model.get("time")).format("MMM D, YYYY, HH:mm:ss")}</time>: ${this.model.getMessageText()}</p>`}});Oh.elements.define("converse-message-versions-modal",class extends JC{renderModal(){return Ag`<converse-message-versions .model="${this.model}"></converse-message-versions>`}getModalTitle(){return kw("Message versions")}});const WN=e=>{const t=void 0!==e.model.contact,s=kw("Refresh"),n=Oh.settings.get("allow_contact_removal");return Ag`<div class="modal-footer">${HC} <button type="button" class="btn btn-info refresh-contact" @click="${t=>e.refreshContact(t)}"><converse-icon class="fa fa-refresh" color="var(--inverse-link-color)" size="1em"></converse-icon> ${s}</button> ${n&&t?(e=>{const t=kw("Remove as contact");return Ag`<button type="button" @click="${t=>e.removeContact(t)}" class="btn btn-danger remove-contact"><converse-icon class="fas fa-trash-alt" color="var(--inverse-link-color)" size="1em"></converse-icon> ${t}</button>`})(e):""}</div>`},{Strophe:VN}=qg.env,{STATUS_WEIGHTS:QN}=yw;function JN(e){Iu.state.roster?.get(e.get("jid"))?.trigger("highlight")}function YN(e,t){const s=Iu.state.roster_filter,n=s.get("type"),i="state"===n?s.get("state").toLowerCase():s.get("text").toLowerCase();if(!i)return!1;if("state"===n){return![Iu.labels.HEADER_REQUESTING_CONTACTS,Iu.labels.HEADER_UNREAD].includes(t)&&("unread_messages"===i?0===e.get("num_unread"):"online"===i?["offline","unavailable","dnd","away","xa"].includes(e.presence.get("show")):!e.presence.get("show").includes(i))}return"items"===n?!e.getFilterCriteria().includes(i):void 0}function XN(e,t){const s=e.presence.get("show")||"offline",n=t.presence.get("show")||"offline";if(QN[s]===QN[n]){const s=e.getDisplayName().toLowerCase(),n=t.getDisplayName().toLowerCase();return s<n?-1:s>n?1:0}return QN[s]<QN[n]?-1:1}function KN(e,t){const s={},{HEADER_UNREAD:n,HEADER_REQUESTING_CONTACTS:i,HEADER_CURRENT_CONTACTS:r,HEADER_UNGROUPED:o,HEADER_PENDING_CONTACTS:a}=Iu.labels;s[n]=0,s[i]=1,s[r]=2,s[o]=3,s[a]=4;const c=s,l=Object.keys(s),d=l.includes(e),u=l.includes(t);if(!d&&!u)return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0;if(d&&u)return c[e]<c[t]?-1:c[e]>c[t]?1:0;if(!d&&u){const e=r;return c[e]<c[t]?-1:c[e]>c[t]?1:0}if(d&&!u){const t=r;return c[e]<c[t]?-1:c[e]>c[t]?1:0}}async function ZN(e){const t={mode:"cors",headers:{Accept:"text/json"}},s=`${Oh.settings.get("xhr_user_search_url")}q=${encodeURIComponent(e)}`;let n;try{n=await fetch(s,t)}catch(t){return bt.error(`Failed to fetch names for query "${e}"`),bt.error(t),[]}const i=n.json;return Array.isArray(i)?i.map((e=>({label:e.fullname||e.jid,value:e.jid}))):(bt.error('Invalid JSON returned"'),[])}const eO=qg.env.utils;Oh.elements.define("converse-user-details-modal",class extends JC{initialize(){super.initialize(),this.model.rosterContactAdded.then((()=>this.registerContactEventHandlers())),this.listenTo(this.model,"change",this.render),this.registerContactEventHandlers(),Oh.trigger("userDetailsModalInitialized",this.model)}renderModal(){return(e=>{const t=e.model?.vcard,s=t?t.toJSON():{},n={...e.model.toJSON(),...s},i=kw("XMPP Address"),r=kw("Email"),o=kw("Full Name"),a=kw("Nickname"),c=kw("The User's Profile Image"),l=kw("Role"),d=kw("URL"),u={alt_text:c,extra_classes:"mb-3",height:"120",width:"120"};return Ag`<div class="modal-body">${n.image?Ag`<div class="mb-4">${wT(Object.assign(n,u))}</div>`:""} ${n.fullname?Ag`<p><label>${o}:</label> ${n.fullname}</p>`:""}<p><label>${i}:</label> <a href="xmpp:${n.jid}">${n.jid}</a></p>${n.nickname?Ag`<p><label>${a}:</label> ${n.nickname}</p>`:""} ${n.url?Ag`<p><label>${d}:</label> <a target="_blank" rel="noopener" href="${n.url}">${n.url}</a></p>`:""} ${n.email?Ag`<p><label>${r}:</label> <a href="mailto:${n.email}">${n.email}</a></p>`:""} ${n.role?Ag`<p><label>${l}:</label> ${n.role}</p>`:""}<converse-omemo-fingerprints jid="${n.jid}"></converse-omemo-fingerprints></div>`})(this)}renderModalFooter(){return WN(this)}getModalTitle(){return this.model.getDisplayName()}registerContactEventHandlers(){void 0!==this.model.contact&&(this.listenTo(this.model.contact,"change",this.render),this.listenTo(this.model.contact.vcard,"change",this.render),this.model.contact.on("destroy",(()=>{delete this.model.contact,this.render()})))}async refreshContact(e){e&&e.preventDefault&&e.preventDefault();const t=this.querySelector(".fa-refresh");eO.addClass("fa-spin",t);try{await Oh.vcard.update(this.model.contact.vcard,!0)}catch(e){bt.fatal(e),this.alert(kw("Sorry, something went wrong while trying to refresh"),"danger")}eO.removeClass("fa-spin",t)}async removeContact(e){if(e?.preventDefault?.(),!Oh.settings.get("allow_contact_removal"))return;await Oh.confirm(kw("Are you sure you want to remove this contact?"))&&(setTimeout((()=>function(e){e.removeFromRoster((()=>e.destroy()),(t=>{t&&bt.error(t),Oh.alert("error",kw("Error"),[kw("Sorry, there was an error while trying to remove %1$s as a contact.",e.getDisplayName())])}))}(this.model.contact)),1),this.modal.hide())}});const{filesize:tO}=qg.env,{dayjs:sO}=qg.env,{dayjs:nO}=qg.env,{filterQueryParamsFromURL:iO,isGIFURL:rO}=Sm;Oh.elements.define("converse-image",class extends Nw{static get properties(){return{src:{type:String},onImgLoad:{type:Function},href:{type:String}}}constructor(){super(),this.src=null,this.href=null,this.onImgClick=null,this.onImgLoad=null}render(){return rO(this.src)&&Ej(this.src,"image")?Lj(iO(this.src),!0):Uj({src:iO(this.src),href:this.href,onClick:this.onImgClick,onLoad:this.onImgLoad})}});const{getURI:oO,isGIFURL:aO}=Sm;function cO(e){return!!oO(e).host()}const lO=e=>{const t=(s=e.image)&&Sj(s,"allowed_image_domains")&&cO(s);var s;const n=e.title||e.description||e.url;return t||n?Ag`<div class="card card--unfurl">${t?(e=>Ag`<converse-image class="card-img-top hor_centered" href="${e.url}" src="${e.image}" .onImgLoad="${e.onload}"></converse-image>`)(e):""} ${n?Ag`<div class="card-body">${e.title?((e,t)=>e.url&&cO(e.url)&&!aO(e.image)?Ag`<a href="${e.url}" target="_blank" rel="noopener">${t(e)}</a>`:t(e))(e,(e=>Ag`<h5 class="card-title">${e.title}</h5>`)):""} ${e.description?Ag`<p class="card-text"><converse-rich-text text="${e.description}"></converse-rich-text></p>`:""} ${e.url?Ag`<p class="card-text"><a href="${e.url}" target="_blank" rel="noopener">${oO(e.url).domain()}</a></p>`:""}</div>`:""}</div>`:""};var dO=s(1070),uO={};uO.styleTagTransform=T(),uO.setAttributes=E(),uO.insert=S().bind(null,"head"),uO.domAPI=w(),uO.insertStyleElement=C();b()(dO.A,uO);dO.A&&dO.A.locals&&dO.A.locals;function hO(e,t=""){return`color: ${e}!important;${t}`}function mO(e){if(Oh.settings.get("colorize_username")){const t=e?.get("color");return t?hO(t):e?Ag`${yT(e?.getColor().then(hO),"")}`:""}}Oh.elements.define("converse-message-unfurl",class extends Nw{static get properties(){return{description:{type:String},image:{type:String},jid:{type:String},title:{type:String},url:{type:String}}}constructor(){super(),this.jid=null,this.url=null,this.title=null,this.image=null,this.description=null}initialize(){const e=Oh.settings.get();this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}render(){return lO(Object.assign({onload:()=>this.onImageLoad()},{description:this.description||"",image:this.image||"",title:this.title||"",url:this.url||""}))}onImageLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}});const fO=e=>{const t=kw("Show more"),s="groupchat"===e.model.get("type"),n=kw("Show less"),i=Ag`<div class="chat-msg__spoiler-hint"><span class="spoiler-hint">${e.model.get("spoiler_hint")}</span> <a class="badge badge-info spoiler-toggle" href="#" @click="${e.toggleSpoilerMessage}"><converse-icon size="1em" color="var(--background)" class="fa ${e.model.get("is_spoiler_visible")?"fa-eye-slash":"fa-eye"}"></converse-icon>${e.model.get("is_spoiler_visible")?n:t}</a></div>`,r=e.model.get("is_spoiler")?"spoiler "+(e.model.get("is_spoiler_visible")?"":"hidden"):"",o=e.model.getMessageText(),a=e.model.get("oob_url")&&o!==e.model.get("oob_url");return Ag`${e.model.get("is_spoiler")?i:""} ${e.model.get("subject")?Ag`<div class="chat-msg__subject">${e.model.get("subject")}</div>`:""} <span class="chat-msg__body--wrapper"><converse-chat-message-body class="chat-msg__text ${e.model.get("is_only_emojis")?"chat-msg__text--larger":""} ${r}" .model="${e.model}" hide_url_previews="${e.model.get("hide_url_previews")}" ?is_me_message="${e.model.isMeCommand()}" text="${o}"></converse-chat-message-body>${!e.model.get("received")||e.model.isMeCommand()||s?"":Ag`<converse-icon size="1em" color="var(--chat-color)" class="fa fa-check chat-msg__receipt"></converse-icon>`} ${e.model.get("edited")?(e=>{const t=kw("This message has been edited");return Ag`<converse-icon title="${t}" class="fa fa-edit chat-msg__edit-modal" @click="${e.showMessageVersionsModal}" size="1em"></converse-icon>`})(e):""} </span>${a?Ag`<div class="chat-msg__media">${Pk(e.model.get("oob_url"))}</div>`:""}<div class="chat-msg__error">${e.model.get("error_text")||e.model.get("error")}</div>`};var gO=s(4563),pO={};pO.styleTagTransform=T(),pO.setAttributes=E(),pO.insert=S().bind(null,"head"),pO.domAPI=w(),pO.insertStyleElement=C();b()(gO.A,pO);gO.A&&gO.A.locals&&gO.A.locals;const{Strophe:vO,dayjs:_O}=qg.env,{SUCCESS:bO}=yw;Oh.elements.define("converse-chat-message",class extends Nw{constructor(){super(),this.jid=null,this.mid=null}static get properties(){return{jid:{type:String},mid:{type:String}}}async initialize(){if(await this.setModels(),!this.model)return void bt.error("Could not find module for converse-chat-message");const e=Oh.settings.get();this.listenTo(e,"change:render_media",(()=>{this.model.save("hide_url_previews",void 0),this.requestUpdate()})),this.listenTo(this.chatbox,"change:first_unread_id",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"contact:change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:change",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:add",(()=>this.requestUpdate()))}async setModels(){this.chatbox=await Oh.chatboxes.get(this.jid),await this.chatbox.initialized,await this.chatbox.messages.fetched,this.model=this.chatbox.messages.get(this.mid),this.model&&this.requestUpdate()}render(){return this.model?this.show_spinner?Zk():this.model.get("file")&&this.model.get("upload")!==bO?this.renderFileProgress():["mep"].includes(this.model.get("type"))?this.renderMEPMessage():["error","info"].includes(this.model.get("type"))?this.renderInfoMessage():this.renderChatMessage():""}getProps(){return Object.assign(this.model.toJSON(),this.getDerivedMessageProps())}renderRetraction(){return(e=>{const t=e.isRetracted()?e.getRetractionText():null;return Ag`<div class="retraction">${t}</div>${e.model.get("moderation_reason")?Ag`<q class="chat-msg--retracted__reason">${e.model.get("moderation_reason")}</q>`:""}`})(this)}renderMessageText(){return fO(this)}renderMEPMessage(){return(e=>{const t=nO(e.model.get("time")).toISOString();return Ag`<div class="message chat-info message--mep ${e.getExtraMessageClasses()}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-msg__content"><div class="chat-msg__body chat-msg__body--${e.model.get("type")} ${e.model.get("is_delayed")?"chat-msg__body--delayed":""}"><div class="chat-info__message">${e.isRetracted()?e.renderRetraction():Ag`<converse-rich-text .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-rich-text>${e.model.get("reason")?Ag`<q class="reason"><converse-rich-text text="${e.model.get("reason")}"></converse-rich-text></q>`:""}`}</div><converse-message-actions ?is_retracted="${e.isRetracted()}" .model="${e.model}"></converse-message-actions></div></div></div>`})(this)}renderInfoMessage(){return(e=>{const t=sO(e.model.get("time")).toISOString(),s=kw("Retry");return Ag`<div class="message chat-info chat-${e.model.get("type")}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-info__message"><converse-rich-text .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-rich-text></div>${e.model.get("reason")?Ag`<q class="reason">${e.model.get("reason")}</q>`:""} ${e.model.get("error_text")?Ag`<q class="reason">${e.model.get("error_text")}</q>`:""} ${e.model.get("retry_event_id")?Ag`<a class="retry" @click="${e.onRetryClicked}">${s}</a>`:""}</div>`})(this)}renderFileProgress(){return this.model.file?(e=>{const t=kw("Uploading file:"),s=e.model.file.name,n=tO(e.model.file.size),i=e.model.occupant||e.model.contact;return Ag`<div class="message chat-msg">${e.shouldShowAvatar()?Ag`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${i||e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content"><span class="chat-msg__text">${t} <strong>${s}</strong>, ${n}</span><progress value="${e.model.get("progress")}"></div></div>`})(this):""}renderChatMessage(){return((e,t)=>{const s=kw("New messages"),n=e.model.isFollowup(),i=e.model.occupant||e.model.contact,r=mO(i),o=i?.vcard?i:e.model;return Ag`${t.is_first_unread?Ag`<div class="message separator"><hr class="separator"><span class="separator-text">${s}</span></div>`:""}<div class="message chat-msg ${e.getExtraMessageClasses()}" data-isodate="${t.time}" data-msgid="${t.msgid}" data-from="${t.from}" data-encrypted="${t.is_encrypted}"><a id="${t.msgid}"></a> ${t.should_show_avatar&&!n?Ag`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${o}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${o.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content chat-msg__content--${t.sender} ${t.is_me_message?"chat-msg__content--action":""}">${t.is_me_message||n?"":Ag`<span class="chat-msg__heading"><span class="chat-msg__author"><a class="show-msg-author-modal" @click="${e.showUserModal}" style="${r}">${t.username}</a> </span>${t.hats.map((e=>Ag`<span class="badge badge-secondary">${e.title}</span>`))} <time timestamp="${e.model.get("edited")||e.model.get("time")}" class="chat-msg__time">${t.pretty_time}</time> ${t.is_encrypted?Ag`<converse-icon class="fa fa-lock" size="1.1em"></converse-icon>`:""}</span>`}<div class="chat-msg__body chat-msg__body--${t.message_type} ${t.received?"chat-msg__body--received":""} ${t.is_delayed?"chat-msg__body--delayed":""}"><div class="chat-msg__message">${t.is_me_message?Ag`<time timestamp="${t.edited||t.time}" class="chat-msg__time">${t.pretty_time}</time>  <span class="chat-msg__author" style="${r}">${t.is_me_message?"**":""}${t.username}</span> `:""} ${t.is_retracted?e.renderRetraction():e.renderMessageText()}</div><converse-message-actions .model="${e.model}" ?is_retracted="${t.is_retracted}"></converse-message-actions></div>${e.model.get("ogp_metadata")?.map((t=>!0===e.model.get("hide_url_previews")?"":Ej(t["og:image"],"image")?Ag`<converse-message-unfurl @animationend="${e.onUnfurlAnimationEnd}" class="${e.model.get("url_preview_transition")}" jid="${e.chatbox?.get("jid")}" description="${t["og:description"]||""}" title="${t["og:title"]||""}" image="${t["og:image"]||""}" url="${t["og:url"]||""}"></converse-message-unfurl>`:""))}</div></div>`})(this,this.getProps())}shouldShowAvatar(){return Oh.settings.get("show_message_avatar")&&!this.model.isMeCommand()&&["chat","groupchat","normal"].includes(this.model.get("type"))}onUnfurlAnimationEnd(){"fade-out"===this.model.get("url_preview_transition")&&this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}async onRetryClicked(){this.show_spinner=!0,this.requestUpdate(),await Oh.trigger(this.model.get("retry_event_id"),{synchronous:!0}),this.model.destroy(),this.parentElement.removeChild(this)}isRetracted(){return this.model.get("retracted")||"retracted"===this.model.get("moderated")}hasMentions(){return"groupchat"===this.model.get("type")&&"them"===this.model.get("sender")&&this.chatbox.isUserMentioned(this.model)}getOccupantAffiliation(){return this.model.occupant?.get("affiliation")}getOccupantRole(){return this.model.occupant?.get("role")}getExtraMessageClasses(){const e=[this.model.isFollowup()?"chat-msg--followup":null,this.model.get("is_delayed")?"delayed":null,this.model.isMeCommand()?"chat-msg--action":null,this.isRetracted()?"chat-msg--retracted":null,this.model.get("type"),this.shouldShowAvatar()?"chat-msg--with-avatar":null].map((e=>e));return"groupchat"===this.model.get("type")&&(e.push(this.getOccupantRole()??""),e.push(this.getOccupantAffiliation()??""),"them"===this.model.get("sender")&&this.hasMentions()&&e.push("mentioned")),this.model.get("correcting")&&e.push("correcting"),e.filter((e=>e)).join(" ")}getDerivedMessageProps(){const e=Oh.settings.get("time_format");return{pretty_time:_O(this.model.get("edited")||this.model.get("time")).format(e),has_mentions:this.hasMentions(),hats:Kj(this.model),is_first_unread:this.chatbox.get("first_unread_id")===this.model.get("id"),is_me_message:this.model.isMeCommand(),is_retracted:this.isRetracted(),username:this.model.getDisplayName(),should_show_avatar:this.shouldShowAvatar(),colorize_username:Oh.settings.get("colorize_username")}}getRetractionText(){if(["groupchat","mep"].includes(this.model.get("type"))&&this.model.get("moderated_by")){const e=this.model.get("moderated_by"),t=this.model.collection.chatbox;this.model.mod||(this.model.mod=t.occupants.findOccupant({jid:e})||t.occupants.findOccupant({nick:vO.getResourceFromJid(e)}));const s=this.model.mod?this.model.mod.getDisplayName():kw("A moderator");return kw("%1$s has removed this message",s)}return kw("%1$s has removed this message",this.model.getDisplayName())}showUserModal(e){if("me"===this.model.get("sender"))Oh.modal.show("converse-profile-modal",{model:this.model},e);else if("groupchat"===this.model.get("type"))e.preventDefault(),Oh.modal.show("converse-muc-occupant-modal",{model:this.model.getOccupant(),message:this.model},e);else{e.preventDefault();const t=this.model.collection.chatbox;Oh.modal.show("converse-user-details-modal",{model:t},e)}}showMessageVersionsModal(e){e.preventDefault(),Oh.modal.show("converse-message-versions-modal",{model:this.model},e)}toggleSpoilerMessage(e){e?.preventDefault(),this.model.save({is_spoiler_visible:!this.model.get("is_spoiler_visible")})}});Oh.elements.define("converse-message-history",class extends Nw{constructor(){super(),this.model=null,this.messages=[]}static get properties(){return{model:{type:Object},messages:{type:Array}}}render(){const e=this.messages;return e.length?hj(e,(e=>e.get("id")),(e=>Ag`${this.renderMessage(e)}`)):""}renderMessage(e){if(e.get("dangling_retraction")||e.get("dangling_moderation")||e.get("is_only_key"))return"";const t=e.get("template_hook");if("string"==typeof t){const s=Oh.hook(t,e,"");return yT(s,"")}{const t=Ag`<converse-chat-message jid="${this.model.get("jid")}" mid="${e.get("id")}"></converse-chat-message>`,s=Xj(e);return s?[s,t]:t}}});var yO=s(6120),wO={};wO.styleTagTransform=T(),wO.setAttributes=E(),wO.insert=S().bind(null,"head"),wO.domAPI=w(),wO.insertStyleElement=C();b()(yO.A,wO);yO.A&&yO.A.locals&&yO.A.locals;Oh.elements.define("converse-chat-content",class extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("scroll",Yj)}async initialize(){await this.setModels(),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"add",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"change",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"remove",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"rendered",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"reset",(()=>this.requestUpdate())),this.listenTo(this.model.notifications,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change:scrolled",this.scrollDown),this.model.occupants&&this.listenTo(this.model.occupants,"change",(()=>this.requestUpdate())),this.addEventListener("scroll",Yj)}async setModels(){this.model=await Oh.chatboxes.get(this.jid),await this.model.initialized,this.requestUpdate()}render(){return this.model?Ag`<div class="chat-content__notifications">${this.model.getNotificationsText()}</div><converse-message-history .model="${this.model}" .messages="${[...this.model.messages.models]}"></converse-message-history>${this.model.ui?.get("chat-content-spinner-top")?Zk():""}`:""}scrollDown(){if(!this.model.ui.get("scrolled")){if(this.scrollTo){const e=this.scrollTop?"smooth":"auto";this.scrollTo({top:0,behavior:e})}else this.scrollTop=0;Oh.trigger("chatBoxScrolledDown",{chatbox:this.model})}}});class AO extends cT{constructor(e){if(super(e),this.it=Pf,e.type!==oT)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===Pf||null==e)return this._t=void 0,this.it=e;if(e===zf)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}AO.directiveName="unsafeHTML",AO.resultType=1;const SO=aT(AO);Oh.elements.define("converse-chat-help",class extends Nw{constructor(){super(),this.messages=[],this.model=null,this.type=null}static get properties(){return{chat_type:{type:String},messages:{type:Array},model:{type:Object},type:{type:String}}}render(){const e=(new Date).toISOString();return[Ag`<converse-icon class="fas fa-times close-chat-help" @click="${this.close}" path-prefix="${Oh.settings.get("assets_path")}" size="1em"></converse-icon>`,...this.messages.map((t=>this.renderHelpMessage({isodate:e,markup:U().sanitize(t,{ALLOWED_TAGS:["strong"]})})))]}close(){this.model.set({show_help_messages:!1})}renderHelpMessage(e){return Ag`<div class="message chat-${this.type}" data-isodate="${e.isodate}">${SO(e.markup)}</div>`}});const xO=qg.env.utils,EO=e=>{const t=Oh.settings.get("emoji_categories");return Ag`<ul class="flex-wrap flex-md-nowrap">${Object.keys(t).map((s=>t[s]?(e=>Ag`<li data-category="${e.category}" class="emoji-category ${e.category} ${e.current_category===e.category?"picked":""}" title="${kw(Oh.settings.get("emoji_category_labels")[e.category])}"><a class="btn pick-category" @click="${e.onCategoryPicked}" href="#emoji-picker-${e.category}" data-category="${e.category}">${e.emoji}</a></li>`)(Object.assign({category:s,emoji:e.sn2Emoji(t[s])},e)):""))}</ul>`},$O=e=>Ag`<li class="emoji insert-emoji ${e.shouldBeHidden(e.emoji.sn)?"hidden":""}" data-emoji="${e.emoji.sn}" title="${e.emoji.sn}"><a href="#" @click="${e.insertEmoji}" data-emoji="${e.emoji.sn}">${xO.shortnamesToEmojis(e.emoji.sn)}</a></li>`;function CO(e){const t=Oh.settings.get("emoji_categories");return Ag`<span ?hidden="${e.query}" class="emoji-lists__container emoji-lists__container--browse">${Object.keys(t).map((s=>t[s]?function(e){return Ag`<a id="emoji-picker-${e.category}" class="emoji-category__heading" data-category="${e.category}">${kw(Oh.settings.get("emoji_category_labels")[e.category])}</a><ul class="emoji-picker" data-category="${e.category}">${Object.values(qg.emojis.json[e.category]).map((t=>$O(Object.assign({emoji:t},e))))}</ul>`}(Object.assign({category:s},e)):""))}</span>`}function kO(e){const t=kw("Search"),s={tone1:":raised_hand_tone1:",tone2:":raised_hand_tone2:",tone3:":raised_hand_tone3:",tone4:":raised_hand_tone4:",tone5:":raised_hand_tone5:"};return Ag`<div class="emoji-picker__header"><input class="form-control emoji-search" name="emoji-search" placeholder="${t}" .value="${e.query||""}" @keydown="${e.onSearchInputKeyDown}" @blur="${e.onSearchInputBlurred}" @focus="${e.onSearchInputFocus}"> ${e.query?"":EO(e)}</div>${e.render_emojis?Ag`<converse-emoji-picker-content .chatview="${e.chatview}" .model="${e.model}" .search_results="${e.search_results}" current_skintone="${e.current_skintone}" query="${e.query}"></converse-emoji-picker-content>`:""}<div class="emoji-skintone-picker">Skin tone:<ul>${Object.keys(s).map((t=>function(e,t,s){return Ag`<li data-skintone="${s}" class="emoji-skintone ${e.current_skintone===t?"picked":""}"><a class="pick-skintone" href="#" data-skintone="${t}" @click="${e.onSkintonePicked}">${xO.shortnamesToEmojis(s)}</a></li>`}(e,t,s[t])))}</ul></div>`}const{sizzle:TO}=qg.env;Oh.elements.define("converse-emoji-picker-content",class extends Nw{static get properties(){return{chatview:{type:Object},search_results:{type:Array},current_skintone:{type:String},model:{type:Object},query:{type:String}}}constructor(){super(),this.model=null,this.current_skintone=null,this.query=null,this.search_results=null}render(){const e={current_skintone:this.current_skintone,insertEmoji:e=>this.insertEmoji(e),query:this.query,search_results:this.search_results,shouldBeHidden:e=>this.shouldBeHidden(e)};return Ag`<div class="emoji-picker__lists">${function(e){const t=kw("Search results");return Ag`<span ?hidden="${!e.query}" class="emoji-lists__container emojis-lists__container--search"><a id="emoji-picker-search-results" class="emoji-category__heading">${t}</a><ul class="emoji-picker">${e.search_results.map((t=>$O(Object.assign({emoji:t},e))))}</ul></span>`}(e)} ${CO(e)}</div>`}firstUpdated(){this.initIntersectionObserver()}initIntersectionObserver(){if(window.IntersectionObserver){if(this.observer)this.observer.disconnect();else{const e={root:this.querySelector(".emoji-picker__lists"),threshold:[.1]},t=e=>this.setCategoryOnVisibilityChange(e);this.observer=new IntersectionObserver(t,e)}TO(".emoji-picker",this).forEach((e=>this.observer.observe(e)))}}setCategoryOnVisibilityChange(e){const t=this.parentElement.navigator.selected,s=e.filter((e=>e.target.contains(t))).pop();let n;if(n=s||e.reduce(((e,t)=>t.intersectionRatio>=(e?.intersectionRatio||0)?t:e),null),n&&n.isIntersecting){const e=n.target.getAttribute("data-category");e!==this.model.get("current_category")&&(this.parentElement.preserve_scroll=!0,this.model.save({current_category:e}))}}insertEmoji(e){e.preventDefault(),e.stopPropagation();const t="IMG"===e.target.nodeName?e.target.parentElement:e.target;this.parentElement.insertIntoTextArea(t.getAttribute("data-emoji"))}shouldBeHidden(e){if(e.includes("_tone")){if(!this.current_skintone||!e.includes(this.current_skintone))return!0}else if(this.current_skintone&&Zj().includes(e))return!0;return!(!this.query||rk(e,this.query))}});const{CHATROOMS_TYPE:jO}=yw,{initStorage:NO}=Sm;Oh.elements.define("converse-emoji-dropdown",class extends BN{static get properties(){return{chatview:{type:Object},icon_classes:{type:String},items:{type:Array}}}constructor(){super(),this.id=Sm.getUniqueId(),this.render_emojis=!1,this.chatview=null,this.addEventListener("shown.bs.dropdown",(()=>this.onShown()))}initModel(){return this.init_promise||(this.init_promise=(async()=>{await Oh.emojis.initialize();const e=`converse.emoji-${Iu.session.get("bare_jid")}-${this.chatview.model.get("jid")}`;this.model=new gp({id:e}),NO(this.model,e),await new Promise((e=>this.model.fetch({success:e,error:e}))),this.model.set({autocompleting:null,ac_position:null})})()),this.init_promise}render(){const e=this.chatview.model.get("type")===jO?"--muc-toolbar-btn-color":"--chat-toolbar-btn-color";return Ag`<button class="btn dropdown-toggle dropdown-toggle--no-caret toggle-emojis" type="button" id="${this.id}" title="${kw("Insert emojis")}" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><converse-icon color="var(${e})" class="fa fa-smile" path-prefix="${Oh.settings.get("assets_path")}" size="1em"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}"><li>${yT(this.initModel().then((()=>Ag`<converse-emoji-picker .chatview="${this.chatview}" .model="${this.model}" @emojiSelected="${()=>this.dropdown.hide()}" ?render_emojis="${this.render_emojis}" current_category="${this.model.get("current_category")||""}" current_skintone="${this.model.get("current_skintone")||""}" query="${this.model.get("query")||""}"></converse-emoji-picker>`)),"")}</li></ul>`}connectedCallback(){super.connectedCallback(),this.render_emojis=!1}async onShown(){await this.initModel(),this.render_emojis||(this.render_emojis=!0,this.requestUpdate(),await this.updateComplete),setTimeout((()=>this.querySelector(".emoji-search")?.focus()))}});var OO=s(9440),IO={};IO.styleTagTransform=T(),IO.setAttributes=E(),IO.insert=S().bind(null,"head"),IO.domAPI=w(),IO.insertStyleElement=C();b()(OO.A,IO);OO.A&&OO.A.locals&&OO.A.locals;const{KEYCODES:MO}=yw;Oh.elements.define("converse-emoji-picker",class extends Nw{static get properties(){return{chatview:{type:Object},current_category:{type:String,reflect:!0},current_skintone:{type:String,reflect:!0},model:{type:Object},query:{type:String,reflect:!0},render_emojis:{type:Boolean}}}firstUpdated(e){super.firstUpdated(e),this.listenTo(this.model,"change",(e=>this.onModelChanged(e.changed))),this.initArrowNavigation()}constructor(){super(),this.render_emojis=null,this.chatview=null,this.model=null,this.query="",this._search_results=[],this.debouncedFilter=Lu((e=>this.model.set({query:e.value})),250)}get search_results(){return this._search_results}set search_results(e){this._search_results=e,this.requestUpdate()}render(){return kO({chatview:this.chatview,current_category:this.current_category,current_skintone:this.current_skintone,model:this.model,onCategoryPicked:e=>this.chooseCategory(e),onSearchInputBlurred:e=>this.chatview.emitFocused(e),onSearchInputFocus:e=>this.onSearchInputFocus(e),onSearchInputKeyDown:e=>this.onSearchInputKeyDown(e),onSkintonePicked:e=>this.chooseSkinTone(e),query:this.query,search_results:this.search_results,render_emojis:this.render_emojis,sn2Emoji:e=>Sm.shortnamesToEmojis(this.getTonedShortname(e))})}updated(e){e.has("query")&&this.updateSearchResults(e),e.has("current_category")&&this.setScrollPosition()}onModelChanged(e){"current_category"in e&&(this.current_category=e.current_category),"current_skintone"in e&&(this.current_skintone=e.current_skintone),"query"in e&&(this.query=e.query)}setScrollPosition(){if(this.preserve_scroll)return void(this.preserve_scroll=!1);const e=this.querySelector(".emoji-lists__container--browse"),t=this.querySelector(`#emoji-picker-${this.current_category}`);t instanceof HTMLElement&&(e.scrollTop=t.offsetTop-3*t.offsetHeight+4)}updateSearchResults(e){const t=e.get("query"),s=rk;if(this.query){if(this.query===t)return this.search_results;t&&this.query.includes(t)?this.search_results=this.search_results.filter((e=>s(e.sn,this.query))):this.search_results=qg.emojis.list.filter((e=>s(e.sn,this.query)))}else this.search_results.length&&(this.search_results=[])}registerEvents(){this.onGlobalKeyDown=e=>this._onGlobalKeyDown(e);document.querySelector("body").addEventListener("keydown",this.onGlobalKeyDown)}connectedCallback(){super.connectedCallback(),this.registerEvents()}disconnectedCallback(){document.querySelector("body").removeEventListener("keydown",this.onGlobalKeyDown),this.disableArrowNavigation(),super.disconnectedCallback()}_onGlobalKeyDown(e){this.navigator&&(e.keyCode===MO.ENTER&&Sm.isVisible(this)?this.onEnterPressed(e):e.keyCode===MO.DOWN_ARROW&&!this.navigator.enabled&&Sm.isVisible(this)?this.enableArrowNavigation(e):e.keyCode===MO.ESCAPE&&(this.disableArrowNavigation(),setTimeout((()=>this.chatview.querySelector(".chat-textarea").focus()),50)))}setCategoryForElement(e){const t=this.current_category,s=e?.getAttribute("data-category")||t;t!==s&&this.model.save({current_category:s})}insertIntoTextArea(e){const t=this.model.get("autocompleting"),s=this.model.get("ac_position");this.model.set({autocompleting:null,query:"",ac_position:null}),this.disableArrowNavigation();const n={bubbles:!0,detail:{value:e,autocompleting:t,ac_position:s,jid:this.chatview.model.get("jid")}};this.dispatchEvent(new CustomEvent("emojiSelected",n))}chooseSkinTone(e){e.preventDefault(),e.stopPropagation();const t=e.target,s=("IMG"===t.nodeName?t.parentElement:t).getAttribute("data-skintone").trim();this.current_skintone===s?this.model.save({current_skintone:""}):this.model.save({current_skintone:s})}chooseCategory(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();const t=e.target,s=t.matches("li")?e.target:Sm.ancestor(t,"li");this.setCategoryForElement(s),this.navigator.select(s),!this.navigator.enabled&&this.navigator.enable()}onSearchInputKeyDown(e){const t=e.target;if(e.keyCode===MO.TAB)if(t.value){e.preventDefault();const s=qg.emojis.shortnames.find((e=>rk(e,t.value)));s&&this.model.set({query:s})}else this.navigator.enabled||this.enableArrowNavigation(e);else e.keyCode!==MO.DOWN_ARROW||this.navigator.enabled?e.keyCode!==MO.ENTER&&e.keyCode!==MO.DOWN_ARROW&&this.debouncedFilter(t):this.enableArrowNavigation(e)}onEnterPressed(e){e.preventDefault(),e.stopPropagation();const t=e.target;qg.emojis.shortnames.includes(t.value)?this.insertIntoTextArea(t.value):1===this.search_results.length?this.insertIntoTextArea(this.search_results[0].sn):this.navigator.selected&&this.navigator.selected.matches(".insert-emoji")?this.insertIntoTextArea(this.navigator.selected.getAttribute("data-emoji")):this.navigator.selected&&this.navigator.selected.matches(".emoji-category")&&this.chooseCategory(new MouseEvent("click",{relatedTarget:this.navigator.selected}))}onSearchInputFocus(e){this.chatview.emitBlurred(e),this.disableArrowNavigation()}getTonedShortname(e){return Zj().includes(e)&&this.current_skintone?`${e.slice(0,e.length-1)}_${this.current_skintone}:`:e}initArrowNavigation(){if(!this.navigator){const e="li:not(.hidden):not(.emoji-skintone), .emoji-search",t={jump_to_picked:".emoji-category",jump_to_picked_selector:".emoji-category.picked",jump_to_picked_direction:RN.DIRECTION.down,picked_selector:".picked",scroll_container:this.querySelector(".emoji-picker__lists"),getSelector:t=>{if(t===RN.DIRECTION.down){const t=this.navigator.selected&&this.navigator.selected.getAttribute("data-category");return t?`ul[data-category="${t}"] li:not(.hidden):not(.emoji-skintone), .emoji-search`:e}return e},onSelected:e=>{e.matches(".insert-emoji")&&this.setCategoryForElement(e.parentElement),e.matches(".insert-emoji, .emoji-category")&&e.firstElementChild.focus(),e.matches(".emoji-search")&&e.focus()}};this.navigator=new RN(this,t)}}disableArrowNavigation(){this.navigator?.disable()}enableArrowNavigation(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.handleKeydown(e)}});Oh.elements.define("converse-message-limit-indicator",class extends Nw{constructor(){super(),this.model=null}static get properties(){return{model:{type:Object}}}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:draft",(()=>this.requestUpdate()))}render(){const e=Oh.settings.get("message_limit");if(!e)return"";return(e=>{const t=kw("Message characters remaining");return Ag`<span class="message-limit ${e<1?"error":""}" title="${t}">${e}</span>`})(e-(this.model.get("draft")||"").length)}});const RO=e=>Ag`<span class="btn-group toolbar-buttons">${yT(e.getButtons(),"")}</span> ${e.show_send_button?function(){const e=kw("Send the message");return Ag`<button type="submit" class="btn send-button" data-action="sendMessage" title="${e}"><converse-icon color="var(--toolbar-btn-text-color)" class="fa fa-paper-plane" size="1em"></converse-icon></button>`}():""}`;var DO=s(5501),LO={};LO.styleTagTransform=T(),LO.setAttributes=E(),LO.insert=S().bind(null,"head"),LO.domAPI=w(),LO.insertStyleElement=C();b()(DO.A,LO);DO.A&&DO.A.locals&&DO.A.locals;const zO=qg.env.Strophe;Oh.elements.define("converse-chat-toolbar",class extends Nw{static get properties(){return{hidden_occupants:{type:Boolean},is_groupchat:{type:Boolean},message_limit:{type:Number},model:{type:Object},show_call_button:{type:Boolean},show_emoji_button:{type:Boolean},show_send_button:{type:Boolean},show_spoiler_button:{type:Boolean}}}constructor(){super(),this.model=null,this.is_groupchat=null,this.hidden_occupants=!1,this.show_send_button=!1,this.show_spoiler_button=!1,this.show_call_button=!1,this.show_emoji_button=!1}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate()))}render(){return RO(this)}firstUpdated(){Oh.trigger("renderToolbar",this)}getButtons(){const e=[];if(this.show_emoji_button){const t=Iu.state.chatboxviews.get(this.model.get("jid"));e.push(Ag`<converse-emoji-dropdown .chatview="${t}"></converse-emoji-dropdown>`)}if(this.show_call_button){const t=this.is_groupchat?"--muc-toolbar-btn-color":"--chat-toolbar-btn-color",s=kw("Start a call");e.push(Ag`<button type="button" class="btn toggle-call" @click="${this.toggleCall}" title="${s}"><converse-icon color="var(${t})" class="fa fa-phone" size="1em"></converse-icon></button>`)}Oh.settings.get("message_limit")&&e.push(Ag`<converse-message-limit-indicator .model="${this.model}" class="right"></converse-message-limit-indicator>`),this.show_spoiler_button&&e.push(this.getSpoilerButton());const t=Iu.session.get("domain"),s=Oh.disco.supports(zO.NS.HTTPUPLOAD,t);return e.push(Ag`${yT(s.then((e=>this.getHTTPUploadButton(!!e))),"")}`),Iu.api.hook("getToolbarButtons",this,e)}getHTTPUploadButton(e){if(e){const e=kw("Choose a file to send");return Ag`<button type="button" class="btn" title="${e}" @click="${this.toggleFileUpload}"><converse-icon class="fa fa-paperclip" size="1em"></converse-icon></button> <input type="file" @change="${this.onFileSelection}" class="fileupload" multiple="" style="display:none">`}return""}getSpoilerButton(){const e=this.model;if(!this.is_groupchat&&!e.presence?.resources.length)return;let t;t=e.get("composing_spoiler")?kw("Click to write as a normal (non-spoiler) message"):kw("Click to write your message as a spoiler");const s=this.is_groupchat?"--muc-toolbar-btn-color":"--chat-toolbar-btn-color",n=Ag`<button type="button" class="btn toggle-compose-spoiler" title="${t}" @click="${this.toggleComposeSpoilerMessage}"><converse-icon color="var(${s})" class="fa ${e.get("composing_spoiler")?"fa-eye-slash":"fa-eye"}" size="1em"></converse-icon></button>`;if(this.is_groupchat)return n;{const t=e.get("jid"),s=Promise.all(e.presence.resources.map((e=>Oh.disco.supports(zO.NS.SPOILER,`${t}/${e.get("name")}`)))).then((e=>e.reduce(((e,t)=>e&&t),!0)));return Ag`${yT(s.then((()=>n)),"")}`}}toggleFileUpload(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.querySelector(".fileupload").click()}onFileSelection(e){this.model.sendFiles(e.target.files)}toggleComposeSpoilerMessage(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.set("composing_spoiler",!this.model.get("composing_spoiler"))}toggleCall(e){e?.preventDefault?.(),e?.stopPropagation?.(),Oh.trigger("callButtonClicked",{connection:Oh.connection.get(),model:this.model})}});const{HEADLINES_TYPE:PO}=yw;var FO=s(2995),UO={};UO.styleTagTransform=T(),UO.setAttributes=E(),UO.insert=S().bind(null,"head"),UO.domAPI=w(),UO.insertStyleElement=C();b()(FO.A,UO);FO.A&&FO.A.locals&&FO.A.locals;Oh.elements.define("converse-chat-heading",class extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const{chatboxes:e}=Iu.state;this.model=e.get(this.jid),this.listenTo(this.model,"change:status",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.model.contact&&this.listenTo(this.model.contact,"destroy",(()=>this.requestUpdate())),this.model.rosterContactAdded?.then((()=>{this.listenTo(this.model.contact,"change:nickname",(()=>this.requestUpdate())),this.requestUpdate()}))}render(){return(e=>{const t=kw("The User's Profile Image"),s=e.model.getDisplayName(),n=Ag`<span title="${t}"><converse-avatar .model="${e.model.contact||e.model}" class="avatar chat-msg__avatar" name="${s}" nonce="${e.model.contact?.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></span>`;return Ag`<div class="chatbox-title ${e.status?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${Iu.api.settings.get("singleton")?"":Ag`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`} ${e.type!==PO?Ag`<a class="show-msg-author-modal" @click="${e.showUserDetailsModal}">${n}</a>`:""}<div class="chatbox-title__text" title="${e.jid}" role="heading" aria-level="2">${e.type!==PO?Ag`<a class="user show-msg-author-modal" @click="${e.showUserDetailsModal}">${s}</a>`:s}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${yT(Qj(e.heading_buttons_promise),"")} ${yT(Vj(e.heading_buttons_promise),"")}</div></div>${e.status?Ag`<p class="chat-head__desc">${e.status}</p>`:""}`})(Object.assign(this.model.toJSON(),{heading_buttons_promise:this.getHeadingButtons(),model:this.model,showUserDetailsModal:e=>this.showUserDetailsModal(e)}))}showUserDetailsModal(e){e.preventDefault(),Oh.modal.show("converse-user-details-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}getHeadingButtons(){const e=[{a_class:"show-user-details-modal",handler:e=>this.showUserDetailsModal(e),i18n_text:kw("Details"),i18n_title:kw("See more information about this person"),icon_class:"fa-id-card",name:"details",standalone:"overlayed"===Oh.settings.get("view_mode")}];Oh.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:kw("Close"),i18n_title:kw("Close and end this conversation"),icon_class:"fa-times",name:"close",standalone:"overlayed"===Oh.settings.get("view_mode")});const{chatboxviews:t}=Iu.state,s=t.get(this.getAttribute("jid"));return s?Iu.api.hook("getHeadingButtons",s,e):e}});async function BO(e){await Oh.confirm(kw("Are you sure you want to clear the messages from this conversation?"))&&await e.clearMessages()}function qO(e){if(!window.CSS?.supports("field-sizing","content"))if(e.target.value){const t=e.target.scrollHeight+"px";e.target.style.height!=t&&(e.target.style.height="auto",e.target.style.height=t)}else e.target.style=""}const{ACTIVE:HO,COMPOSING:GO}=yw;class WO extends Nw{async initialize(){const{chatboxes:e}=Iu.state;this.model=e.get(this.getAttribute("jid")),await this.model.initialized,this.listenTo(this.model.messages,"change:correcting",this.onMessageCorrecting),this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate())),this.handleEmojiSelection=({detail:e})=>{this.model.get("jid")===e.jid&&this.insertIntoTextArea(e.value,e.autocompleting,!1,e.ac_position)},document.addEventListener("emojiSelected",this.handleEmojiSelection),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("emojiSelected",this.handleEmojiSelection)}render(){return(e=>{const t=e.model.get("composing_spoiler"),s=kw(t?"Hidden message":"Message"),n=kw("Optional hint"),i=Oh.settings.get("message_limit"),r=Oh.settings.get("visible_toolbar_buttons").call,o=Oh.settings.get("visible_toolbar_buttons").emoji,a=Oh.settings.get("show_send_button"),c=Oh.settings.get("visible_toolbar_buttons").spoiler,l=Oh.settings.get("show_toolbar"),d=e.querySelector(".spoiler-hint")?.value,u=e.querySelector(".chat-textarea")?.value;return Ag`<form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?Ag`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?composing_spoiler="${t}" ?show_call_button="${r}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" enterkeyhint="send" placeholder="${n||""}" i value="${d||""}" class="${t?"":"hidden"} spoiler-hint"> <textarea autofocus type="text" enterkeyhint="send" @drop="${t=>e.onDrop(t)}" @input="${qO}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>e.model.set({draft:t.target.value})}" class="chat-textarea ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${s}">${u||""}</textarea></form>`})(this)}insertIntoTextArea(e,t=!1,s=!1,n,i=" "){const r=this.querySelector(".chat-textarea");if(s?Sm.addClass("correcting",r):Sm.removeClass("correcting",r),t)r.value=n&&"string"==typeof t?r.value.replace(new RegExp(t,"g"),((s,r)=>r==n-t.length?e+i:s)):e;else{let t=r.value;t&&t[t.length-1]!==i&&(t+=i),r.value=t+e+i}const o=document.createEvent("HTMLEvents");o.initEvent("change",!1,!0),r.dispatchEvent(o),Sm.placeCaretAtEnd(r)}onMessageCorrecting(e){if(e.get("correcting"))this.insertIntoTextArea(Sm.prefixMentions(e),!0,!0);else{const t=this.model.messages.findWhere("correcting");t&&t!==e?this.insertIntoTextArea(Sm.prefixMentions(e),!0,!0):this.insertIntoTextArea("",!0,!1)}}onEscapePressed(e){const t=this.model.messages.findLastIndex("correcting"),s=t>=0?this.model.messages.at(t):null;s&&(e.preventDefault(),s.save("correcting",!1),this.insertIntoTextArea("",!0,!1))}onPaste(e){if(e.stopPropagation(),0!==e.clipboardData.files.length)return e.preventDefault(),void this.model.sendFiles(Array.from(e.clipboardData.files));this.model.set({draft:e.clipboardData.getData("text/plain")})}onDrop(e){0!=e.dataTransfer.files.length&&(e.preventDefault(),this.model.sendFiles(e.dataTransfer.files))}onKeyUp(e){this.model.set({draft:e.target.value})}onKeyDown(e){if(!e.ctrlKey){if(!e.shiftKey&&!e.altKey&&!e.metaKey)if(e.keyCode===qg.keycodes.TAB){const t=Sm.getCurrentWord(e.target,null,/(:.*?:)/g);t.startsWith(":")&&(e.preventDefault(),e.stopPropagation(),this.model.trigger("emoji-picker-autocomplete",e.target,t))}else{if(e.keyCode===qg.keycodes.FORWARD_SLASH)return;if(e.keyCode===qg.keycodes.ESCAPE)return this.onEscapePressed(e);if(e.keyCode===qg.keycodes.ENTER)return this.onFormSubmitted(e);if(e.keyCode!==qg.keycodes.UP_ARROW||e.target.selectionEnd){if(e.keyCode===qg.keycodes.DOWN_ARROW&&e.target.selectionEnd===e.target.value.length&&Sm.hasClass("correcting",this.querySelector(".chat-textarea")))return this.model.editLaterMessage()}else{const e=this.querySelector(".chat-textarea");if(!e.value||Sm.hasClass("correcting",e))return this.model.editEarlierMessage()}}[qg.keycodes.SHIFT,qg.keycodes.META,qg.keycodes.META_RIGHT,qg.keycodes.ESCAPE,qg.keycodes.ALT].includes(e.keyCode)||this.model.get("chat_state")!==GO&&this.model.setChatState(GO)}}async onFormSubmitted(e){e?.preventDefault?.();const{chatboxviews:t}=Iu.state,s=this.querySelector(".chat-textarea"),n=s.value.trim();if(Oh.settings.get("message_limit")&&n.length>Oh.settings.get("message_limit")||!n.replace(/\s/g,"").length)return;if(!Oh.connection.get().authenticated){const e=kw("Sorry, the connection has been lost, and your message could not be sent");return Oh.alert("error",kw("Error"),e),void Oh.connection.reconnect()}let i,r={};this.model.get("composing_spoiler")&&(r=this.querySelector("form.chat-message-form input.spoiler-hint"),i=r.value),Sm.addClass("disabled",s),s.setAttribute("disabled","disabled"),this.querySelector("converse-emoji-dropdown")?.dropdown.hide();const o=await async function(e,t){const s=t.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(s){let n=!1;if(n=await Oh.hook("parseMessageForCommands",{model:e,text:t},n),n)return!0;if("clear"===s[1])return BO(e),!0;if("close"===s[1]){const{chatboxviews:t}=Iu.state;return t.get(e.get("jid"))?.close(),!0}if("help"===s[1])return e.set({show_help_messages:!1},{silent:!0}),e.set({show_help_messages:!0}),!0}return!1}(this.model,n),a=o?null:await this.model.sendMessage({body:n,spoiler_hint:i});if((o||a)&&(r.value="",s.value="",Sm.removeClass("correcting",s),s.style.height="auto",this.model.set({draft:""})),"overlayed"===Oh.settings.get("view_mode")){t.get(this.getAttribute("jid")).querySelector(".chat-content__messages").parentElement.style.display="none"}if(s.removeAttribute("disabled"),Sm.removeClass("disabled",s),"overlayed"===Oh.settings.get("view_mode")){t.get(this.getAttribute("jid")).querySelector(".chat-content__messages").parentElement.style.display=""}this.model.setChatState(HO,{silent:!0}),s.focus()}}Oh.elements.define("converse-message-form",WO);var VO=s(1089),QO={};QO.styleTagTransform=T(),QO.setAttributes=E(),QO.insert=S().bind(null,"head"),QO.domAPI=w(),QO.insertStyleElement=C();b()(VO.A,QO);VO.A&&VO.A.locals&&VO.A.locals;class JO extends Nw{async connectedCallback(){super.connectedCallback(),await this.initialize(),this.requestUpdate()}async initialize(){this.model=await Oh.chatboxes.get(this.getAttribute("jid")),await this.model.initialized,this.listenTo(this.model,"change:num_unread",(()=>this.requestUpdate())),this.listenTo(this.model,"emoji-picker-autocomplete",this.autocompleteInPicker),this.addEventListener("focusin",(e=>this.emitFocused(e))),this.addEventListener("focusout",(e=>this.emitBlurred(e))),this.addEventListener("click",(e=>this.sendButtonClicked(e)))}render(){return this.model?(e=>{const t=kw("You have unread messages");return Ag`${e.model.ui.get("scrolled")&&e.model.get("num_unread")?Ag`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""}<converse-message-form jid="${e.model.get("jid")}"></converse-message-form>`})({model:this.model,viewUnreadMessages:e=>this.viewUnreadMessages(e)}):""}sendButtonClicked(e){if("sendMessage"===e.delegateTarget?.dataset.action){const t=this.querySelector("converse-message-form");t?.onFormSubmitted(e)}}viewUnreadMessages(e){e?.preventDefault?.(),this.model.ui.set({scrolled:!1})}emitFocused(e){const{chatboxviews:t}=Iu.state;t.get(this.getAttribute("jid"))?.emitFocused(e)}emitBlurred(e){const{chatboxviews:t}=Iu.state;t.get(this.getAttribute("jid"))?.emitBlurred(e)}onDragOver(e){e.preventDefault()}clearMessages(e){e?.preventDefault?.(),BO(this.model)}async autocompleteInPicker(e,t){await Oh.emojis.initialize();const s=this.querySelector("converse-emoji-picker");if(s){s.model.set({ac_position:e.selectionStart,autocompleting:t,query:t});const n=this.querySelector("converse-emoji-dropdown");n?.dropdown.show()}}}Oh.elements.define("converse-chat-bottom-panel",JO);const{CHATROOMS_TYPE:YO,INACTIVE:XO}=yw;class KO extends Nw{static get properties(){return{jid:{type:String}}}constructor(){super(),this.jid=null,this.model=null}disconnectedCallback(){super.disconnectedCallback(),Iu.state.chatboxviews.remove(this.jid,this)}updated(){this.model&&this.jid!==this.model.get("jid")&&(this.stopListening(),Iu.state.chatboxviews.remove(this.model.get("jid"),this),delete this.model,this.requestUpdate(),this.initialize())}close(e){return e?.preventDefault?.(),this.model.close(e)}maybeFocus(){Oh.settings.get("auto_focus")&&this.focus()}focus(){const e=this.getElementsByClassName("chat-textarea")[0];return e&&document.activeElement!==e&&e.focus(),this}emitBlurred(e){this.contains(document.activeElement)||this.contains(e.relatedTarget)||Oh.trigger("chatBoxBlurred",this,e)}emitFocused(e){this.contains(e.relatedTarget)||Oh.trigger("chatBoxFocused",this,e)}getBottomPanel(){return this.model.get("type")===YO?this.querySelector("converse-muc-bottom-panel"):this.querySelector("converse-chat-bottom-panel")}getMessageForm(){return this.model.get("type")===YO?this.querySelector("converse-muc-message-form"):this.querySelector("converse-message-form")}scrollDown(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.ui.get("scrolled")&&this.model.ui.set({scrolled:!1}),Jj(this.model)}onWindowStateChanged(){document.hidden?(this.model.setChatState(XO,{silent:!0}),this.model.sendChatState()):this.model.isHidden()||this.model.clearUnreadMsgCounter()}}const{CHATROOMS_TYPE:ZO}=yw,{ACTIVE:eI}=yw;class tI extends KO{length=200;async initialize(){const{chatboxviews:e,chatboxes:t}=Iu.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>!this.model.get("hidden")&&this.afterShown())),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),await this.model.messages.fetched,!this.model.get("hidden")&&this.afterShown(),Oh.trigger("chatBoxViewInitialized",this)}render(){return(e=>Ag`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e.model?Ag`<converse-chat-heading jid="${e.jid}" class="chat-head chat-head-chatbox row g-0"></converse-chat-heading><div class="chat-body"><div class="chat-content ${e.show_send_button?"chat-content-sendbutton":""}" aria-live="polite"><converse-chat-content class="chat-content__messages" jid="${e.jid}"></converse-chat-content>${e.show_help_messages?Ag`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${e.help_messages}" ?hidden="${!e.show_help_messages}" type="info" chat_type="${ZO}"></converse-chat-help></div>`:""}</div><converse-chat-bottom-panel jid="${e.jid}" class="bottom-panel"></converse-chat-bottom-panel></div>`:""}</div>`)(Object.assign({model:this.model,help_messages:this.getHelpMessages(),show_help_messages:this.model.get("show_help_messages")},this.model.toJSON()))}getHelpMessages(){return[`<strong>/clear</strong>: ${kw("Remove messages")}`,`<strong>/close</strong>: ${kw("Close this chat")}`,`<strong>/me</strong>: ${kw("Write in the third person")}`,`<strong>/help</strong>: ${kw("Show this menu")}`]}afterShown(){this.model.setChatState(eI),this.model.clearUnreadMsgCounter(),this.maybeFocus()}}Oh.elements.define("converse-chat",tI);var sI=s(2852),nI={};nI.styleTagTransform=T(),nI.setAttributes=E(),nI.insert=S().bind(null,"head"),nI.domAPI=w(),nI.insertStyleElement=C();b()(sI.A,nI);sI.A&&sI.A.locals&&sI.A.locals;const{Strophe:iI}=qg.env;qg.plugins.add("converse-chatview",{dependencies:["converse-chatboxviews","converse-chat","converse-disco","converse-modal"],initialize(){Oh.settings.extend({allowed_audio_domains:null,allowed_image_domains:null,allowed_video_domains:null,auto_focus:!0,debounced_content_rendering:!0,filter_url_query_params:null,image_urls_regex:null,message_limit:0,muc_hats:["xep317"],render_media:!0,show_message_avatar:!0,show_retraction_warning:!0,show_send_button:!0,show_toolbar:!0,time_format:"HH:mm",use_system_emojis:!0,visible_toolbar_buttons:{call:!1,clear:!0,emoji:!0,spoiler:!1}});const e={ChatBoxView:tI,ChatView:tI};Object.assign(Iu,e),Object.assign(Iu.exports,e),Oh.listen.on("connected",(()=>Oh.disco.own.features.add(iI.NS.SPOILER))),Oh.listen.on("chatBoxClosed",(e=>{return t=e.get("jid"),void(location.hash===`converse/chat?jid=${t}`&&history.pushState(null,"",window.location.pathname));var t}))}});Oh.elements.define("converse-brand-byline",class extends Nw{render(){const e="fullscreen"===Oh.settings.get("view_mode");return Ag`${e?Ag`<p class="brand-subtitle">${Iu.VERSION_NAME}</p><p class="brand-subtitle"><a target="_blank" rel="nofollow" href="https://conversejs.org">Open Source</a> XMPP chat client brought to you by <a target="_blank" rel="nofollow" href="https://opkode.com">Opkode</a></p><p class="brand-subtitle"><a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">Translate</a> it into your own language</p>`:""}`}});Oh.elements.define("converse-brand-logo",class extends Nw{render(){const e="fullscreen"===Oh.settings.get("view_mode");return Ag`<a class="brand-heading" href="https://conversejs.org" target="_blank" rel="noopener"><span class="brand-name-wrapper ${e?"brand-name-wrapper--fullscreen":""}"><svg class="converse-svg-logo" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 364 364"><title>Converse</title><g class="cls-1" id="g904"><g data-name="Layer 2"><g data-name="Layer 7"><path class="cls-3" d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z"/><path class="cls-4" d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z"/></g></g></g></svg> <span class="brand-name"><span class="brand-name__text">converse<span class="subdued">.js</span></span> ${e?Ag`<p class="byline">messaging freedom</p>`:""}</span></span></a>`}});Oh.elements.define("converse-brand-heading",class extends Nw{render(){return Lf`<converse-brand-logo></converse-brand-logo><converse-brand-byline></converse-brand-byline>`}});const{Strophe:rI,u:oI}=qg.env;function aI(){const e=Iu.state.chatboxes.add(new Iu.exports.ControlBox({id:"controlbox"}));return Iu.state.chatboxviews.get("controlbox")?.setModel(),e}function cI(e){e?.preventDefault?.();const t=Iu.state.chatboxes.get("controlbox")||aI();oI.safeSave(t,{closed:!1})}function lI(){const e=Iu.state.chatboxes?.get("controlbox");e&&oI.safeSave(e,{connected:!1})}function dI(){const{chatboxviews:e}=Iu.state,t=e?.get("controlbox");t&&(oI.safeSave(t.model,{connected:!1}),t?.controlbox_pane&&(t.controlbox_pane.remove(),delete t.controlbox_pane))}async function uI(e){e?.preventDefault();await Oh.confirm(kw("Are you sure you want to log out?"))&&Oh.user.logout()}function hI(){(Iu.state.chatboxes.get("controlbox")||aI()).save({connected:!0})}const{Strophe:mI}=qg.env,fI=[mI.Status.ERROR,mI.Status.CONNECTING,mI.Status.CONNFAIL,mI.Status.AUTHENTICATING,mI.Status.AUTHFAIL,mI.Status.DISCONNECTING,mI.Status.RECONNECTING],gI=Object.fromEntries([[mI.Status.ERROR,"Error"],[mI.Status.CONNECTING,"Connecting"],[mI.Status.CONNFAIL,"Connection failure"],[mI.Status.AUTHENTICATING,"Authenticating"],[mI.Status.AUTHFAIL,"Authentication failure"],[mI.Status.CONNECTED,"Connected"],[mI.Status.DISCONNECTED,"Disconnected"],[mI.Status.DISCONNECTING,"Disconnecting"],[mI.Status.ATTACHED,"Attached"],[mI.Status.REDIRECT,"Redirect"],[mI.Status.CONNTIMEOUT,"Connection timeout"],[mI.Status.RECONNECTING,"Reconnecting"]]),pI=Object.fromEntries([[mI.Status.ERROR,"error"],[mI.Status.CONNECTING,"info"],[mI.Status.CONNFAIL,"error"],[mI.Status.AUTHENTICATING,"info"],[mI.Status.AUTHFAIL,"error"],[mI.Status.CONNECTED,"info"],[mI.Status.DISCONNECTED,"error"],[mI.Status.DISCONNECTING,"warn"],[mI.Status.ATTACHED,"info"],[mI.Status.REDIRECT,"info"],[mI.Status.RECONNECTING,"warn"]]),{ANONYMOUS:vI,EXTERNAL:_I,LOGIN:bI,PREBIND:yI,CONNECTION_STATUS:wI}=yw,AI=e=>{const t=Oh.settings.get("authentication"),s=kw("Log in"),n=kw("XMPP Address"),i=Oh.settings.get("locked_domain"),r=Oh.settings.get("default_domain"),o=(i||r)&&kw("Username")||kw("user@domain"),a=Oh.settings.get("allow_user_trust_override");return Ag`<fieldset class="form-group"><label for="converse-login-jid" class="form-label">${n}:</label> <input id="converse-login-jid" ?autofocus="${!!Oh.settings.get("auto_focus")}" @changed="${e.validate}" value="${Oh.settings.get("jid")??""}" required class="form-control" type="text" name="jid" placeholder="${o}"></fieldset>${t!==_I?(()=>{const e=kw("Password");return Ag`<div><label for="converse-login-password" class="form-label">${e}</label> <input id="converse-login-password" class="form-control" required="required" value="${Oh.settings.get("password")??""}" type="password" name="password" placeholder="${e}"></div>`})():""} ${Oh.settings.get("show_connection_url_input")?(()=>{const e=kw("Connection URL"),t=kw("HTTP or websocket URL that is used to connect to your XMPP server"),s=kw("e.g. wss://example.org/xmpp-websocket");return Ag`<div class="form-group fade-in"><label for="converse-conn-url" class="form-label">${e}</label><p class="form-help instructions">${t}</p><input id="converse-conn-url" class="form-control" type="url" name="connection-url" placeholder="${s}"></div>`})():""} ${a?(e=>{const t=kw("To improve performance, we cache your data in this browser. Uncheck this box if this is a public computer or if you want your data to be deleted when you log out. It's important that you explicitly log out, otherwise not all cached data might be deleted. Please note, when using an untrusted device, OMEMO encryption is NOT available."),s=kw("This is a trusted device");return Ag`<div class="form-group form-check login-trusted mt-2"><input id="converse-login-trusted" type="checkbox" class="form-check-input p-1 me-1" name="trusted" ?checked="${e}"> <label for="converse-login-trusted" class="form-check-label login-trusted__desc">${s}</label> <button type="button" class="btn p-0" data-toggle="popover" title="${t}" data-content="${t}"><converse-icon class="fa fa-info-circle" size="1.2em"></converse-icon></button></div>`})("off"!==a):""}<fieldset class="form-group buttons"><input class="btn btn-primary" type="submit" value="${s}"></fieldset>${Oh.settings.get("allow_registration")&&!Oh.settings.get("auto_login")&&Iu.pluggable.plugins["converse-register"].enabled(Iu)?(()=>{const e=kw("Create an account"),t=kw("Don't have a chat account?");return Ag`<fieldset class="switch-form"><p>${t}</p><p><a class="register-account toggle-register-login" href="#converse/register">${e}</a></p></fieldset>`})():""}`},SI=e=>{const{connfeedback:t}=Iu.state,s=t.get("connection_status");let n,i;fI.includes(s)&&(i=gI[s],n=pI[s]);const r=t.get("message");return Ag`<converse-brand-heading></converse-brand-heading><form id="converse-login" class="converse-form" method="post" @submit="${e.onLoginFormSubmitted}"><div class="conn-feedback fade-in ${i?n:"hidden"}"><p class="feedback-subject">${i}</p><p class="feedback-message ${r?"":"hidden"}">${r}</p></div>${"CONNECTING"===wI[s]?Zk():(e=>{const t=Oh.settings.get("authentication"),s=kw("Disconnected"),n=kw("Click here to log in anonymously");return Ag`${t==bI||t==_I?AI(e):""} ${t==vI?Ag`<input class="btn btn-primary login-anon" type="submit" value="${n}">`:""} ${t==yI?Ag`<p>${s}</p>`:""}`})(e)}</form>`};var xI=s(5832),EI={};EI.styleTagTransform=T(),EI.setAttributes=E(),EI.insert=S().bind(null,"head"),EI.domAPI=w(),EI.insertStyleElement=C();b()(xI.A,EI);xI.A&&xI.A.locals&&xI.A.locals;const{Strophe:$I}=qg.env,{ANONYMOUS:CI}=yw;Oh.elements.define("converse-login-form",class extends Nw{initialize(){this.listenTo(Iu.state.connfeedback,"change",(()=>this.requestUpdate())),this.handler=()=>this.requestUpdate()}connectedCallback(){super.connectedCallback(),Oh.settings.listen.on("change",this.handler)}disconnectedCallback(){super.disconnectedCallback(),Oh.settings.listen.not("change",this.handler)}render(){return SI(this)}firstUpdated(){this.initPopovers()}async onLoginFormSubmitted(e){if(e?.preventDefault(),Oh.settings.get("authentication")===CI){const e=Iu.session.get("jid");return this.connect(e)}const t=e.target;(function(e){const t=e.querySelector("input[name=jid]");return!t.value||Oh.settings.get("locked_domain")||Oh.settings.get("default_domain")||oI.isValidJID(t.value)?(t.setCustomValidity(""),!0):(t.setCustomValidity(kw("Please enter a valid XMPP address")),!1)})(t)&&(!function(e,t={}){const s=new FormData(e),n=s.get("connection-url");n?.startsWith("ws")?t.websocket_url=n:n?.startsWith("http")&&(t.bosh_service_url=n);let i=s.get("jid");if(Oh.settings.get("locked_domain")){const e="@"+Oh.settings.get("locked_domain");i.endsWith(e)&&(i=i.substr(0,i.length-e.length)),i=rI.escapeNode(i)+e}else Oh.settings.get("default_domain")&&!i.includes("@")&&(i=i+"@"+Oh.settings.get("default_domain"));t.jid=i,t.password=s.get("password"),Oh.settings.set(t),Iu.state.config.save({trusted:!!s.get("trusted")})}(t),Oh.settings.get("bosh_service_url")||Oh.settings.get("websocket_url")||await this.discoverConnectionMethods(t),Oh.settings.get("bosh_service_url")||Oh.settings.get("websocket_url")?this.connect():Oh.settings.set("show_connection_url_input",!0))}discoverConnectionMethods(e){if(!Oh.settings.get("discover_connection_methods"))return;const t=new FormData(e).get("jid");if(t instanceof File)throw new Error('Found file instead of string for "jid" field in form');const s=$I.getDomainFromJid(t);return Oh.connection.init(t),Oh.connection.get().discoverConnectionMethods(s)}initPopovers(){Array.from(this.querySelectorAll('[data-toggle="popover"]')).forEach((e=>new Q$(e)))}connect(e){["converse/login","converse/register"].includes(location.hash)&&history.pushState(null,"",window.location.pathname),Oh.connection.get()?.reset(),Oh.user.login(e)}});const kI=e=>Ag`<converse-icon size="1em" class="fa fa-arrow-left" @click="${()=>function(e){cI();const t=Iu.state.chatboxes.get(e);oI.safeSave(t,{hidden:!0})}(e)}"></converse-icon>`;class TI extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}render(){return kI(this.jid)}}Oh.elements.define("converse-controlbox-navback",TI);function jI(){const e=kw("Log out");return Ag`<a class="controlbox-heading__btn logout align-self-center" title="${e}" @click="${uI}"><converse-icon class="fa fa-sign-out-alt" size="1em"></converse-icon></a>`}const NI=e=>{const t=e.model.get("connected"),s=Oh.settings.get("show_client_info")||Oh.settings.get("allow_adhoc_commands");return Ag`<div class="btn-toolbar g-0">${t&&s?function(e){const t=kw("Show details about this chat client");return Ag`<a class="controlbox-heading__btn show-client-info align-self-center" title="${t}" @click="${e.showUserSettingsModal}"><converse-icon class="fa fa-cog" size="1em"></converse-icon></a>`}(e):""} ${t&&Oh.settings.get("allow_logout")?jI():""} ${Oh.settings.get("sticky_controlbox")?"":function(e){return Ag`<a class="controlbox-heading__btn close align-self-center" @click="${t=>e.closeControlBox(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></a>`}(e)}</div>`};var OI=s(7190),II={};II.styleTagTransform=T(),II.setAttributes=E(),II.insert=S().bind(null,"head"),II.domAPI=w(),II.insertStyleElement=C();b()(OI.A,II);OI.A&&OI.A.locals&&OI.A.locals;class MI extends Nw{initialize(){const{chatboxes:e}=Iu.state;this.model=e.get("controlbox")}render(){return NI(this)}showUserSettingsModal(e){e?.preventDefault(),Oh.modal.show("converse-user-settings-modal",{model:Iu.state.xmppstatus,_converse:Iu},e)}closeControlBox(e){e?.preventDefault();const t=Iu.state.chatboxviews.get("controlbox");t?.close()}}Oh.elements.define("converse-controlbox-buttons",MI);const{dayjs:RI}=qg.env,{CONTROLBOX_TYPE:DI}=yw;const LI=class extends cd{defaults(){return{bookmarked:!1,box_id:"controlbox",chat_state:void 0,closed:!Oh.settings.get("show_controlbox_by_default"),num_unread:0,time_opened:RI(0).valueOf(),type:DI,url:""}}validate(e){return e.type===DI?"embedded"===Oh.settings.get("view_mode")&&Oh.settings.get("singleton")?"Controlbox not relevant in embedded view mode":void 0:Iu.state.ChatBox.prototype.validate.call(this,e)}maybeShow(e){return e||"controlbox"!==this.get("id")?Iu.state.ChatBox.prototype.maybeShow.call(this,e):this}onReconnection(){this.save("connected",!0)}};class zI extends Nw{async connectedCallback(){super.connectedCallback(),await Oh.waitUntil("initialized");const{chatboxes:e}=Iu.state;this.model=e.get("controlbox"),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=Oh.connection.connected()?kw("Chat Contacts"):kw("Toggle chat");return Ag`<button type="button" class="btn toggle-controlbox ${e.model?.get("closed")?"":"hidden"}" @click="${e=>cI(e)}"><span class="toggle-feedback">${t}</span></button>`})(this)}}Oh.elements.define("converse-controlbox-toggle",zI);const PI=zI,{Strophe:FI}=qg.env,{ANONYMOUS:UI}=yw;const BI=e=>Ag`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e.model.get("connected")?Ag`<converse-user-profile></converse-user-profile>`:Ag`<converse-controlbox-buttons class="controlbox-padded"></converse-controlbox-buttons>`}<div class="controlbox-pane">${e.model.get("connected")?Ag`<converse-headlines-feeds-list class="controlbox-section"></converse-headlines-feeds-list><div id="chatrooms" class="controlbox-section"><converse-rooms-list></converse-rooms-list></div>${Oh.settings.get("authentication")===UI?"":Ag`<div id="converse-roster" class="controlbox-section"><converse-roster></converse-roster></div>`}`:function(e){const t=Iu.state.connfeedback.get("connection_status");return[FI.Status.RECONNECTING,FI.Status.CONNECTING].includes(t)?Zk({class:"vertically-centered"}):"register"===e.model.get("active-form")?Ag`<converse-register-panel></converse-register-panel>`:Ag`<converse-login-form id="converse-login-panel" class="controlbox-pane fade-in"></converse-login-form>`}(e)}</div></div>`,{LOGOUT:qI}=yw;class HI extends Nw{initialize(){this.setModel();const{chatboxviews:e}=Iu.state;e.add("controlbox",this),this.model.get("connected")&&void 0===this.model.get("closed")&&this.model.set("closed",!Oh.settings.get("show_controlbox_by_default")),this.requestUpdate(),Oh.trigger("controlBoxInitialized",this)}setModel(){this.model=Iu.state.chatboxes.get("controlbox"),this.listenTo(Iu.state.connfeedback,"change:connection_status",(()=>this.requestUpdate())),this.listenTo(this.model,"change:active-form",(()=>this.requestUpdate())),this.listenTo(this.model,"change:connected",(()=>this.requestUpdate())),this.listenTo(this.model,"change:closed",(()=>{this.requestUpdate(),this.model.get("closed")||this.afterShown()})),this.requestUpdate()}render(){return this.model&&!this.model.get("closed")?BI(this):""}close(e){e?.preventDefault?.();const t=Oh.connection.get();if(("closeAllChatBoxes"!==e?.name||t.disconnection_cause===qI&&!Oh.settings.get("show_controlbox_by_default"))&&!Oh.settings.get("sticky_controlbox")&&"overlayed"===Oh.settings.get("view_mode"))return Sm.safeSave(this.model,{closed:!0}),Oh.trigger("controlBoxClosed",this),this}afterShown(){return Oh.trigger("controlBoxOpened",this),this}}Oh.elements.define("converse-controlbox",HI);const GI=HI,{u:WI}=qg.env,VI={controlbox:{async open(){await Oh.waitUntil("chatBoxesFetched");let e=await Oh.chatboxes.get("controlbox");return e||(e=await Oh.chatboxes.create("controlbox",{},LI)),WI.safeSave(e,{closed:!1}),e},get:()=>Iu.state.chatboxviews.get("controlbox")}};var QI=s(6264),JI={};JI.styleTagTransform=T(),JI.setAttributes=E(),JI.insert=S().bind(null,"head"),JI.domAPI=w(),JI.insertStyleElement=C();b()(QI.A,JI);QI.A&&QI.A.locals&&QI.A.locals;const{CONTROLBOX_TYPE:YI}=yw;qg.plugins.add("converse-controlbox",{dependencies:["converse-modal","converse-chatboxes","converse-chat","converse-rosterview","converse-chatview"],enabled:e=>!e.api.settings.get("singleton"),initialize(){Oh.settings.extend({allow_logout:!0,allow_user_trust_override:!0,default_domain:void 0,locked_domain:void 0,show_connection_url_input:!1,show_controlbox_by_default:!1,sticky_controlbox:!1}),Oh.promises.add("controlBoxInitialized",!1),Object.assign(Oh,VI);const e={ControlBox:LI,ControlBoxView:GI,ControlBoxToggle:PI};Object.assign(Iu,e),Object.assign(Iu.exports,e),Oh.chatboxes.registry.add(YI,LI),Oh.listen.on("chatBoxesFetched",hI),Oh.listen.on("clearSession",dI),Oh.listen.on("will-reconnect",lI),Oh.waitUntil("chatBoxViewsInitialized").then(aI).catch((e=>bt.fatal(e)))}});Oh.elements.define("converse-headlines-heading",class extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}async initialize(){this.model=Iu.state.chatboxes.get(this.jid),await this.model.initialized,this.requestUpdate()}render(){return(e=>Ag`<div class="chatbox-title ${e.status?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${Iu.api.settings.get("singleton")?"":Ag`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`}<div class="chatbox-title__text" title="${e.jid}">${e.display_name}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${yT(Qj(e.heading_buttons_promise),"")} ${yT(Vj(e.heading_buttons_promise),"")}</div></div>${e.status?Ag`<p class="chat-head__desc">${e.status}</p>`:""}`)({...this.model.toJSON(),display_name:this.model.getDisplayName(),heading_buttons_promise:this.getHeadingButtons()})}getHeadingButtons(){const e=[];return Oh.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:kw("Close"),i18n_title:kw("Close these announcements"),icon_class:"fa-times",name:"close",standalone:"overlayed"===Oh.settings.get("view_mode")}),Iu.api.hook("getHeadingButtons",this,e)}close(e){e.preventDefault(),this.model.close()}});class XI extends KO{async initialize(){const{chatboxviews:e,chatboxes:t}=Iu.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>this.afterShown())),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.messages,"add",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"remove",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"reset",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),await this.model.messages.fetched,this.model.maybeShow(),Oh.trigger("headlinesBoxViewInitialized",this)}render(){return(e=>Ag`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e?Ag`<converse-headlines-heading jid="${e.get("jid")}" class="chat-head chat-head-chatbox row g-0"></converse-headlines-heading><div class="chat-body"><div class="chat-content" aria-live="polite"><converse-chat-content class="chat-content__messages" jid="${e.get("jid")}"></converse-chat-content></div></div>`:""}</div>`)(this.model)}async close(e){return e?.preventDefault?.(),location.hash==="converse/chat?jid="+this.model.get("jid")&&history.pushState(null,"",window.location.pathname),await this.model.close(e),this}getNotifications(){return[]}afterShown(){this.model.clearUnreadMsgCounter()}}Oh.elements.define("converse-headlines",XI);const{HEADLINES_TYPE:KI}=yw;const ZI=e=>{const t=e.model.filter((e=>e.get("type")===KI)),s=kw("Announcements");return Ag`<div class="controlbox-section" id="headline"><div class="d-flex controlbox-padded ${t.length?"":"hidden"}"><span class="w-100 controlbox-heading controlbox-heading--headline" role="heading" aria-level="3">${s}</span></div></div><div class="list-container list-container--headline ${t.length?"":"hidden"}"><div class="items-list rooms-list headline-list">${t.map((t=>function(e,t){const s=kw("Click to open this server message");return Ag`<div class="list-item controlbox-padded d-flex flex-row" data-headline-jid="${t.get("jid")}"><a class="list-item-link open-headline available-room w-100" data-headline-jid="${t.get("jid")}" title="${s}" @click="${t=>e.openHeadline(t)}" href="#">${t.get("jid")}</a></div>`}(e,t)))}</div></div>`},{HEADLINES_TYPE:eM}=yw;class tM extends Nw{initialize(){this.model=Iu.state.chatboxes,this.listenTo(this.model,"add",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"remove",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"destroy",(e=>this.renderIfHeadline(e))),this.requestUpdate()}render(){return ZI(this)}renderIfHeadline(e){return e?.get("type")===eM&&this.requestUpdate()}async openHeadline(e){e.preventDefault();const t=e.target.getAttribute("data-headline-jid");(await Oh.headlines.get(t)).maybeShow(!0)}}Oh.elements.define("converse-headlines-feeds-list",tM);var sM=s(3363),nM={};nM.styleTagTransform=T(),nM.setAttributes=E(),nM.insert=S().bind(null,"head"),nM.domAPI=w(),nM.insertStyleElement=C();b()(sM.A,nM);sM.A&&sM.A.locals&&sM.A.locals;var iM=s(6524),rM={};rM.styleTagTransform=T(),rM.setAttributes=E(),rM.insert=S().bind(null,"head"),rM.domAPI=w(),rM.insertStyleElement=C();b()(iM.A,rM);iM.A&&iM.A.locals&&iM.A.locals;qg.plugins.add("converse-headlines-view",{dependencies:["converse-headlines","converse-chatview"],initialize(){const e={HeadlinesFeedsList:tM,HeadlinesPanel:tM};Object.assign(Iu,e),Object.assign(Iu.exports,e)}});var oM=s(304),aM={};aM.styleTagTransform=T(),aM.setAttributes=E(),aM.insert=S().bind(null,"head"),aM.domAPI=w(),aM.insertStyleElement=C();b()(oM.A,aM);oM.A&&oM.A.locals&&oM.A.locals;Oh.elements.define("converse-mam-placeholder",class extends Nw{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}render(){return(e=this).model.get("fetching")?Zk({classes:"hor_centered"}):Lf`<a @click="${t=>e.fetchMissingMessages(t)}" title="${kw("Click to load missing messages")}"><div class="message mam-placeholder"></div></a>`;var e}async fetchMissingMessages(e){e?.preventDefault?.(),this.model.set("fetching",!0);const t={before:this.model.get("before"),start:this.model.get("start")};await Sm.mam.fetchArchivedMessages(this.model.collection.chatbox,t),this.model.destroy()}});const{CHATROOMS_TYPE:cM}=yw;function lM(e,t){return e instanceof ab?Lf`<converse-mam-placeholder .model="${e}"></converse-mam-placeholder>`:t}async function dM(e){if(!e.model.ui.get("chat-content-spinner-top")&&e.model.messages.length){const t=e.model.get("type")===cM,s=e.model.getOldestMessage();if(s){const n=Iu.session.get("bare_jid"),i=t?e.model.get("jid"):n,r=s.get(`stanza_id ${i}`);e.model.ui.set("chat-content-spinner-top",!0);try{r?await Sm.mam.fetchArchivedMessages(e.model,{before:r}):await Sm.mam.fetchArchivedMessages(e.model,{end:s.get("time")})}catch(t){return bt.error(t),void e.model.ui.set("chat-content-spinner-top",!1)}Oh.settings.get("allow_url_history_change")&&history.pushState(null,"",`#${s.get("msgid")}`),setTimeout((()=>e.model.ui.set("chat-content-spinner-top",!1)),250)}}}qg.plugins.add("converse-mam-views",{dependencies:["converse-mam","converse-chatview","converse-muc-views"],initialize(){Oh.listen.on("chatBoxScrolledUp",dM),Oh.listen.on("getMessageTemplate",lM)}});const{Strophe:uM,sizzle:hM}=qg.env;Oh.elements.define("converse-muc-affiliation-form",class extends Nw{static get properties(){return{muc:{type:Object},jid:{type:String},affiliation:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}constructor(){super(),this.jid=null,this.muc=null}render(){return(e=>{const t=kw("Change affiliation"),s=kw("New affiliation"),n=kw("Reason"),i=e.muc.getOwnOccupant().getAssignableAffiliations();return Ag`<form class="affiliation-form" @submit="${t=>e.assignAffiliation(t)}">${e.alert_message?Ag`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""}<div><div class="row"><div class="col"><label class="form-label"><strong>${s}:</strong></label> <select class="form-select select-affiliation" name="affiliation">${i.map((t=>Ag`<option value="${t}" ?selected="${t===e.affiliation}">${t}</option>`))}</select></div><div class="col"><label class="form-label"><strong>${n}:</strong></label> <input class="form-control" type="text" name="reason"></div></div></div><div><div class="col"><input type="submit" class="btn btn-primary" name="change" value="${t}"></div></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}async assignAffiliation(e){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),s=t.get("affiliation"),n={jid:this.jid,reason:t.get("reason")},i=this.muc.get("jid");try{await Sm.muc.setAffiliation(s,i,[n])}catch(e){return null===e?this.alert(kw("Timeout error while trying to set the affiliation"),"danger"):hM(`not-allowed[xmlns="${uM.NS.STANZAS}"]`,e).length?this.alert(kw("Sorry, you're not allowed to make that change"),"danger"):this.alert(kw("Sorry, something went wrong while trying to set the affiliation"),"danger"),void bt.error(e)}await this.muc.occupants.fetchMembers();const r=new CustomEvent("affiliationChanged",{bubbles:!0});this.dispatchEvent(r)}});const{Strophe:mM,sizzle:fM}=qg.env;Oh.elements.define("converse-muc-role-form",class extends Nw{static get properties(){return{muc:{type:Object},jid:{type:String},role:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}constructor(){super(),this.muc=null}render(){return(e=>{const t=kw("Change role"),s=kw("New Role"),n=kw("Reason"),i=e.muc.getOwnOccupant().getAssignableRoles();return Ag`<form class="role-form" @submit="${e.assignRole}"><div><input type="hidden" name="jid" value="${e.jid}"> <input type="hidden" name="nick" value="${e.nick}"><div class="row"><div class="col"><label class="form-label"><strong>${s}:</strong></label> <select class="form-select select-role" name="role">${i.map((t=>Ag`<option value="${t}" ?selected="${t===e.role}">${t}</option>`))}</select></div><div class="col"><label class="form-label"><strong>${n}:</strong></label> <input class="form-control" type="text" name="reason"></div></div></div><div><div class="col"><input type="submit" class="btn btn-primary" value="${t}"></div></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}assignRole(e){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),s=this.muc.getOccupant(t.get("jid")||t.get("nick")),n=t.get("role"),i=t.get("reason");this.muc.setRole(s,n,i,(()=>{const e=new CustomEvent("roleChanged",{bubbles:!0});this.dispatchEvent(e)}),(e=>{fM(`not-allowed[xmlns="${mM.NS.STANZAS}"]`,e).length?this.alert(kw("You're not allowed to make that change"),"danger"):(this.alert(kw("Sorry, something went wrong while trying to set the role"),"danger"),Sm.isErrorObject(e)&&bt.error(e))}))}});Oh.elements.define("converse-muc-message-form",class extends WO{async initialize(){super.initialize(),await this.model.initialized,this.initMentionAutoComplete()}render(){return(e=>{const t=e.model.get("composing_spoiler"),s=kw(t?"Hidden message":"Message"),n=kw("Optional hint"),i=Oh.settings.get("message_limit"),r=Oh.settings.get("visible_toolbar_buttons").call,o=Oh.settings.get("visible_toolbar_buttons").emoji,a=Oh.settings.get("show_send_button"),c=Oh.settings.get("visible_toolbar_buttons").spoiler,l=Oh.settings.get("show_toolbar"),d=e.querySelector(".spoiler-hint")?.value,u=e.querySelector(".chat-textarea")?.value;return Ag`<form class="setNicknameButtonForm hidden"><input type="submit" class="btn btn-primary" name="join" value="Join"></form><form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?Ag`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?hidden_occupants="${e.model.get("hidden_occupants")}" ?is_groupchat="${"groupchat"===e.model.get("message_type")}" ?show_call_button="${r}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" placeholder="${n||""}" value="${d||""}" class="${t?"":"hidden"} spoiler-hint"><div class="suggestion-box"><ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul><textarea autofocus type="text" @drop="${t=>e.onDrop(t)}" @input="${qO}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>e.model.set({draft:t.target.value})}" class="chat-textarea suggestion-box__input ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${s}">${u||""}</textarea> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div></form>`})(this)}shouldAutoComplete(){return this.model.session.get("connection_status")===qg.ROOMSTATUS.ENTERED&&!(this.model.features.get("moderated")&&"visitor"===this.model.getOwnRole())}initMentionAutoComplete(){this.mention_auto_complete=new uk(this,{auto_first:!0,auto_evaluate:!1,min_chars:Oh.settings.get("muc_mention_autocomplete_min_chars"),match_current_word:!0,list:()=>this.getAutoCompleteList(),filter:"contains"==Oh.settings.get("muc_mention_autocomplete_filter")?rk:ok,ac_triggers:["Tab","@"],include_triggers:[],item:(e,t)=>function(e,t,s){s=s.trim();const n=document.createElement("li");if(n.setAttribute("aria-selected","false"),Oh.settings.get("muc_mention_autocomplete_show_avatar")){const s=t.label.toLowerCase(),i=document.createElement("converse-avatar");i.model=e.occupants.findWhere((e=>e.getDisplayName()?.toLowerCase()?.startsWith(s)||e.get("nickname")?.toLowerCase()?.startsWith(s)||e.get("jid")?.toLowerCase()?.startsWith(s)?e:void 0)),i.setAttribute("name",i.model.getDisplayName()),i.setAttribute("height","22"),i.setAttribute("width","22"),i.setAttribute("class","avatar avatar-autocomplete"),n.appendChild(i)}const i=new RegExp("("+s+")","ig");return(s?t.split(i):[t]).forEach((e=>{if(s&&e.match(i)){const t=document.createElement("mark");t.textContent=e,n.appendChild(t)}else n.appendChild(document.createTextNode(e))})),n}(this.model,e,t)}),this.mention_auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}getAutoCompleteList(){return this.model.getAllKnownNicknames().map((e=>({label:e,value:`@${e}`})))}onKeyDown(e){this.shouldAutoComplete()&&this.mention_auto_complete.onKeyDown(e)||super.onKeyDown(e)}onKeyUp(e){this.shouldAutoComplete()&&this.mention_auto_complete.evaluate(e),super.onKeyUp(e)}});var gM=s(4734),pM={};pM.styleTagTransform=T(),pM.setAttributes=E(),pM.insert=S().bind(null,"head"),pM.domAPI=w(),pM.insertStyleElement=C();b()(gM.A,pM);gM.A&&gM.A.locals&&gM.A.locals;class vM extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback();const{chatboxes:e}=Iu.state;this.model=e.get(this.jid)}render(){return(e=>{const t=kw("Nickname"),s=e.model?.isEntered()?kw("Change nickname"):kw("Enter groupchat"),n=Oh.settings.get("muc_show_logs_before_join")?kw("Choose a nickname to enter"):kw("Please choose your nickname"),i=e.model?.get("nickname_validation_message");return Ag`<div class="chatroom-form-container muc-nickname-form"><form class="converse-form chatroom-form converse-centered-form" @submit="${t=>e.submitNickname(t)}"><fieldset><label class="form-label">${n}</label><p class="validation-message">${i}</p><input type="text" required="required" name="nick" value="${e.model?.get("nick")||""}" class="form-control ${i?"error":""}" placeholder="${t}"></fieldset><fieldset><input type="submit" class="btn btn-primary" name="join" value="${s}"></fieldset></form></div>`})(this)}submitNickname(e){e.preventDefault();const t=e.target.nick.value.trim();t&&(this.model.isEntered()?(this.model.setNickname(t),this.closeModal()):this.model.join(t))}closeModal(){document.querySelector("converse-muc-nickname-modal").close()}}Oh.elements.define("converse-muc-nickname-form",vM);const _M=e=>{const t=kw("You have unread messages"),s=e.model.session.get("connection_status"),n=kw("You're not allowed to send messages in this room");return s===qg.ROOMSTATUS.ENTERED?Ag`${e.model.ui.get("scrolled")&&e.model.get("num_unread_general")?Ag`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""} ${e.can_post?(e=>{const t=kw("You have unread messages");return Ag`${e.model.ui.get("scrolled")&&e.model.get("num_unread")?Ag`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""}<converse-muc-message-form jid="${e.model.get("jid")}"></converse-muc-message-form>`})(e):Ag`<span class="muc-bottom-panel muc-bottom-panel--muted">${n}</span>`}`:s!=qg.ROOMSTATUS.NICKNAME_REQUIRED?"":Oh.settings.get("muc_show_logs_before_join")?Ag`<span class="muc-bottom-panel muc-bottom-panel--nickname"><converse-muc-nickname-form jid="${e.model.get("jid")}"></converse-muc-nickname-form></span>`:void 0};const bM=(e,t)=>{const s=kw("Log in using an account on another Peertube instance:"),n=kw("Your Peertube instance URL"),i=kw("OK"),r=Oh.settings.get("livechat_external_auth_oidc_buttons"),o=[];if(Array.isArray(r)&&r.length){const e=r.filter((e=>"custom"===e.type)).sort(((e,t)=>e.buttonLabel>t.buttonLabel?1:e.buttonLabel<t.buttonLabel?-1:0)),t=r.filter((e=>"custom"!==e.type)).sort(((e,t)=>e.buttonLabel>t.buttonLabel?1:e.buttonLabel<t.buttonLabel?-1:0));for(const s of[e,t]){if(!s.length)continue;const e=[];for(const t of s){if("object"!=typeof t)continue;const s=t.type,n=t.buttonLabel,i=t.url;s&&s&&i&&e.push({label:n,url:i,class:"livechat-external-login-modal-external-auth-oidc-type-"+s})}o.push(e)}}return Ag`<div class="modal-body livechat-external-login-modal">${o.length&&window.sessionStorage?Ag`<div class="livechat-external-login-modal-external-auth-oidc">${o.map((t=>Ag`<div class="livechat-external-login-modal-external-auth-oidc-block">${t.map((t=>Ag`<button type="button" class="btn btn-primary ${t.class}" @click="${s=>{!function(e,t,s){e.preventDefault(),t.clearAlert();const n=window.open(s,"livechat-external-auth","popup");window.externalAuthGetResult=e=>{if(window.externalAuthGetResult=void 0,e)if(console.log("Received an external authentication result...",e),e.ok)if(console.info("Got external account information",e),window.sessionStorage.setItem("peertube-plugin-livechat-external-auth-oidc-token",e.token),"button-close-open"===Oh.settings.get("livechat_external_auth_reconnect_mode"))try{document.getElementsByClassName("livechat-external-login-modal")[0].closest(".modal-dialog").querySelector("button.close").click(),Iu.api.listen.once("disconnected",(()=>{document.getElementsByClassName("peertube-plugin-livechat-button-open")[0].click()})),document.getElementsByClassName("peertube-plugin-livechat-button-close")[0].click()}catch(e){console.error(e),window.location.reload()}else window.location.reload();else t.external_auth_oidc_alert_message=kw("Authentication failed")+(e.message?` (${e.message})`:"");else n&&n.close()}}(s,e,t.url)}}">${t.label}</button>`))}</div>`))} ${t.external_auth_oidc_alert_message?Ag`<div class="invalid-feedback d-block">${t.external_auth_oidc_alert_message}</div>`:""}</div><hr>`:""}<form class="converse-form chatroom-form" @submit="${t=>e.openRemotePeertube(t)}"><label>${s} <input type="url" placeholder="${n}" class="form-control ${t.remote_peertube_alert_message?"is-invalid":""}" name="peertube_url" @keyup="${e.onRemotePeertubeKeyUp}" ?disabled="${"loading"===t.remote_peertube_state}"></label> <input type="submit" class="btn btn-primary" value="${i}" ?disabled="${"loading"===t.remote_peertube_state}"> ${"loading"!==t.remote_peertube_state?"":Ag`<small class="form-text text-muted">${kw("Searching the video on the Peertube instance...")}</small>`} ${t.remote_peertube_alert_message?Ag`<div class="invalid-feedback d-block">${t.remote_peertube_alert_message} ${t.remote_peertube_open_failed_url?Ag`<a href="${t.remote_peertube_open_failed_url}" target="_top">${t.remote_peertube_open_failed_url}</a>`:""}</div>`:""} ${t.remote_peertube_try_anyway_url?Ag`<div>${kw("In some cases, the video can still be retrieved if you connect to the remote instance.")} <button type="button" class="btn btn-primary" @click="${()=>e.openUrlTargetTop(t.remote_peertube_try_anyway_url)}">${kw("Try anyway to open the video on the Peertube instance")}</button></div>`:""}</form></div>`};Oh.elements.define("converse-livechat-external-login-content",class extends Nw{static get properties(){return{external_auth_oidc_alert_message:{type:String,attribute:!1},remote_peertube_state:{type:String,attribute:!1},remote_peertube_alert_message:{type:String,attribute:!1},remote_peertube_try_anyway_url:{type:String,attribute:!1},remote_peertube_open_failed_url:{type:String,attribute:!1}}}constructor(){super(),this.remote_peertube_state="init"}render(){return bM(this,{external_auth_oidc_alert_message:this.external_auth_oidc_alert_message,remote_peertube_state:this.remote_peertube_state,remote_peertube_alert_message:this.remote_peertube_alert_message,remote_peertube_try_anyway_url:this.remote_peertube_try_anyway_url,remote_peertube_open_failed_url:this.remote_peertube_open_failed_url})}onRemotePeertubeKeyUp(e){"init"!==this.remote_peertube_state&&(this.remote_peertube_state="init",this.remote_peertube_alert_message="",this.clearAlert())}async openRemotePeertube(e){e.preventDefault(),this.clearAlert();const t=e.target.peertube_url.value.trim();if(t){this.remote_peertube_state="loading";try{const e=new URL("/api/v1/config",t),s=await(await fetch(e.toString())).json();if(!s||"object"!=typeof s)throw new Error("Invalid config API result");if(!("plugin"in s)||!("registered"in s.plugin)||!Array.isArray(s.plugin.registered))throw new Error("No registered plugin in config API result");if(!s.plugin.registered.find((e=>"peertube-plugin-livechat"===e.npmName)))return console.error("Plugin livechat not available on remote instance"),this.remote_peertube_state="error",void(this.remote_peertube_alert_message=kw("The livechat plugin is not installed on this Peertube instance."));const n=Oh.settings.get("livechat_peertube_video_original_url"),i=Oh.settings.get("livechat_peertube_video_uuid");for(const e of[n,i])if(e)for(const s of["local","search-index"]){const n=new URL("/api/v1/search/videos",t);n.searchParams.append("start","0"),n.searchParams.append("count",1),n.searchParams.append("search",e),n.searchParams.append("searchTarget",s);const i=null;if(i&&Array.isArray(i.data)&&i.data.length>0&&i.data[0].uuid){console.log("Video found, opening on remote instance"),this.remote_peertube_state="ok";const e=new URL("/videos/watch/"+encodeURIComponent(i.data[0].uuid),t).toString();return void this.openUrlTargetTop(e)}}console.error("Video not found on remote instance"),this.remote_peertube_state="error",this.remote_peertube_alert_message=kw("This video is not available on this Peertube instance."),this.remote_peertube_try_anyway_url=new URL("/search/lazy-load-video;url="+encodeURIComponent(n),t).toString()}catch(e){console.error(e),this.remote_peertube_state="error",this.remote_peertube_alert_message=kw("Invalid Peertube URL.")}}}openUrlTargetTop(e){try{window.open(e,"_top")}catch(t){console.log(t),this.remote_peertube_state="error",this.remote_peertube_alert_message=kw("Your browser has blocked the opening on the remote instance, please try to open manually this link:"),this.remote_peertube_open_failed_url=e,this.remote_peertube_try_anyway_url=""}}clearAlert(){this.external_auth_oidc_alert_message="",this.remote_peertube_alert_message="",this.remote_peertube_try_anyway_url="",this.remote_peertube_open_failed_url=""}});Oh.elements.define("converse-livechat-external-login",class extends JC{remotePeertubeError="";renderModal(){return Ag`<converse-livechat-external-login-content></converse-livechat-external-login-content>`}getModalTitle(){return kw("Log in using an external account")}close(){super.close();try{window.externalAuthGetResult&&window.externalAuthGetResult()}catch(e){console.error(e)}}});Oh.elements.define("livechat-slow-mode",class extends Nw{static get properties(){return{jid:{type:String}}}hideInfoBox=!1;async connectedCallback(){super.connectedCallback(),this.model=Iu.chatboxes.get(this.jid),await this.model.initialized;let e=this.model.config.get("slow_mode_duration");this.listenTo(this.model.config,"change:slow_mode_duration",(()=>{if(this.hideInfoBox){const t=this.model.config.get("slow_mode_duration");t!==e&&(e=t,this.hideInfoBox=!1)}this.requestUpdate()}))}render(){return parseInt(this.model.config.get("slow_mode_duration"))>0?this.hideInfoBox?Ag``:Ag`<div class="livechat-slow-mode-info-box"><converse-icon class="fa fa-info-circle" size="1.2em"></converse-icon>${kw("Slow mode is enabled, users can send a message every %1$s seconds.",this.model.config.get("slow_mode_duration"))} <i class="livechat-hide-slow-mode-info-box" @click="${this.closeSlowModeInfoBox}" title="${kw("Close")}"><converse-icon class="fa fa-times" size="1em"></converse-icon></i></div>`:Ag``}closeSlowModeInfoBox(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.hideInfoBox=!0,this.requestUpdate()}});const yM=e=>{if(!Oh.settings.get("livechat_enable_viewer_mode"))return Ag``;const t=e.model,s=kw("Nickname"),n=kw("Enter groupchat"),i=kw("Choose a nickname to enter"),r=kw("Log in using an external account");return Ag`<div class="livechat-viewer-mode-content chatroom-form-container"><form class="converse-form chatroom-form" @submit="${e=>async function(e,t){e.preventDefault();const s=e.target.nick.value.trim();s&&(await t.setNickname(s),Iu.api.trigger("livechatViewerModeSetNickname",t,s,{synchronous:!0}))}(e,t)}"><label>${i}</label><fieldset><input type="text" required name="nick" class="form-control" placeholder="${s}"></fieldset><fieldset><input type="submit" class="btn btn-primary" name="join" value="${n}"></fieldset></form>${Oh.settings.get("livechat_peertube_video_original_url")?Ag`<hr><div class="livechat-viewer-mode-external-login"><button type="button" class="btn btn-primary" @click="${e=>{e.preventDefault(),Oh.modal.show("converse-livechat-external-login")}}">${r}</button></div>`:""}</div>`},wM=e=>{let t;return!e.can_post&&e.model.features?.get?.("x_peertubelivechat_mute_anonymous")&&!0===Iu.api.settings.get("livechat_specific_is_anonymous")&&(t=kw("Only registered users can send messages.")),Ag`${yM(e)} ${(e=>e.can_post?Ag`<livechat-slow-mode jid="${e.model.get("jid")}"></livechat-slow-mode>`:Ag``)(e)} ${(e=>e.can_post?e.model.features?.get?.("x_peertubelivechat_emoji_only_mode")?Ag`<div class="livechat-emoji-only-info-box"><converse-icon class="fa fa-info-circle" size="1.2em"></converse-icon>${kw("Emoji only mode is enabled, you can only use emoji in your messages.")}</div>`:"":Ag``)(e)} ${t?Ag`<span class="muc-bottom-panel muc-bottom-panel--muted">${t}</span>`:_M(e)}`};var AM=s(6215),SM={};SM.styleTagTransform=T(),SM.setAttributes=E(),SM.insert=S().bind(null,"head"),SM.domAPI=w(),SM.insertStyleElement=C();b()(AM.A,SM);AM.A&&AM.A.locals&&AM.A.locals;Oh.elements.define("converse-muc-bottom-panel",class extends JO{async initialize(){await super.initialize(),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model,"change:num_unread_general",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",this.renderIfOwnOccupant),this.listenTo(this.model.occupants,"change:role",this.renderIfOwnOccupant),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate()))}render(){if(!this.model)return"";const e=this.model.isEntered(),t=this.model.canPostMessages();return wM({can_post:t,entered:e,model:this.model,is_groupchat:!0,viewUnreadMessages:e=>this.viewUnreadMessages(e)})}renderIfOwnOccupant(e){const t=Iu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}sendButtonClicked(e){if("sendMessage"===e.delegateTarget?.dataset.action){const t=this.querySelector("converse-muc-message-form");t?.onFormSubmitted(e)}}});var xM=s(1709),EM={};EM.styleTagTransform=T(),EM.setAttributes=E(),EM.insert=S().bind(null,"head"),EM.domAPI=w(),EM.insertStyleElement=C();b()(xM.A,EM);xM.A&&xM.A.locals&&xM.A.locals;Oh.elements.define("converse-list-filter",class extends Nw{constructor(){super(),this.items=null,this.model=null,this.template=null,this.promise=Promise.resolve()}static get properties(){return{items:{type:Array},model:{type:Object},promise:{type:Promise},template:{type:Object}}}initialize(){this.liveFilter=Lu((e=>this.model.save({text:e.target.value})),250),this.listenTo(this.items,"add",(()=>this.requestUpdate())),this.listenTo(this.items,"destroy",(()=>this.requestUpdate())),this.listenTo(this.items,"remove",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>{this.dispatchUpdateEvent(),this.requestUpdate()})),this.promise.then((()=>this.requestUpdate())),this.requestUpdate()}render(){return this.shouldBeVisible()?this.template(this):""}dispatchUpdateEvent(){this.dispatchEvent(new CustomEvent("update",{detail:this.model.changed}))}changeChatStateFilter(e){e&&e.preventDefault();const t=this.querySelector(".state-type").value;this.model.save({state:t})}changeTypeFilter(e){e&&e.preventDefault();const t=e.target,s=t.closest("converse-icon")?.dataset.type||"items";if("state"===s){const e=this.querySelector(".state-type").value;this.model.save({type:s,state:e})}else{const e=this.querySelector(".items-filter").value;this.model.save({type:s,text:e})}}submitFilter(e){e?.preventDefault(),this.liveFilter()}isActive(){return"state"===this.model.get("type")||this.model.get("text")}shouldBeVisible(){return this.items?.length>=5||this.isActive()}clearFilter(e){e&&e.preventDefault(),this.model.save({text:""})}});const $M={offline:"Offline",unavailable:"Unavailable",xa:"Extended Away",away:"Away",dnd:"Do not disturb",chat:"Chattty",online:"Online"};let CM;function kM(e){CM||function(){let e;CM={},CM.owner={label:kw("Owner"),classname:"badge-groupchat"},CM.admin={label:kw("Admin"),classname:"badge-info"},CM.member={label:kw("Member"),classname:"badge-info"},CM.moderator={label:kw("Moderator"),classname:"badge-info"},CM.visitor={label:kw("Visitor"),classname:"badge-secondary"};for(let t=1;t<5&&(!e||Object.values(e).find((e=>e>1)));t++){const s={};for(const n of Object.values(CM))(!e||(e[n.shortlabel]??0)>=2)&&(n.shortlabel=n.label.substr(0,t).toLocaleUpperCase(),s[n.shortlabel]??=0,s[n.shortlabel]++);e=s}}();const t=CM[e];return t?Ag`<span title="${t.label}" aria-label="${t.label}" class="badge ${t.classname??"badge-info"}">${t.shortlabel}</span>`:""}const TM=e=>{const t=e.get("role"),s=(e=>kw("Click to mention %1$s in your message.",e.get("nick")))(e),n=kw("This user is a moderator."),i=kw("This user can send messages in this groupchat."),r=kw("This user can NOT send messages in this groupchat."),o=e.get("jid")?`${e.get("jid")} `:"";return"moderator"===t?`${o}${n} ${s}`:"participant"===t?`${o}${i} ${s}`:"visitor"===t?`${o}${r} ${s}`:["visitor","participant","moderator"].includes(t)?void 0:`${o}${s}`};const jM=(e,t)=>{const s=e.get("affiliation"),n=$M[e.get("show")],i=e.get("role"),r=e.get("show");let o,a;return[o,a]="online"===r?["fa fa-circle","chat-status-online"]:"dnd"===r?["fa fa-minus-circle","chat-status-busy"]:"away"===r?["fa fa-circle","chat-status-away"]:["fa fa-circle","subdued-color"],Ag`<li class="occupant" id="${e.id}"><div class="row g-0"><div class="col-auto"><a class="show-msg-author-modal" @click="${t=>function(e,t){Oh.modal.show("converse-muc-occupant-modal",{model:t},e)}(t,e)}"><converse-avatar .model="${e}" class="avatar chat-msg__avatar" name="${e.getDisplayName()}" nonce="${e.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><converse-icon title="${n}" color="var(--${a})" style="margin-top:-.1em" size="0.82em" class="${o} chat-status chat-status--avatar"></converse-icon></a></div><div class="col occupant-nick-badge"><span class="occupant-nick" title="${TM(e)}" @click="${t.onOccupantClicked}" style="${mO(e)}">${e.getDisplayName()}</span> <span class="occupant-badges">${"owner"===s?kM("owner"):""} ${"admin"===s?kM("admin"):""} ${"member"===s?kM("member"):""} ${"moderator"===i?kM("moderator"):""} ${"visitor"===i?kM("visitor"):""} </span>${yT(async function(e){const t=await Oh.hook("getOccupantActionButtons",e,[]);if(!t?.length)return"";const s=t.map((e=>Ag`<button class="dropdown-item ${e.button_class}" @click="${e.handler}" type="button"><converse-icon class="${e.icon_class}" color="var(--inverse-link-color)" size="1em" aria-hidden="true"></converse-icon> ${e.i18n_text}</button>`));return Ag`<converse-dropdown class="occupant-actions chatbox-btn" .items="${s}"></converse-dropdown>`}(e))}</div></div></li>`},NM=e=>{const t=kw("Filter"),s=kw("Filter by name"),n=kw("Filter by status"),i=kw("Any"),r=kw("Online"),o=kw("Chatty"),a=kw("Busy"),c=kw("Away"),l=kw("Extended Away"),d=kw("Offline"),u=e.model.get("state"),h=e.model.get("text"),m=e.model.get("type"),f="overlayed"===Oh.settings.get("view_mode");return Ag`<form class="items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="${f?"":"flex-nowrap"}"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===m?"selected":""}" data-type="items" title="${s}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===m?"selected":""}" data-type="state" title="${n}"></converse-icon></div><div class="btn-group"><input .value="${h||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===m?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${h&&"state"!==m?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==m?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${i}</option><option ?selected="${"online"===u}" value="online">${r}</option><option ?selected="${"chat"===u}" value="chat">${o}</option><option ?selected="${"dnd"===u}" value="dnd">${a}</option><option ?selected="${"away"===u}" value="away">${c}</option><option ?selected="${"xa"===u}" value="xa">${l}</option><option ?selected="${"offline"===u}" value="offline">${d}</option></select></div></form>`};const OM=(e,t)=>{const s=1===e.model.occupants?kw("Participant"):kw("Participants"),n=kw("Hide"),i=kw("Show filter"),r=kw("Hide filter"),o=e.model.get("filter_visible"),a=kw("Invite someone"),c=kw("Invite someone to join this groupchat"),l=[];return e.model.invitesAllowed()&&l.push(Ag`<a href="#" class="dropdown-item open-invite-modal" role="button" title="${c}" @click="${t=>e.showInviteModal(t)}"><converse-icon size="1em" class="fa fa-user-plus"></converse-icon>${a}</a>`),e.model.occupants.length>5&&l.push(Ag`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${o?r:i}</a>`),l.length?l.push(Ag`<a href="#" class="dropdown-item" role="button" @click="${t=>e.closeSidebar(t)}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${n}</a>`):l.push(Ag`<i class="hide-occupants" @click="${t=>e.closeSidebar(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></i>`),Ag`<div class="dragresize-occupants-left"> </div><div class="occupants"><div class="occupants-header"><div class="occupants-header--title"><span class="occupants-heading">${e.model.occupants.length} ${s}</span> ${1===l.length?l[0]:Ag`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${l}"></converse-dropdown>`}</div></div><ul class="occupant-list">${o?Ag`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${e.model.initialized}" .items="${e.model.occupants}" .template="${NM}" .model="${e.filter}"></converse-list-filter>`:""} ${hj(e.model.occupants.models,(e=>e.get("jid")),(s=>function(e,t,s){return function(e,t){if(!e.model.get("filter_visible"))return!1;const s=e.filter.get("type"),n="state"===s?e.filter.get("state").toLowerCase():e.filter.get("text").toLowerCase();if(!n)return!1;if("state"===s){const e=t.get("show");return"online"===n?["offline","unavailable"].includes(e):!e.includes(n)}return"items"===s?!t.getDisplayName().toLowerCase().includes(n):void 0}(e,t)?"":jM(t,s)}(e,s,t)))}</ul></div>`},IM=qg.env.utils;Oh.elements.define("converse-muc-invite-modal",class extends JC{constructor(e){super(e),this.id="converse-muc-invite-modal",this.muc=e.muc}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render()))}renderModal(){return(e=>{const t=kw("Invite"),s=kw("user@example.org"),n=kw("Please enter a valid XMPP address"),i=kw("XMPP Address"),r=kw("Optional reason for the invitation");return Ag`<form class="converse-form" @submit="${t=>e.submitInviteForm(t)}"><fieldset><label class="form-label clearfix" for="invitee_jids">${i}:</label> ${e.model.get("invalid_invite_jid")?Ag`<div class="error error-feedback">${n}</div>`:""}<converse-autocomplete .getAutoCompleteList="${()=>e.getAutoCompleteList()}" ?autofocus="${!0}" min_chars="1" position="below" required="required" name="invitee_jids" id="invitee_jids" placeholder="${s}"></converse-autocomplete></fieldset><fieldset><label class="form-label">${r}:</label> <textarea class="form-control" name="reason"></textarea></fieldset><fieldset><input type="submit" class="btn btn-primary" value="${t}"></fieldset></form>`})(this)}getModalTitle(){return kw("Invite someone to this groupchat")}getAutoCompleteList(){return Iu.state.roster.map((e=>({label:e.getDisplayName(),value:e.get("jid")})))}submitInviteForm(e){e.preventDefault();const t=new FormData(e.target),s=t.get("invitee_jids")?.trim(),n=t.get("reason");IM.isValidJID(s)?(this.muc.directInvite(s,n),this.modal.hide()):this.model.set({invalid_invite_jid:!0})}});var MM=s(8945),RM={};RM.styleTagTransform=T(),RM.setAttributes=E(),RM.insert=S().bind(null,"head"),RM.domAPI=w(),RM.insertStyleElement=C();b()(MM.A,RM);MM.A&&MM.A.locals&&MM.A.locals;var DM=s(33),LM={};LM.styleTagTransform=T(),LM.setAttributes=E(),LM.insert=S().bind(null,"head"),LM.domAPI=w(),LM.insertStyleElement=C();b()(DM.A,LM);DM.A&&DM.A.locals&&DM.A.locals;const{initStorage:zM}=Sm;Oh.elements.define("converse-muc-sidebar",class extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const e=`_converse.occupants-filter-${this.jid}`;this.filter=new Vb,this.filter.id=e,zM(this.filter,e),this.filter.fetch();const{chatboxes:t}=Iu.state;this.model=t.get(this.jid);const s=Lu((()=>this.requestUpdate()),200,{maxWait:1e3});this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",s),this.listenTo(this.model.occupants,"remove",s),this.listenTo(this.model.occupants,"change",s),this.listenTo(this.model.occupants,"sort",s),this.listenTo(this.model.occupants,"vcard:change",s),this.listenTo(this.model.occupants,"vcard:add",s),this.listenTo(this.model.features,"change:open",(()=>this.requestUpdate())),this.model.initialized.then((()=>this.requestUpdate()))}render(){return OM(this,Object.assign(this.model.toJSON(),{occupants:[...this.model.occupants.models],onOccupantClicked:e=>this.onOccupantClicked(e)}))}showInviteModal(e){e.preventDefault(),Oh.modal.show("converse-muc-invite-modal",{model:new cd,muc:this.model},e)}toggleFilter(e){e?.preventDefault?.(),Sm.safeSave(this.model,{filter_visible:!this.model.get("filter_visible")})}closeSidebar(e){e?.preventDefault?.(),Sm.safeSave(this.model,{hidden_occupants:!0})}onOccupantClicked(e){e?.preventDefault?.();const{chatboxviews:t}=Iu.state,s=t.get(this.getAttribute("jid")),n=e.target;s?.getMessageForm().insertIntoTextArea(`@${n.textContent}`)}});const{CHATROOMS_TYPE:PM}=yw,FM=e=>Ag`${e?.model&&Oh.settings.get("livechat_task_app_enabled")?Ag`<livechat-converse-muc-task-app .model="${e.model}"></livechat-converse-muc-task-app>`:""} ${e?.model&&Oh.settings.get("livechat_note_app_enabled")?Ag`<livechat-converse-muc-note-app .model="${e.model}"></livechat-converse-muc-note-app>`:""} ${e?.model&&Oh.settings.get("livechat_mam_search_app_enabled")?Ag`<livechat-converse-muc-mam-search-app .model="${e.model}"></livechat-converse-muc-mam-search-app>`:""} ${(e=>{const t=Oh.settings.get("show_send_button");let s,n;return"overlayed"===Oh.settings.get("view_mode")?(s="d-none d-md-flex col-s-10 col-md-8",n="col-xs-12 col-s-2 col-md-4"):(s="d-none d-md-flex col-md-8 col-xl-10",n="col-xs-12 col-md-4 col-xl-2"),Ag`<div class="chat-area ${e.shouldShowSidebar()?s:"col-xs-12"}"><div class="chat-content ${t?"chat-content-sendbutton":""}" aria-live="polite"><converse-chat-content class="chat-content__messages" jid="${e.jid}"></converse-chat-content>${e.model?.get("show_help_messages")?Ag`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${e.getHelpMessages()}" type="info" chat_type="${PM}"></converse-chat-help></div>`:""}</div><converse-muc-bottom-panel jid="${e.jid}" class="bottom-panel"></converse-muc-bottom-panel></div>${e.model?Ag`<converse-muc-sidebar class="${e.shouldShowSidebar()?n:"col-xs-0 hidden"}" jid="${e.jid}" @mousedown="${t=>e.onMousedown(t)}"></converse-muc-sidebar>`:""}`})(e)}`,{u:UM}=qg.env;Oh.elements.define("converse-muc-chatarea",class extends Nw{static get properties(){return{jid:{type:String},show_help_messages:{type:Boolean},type:{type:String}}}constructor(){super(),this.jid=null,this.type=null}async initialize(){this.model=await Oh.rooms.get(this.jid),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate())),this.onMouseMove=this._onMouseMove.bind(this),this.onMouseUp=this._onMouseUp.bind(this),this.requestUpdate()}render(){return this.model?FM(this):""}shouldShowSidebar(){return!this.model.get("hidden_occupants")&&this.model.session.get("connection_status")===qg.ROOMSTATUS.ENTERED}getHelpMessages(){const e=Oh.settings.get("muc_disable_slash_commands"),t=Array.isArray(e)?e:[];return[`<strong>/admin</strong>: ${kw("Change user's affiliation to admin")}`,`<strong>/ban</strong>: ${kw("Ban user by changing their affiliation to outcast")}`,`<strong>/clear</strong>: ${kw("Clear the chat area")}`,`<strong>/close</strong>: ${kw("Close this groupchat")}`,`<strong>/deop</strong>: ${kw("Change user role to participant")}`,`<strong>/destroy</strong>: ${kw("Remove this groupchat")}`,`<strong>/help</strong>: ${kw("Show this menu")}`,`<strong>/kick</strong>: ${kw("Kick user from groupchat")}`,`<strong>/me</strong>: ${kw("Write in 3rd person")}`,`<strong>/member</strong>: ${kw("Grant membership to a user")}`,`<strong>/modtools</strong>: ${kw("Opens up the moderator tools GUI")}`,`<strong>/mute</strong>: ${kw("Remove user's ability to post messages")}`,`<strong>/nick</strong>: ${kw("Change your nickname")}`,`<strong>/op</strong>: ${kw("Grant moderator role to user")}`,`<strong>/owner</strong>: ${kw("Grant ownership of this groupchat")}`,`<strong>/register</strong>: ${kw("Register your nickname")}`,`<strong>/revoke</strong>: ${kw("Revoke the user's current affiliation")}`,`<strong>/subject</strong>: ${kw("Set groupchat subject")}`,`<strong>/topic</strong>: ${kw("Set groupchat subject (alias for /subject)")}`,`<strong>/voice</strong>: ${kw("Allow muted user to post messages")}`].filter((e=>t.every((t=>!e.startsWith(t+"<",9))))).filter((e=>this.model.getAllowedCommands().some((t=>e.startsWith(t+"<",9)))))}onMousedown(e){UM.hasClass("dragresize-occupants-left",e.target)&&this.onStartResizeOccupants(e)}onStartResizeOccupants(e){this.resizing=!0,this.addEventListener("mousemove",this.onMouseMove),this.addEventListener("mouseup",this.onMouseUp);const t=this.querySelector("converse-muc-sidebar"),s=window.getComputedStyle(t);this.width=parseInt(s.width.replace(/px$/,""),10),this.prev_pageX=e.pageX}_onMouseMove(e){if(this.resizing){e.preventDefault();const t=this.prev_pageX-e.pageX;this.resizeSidebarView(t,e.pageX),this.prev_pageX=e.pageX}}_onMouseUp(e){if(this.resizing){e.preventDefault(),this.resizing=!1,this.removeEventListener("mousemove",this.onMouseMove),this.removeEventListener("mouseup",this.onMouseUp);const t=this.querySelector("converse-muc-sidebar").getBoundingClientRect(),s=this.calculateSidebarWidth(t,0);UM.safeSave(this.model,{occupants_width:s})}}calculateSidebarWidth(e,t){let s=e.width+t;const n=this.clientWidth;return s<.2*n?(s=.2*n,this.is_minimum=!0):s>.75*n?(s=.75*n,this.is_maximum=!0):n-s<250?(s=n-250,this.is_maximum=!0):(this.is_maximum=!1,this.is_minimum=!1),s}resizeSidebarView(e,t){const s=this.querySelector("converse-muc-sidebar"),n=s.getBoundingClientRect();if(this.is_minimum)this.is_minimum=n.left<t;else if(this.is_maximum)this.is_maximum=n.left>t;else{const t=this.calculateSidebarWidth(n,e);s.style.flex="0 0 "+t+"px"}}});const BM=e=>{const t=kw("This groupchat no longer exists"),s=kw('The following reason was given: "%1$s"',e.reason||"");return Ag`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${t}</h3></div>${e.reason?Ag`<p class="destroyed-reason">${s}</p>`:""} ${e.moved_jid?(e=>{const t=kw("The conversation has moved to a new address. Click the link below to enter.");return Ag`<p class="moved-label">${t}</p><p class="moved-link"><a class="switch-chat" @click="${t=>e.onSwitch(t)}">${e.moved_jid}</a></p>`})(e):""}`};Oh.elements.define("converse-muc-destroyed",class extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=Iu.state.chatboxes.get(this.jid)}render(){const e=this.model.get("destroyed_reason"),t=this.model.get("moved_jid");return BM({moved_jid:t,reason:e,onSwitch:e=>this.onSwitch(e)})}async onSwitch(e){e.preventDefault();const t=this.model.get("moved_jid");(await Oh.rooms.get(t,{},!0)).maybeShow(!0),this.model.destroy()}});Oh.elements.define("converse-muc-disconnected",class extends Nw{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=Iu.state.chatboxes.get(this.jid)}render(){const e=this.model.session.get("disconnection_message");if(!e)return;const t=[e],s=this.model.session.get("disconnection_actor");s&&t.push(kw("This action was done by %1$s.",s));const n=this.model.session.get("disconnection_reason");return n&&t.push(kw('The reason given is: "%1$s".',n)),(e=>Ag`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${e[0]}</h3>${e.slice(1).map((e=>Ag`<p class="disconnect-msg">${e}</p>`))}</div>`)(t)}});const qM=kw("Click to set a new picture");Oh.elements.define("converse-image-picker",class extends Nw{constructor(){super(),this.model=null,this.width=null,this.height=null,this.data=new cd,this.nonce=null}static get properties(){return{height:{type:Number},model:{type:Object},width:{type:Number}}}render(){return Ag`<a class="change-avatar" @click="${this.openFileSelection}" title="${qM}"><converse-avatar .model="${this.model}" .pickerdata="${this.data}" class="avatar" name="${this.model.getDisplayName()}" height="${this.height}" nonce="${this.nonce||this.model.vcard?.get("vcard_updated")}" width="${this.width}"></converse-avatar></a><input @change="${this.updateFilePreview}" class="hidden" name="avatar_image" type="file">`}openFileSelection(e){e.preventDefault(),this.querySelector('input[type="file"]').click()}updateFilePreview(e){const t=e.target.files[0],s=new FileReader;s.onloadend=()=>{this.data.set({data_uri:s.result,image_type:t.type}),this.nonce=(new Date).toISOString(),this.requestUpdate()},s.readAsDataURL(t)}});var HM=s(998),GM={};GM.styleTagTransform=T(),GM.setAttributes=E(),GM.insert=S().bind(null,"head"),GM.domAPI=w(),GM.insertStyleElement=C();b()(HM.A,GM);HM.A&&HM.A.locals&&HM.A.locals;const WM=qg.env.utils;var VM=s(4026),QM=s.n(VM);const JM="image/png";async function YM(e){if(e.type===JM){const t=new FileReader;return await new Promise((s=>{t.onloadend=e=>{const t=new DataView(e.target.result);if(2303741511===t.getUint32(0)&&218765834===t.getUint32(4)){const e=t.getUint8(25);s(e===4||e===6)}s(!1)},t.readAsArrayBuffer(e)}))}return!1}const{sizzle:XM}=qg.env,KM=qg.env.utils;Oh.elements.define("converse-muc-config-modal",class extends JC{constructor(e){super(e),this.id="converse-muc-config-modal"}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.listenTo(this.model.features,"change:passwordprotected",(()=>this.render())),this.listenTo(this.model.session,"change:config_stanza",(()=>this.render()))}renderModal(){return(e=>{const t=Oh.settings.get("roomconfig_whitelist");let s=[],n="",i=kw("Loading configuration form");const r=e.model.session.get("config_stanza");if(r){const o=WM.toStanza(r);let{fields:a}=fp(o);t.length&&(a=a.filter((e=>t.includes(e.var))));const c={new_password:!e.model.features.get("passwordprotected"),fixed_username:e.model.get("jid")};s=a.map((e=>WM.xFormField2TemplateResult(e,c))),n=o.querySelector("instructions")?.textContent,i=o.querySelector("title")?.textContent}const o=kw("Save");return Ag`<form class="converse-form chatroom-form ${s.length?"":"converse-form--spinner"}" autocomplete="off" @submit="${t=>e.submitConfigForm(t)}"><fieldset><legend class="centered">${i}</legend>${i!==n?Ag`<p class="form-help">${n}</p>`:""} ${s.length&&e.model.features.get("vcard-temp")?Ag`<div class="row py-2"><converse-image-picker .model="${e.model}" width="96" height="96"></converse-image-picker></div>`:""} ${s.length?s:Zk({classes:"hor_centered"})}</fieldset>${s.length?Ag`<fieldset><input type="submit" class="btn btn-primary" value="${o}"></fieldset>`:""}</form>`})(this)}connectedCallback(){super.connectedCallback(),this.getConfig()}getModalTitle(){return kw("Configure %1$s",this.model.getDisplayName())}async getConfig(){const e=await this.model.fetchRoomConfiguration();this.model.session.set("config_stanza",e.outerHTML)}async setAvatar(e){if(!this.model.features.get("vcard-temp"))return;const t=new FormData(e.target).get("avatar_image");if(t?.size){const e=YM?t:await async function(e,t={targetSize:.1,quality:.75,maxWidth:256,maxHeight:256}){const s=new(QM())(t),n=await s.compress([e]),{photo:i}=n[0];return i.data}(t),s=new FileReader;s.onloadend=async()=>{const e={image:btoa(s.result),image_type:t.type};await Oh.vcard.set(this.model.get("jid"),e)},s.readAsBinaryString(e)}}async submitConfigForm(e){e.preventDefault();const t=XM(':input:not([type=button]):not([type=submit]):not([name="avatar_image"][type="file"])',e.target).map(KM.webForm2xForm).filter((e=>e));try{await this.model.sendConfiguration(t)}catch(e){bt.error(e);const t=kw("Sorry, an error occurred while trying to submit the config form.")+" "+kw("Check your browser's developer console for details.");Oh.alert("error",kw("Error"),t)}try{await this.setAvatar(e)}catch(e){return bt.fatal(e),void this.alert([kw("Sorry, an error happened while trying to save the groupchat avatar."),kw("You can check your browser's developer console for any error output.")].join(" "))}await this.model.refreshDiscoInfo(),this.modal.hide()}});const ZM=e=>{const t=e.config.toJSON(),s=e.features.toJSON(),n=e.occupants.filter((e=>"offline"!==e.get("show"))).length,i=kw("XMPP address"),r=kw("Message archiving"),o=kw("Messages are archived on the server"),a=kw("Description"),c=kw("Features"),l=kw("Hidden"),d=kw("This groupchat is not publicly searchable"),u=kw("This groupchat is restricted to members only"),h=kw("Members only"),m=kw("Moderated"),f=kw("Participants entering this groupchat need to request permission to write"),g=kw("Name"),p=kw("This groupchat does not require a password upon entry"),v=kw("No password required"),_=kw("Not anonymous"),b=kw("All other groupchat participants can see your XMPP address"),y=kw("Not moderated"),w=kw("Participants entering this groupchat can write right away"),A=kw("Online users"),S=kw("Open"),x=kw("Anyone can join this groupchat"),E=kw("This groupchat requires a password before entry"),$=kw("Password protected"),C=kw("Persistent"),k=kw("This groupchat persists even if it's unoccupied"),T=kw("Public"),j=kw("This groupchat is publicly searchable"),N=kw("Semi-anonymous"),O=kw("Only moderators can see your XMPP address"),I=kw("Temporary"),M=kw("This groupchat will disappear once the last person leaves");return Ag`<div class="room-info"><converse-avatar .model="${e}" class="avatar align-self-center" name="${e.getDisplayName()}" nonce="${e.vcard?.get("vcard_updated")}" height="72" width="72"></converse-avatar><p class="room-info"><strong>${g}</strong>: ${e.get("name")}</p><p class="room-info"><strong>${i}</strong>:<converse-rich-text text="xmpp:${e.get("jid")}?join"></converse-rich-text></p><br><p class="room-info"><strong>${a}</strong>:<converse-rich-text text="${t.description}" render_styling></converse-rich-text></p>${e.get("subject")?(e=>{const t=e.get("subject"),s=kw("Topic"),n=kw("Topic author");return Ag`<p class="room-info"><strong>${s}</strong>:<converse-rich-text text="${t.text}" render_styling></converse-rich-text></p><p class="room-info"><strong>${n}</strong>: ${t&&t.author}</p>`})(e):""}<p class="room-info"><strong>${A}</strong>: ${n}</p><p class="room-info"><strong>${c}</strong>:</p><div class="chatroom-features"><ul class="features-list">${s.passwordprotected?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-lock"></converse-icon>${$} - <em>${E}</em></li>`:""} ${s.unsecured?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-unlock"></converse-icon>${v} - <em>${p}</em></li>`:""} ${s.hidden?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-eye-slash"></converse-icon>${l} - <em>${d}</em></li>`:""} ${s.public_room?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-eye"></converse-icon>${T} - <em>${j}</em></li>`:""} ${s.membersonly?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-address-book"></converse-icon>${h} - <em>${u}</em></li>`:""} ${s.open?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-globe"></converse-icon>${S} - <em>${x}</em></li>`:""} ${s.persistent?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-save"></converse-icon>${C} - <em>${k}</em></li>`:""} ${s.temporary?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-snowflake"></converse-icon>${I} - <em>${M}</em></li>`:""} ${s.nonanonymous?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-id-card"></converse-icon>${_} - <em>${b}</em></li>`:""} ${s.semianonymous?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-user-secret"></converse-icon>${N} - <em>${O}</em></li>`:""} ${s.moderated?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-gavel"></converse-icon>${m} - <em>${f}</em></li>`:""} ${s.unmoderated?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-info-circle"></converse-icon>${y} - <em>${w}</em></li>`:""} ${s.mam_enabled?Ag`<li class="feature"><converse-icon size="1em" class="fa fa-database"></converse-icon>${r} - <em>${o}</em></li>`:""}</ul></div><p></p></div>`};var eR=s(8011),tR={};tR.styleTagTransform=T(),tR.setAttributes=E(),tR.insert=S().bind(null,"head"),tR.domAPI=w(),tR.insertStyleElement=C();b()(eR.A,tR);eR.A&&eR.A.locals&&eR.A.locals;Oh.elements.define("converse-muc-details-modal",class extends JC{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.listenTo(this.model.features,"change",(()=>this.render())),this.listenTo(this.model.occupants,"add",(()=>this.render())),this.listenTo(this.model.occupants,"change",(()=>this.render()))}renderModal(){return ZM(this.model)}getModalTitle(){return kw("Groupchat info",this.model.getDisplayName())}});Oh.elements.define("converse-muc-nickname-modal",class extends JC{renderModal(){return Ag`<converse-muc-nickname-form jid="${this.model.get("jid")}"></converse-muc-nickname-form>`}getModalTitle(){return kw("Change your nickname")}});var sR=s(4926),nR={};nR.styleTagTransform=T(),nR.setAttributes=E(),nR.insert=S().bind(null,"head"),nR.domAPI=w(),nR.insertStyleElement=C();b()(sR.A,nR);sR.A&&sR.A.locals&&sR.A.locals;Oh.elements.define("converse-rich-text",class extends Nw{static get properties(){return{embed_audio:{type:Boolean},embed_videos:{type:Boolean},mentions:{type:Array},nick:{type:String},offset:{type:Number},onImgClick:{type:Function},onImgLoad:{type:Function},render_styling:{type:Boolean},show_images:{type:Boolean},hide_media_urls:{type:Boolean},show_me_message:{type:Boolean},text:{type:String}}}constructor(){super(),this.nick=null,this.onImgClick=null,this.onImgLoad=null,this.text=null,this.embed_audio=!1,this.embed_videos=!1,this.hide_media_urls=!1,this.mentions=[],this.offset=0,this.render_styling=!1,this.show_image_urls=!0,this.show_images=!1,this.show_me_message=!1}render(){const e={embed_audio:this.embed_audio,embed_videos:this.embed_videos,hide_media_urls:this.hide_media_urls,mentions:this.mentions,nick:this.nick,onImgClick:this.onImgClick,onImgLoad:this.onImgLoad,render_styling:this.render_styling,show_images:this.show_images,show_me_message:this.show_me_message};return kN(this.text,this.offset,e)}});const iR=e=>{if(!Oh.settings.get("livechat_mini_muc_head"))return Ag`${(e=>{const t=e.model.toJSON(),s=e.user_settings?.get("mucs_with_hidden_subject",[])?.includes(e.model.get("jid")),n=e.getHeadingButtons(s),i=kw("Hide the groupchat topic"),r=kw("This groupchat is bookmarked"),o=t.subject?t.subject.text:"",a=o&&!s;return Ag`<div class="chatbox-title ${a?"":"chatbox-title--no-desc"}"><a data-room-jid="${e.model.get("jid")}" title="${kw("Show more information on this groupchat")}" @click="${t=>e.showRoomDetailsModal(t)}"><converse-avatar .model="${e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a><div class="chatbox-title--row">${Iu.api.settings.get("singleton")?"":Ag`<converse-controlbox-navback jid="${t.jid}"></converse-controlbox-navback>`}<div class="chatbox-title__text" role="heading" aria-level="2" title="${"hidden"!==Oh.settings.get("locked_muc_domain")?t.jid:""}">${e.model.getDisplayName()} ${t.bookmarked?Ag`<converse-icon class="fa fa-bookmark chatbox-title__text--bookmarked" size="1em" color="var(--chatroom-head-color)" title="${r}"></converse-icon>`:""}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${yT(Vj(n),"")} ${yT(Qj(n),"")}</div></div>${a?Ag`<p class="chat-head__desc" title="${i}"><converse-rich-text text="${o}" render_styling></converse-rich-text></p>`:""}`})(e)}`;const t=e.getHeadingButtons(!0);return Ag`<div class="livechat-mini-muc-bar-buttons">${yT(Vj(t),"")} ${yT(Qj(t),"")} ${function(){const e=document.querySelector(".peertube-plugin-livechat-buttons.peertube-plugin-livechat-buttons-open");if(!e)return Ag``;e.classList.remove("peertube-plugin-livechat-buttons-cloned");const t=[];return e.childNodes.forEach((e=>{try{if(null===e.offsetParent)return;t.push(e)}catch(e){console.error(e)}})),t.length?(console.log("[peertube-plugin-livechat] Adding class peertube-plugin-livechat-buttons-cloned"),e.classList.add("peertube-plugin-livechat-buttons-cloned"),Ag`${hj(t,(e=>Ag`<a href="#" title="${e.getAttribute("title")??""}" class="${e.className}" @click="${()=>{e.click()}}">${SO(e.innerHTML)}</a>`))}`):Ag``}()}</div>`};var rR=s(8185),oR={};oR.styleTagTransform=T(),oR.setAttributes=E(),oR.insert=S().bind(null,"head"),oR.domAPI=w(),oR.insertStyleElement=C();b()(rR.A,oR);rR.A&&rR.A.locals&&rR.A.locals;Oh.elements.define("converse-muc-heading",class extends Nw{async initialize(){const{chatboxes:e}=Iu.state;this.model=e.get(this.getAttribute("jid")),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.user_settings=await Iu.api.user.settings.getModel(),this.listenTo(this.user_settings,"change:mucs_with_hidden_subject",(()=>this.requestUpdate())),await this.model.initialized,this.model.occupants.forEach((e=>this.onOccupantAdded(e))),this.listenTo(this.model.occupants,"add",this.onOccupantAdded),this.listenTo(this.model.occupants,"change:affiliation",this.onOccupantAffiliationChanged),this.requestUpdate()}render(){return this.model&&this.user_settings?iR(this):""}onOccupantAdded(e){const t=Iu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}onOccupantAffiliationChanged(e){const t=Iu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}showRoomDetailsModal(e){e.preventDefault(),Oh.modal.show("converse-muc-details-modal",{model:this.model},e)}toggleTopic(e){e?.preventDefault?.(),this.model.toggleSubjectHiddenState()}toggleOccupants(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.save({hidden_occupants:!this.model.get("hidden_occupants")})}showConfigModal(e){e.preventDefault(),Oh.modal.show("converse-muc-config-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}destroy(e){e.preventDefault(),UT(this.model)}getHeadingButtons(e){const t=[];t.push({i18n_text:kw("Details"),i18n_title:kw("Show more information about this groupchat"),handler:e=>this.showRoomDetailsModal(e),a_class:"show-muc-details-modal",icon_class:"fa-info-circle",name:"details"}),"owner"===this.model.getOwnAffiliation()&&t.push({i18n_text:kw("Configure"),i18n_title:kw("Configure this groupchat"),handler:e=>this.showConfigModal(e),a_class:"configure-chatroom-button",icon_class:"fa-wrench",name:"configure"}),t.push({i18n_text:kw("Nickname"),i18n_title:kw("Change the nickname you're using in this groupchat"),handler:e=>Oh.modal.show("converse-muc-nickname-modal",{model:this.model},e),a_class:"open-nickname-modal",icon_class:"fa-smile",name:"nickname"});const s=this.model.get("subject");s&&s.text&&t.push({i18n_text:kw(e?"Show topic":"Hide topic"),i18n_title:kw(e?"Show the topic message in the heading":"Hide the topic in the heading"),handler:e=>this.toggleTopic(e),a_class:"hide-topic",icon_class:"fa-minus-square",name:"toggle-topic"}),t.push({i18n_text:this.model.get("hidden_occupants")?kw("Show participants"):kw("Hide participants"),i18n_title:this.model.get("hidden_occupants")?kw("Show the groupchat participants"):kw("Hide the groupchat participants"),handler:e=>this.toggleOccupants(e),icon_class:"fa-users"});if(this.model.session.get("connection_status")===qg.ROOMSTATUS.ENTERED){const e=this.model.getAllowedCommands();e.includes("modtools")&&t.push({i18n_text:kw("Moderate"),i18n_title:kw("Moderate this groupchat"),handler:()=>WT(this.model),a_class:"moderate-chatroom-button",icon_class:"fa-user-cog",name:"moderate"}),e.includes("destroy")&&t.push({i18n_text:kw("Destroy"),i18n_title:kw("Remove this groupchat"),handler:e=>this.destroy(e),a_class:"destroy-chatroom-button",icon_class:"fa-trash",name:"destroy"})}Oh.settings.get("singleton")||t.push({i18n_text:kw("Leave"),i18n_title:kw("Leave and close this groupchat"),handler:async e=>{e.stopPropagation();const t=[kw("Are you sure you want to leave this groupchat?")];await Oh.confirm(kw("Confirm"),t)&&this.close(e)},a_class:"close-chatbox-button",standalone:"overlayed"===Oh.settings.get("view_mode"),icon_class:"fa-sign-out-alt",name:"signout"});const{chatboxviews:n}=Iu.state,i=n.get(this.getAttribute("jid"));return i?Iu.api.hook("getHeadingButtons",i,t):Promise.resolve(t)}});class aR extends Nw{static get properties(){return{jid:{type:String}}}constructor(){super(),this.jid=null}connectedCallback(){super.connectedCallback();const{chatboxes:e}=Iu.state;this.model=e.get(this.jid),this.listenTo(this.model,"change:password_validation_message",this.render),this.render()}render(){return(e=>{const t=kw("This groupchat requires a password"),s=kw("Password: "),n=kw("Submit");return Ag`<form class="converse-form chatroom-form converse-centered-form" @submit="${e.submitPassword}"><fieldset><label class="form-label">${t}</label><p class="validation-message">${e.validation_message}</p><input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.jid}"><input type="password" name="password" required="required" class="form-control ${e.validation_message?"error":""}" placeholder="${s}"></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${n}"></fieldset></form>`})({jid:this.model.get("jid"),submitPassword:e=>this.submitPassword(e),validation_message:this.model.get("password_validation_message")})}submitPassword(e){e.preventDefault();const t=this.querySelector("input[type=password]").value;this.model.join(this.model.get("nick"),t),this.model.set("password_validation_message",null)}}Oh.elements.define("converse-muc-password-form",aR);class cR extends KO{length=300;is_chatroom=!0;async initialize(){this.model=await Oh.rooms.get(this.jid),Iu.state.chatboxviews.add(this.jid,this),this.setAttribute("id",this.model.get("box_id")),this.listenTo(this.model.session,"change:connection_status",this.onConnectionStatusChanged),this.listenTo(this.model.session,"change:view",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),this.onConnectionStatusChanged(),this.model.maybeShow(),Oh.trigger("chatRoomViewInitialized",this)}render(){return(e=>Ag`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e.model?Ag`<converse-muc-heading jid="${e.model.get("jid")}" class="chat-head chat-head-chatroom row g-0"></converse-muc-heading><livechat-converse-muc-terms .model="${e.model}" termstype="global"></livechat-converse-muc-terms><livechat-converse-muc-terms .model="${e.model}" termstype="muc"></livechat-converse-muc-terms><livechat-converse-muc-poll .model="${e.model}"></livechat-converse-muc-poll><div class="chat-body chatroom-body row g-0">${BT(e)}</div>`:""}</div>`)({model:this.model})}onConnectionStatusChanged(){this.model.session.get("connection_status")===qg.ROOMSTATUS.CONNECTING&&(this.model.session.save({disconnection_actor:void 0,disconnection_message:void 0,disconnection_reason:void 0}),this.model.save({moved_jid:void 0,password_validation_message:void 0,reason:void 0})),this.requestUpdate()}}Oh.elements.define("converse-muc",cR);var lR=s(4659),dR={};dR.styleTagTransform=T(),dR.setAttributes=E(),dR.insert=S().bind(null,"head"),dR.domAPI=w(),dR.insertStyleElement=C();b()(lR.A,dR);lR.A&&lR.A.locals&&lR.A.locals;const{Strophe:uR}=qg.env,{CHATROOMS_TYPE:hR}=yw;qg.MUC.VIEWS={CONFIG:"config-form"},qg.plugins.add("converse-muc-views",{dependencies:["converse-modal","converse-controlbox","converse-chatview"],initialize(){const{_converse:e}=this;Oh.settings.extend({auto_list_rooms:!1,cache_muc_messages:!0,locked_muc_nickname:!1,modtools_disable_query:[],muc_disable_slash_commands:!1,muc_mention_autocomplete_filter:"contains",muc_mention_autocomplete_min_chars:0,muc_mention_autocomplete_show_avatar:!0,muc_roomid_policy:null,muc_roomid_policy_hint:null,muc_search_service:"api@search.jabber.network",roomconfig_whitelist:[],show_retraction_warning:!0});const t={ChatRoomView:cR,MUCView:cR};Object.assign(e,t),Object.assign(e.exports,t),Oh.settings.get("muc_domain")||Oh.listen.on("serviceDiscovered",(async e=>{if(e?.get("var")===uR.NS.MUC){if(e.entity.get("jid").includes("@"))return;await e.entity.getIdentity("conference","text")&&Oh.settings.set("muc_domain",uR.getDomainFromJid(e.get("from")))}})),Oh.listen.on("clearsession",(()=>{const t=e.chatboxviews.get("controlbox");t&&t.roomspanel&&(t.roomspanel.model.destroy(),t.roomspanel.remove(),delete t.roomspanel)})),Oh.listen.on("chatBoxClosed",(e=>{var t;e.get("type")===hR&&(t=e.get("jid"),location.hash===`converse/room?jid=${t}`&&history.pushState(null,"",window.location.pathname))})),Oh.listen.on("parseMessageForCommands",VT),Oh.listen.on("confirmDirectMUCInvitation",FT)}});const mR=()=>{const e=kw("Already have a chat account?"),t=kw("Log in here");return Ag`<div class="switch-form"><p>${e}</p><p><a class="login-here toggle-register-login" href="#converse/login">${t}</a></p></div>`},fR=e=>{const t=Oh.settings.get("registration_domain"),s=kw("Create your account"),n=kw("Please enter the XMPP provider to register with:"),i=!t&&e.status===gR;return Ag`<form id="converse-register" class="converse-form" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${s}</legend><div><label class="form-label">${n}</label> ${t||(()=>{const e=Oh.settings.get("domain_placeholder"),t=kw("Tip: A list of public XMPP providers is available"),s=kw("here"),n=Oh.settings.get("providers_link");return Ag`<input class="form-control" required="required" type="text" name="domain" placeholder="${e}"><p class="form-text text-muted">${t} <a href="${n}" class="url" target="_blank" rel="noopener">${s}</a>.</p>`})()}</div>${i?(()=>{const e=kw("Fetch registration form"),t=kw("Already have a chat account?"),s=kw("Log in here");return Ag`<fieldset class="form-group buttons"><input class="btn btn-primary" type="submit" value="${e}"></fieldset><div class="switch-form"><p>${t}</p><p><a class="login-here toggle-register-login" href="#converse/login">${s}</a></p></div>`})():""}</form>`},gR=0,pR=e=>Ag`<converse-brand-logo></converse-brand-logo>${e.alert_message?Ag`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""} ${e.status===gR?fR(e):""} ${1===e.status?(e=>{const t=Oh.settings.get("registration_domain"),s=kw("Cancel");return Ag`<form id="converse-register" class="converse-form no-scrolling" @submit="${t=>e.onFormSubmission(t)}">${Zk({classes:"hor_centered"})} ${t?"":Ag`<button class="btn btn-secondary button-cancel hor_centered" @click="${t=>e.renderProviderChoiceForm(t)}">${s}</button>`}</form>`})(e):""} ${2===e.status?(e=>{const t=kw("Choose a different provider"),s=kw("Account Registration:"),n=kw("Register"),i=Oh.settings.get("registration_domain");return Ag`<form id="converse-register" class="converse-form" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${s} ${e.domain}</legend><p class="title">${e.title}</p><p class="form-help instructions">${e.instructions}</p><div class="form-errors hidden"></div>${e.form_fields}<fieldset class="buttons form-group">${e.fields?Ag`<input type="submit" class="btn btn-primary" value="${n}">`:""} ${i?"":Ag`<input type="button" class="btn btn-secondary button-cancel" value="${t}" @click="${t=>e.renderProviderChoiceForm(t)}">`} ${mR()}</fieldset></form>`})(e):""} ${3===e.status?mR():""}`;async function vR(e){await Oh.waitUntil("controlBoxInitialized");const{chatboxes:t}=Iu.state;t.get("controlbox").set({"active-form":e})}function _R(e){"#converse/login"===location.hash?(e?.preventDefault(),vR("login")):"#converse/register"===location.hash&&(e?.preventDefault(),vR("register"))}var bR=s(9847),yR={};yR.styleTagTransform=T(),yR.setAttributes=E(),yR.insert=S().bind(null,"head"),yR.domAPI=w(),yR.insertStyleElement=C();b()(bR.A,yR);bR.A&&bR.A.locals&&bR.A.locals;const{Strophe:wR,sizzle:AR,$iq:SR}=qg.env,{CONNECTION_STATUS:xR}=yw,ER=1,$R=2;Oh.elements.define("converse-register-panel",class extends Nw{static get properties(){return{status:{type:String},alert_message:{type:String},alert_type:{type:String}}}constructor(){super(),this.urls=[],this.fields={},this.domain=null,this.alert_type="info",this.setErrorMessage=e=>this.setMessage(e,"danger"),this.setFeedbackMessage=e=>this.setMessage(e,"info")}initialize(){this.reset(),this.listenTo(Iu,"connectionInitialized",(()=>this.registerHooks()));const e=Oh.settings.get("registration_domain");e?this.fetchRegistrationForm(e):this.status=0}render(){return pR(this)}setMessage(e,t){this.alert_type=t,this.alert_message=e}registerHooks(){const e=Oh.connection.get(),t=e._connect_cb.bind(e);e._connect_cb=(e,s,n)=>{this._registering?this.getRegistrationFields(e,s)&&(this._registering=!1):t(e,s,n)}}getRegistrationFields(e,t){const s=Oh.connection.get();s.connected=!0;const n=s._proto._reqToData(e);if(!n)return;if(s._proto._connect_cb(n)===wR.Status.CONNFAIL)return this.status=0,this.setErrorMessage(kw("Sorry, we're unable to connect to your chosen provider.")),!1;const i=n.getElementsByTagName("register"),r=n.getElementsByTagName("mechanism");if(0===i.length&&0===r.length)return s._proto._no_auth_received(t),!1;if(0===i.length)return s._changeConnectStatus(wR.Status.REGIFAIL),this.alert_type="danger",this.setErrorMessage(kw("Sorry, the given provider does not support in band account registration. Please try with a different provider.")),!0;s._addSysHandler((e=>this.onRegistrationFields(e)),null,"iq",null,null);const o=SR({type:"get"}).c("query",{xmlns:wR.NS.REGISTER}).tree();return o.setAttribute("id",s.getUniqueId("sendIQ")),s.send(o),s.connected=!1,!0}onRegistrationFields(e){return"error"===e.getAttribute("type")?(this.reportErrors(e),Oh.settings.get("registration_domain")?this.status=3:this.status=0,!1):(this.setFields(e),this.status===ER&&this.renderRegistrationForm(e),!1)}reset(e){Object.assign(this,{fields:{},urls:[],title:"",instructions:"",registered:!1,_registering:!1,domain:null,form_type:null}),e&&Object.assign(this,e)}onFormSubmission(e){e?.preventDefault?.();const t=e.target;null===t.querySelector("input[name=domain]")?this.submitRegistrationForm(t):this.onProviderChosen(t)}onProviderChosen(e){const t=e.querySelector("input[name=domain]")?.value;t&&this.fetchRegistrationForm(t.trim())}fetchRegistrationForm(e){return this.status=ER,this.reset({domain:wR.getDomainFromJid(e),_registering:!0}),Oh.connection.init(),Oh.connection.get()?.connect(this.domain,"",(e=>this.onConnectStatusChanged(e))),!1}onConnectStatusChanged(e){if(bt.debug("converse-register: onConnectStatusChanged"),[wR.Status.DISCONNECTED,wR.Status.CONNFAIL,wR.Status.REGIFAIL,wR.Status.NOTACCEPTABLE,wR.Status.CONFLICT].includes(e))bt.error(`Problem during registration: Strophe.Status is ${xR[e]}`),this.abortRegistration();else if(e===wR.Status.REGISTERED){if(bt.debug("Registered successfully."),Oh.connection.get().reset(),["converse/login","converse/register"].includes(window.location.hash)&&history.pushState(null,"",window.location.pathname),vR("login"),this.fields.password&&this.fields.username){const e=Oh.connection.get();e.connect(this.fields.username.toLowerCase()+"@"+this.domain.toLowerCase(),this.fields.password,e.onConnectStatusChanged),this.setFeedbackMessage(kw("Now logging you in"))}else this.setFeedbackMessage(kw("Registered successfully"));this.reset()}}getLegacyFormFields(){const e=Object.keys(this.fields).map((e=>"username"===e?yk({domain:` @${this.domain}`,name:e,type:"text",label:e,value:"",required:!0}):vk({label:e,name:e,placeholder:e,required:!0,type:"password"===e||"email"===e?e:"text",value:""}))),t=this.urls.map((e=>bk({label:"",value:e})));return[...e,...t]}getFormFields(e){if("xform"===this.form_type){const{fields:t}=fp(e);return t?.map((e=>Sm.xFormField2TemplateResult(e,{domain:this.domain})))??[]}return this.getLegacyFormFields()}renderRegistrationForm(e){this.form_fields=this.getFormFields(e),this.status=$R}reportErrors(e){const t=Array.from(e.querySelectorAll("error"));t.length?this.setErrorMessage(t.reduce(((e,t)=>`${e}\n${t.textContent}`),"")):this.setErrorMessage(kw("The provider rejected your registration attempt. Please check the values you entered for correctness."))}renderProviderChoiceForm(e){e?.preventDefault?.();const t=Oh.connection.get();t._proto._abortAllRequests(),t.reset(),this.status=0}abortRegistration(){const e=Oh.connection.get();e._proto._abortAllRequests(),e.reset(),[ER,$R].includes(this.status)?Oh.settings.get("registration_domain")&&this.fetchRegistrationForm(Oh.settings.get("registration_domain")):this.requestUpdate()}submitRegistrationForm(e){const t=AR(":input:not([type=button]):not([type=submit])",e),s=SR({type:"set",id:Sm.getUniqueId()}).c("query",{xmlns:wR.NS.REGISTER});if("xform"===this.form_type){s.c("x",{xmlns:wR.NS.XFORM,type:"submit"});const e=t.map((e=>Sm.webForm2xForm(e))).filter((e=>e));e.forEach((e=>s.cnode(e).up()))}else t.forEach((e=>s.c(e.getAttribute("name"),{},e.value)));const n=Oh.connection.get();n._addSysHandler((e=>this._onRegisterIQ(e)),null,"iq",null,null),n.send(s),this.setFields(s.tree())}setFields(e){const t=e.querySelector("query"),s=AR(`x[xmlns="${wR.NS.XFORM}"]`,t);s.length>0?this.setFieldsFromXForm(s.pop()):this.setFieldsFromLegacy(t)}setFieldsFromLegacy(e){[].forEach.call(e.children,(e=>{"instructions"!==e.tagName.toLowerCase()?"x"!==e.tagName.toLowerCase()?this.fields[e.tagName.toLowerCase()]=wR.getText(e):"jabber:x:oob"===e.getAttribute("xmlns")&&this.urls.concat(AR("url",e).map((e=>e.textContent))):this.instructions=wR.getText(e)})),this.form_type="legacy"}setFieldsFromXForm(e){this.title=e.querySelector("title")?.textContent??"",this.instructions=e.querySelector("instructions")?.textContent??"",e.querySelectorAll("field").forEach((e=>{const t=e.getAttribute("var");t?this.fields[t.toLowerCase()]=e.querySelector("value")?.textContent??"":bt.warn("Found field we couldn't parse")})),this.form_type="xform"}_onRegisterIQ(e){const t=Oh.connection.get();if("error"===e.getAttribute("type")){bt.error("Registration failed."),this.reportErrors(e);const s=e.getElementsByTagName("error");if(1!==s.length)return t._changeConnectStatus(wR.Status.REGIFAIL,"unknown"),!1;const n=s[0].firstElementChild.tagName.toLowerCase();"conflict"===n?t._changeConnectStatus(wR.Status.CONFLICT,n):"not-acceptable"===n?t._changeConnectStatus(wR.Status.NOTACCEPTABLE,n):t._changeConnectStatus(wR.Status.REGIFAIL,n)}else t._changeConnectStatus(wR.Status.REGISTERED,null);return!1}});const{Strophe:CR}=qg.env,{CONNECTION_STATUS:kR}=yw;CR.addNamespace("REGISTER","jabber:iq:register");const TR=Object.keys(CR.Status).reduce(((e,t)=>Math.max(e,CR.Status[t])),0);CR.Status.REGIFAIL=TR+1,CR.Status.REGISTERED=TR+2,CR.Status.CONFLICT=TR+3,CR.Status.NOTACCEPTABLE=TR+5,qg.plugins.add("converse-register",{dependencies:["converse-controlbox"],enabled:()=>!0,initialize(){kR[CR.Status.REGIFAIL]="REGIFAIL",kR[CR.Status.REGISTERED]="REGISTERED",kR[CR.Status.CONFLICT]="CONFLICT",kR[CR.Status.NOTACCEPTABLE]="NOTACCEPTABLE",Oh.settings.extend({allow_registration:!0,domain_placeholder:kw(" e.g. conversejs.org"),providers_link:"https://compliance.conversations.im/",registration_domain:""}),_R(),addEventListener("hashchange",_R)}});const jR=()=>{const e=Ag`<?xml version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" style="display:none"><symbol id="icon-filter" viewBox="0 0 512 512"><path d="M3.9 54.9C10.5 40.9 24.5 32 40 32H472c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9V448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6V320.9L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/></symbol><symbol id="icon-address-book" viewBox="0 0 448 512"><path d="M436 160c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20zm-228-32c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H118.4C106 384 96 375.4 96 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z"></path></symbol><symbol id="icon-angle-double-down" viewBox="0 0 320 512"><path d="M143 256.3L7 120.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0L313 86.3c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.4 9.5-24.6 9.5-34 .1zm34 192l136-136c9.4-9.4 9.4-24.6 0-33.9l-22.6-22.6c-9.4-9.4-24.6-9.4-33.9 0L160 352.1l-96.4-96.4c-9.4-9.4-24.6-9.4-33.9 0L7 278.3c-9.4 9.4-9.4 24.6 0 33.9l136 136c9.4 9.5 24.6 9.5 34 .1z"></path></symbol><symbol id="icon-angle-double-left" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"></path></symbol><symbol id="icon-angle-double-right" viewBox="0 0 448 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"></path></symbol><symbol id="icon-angle-double-up" viewBox="0 0 320 512"><path d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"></path></symbol><symbol id="icon-angle-down" viewBox="0 0 320 512"><path d="M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"></path></symbol><symbol id="icon-angle-left" viewBox="0 0 256 512"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path></symbol><symbol id="icon-angle-right" viewBox="0 0 256 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></symbol><symbol id="icon-angle-up" viewBox="0 0 320 512"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"></path></symbol><symbol id="icon-arrow-alt-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm116-292H256v-70.9c0-10.7-13-16.1-20.5-8.5L121.2 247.5c-4.7 4.7-4.7 12.2 0 16.9l114.3 114.9c7.6 7.6 20.5 2.2 20.5-8.5V300h116c6.6 0 12-5.4 12-12v-64c0-6.6-5.4-12-12-12z"></path></symbol><symbol id="icon-arrow-alt-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zM140 300h116v70.9c0 10.7 13 16.1 20.5 8.5l114.3-114.9c4.7-4.7 4.7-12.2 0-16.9l-114.3-115c-7.6-7.6-20.5-2.2-20.5 8.5V212H140c-6.6 0-12 5.4-12 12v64c0 6.6 5.4 12 12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-arrow-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-143.6-28.9L288 302.6V120c0-13.3-10.7-24-24-24h-16c-13.3 0-24 10.7-24 24v182.6l-72.4-75.5c-9.3-9.7-24.8-9.9-34.3-.4l-10.9 11c-9.4 9.4-9.4 24.6 0 33.9L239 404.3c9.4 9.4 24.6 9.4 33.9 0l132.7-132.7c9.4-9.4 9.4-24.6 0-33.9l-10.9-11c-9.5-9.5-25-9.3-34.3.4z"></path></symbol><symbol id="icon-arrow-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm28.9-143.6L209.4 288H392c13.3 0 24-10.7 24-24v-16c0-13.3-10.7-24-24-24H209.4l75.5-72.4c9.7-9.3 9.9-24.8.4-34.3l-11-10.9c-9.4-9.4-24.6-9.4-33.9 0L107.7 239c-9.4 9.4-9.4 24.6 0 33.9l132.7 132.7c9.4 9.4 24.6 9.4 33.9 0l11-10.9c9.5-9.5 9.3-25-.4-34.3z"></path></symbol><symbol id="icon-arrow-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></symbol><symbol id="icon-arrow-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm143.6 28.9l72.4-75.5V392c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V209.4l72.4 75.5c9.3 9.7 24.8 9.9 34.3.4l10.9-11c9.4-9.4 9.4-24.6 0-33.9L273 107.7c-9.4-9.4-24.6-9.4-33.9 0L106.3 240.4c-9.4 9.4-9.4 24.6 0 33.9l10.9 11c9.6 9.5 25.1 9.3 34.4-.4z"></path></symbol><symbol id="icon-arrow-down" viewBox="0 0 448 512"><path d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"></path></symbol><symbol id="icon-arrow-left" viewBox="0 0 448 512"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 448 512"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></symbol><symbol id="icon-arrow-up" viewBox="0 0 448 512"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></symbol><symbol id="icon-arrows-alt" viewBox="0 0 512 512"><path d="M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"></path></symbol><symbol id="icon-arrows-alt-h" viewBox="0 0 512 512"><path d="M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z"></path></symbol><symbol id="icon-arrows-alt-v" viewBox="0 0 256 512"><path d="M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"></path></symbol><symbol id="icon-bars" viewBox="0 0 448 512"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></symbol><symbol id="icon-bookmark" viewBox="0 0 384 512"><path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"></path></symbol><symbol id="icon-bookmark-empty" viewBox="0 0 384 512"><path d="M0 48C0 21.5 21.5 0 48 0l0 48V441.4l130.1-92.9c8.3-6 19.6-6 27.9 0L336 441.4V48H48V0H336c26.5 0 48 21.5 48 48V488c0 9-5 17.2-13 21.3s-17.6 3.4-24.9-1.8L192 397.5 37.9 507.5c-7.3 5.2-16.9 5.9-24.9 1.8S0 497 0 488V48z"/></symbol><symbol id="icon-caret-down" viewBox="0 0 320 512"><path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></symbol><symbol id="icon-caret-right" viewBox="0 0 192 512"><path d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></symbol><symbol id="icon-check" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path></symbol><symbol id="icon-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></symbol><symbol id="icon-cog" viewBox="0 0 512 512"><path d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path></symbol><symbol id="icon-database" viewBox="0 0 448 512"><path d="M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"></path></symbol><symbol id="icon-edit" viewBox="0 0 576 512"><path d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"></path></symbol><symbol id="icon-eye" viewBox="0 0 576 512"><path d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></symbol><symbol id="icon-eye-slash" viewBox="0 0 640 512"><path d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"></path></symbol><symbol id="icon-gavel" viewBox="0 0 512 512"><path d="M504.971 199.362l-22.627-22.627c-9.373-9.373-24.569-9.373-33.941 0l-5.657 5.657L329.608 69.255l5.657-5.657c9.373-9.373 9.373-24.569 0-33.941L312.638 7.029c-9.373-9.373-24.569-9.373-33.941 0L154.246 131.48c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l5.657-5.657 39.598 39.598-81.04 81.04-5.657-5.657c-12.497-12.497-32.758-12.497-45.255 0L9.373 412.118c-12.497 12.497-12.497 32.758 0 45.255l45.255 45.255c12.497 12.497 32.758 12.497 45.255 0l114.745-114.745c12.497-12.497 12.497-32.758 0-45.255l-5.657-5.657 81.04-81.04 39.598 39.598-5.657 5.657c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l124.451-124.451c9.372-9.372 9.372-24.568 0-33.941z"></path></symbol><symbol id="icon-globe" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></symbol><symbol id="icon-id-card" viewBox="0 0 576 512"><path d="M528 32H48C21.5 32 0 53.5 0 80v16h576V80c0-26.5-21.5-48-48-48zM0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V128H0v304zm352-232c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zM176 192c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zM67.1 396.2C75.5 370.5 99.6 352 128 352h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.9-5.2 19.8-15.6 19.8H82.7c-10.4 0-18.8-10-15.6-19.8z"></path></symbol><symbol id="icon-id-card-alt" viewBox="0 0 576 512"><path d="M528 64H384v96H192V64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM288 224c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm93.3 224H194.7c-10.4 0-18.8-10-15.6-19.8 8.3-25.6 32.4-44.2 60.9-44.2h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.8-5.2 19.8-15.6 19.8zM352 32c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v96h128V32z"></path></symbol><symbol id="icon-info" viewBox="0 0 192 512"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></symbol><symbol id="icon-info-circle" viewBox="0 0 512 512"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></symbol><symbol id="icon-list-ul" viewBox="0 0 512 512"><path d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-lock" viewBox="0 0 448 512"><path d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"></path></symbol><symbol id="icon-lock-open" viewBox="0 0 576 512"><path d="M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"></path></symbol><symbol id="icon-minus" viewBox="0 0 448 512"><path d="M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-minus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"></path></symbol><symbol id="icon-minus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"></path></symbol><symbol id="icon-paper-plane" viewBox="0 0 512 512"><path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"></path></symbol><symbol id="icon-paperclip" viewBox="0 0 448 512"><path d="M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"></path></symbol><symbol id="icon-pencil-alt" viewBox="0 0 512 512"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"></path></symbol><symbol id="icon-phone" viewBox="0 0 512 512"><path d="M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"></path></symbol><symbol id="icon-plus" viewBox="0 0 448 512"><path d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-plus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-plus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-save" viewBox="0 0 448 512"><path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"></path></symbol><symbol id="icon-sign-out-alt" viewBox="0 0 512 512"><path d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-smile" viewBox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"></path></symbol><symbol id="icon-snowflake" viewBox="0 0 448 512"><path d="M440.3 345.2l-33.8-19.5 26-7c8.2-2.2 13.1-10.7 10.9-18.9l-4-14.9c-2.2-8.2-10.7-13.1-18.9-10.9l-70.8 19-63.9-37 63.8-36.9 70.8 19c8.2 2.2 16.7-2.7 18.9-10.9l4-14.9c2.2-8.2-2.7-16.7-10.9-18.9l-26-7 33.8-19.5c7.4-4.3 9.9-13.7 5.7-21.1L430.4 119c-4.3-7.4-13.7-9.9-21.1-5.7l-33.8 19.5 7-26c2.2-8.2-2.7-16.7-10.9-18.9l-14.9-4c-8.2-2.2-16.7 2.7-18.9 10.9l-19 70.8-62.8 36.2v-77.5l53.7-53.7c6.2-6.2 6.2-16.4 0-22.6l-11.3-11.3c-6.2-6.2-16.4-6.2-22.6 0L256 56.4V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v40.4l-19.7-19.7c-6.2-6.2-16.4-6.2-22.6 0L138.3 48c-6.3 6.2-6.3 16.4 0 22.6l53.7 53.7v77.5l-62.8-36.2-19-70.8c-2.2-8.2-10.7-13.1-18.9-10.9l-14.9 4c-8.2 2.2-13.1 10.7-10.9 18.9l7 26-33.8-19.5c-7.4-4.3-16.8-1.7-21.1 5.7L2.1 145.7c-4.3 7.4-1.7 16.8 5.7 21.1l33.8 19.5-26 7c-8.3 2.2-13.2 10.7-11 19l4 14.9c2.2 8.2 10.7 13.1 18.9 10.9l70.8-19 63.8 36.9-63.8 36.9-70.8-19c-8.2-2.2-16.7 2.7-18.9 10.9l-4 14.9c-2.2 8.2 2.7 16.7 10.9 18.9l26 7-33.8 19.6c-7.4 4.3-9.9 13.7-5.7 21.1l15.5 26.8c4.3 7.4 13.7 9.9 21.1 5.7l33.8-19.5-7 26c-2.2 8.2 2.7 16.7 10.9 18.9l14.9 4c8.2 2.2 16.7-2.7 18.9-10.9l19-70.8 62.8-36.2v77.5l-53.7 53.7c-6.3 6.2-6.3 16.4 0 22.6l11.3 11.3c6.2 6.2 16.4 6.2 22.6 0l19.7-19.7V496c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-40.4l19.7 19.7c6.2 6.2 16.4 6.2 22.6 0l11.3-11.3c6.2-6.2 6.2-16.4 0-22.6L256 387.7v-77.5l62.8 36.2 19 70.8c2.2 8.2 10.7 13.1 18.9 10.9l14.9-4c8.2-2.2 13.1-10.7 10.9-18.9l-7-26 33.8 19.5c7.4 4.3 16.8 1.7 21.1-5.7l15.5-26.8c4.3-7.3 1.8-16.8-5.6-21z"></path></symbol><symbol id="icon-spinner" viewBox="0 0 512 512"><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"></path></symbol><symbol id="icon-sync" viewBox="0 0 512 512"><path d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"></path></symbol><symbol id="icon-times" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></symbol><symbol id="icon-times-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path></symbol><symbol id="icon-trash" viewBox="0 0 448 512"><path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"></path></symbol><symbol id="icon-trash-alt" viewBox="0 0 448 512"><path d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-unlock" viewBox="0 0 448 512"><path d="M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"></path></symbol><symbol id="icon-user" viewBox="0 0 448 512"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-cog" viewBox="0 0 640 512"><path d="M610.5 373.3c2.6-14.1 2.6-28.5 0-42.6l25.8-14.9c3-1.7 4.3-5.2 3.3-8.5-6.7-21.6-18.2-41.2-33.2-57.4-2.3-2.5-6-3.1-9-1.4l-25.8 14.9c-10.9-9.3-23.4-16.5-36.9-21.3v-29.8c0-3.4-2.4-6.4-5.7-7.1-22.3-5-45-4.8-66.2 0-3.3.7-5.7 3.7-5.7 7.1v29.8c-13.5 4.8-26 12-36.9 21.3l-25.8-14.9c-2.9-1.7-6.7-1.1-9 1.4-15 16.2-26.5 35.8-33.2 57.4-1 3.3.4 6.8 3.3 8.5l25.8 14.9c-2.6 14.1-2.6 28.5 0 42.6l-25.8 14.9c-3 1.7-4.3 5.2-3.3 8.5 6.7 21.6 18.2 41.1 33.2 57.4 2.3 2.5 6 3.1 9 1.4l25.8-14.9c10.9 9.3 23.4 16.5 36.9 21.3v29.8c0 3.4 2.4 6.4 5.7 7.1 22.3 5 45 4.8 66.2 0 3.3-.7 5.7-3.7 5.7-7.1v-29.8c13.5-4.8 26-12 36.9-21.3l25.8 14.9c2.9 1.7 6.7 1.1 9-1.4 15-16.2 26.5-35.8 33.2-57.4 1-3.3-.4-6.8-3.3-8.5l-25.8-14.9zM496 400.5c-26.8 0-48.5-21.8-48.5-48.5s21.8-48.5 48.5-48.5 48.5 21.8 48.5 48.5-21.7 48.5-48.5 48.5zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm201.2 226.5c-2.3-1.2-4.6-2.6-6.8-3.9l-7.9 4.6c-6 3.4-12.8 5.3-19.6 5.3-10.9 0-21.4-4.6-28.9-12.6-18.3-19.8-32.3-43.9-40.2-69.6-5.5-17.7 1.9-36.4 17.9-45.7l7.9-4.6c-.1-2.6-.1-5.2 0-7.8l-7.9-4.6c-16-9.2-23.4-28-17.9-45.7.9-2.9 2.2-5.8 3.2-8.7-3.8-.3-7.5-1.2-11.4-1.2h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c10.1 0 19.5-3.2 27.2-8.5-1.2-3.8-2-7.7-2-11.8v-9.2z"></path></symbol><symbol id="icon-user-plus" viewBox="0 0 640 512"><path d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-secret" viewBox="0 0 448 512"><path d="M383.9 308.3l23.9-62.6c4-10.5-3.7-21.7-15-21.7h-58.5c11-18.9 17.8-40.6 17.8-64v-.3c39.2-7.8 64-19.1 64-31.7 0-13.3-27.3-25.1-70.1-33-9.2-32.8-27-65.8-40.6-82.8-9.5-11.9-25.9-15.6-39.5-8.8l-27.6 13.8c-9 4.5-19.6 4.5-28.6 0L182.1 3.4c-13.6-6.8-30-3.1-39.5 8.8-13.5 17-31.4 50-40.6 82.8-42.7 7.9-70 19.7-70 33 0 12.6 24.8 23.9 64 31.7v.3c0 23.4 6.8 45.1 17.8 64H56.3c-11.5 0-19.2 11.7-14.7 22.3l25.8 60.2C27.3 329.8 0 372.7 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-48.4-25.8-90.4-64.1-114.1zM176 480l-41.6-192 49.6 32 24 40-32 120zm96 0l-32-120 24-40 49.6-32L272 480zm41.7-298.5c-3.9 11.9-7 24.6-16.5 33.4-10.1 9.3-48 22.4-64-25-2.8-8.4-15.4-8.4-18.3 0-17 50.2-56 32.4-64 25-9.5-8.8-12.7-21.5-16.5-33.4-.8-2.5-6.3-5.7-6.3-5.8v-10.8c28.3 3.6 61 5.8 96 5.8s67.7-2.1 96-5.8v10.8c-.1.1-5.6 3.2-6.4 5.8z"></path></symbol><symbol id="icon-users" viewBox="0 0 640 512"><path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path></symbol><symbol id="icon-wrench" viewBox="0 0 512 512"><path d="M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"></path></symbol><symbol id="icon-refresh" viewBox="0 0 512 512"><path d="M464 16c-17.67 0-32 14.31-32 32v74.09C392.1 66.52 327.4 32 256 32C161.5 32 78.59 92.34 49.58 182.2c-5.438 16.81 3.797 34.88 20.61 40.28c16.89 5.5 34.88-3.812 40.3-20.59C130.9 138.5 189.4 96 256 96c50.5 0 96.26 24.55 124.4 64H336c-17.67 0-32 14.31-32 32s14.33 32 32 32h128c17.67 0 32-14.31 32-32V48C496 30.31 481.7 16 464 16zM441.8 289.6c-16.92-5.438-34.88 3.812-40.3 20.59C381.1 373.5 322.6 416 256 416c-50.5 0-96.25-24.55-124.4-64H176c17.67 0 32-14.31 32-32s-14.33-32-32-32h-128c-17.67 0-32 14.31-32 32v144c0 17.69 14.33 32 32 32s32-14.31 32-32v-74.09C119.9 445.5 184.6 480 255.1 480c94.45 0 177.4-60.34 206.4-150.2C467.9 313 458.6 294.1 441.8 289.6z"></path></symbol><symbol id="icon-copy" viewBox="0 0 448 512"><path d="M320 448v40c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V120c0-13.3 10.7-24 24-24h72v296c0 30.9 25.1 56 56 56h168zm0-344V0H152c-13.3 0-24 10.7-24 24v368c0 13.3 10.7 24 24 24h272c13.3 0 24-10.7 24-24V128H344c-13.2 0-24-10.8-24-24zm121-31L375 7A24 24 0 0 0 358.1 0H352v96h96v-6.1a24 24 0 0 0 -7-17z"></path></symbol><symbol id="icon-quote-right" viewBox="0 0 512 512"><path d="M464 32H336c-26.5 0-48 21.5-48 48v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48zm-288 0H48C21.5 32 0 53.5 0 80v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48z"></path></symbol></svg>`;return Ag`${e} <svg xmlns="http://www.w3.org/2000/svg" style="display:none"><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><symbol id="icon-list-check" viewBox="0 0 448 512"><path d="M152.1 38.2c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 113C-2.3 103.6-2.3 88.4 7 79s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zm0 160c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 273c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zM224 96c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zM160 416c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H192c-17.7 0-32-14.3-32-32zM48 368a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/></symbol><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><symbol id="icon-circle-question" viewBox="0 0 448 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM169.8 165.3c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24V250.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1H222.6c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/></symbol><!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><symbol id="icon-square-poll-horizontal" viewBox="0 0 448 512"><path d="M448 96c0-35.3-28.7-64-64-64L64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320zM256 160c0 17.7-14.3 32-32 32l-96 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l96 0c17.7 0 32 14.3 32 32zm64 64c17.7 0 32 14.3 32 32s-14.3 32-32 32l-192 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l192 0zM192 352c0 17.7-14.3 32-32 32l-32 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l32 0c17.7 0 32 14.3 32 32z"/></symbol><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><symbol id="icon-note-sticky" viewBox="0 0 448 512"><path d="M64 80c-8.8 0-16 7.2-16 16l0 320c0 8.8 7.2 16 16 16l224 0 0-80c0-17.7 14.3-32 32-32l80 0 0-224c0-8.8-7.2-16-16-16L64 80zM288 480L64 480c-35.3 0-64-28.7-64-64L0 96C0 60.7 28.7 32 64 32l320 0c35.3 0 64 28.7 64 64l0 224 0 5.5c0 17-6.7 33.3-18.7 45.3l-90.5 90.5c-12 12-28.3 18.7-45.3 18.7l-5.5 0z"/></symbol><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><symbol id="icon-magnifying-glass" viewBox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></symbol></svg>`};Oh.elements.define("converse-fontawesome",class extends Nw{render(){return jR()}});function NR(){return window.matchMedia("(prefers-color-scheme: dark)").matches?Oh.settings.get("dark_theme"):Oh.settings.get("theme")}function OR(){if(!Oh.settings.get("auto_insert"))return;const e=Oh.settings.get("root");if(!e.querySelector("converse-root")){const t=document.createElement("converse-root"),s=e.querySelector("body");s?s.appendChild(t):e.appendChild(t)}}var IR=s(5190),MR={};MR.styleTagTransform=T(),MR.setAttributes=E(),MR.insert=S().bind(null,"head"),MR.domAPI=w(),MR.insertStyleElement=C();b()(IR.A,MR);IR.A&&IR.A.locals&&IR.A.locals;class RR extends Nw{render(){return(()=>{const e=Oh.settings.get("singleton")?["converse-singleton"]:[];return e.push(`converse-${Oh.settings.get("view_mode")}`),Ag`${Oh.settings.get("show_background")?Ag`<converse-bg></converse-bg>`:""}<converse-chats class="converse-chatboxes row justify-content-start g-0 ${e.join(" ")}"></converse-chats><div id="converse-modals" class="modals"></div><converse-fontawesome></converse-fontawesome>`})()}initialize(){this.setAttribute("id","conversejs"),this.setClasses();const e=Oh.settings.get();this.listenTo(e,"change:view_mode",(()=>this.setClasses())),this.listenTo(e,"change:singleton",(()=>this.setClasses())),window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>this.setClasses())),window.matchMedia("(prefers-color-scheme: light)").addListener((()=>this.setClasses()))}setClasses(){this.className="",this.classList.add("container-fluid"),this.classList.add("g-0"),this.classList.add("conversejs"),this.classList.add(`converse-${Oh.settings.get("view_mode")}`),this.classList.add(`theme-${NR()}`),this.requestUpdate()}}var DR=s(4842),LR={};LR.styleTagTransform=T(),LR.setAttributes=E(),LR.insert=S().bind(null,"head"),LR.domAPI=w(),LR.insertStyleElement=C();b()(DR.A,LR);DR.A&&DR.A.locals&&DR.A.locals;class zR extends Nw{initialize(){this.setClasses()}render(){return Ag`${"cyberpunk"===Oh.settings.get("theme")?Ag`<section class="moving-grid"><div class="container"><div class="static-lines">${[...Array(20).keys()].map((()=>Ag`<div class="vert"></div>`))}</div><div class="moving-lines">${[...Array(60).keys()].map((()=>Ag`<div class="horz"></div>`))}</div></div></section>`:""}<div class="inner-content converse-brand row"><div class="converse-brand__heading"><svg height="160px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 364 364" version="1.1"><title>Logo Converse</title><defs><linearGradient id="gradient" x1="92.14" y1="27.64" x2="267.65" y2="331.62" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff1d1"/><stop offset="0.05" stop-color="#fae8c1"/><stop offset="0.15" stop-color="#f0d5a1"/><stop offset="0.27" stop-color="#e7c687"/><stop offset="0.4" stop-color="#e1bb72"/><stop offset="0.54" stop-color="#dcb264"/><stop offset="0.71" stop-color="#daad5c"/><stop offset="1" stop-color="#d9ac59"/></linearGradient><filter id="shadow"><feGaussianBlur in="SourceAlpha" stdDeviation="2.3" result="blur1"/><feOffset in="blur1" dx="3" dy="3" result="blur2"/><feColorMatrix in="blur2" type="matrix" result="blur3" values="1 0 0 0 0.1                                    0 1 0 0 0.1                                    0 0 1 0 0.1                                    0 0 0 1 0"/><feMerge><feMergeNode in="blur3"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><g filter="url(#shadow)"><path d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" fill="#d9ac59"/><path d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" fill="url(#gradient)"/></g></svg> <span class="converse-brand__text"><span>converse<span class="subdued">.js</span></span><p class="byline">messaging freedom</p></span></div>${"overlayed"===Oh.settings.get("view_mode")?Ag`<div class="converse-brand__padding"></div>`:""}</div>`}setClasses(){this.classList.add(`theme-${NR()}`),this.requestUpdate()}}Oh.elements.define("converse-bg",zR);qg.plugins.add("converse-rootview",{initialize(){Oh.settings.extend({auto_insert:!0,theme:"classic",dark_theme:"dracula",show_background:!1}),Oh.listen.on("chatBoxesInitialized",OR),Oh.elements.define("converse-root",RR)}});const PR=e=>{const t=kw("Add"),s=kw("name@example.org"),n=kw("Group"),i=kw("Name"),r=kw("XMPP Address"),o=e.model.get("error");return Ag`<form class="converse-form add-xmpp-contact" @submit="${t=>e.addContactFromForm(t)}"><div class="modal-body"><span class="modal-alert"></span><div class="form-group add-xmpp-contact__jid"><label class="form-label clearfix" for="jid">${r}:</label> ${Oh.settings.get("autocomplete_add_contact")?Ag`<converse-autocomplete .list="${function(){const e=Iu.state.roster;return[...new Set(e.map((e=>VN.getDomainFromJid(e.get("jid")))))]}()}" .data="${(e,t)=>`${t.slice(0,t.indexOf("@"))}@${e}`}" position="below" filter="${ok}" ?required="${!Oh.settings.get("xhr_user_search_url")}" value="${e.model.get("jid")||""}" placeholder="${s}" name="jid"></converse-autocomplete>`:Ag`<input type="text" name="jid" ?required="${!Oh.settings.get("xhr_user_search_url")}" value="${e.model.get("jid")||""}" class="form-control" placeholder="${s}">`}</div><div class="form-group add-xmpp-contact__name"><label class="form-label clearfix" for="name">${i}:</label> ${Oh.settings.get("autocomplete_add_contact")&&"string"==typeof Oh.settings.get("xhr_user_search_url")?Ag`<converse-autocomplete .getAutoCompleteList="${ZN}" filter="${ok}" value="${e.model.get("nickname")||""}" placeholder="${s}" name="name"></converse-autocomplete>`:Ag`<input type="text" name="name" value="${e.model.get("nickname")||""}" class="form-control" placeholder="${s}">`}</div><div class="form-group add-xmpp-contact__group"><label class="form-label clearfix" for="name">${n}:</label><converse-autocomplete .list="${function(){const e=Iu.state.roster.reduce(((e,t)=>e.concat(t.get("groups"))),[]);return[...new Set(e.filter((e=>e)))]}()}" name="group"></converse-autocomplete></div>${o?Ag`<div><div style="display:block" class="invalid-feedback">${o}</div></div>`:""} <button type="submit" class="btn btn-primary">${t}</button></div></form>`};Oh.elements.define("converse-add-contact-modal",class extends JC{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.render(),this.addEventListener("shown.bs.modal",(()=>this.querySelector('input[name="jid"]')?.focus()),!1)}renderModal(){return PR(this)}getModalTitle(){return kw("Add a Contact")}validateSubmission(e){return!e||e.split("@").filter((e=>!!e)).length<2?(this.model.set("error",kw("Please enter a valid XMPP address")),!1):Iu.state.roster.get(lt.getBareJidFromJid(e))?(this.model.set("error",kw("This contact has already been added")),!1):(this.model.set("error",null),!0)}afterSubmission(e,t,s,n){n&&!Array.isArray(n)&&(n=[n]),Iu.state.roster.addAndSubscribe(t,s,n),this.model.clear(),this.modal.hide()}async addContactFromForm(e){e.preventDefault();const t=new FormData(e.target);let s=(t.get("name")||"").trim(),n=(t.get("jid")||"").trim();if(!n&&"string"==typeof Oh.settings.get("xhr_user_search_url")){const e=await ZN(s);if(1!==e.length)return this.model.set("error",kw("Sorry, could not find a contact with that name")),void this.render();n=e[0].value,s=e[0].label}this.validateSubmission(n)&&this.afterSubmission(e.target,n,s,t.get("group"))}});const{isUniView:FR}=Sm;function UR(e){const t=e.get("jid"),s=[];if(FR()){const e=Iu.state.chatboxes.get(t);e&&!e.get("hidden")&&s.push("open")}const n=e.get("ask"),i=e.get("requesting"),r=e.get("subscription");return"subscribe"===n||"from"===r?s.push("pending-xmpp-contact"):!0===i?s.push("requesting-xmpp-contact"):("both"===r||"to"===r||Sm.isSameBareJID(t,Oh.connection.get().jid))&&(s.push("current-xmpp-contact"),s.push(r),s.push(e.presence.get("show"))),Ag`<li class="list-item d-flex controlbox-padded ${s.join(" ")}" data-status="${e.presence.get("show")}"><converse-roster-contact .model="${e}"></converse-roster-contact></li>`}const BR=e=>{const t=kw("Click to hide these contacts"),s=Iu.state.roster.state.get("collapsed_groups");return Ag`<div class="roster-group" data-group="${e.name}"><a href="#" class="list-toggle group-toggle controlbox-padded" title="${t}" @click="${t=>function(e,t){e?.preventDefault?.();const{roster:s}=Iu.state,n=s.state.get("collapsed_groups");n.includes(t)?s.state.save("collapsed_groups",n.filter((e=>e!==t))):s.state.save("collapsed_groups",[...n,t])}(t,e.name)}"><converse-icon color="var(--chat-head-color-dark)" size="1em" class="fa ${s.includes(e.name)?"fa-caret-right":"fa-caret-down"}"></converse-icon>${e.name}</a><ul class="items-list roster-group-contacts ${s.includes(e.name)?"collapsed":""}" data-group="${e.name}">${hj(e.contacts,(e=>e.get("jid")),UR)}</ul></div>`},qR=e=>{const t=kw("Filter"),s=kw("Filter by contact name"),n=kw("Filter by group name"),i=kw("Filter by status"),r=kw("Any"),o=kw("Unread"),a=kw("Available"),c=kw("Chatty"),l=kw("Busy"),d=kw("Away"),u=kw("Extended Away"),h=kw("Offline"),m=e.model.get("state"),f=e.model.get("text"),g=e.model.get("type");return Ag`<form class="controlbox-padded items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="flex-nowrap"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===g?"selected":""}" data-type="items" title="${s}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-users clickable ${"groups"===g?"selected":""}" data-type="groups" title="${n}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===g?"selected":""}" data-type="state" title="${i}"></converse-icon></div><div class="btn-group"><input .value="${f||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===g?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${f&&"state"!==g?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==g?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${r}</option><option ?selected="${"unread_messages"===m}" value="unread_messages">${o}</option><option ?selected="${"online"===m}" value="online">${a}</option><option ?selected="${"chat"===m}" value="chat">${c}</option><option ?selected="${"dnd"===m}" value="dnd">${l}</option><option ?selected="${"away"===m}" value="away">${d}</option><option ?selected="${"xa"===m}" value="xa">${u}</option><option ?selected="${"offline"===m}" value="offline">${h}</option></select></div></form>`},{CLOSED:HR}=yw,GR=e=>{const t=kw("Contacts"),s=kw("Click to toggle contacts"),n=kw("Add a contact"),i=Iu.state.roster||[],r=i.reduce(((e,t)=>function(e,t){if(t.get("requesting")){const s=Iu.labels.HEADER_REQUESTING_CONTACTS;e[s]?e[s].push(t):e[s]=[t]}else{let s;Oh.settings.get("roster_groups")?(s=t.get("groups"),s=0===s.length?[Iu.labels.HEADER_UNGROUPED]:s):s="subscribe"===t.get("ask")?[Iu.labels.HEADER_PENDING_CONTACTS]:[Iu.labels.HEADER_CURRENT_CONTACTS];for(const n of s)e[n]?e[n].push(t):e[n]=[t]}if(t.get("num_unread")){const s=Iu.labels.HEADER_UNREAD;e[s]?e[s].push(t):e[s]=[t]}return e}(e,t)),{}),o=Object.keys(r).filter((t=>function(e,t){if(!t.get("filter_visible"))return!0;const s=Iu.state.roster_filter;if("groups"===s.get("type")){const t=s.get("text")?.toLowerCase();if(!t)return!0;if(!e.toLowerCase().includes(t))return!1}return!0}(t,e.model))),a=e.model.get("toggle_state")===HR;o.sort(KN);const c=kw("Show filter"),l=kw("Hide filter"),d=e.model.get("filter_visible"),u=[];if(Oh.settings.get("allow_contact_requests")&&u.push(Ag`<a href="#" class="dropdown-item add-contact" role="button" @click="${t=>e.showAddContactModal(t)}" title="${n}" data-toggle="modal" data-target="#add-contact-modal"><converse-icon class="fa fa-user-plus" size="1em"></converse-icon>${n}</a>`),i.length>5&&u.push(Ag`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${d?l:c}</a>`),"debug"===Oh.settings.get("loglevel")){const t=kw("Re-sync contacts");u.push(Ag`<a href="#" class="dropdown-item" role="button" @click="${t=>e.syncContacts(t)}" title="${t}"><converse-icon class="fa fa-sync sync-contacts" size="1em"></converse-icon>${t}</a>`)}return Ag`<div class="d-flex controlbox-padded"><span class="w-100 controlbox-heading controlbox-heading--contacts"><a class="list-toggle open-contacts-toggle" title="${s}" role="heading" aria-level="3" @click="${e.toggleRoster}">${t} ${i.length?Ag`<converse-icon class="fa ${a?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--chat-color)"></converse-icon>`:""}</a></span><converse-dropdown class="chatbox-btn btn-group dropstart dropdown--contacts" .items="${u}"></converse-dropdown></div><div class="list-container roster-contacts ${a?"hidden":""}">${d?Ag`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${Oh.waitUntil("rosterInitialized")}" .items="${Iu.state.roster}" .template="${qR}" .model="${Iu.state.roster_filter}"></converse-list-filter>`:""} ${hj(o,(e=>e),(t=>{const s=r[t].filter((s=>function(e,t,s){if(!s.get("filter_visible"))return!0;const n=e.presence.get("show");return Oh.settings.get("hide_offline_users")&&"offline"===n?("subscribe"===e.get("ask")||"from"===e.get("subscription")||!0===e.get("requesting"))&&!YN(e,t):!YN(e,t)}(s,t,e.model)));return s.sort(XN),s.length?BR({contacts:s,name:t}):""}))}</div>`},{initStorage:WR}=Sm,{CLOSED:VR,OPENED:QR}=yw;Oh.elements.define("converse-roster",class extends Nw{async initialize(){const e=`converse.contacts-panel${Iu.session.get("bare_jid")}`;this.model=new cd({id:e}),WR(this.model,e),this.model.fetch(),await Oh.waitUntil("rosterInitialized");const{chatboxes:t,presences:s,roster:n}=Iu.state;this.listenTo(Iu,"rosterContactsFetched",(()=>this.requestUpdate())),this.listenTo(s,"change:show",(()=>this.requestUpdate())),this.listenTo(t,"change:hidden",(()=>this.requestUpdate())),this.listenTo(n,"add",(()=>this.requestUpdate())),this.listenTo(n,"destroy",(()=>this.requestUpdate())),this.listenTo(n,"remove",(()=>this.requestUpdate())),this.listenTo(n,"change",(()=>this.requestUpdate())),this.listenTo(n.state,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),Oh.trigger("rosterViewInitialized")}render(){return GR(this)}showAddContactModal(e){Oh.modal.show("converse-add-contact-modal",{model:new cd},e)}async syncContacts(e){e?.preventDefault();const{roster:t}=Iu.state;this.syncing_contacts=!0,this.requestUpdate(),t.data.save("version",null),await t.fetchFromServer(),Oh.user.presence.send(),this.syncing_contacts=!1,this.requestUpdate()}toggleRoster(e){e?.preventDefault?.();const t=this.querySelector(".list-container.roster-contacts");this.model.get("toggle_state")===VR?Hk(t).then((()=>this.model.save({toggle_state:QR}))):Gk(t).then((()=>this.model.save({toggle_state:VR})))}toggleFilter(e){e?.preventDefault?.(),this.model.save({filter_visible:!this.model.get("filter_visible")})}});const JR={dnd:kw("This contact is busy"),online:kw("This contact is online"),offline:kw("This contact is offline"),unavailable:kw("This contact is unavailable"),xa:kw("This contact is away for an extended period"),away:kw("This contact is away")},YR=e=>{const t=e.model.presence.get("show")||"offline";let s,n;[s,n]="online"===t?["fa fa-circle","chat-status-online"]:"dnd"===t?["fa fa-minus-circle","chat-status-busy"]:"away"===t?["fa fa-circle","chat-status-away"]:["fa fa-circle","subdued-color"];const i=JR[t],r=e.model.get("num_unread")||0,o=e.model.getDisplayName(),a=e.model.get("jid"),c=kw("Click to chat with %1$s (XMPP address: %2$s)",o,a);return Ag`<a class="list-item-link cbox-list-item open-chat ${r?"unread-msgs":""}" title="${c}" href="#" data-jid="${a}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><converse-icon title="${i}" color="var(--${n})" size="1em" class="${s} chat-status chat-status--avatar"></converse-icon></span>${r?Ag`<span class="msgs-indicator">${r}</span>`:""} <span class="contact-name contact-name--${t} ${r?"unread-msgs":""}">${o}</span> </a>${Oh.settings.get("allow_contact_removal")?(e=>{const t=e.model.getDisplayName(),s=kw("Click to remove %1$s as a contact",t);return Ag`<a class="list-item-action remove-xmpp-contact" @click="${e.removeContact}" title="${s}" href="#"><converse-icon class="fa fa-trash-alt" size="1.5em"></converse-icon></a>`})(e):""}`};class XR extends Nw{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}initialize(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"highlight",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"presenceChanged",(()=>this.requestUpdate()))}render(){if(!0===this.model.get("requesting")){const e=this.model.getDisplayName();return(e=>Ag`<a class="open-chat w-100" href="#" @click="${e.openChat}"><span class="req-contact-name w-100" title="JID: ${e.jid}">${e.display_name}</span> </a><a class="accept-xmpp-request list-item-action list-item-action--visible" @click="${e.acceptRequest}" aria-label="${e.desc_accept}" title="${e.desc_accept}" href="#"><converse-icon class="fa fa-check" size="1em"></converse-icon></a><a class="decline-xmpp-request list-item-action list-item-action--visible" @click="${e.declineRequest}" aria-label="${e.desc_decline}" title="${e.desc_decline}" href="#"><converse-icon class="fa fa-times" size="1em"></converse-icon></a>`)(Object.assign(this.model.toJSON(),{display_name:e,openChat:e=>this.openChat(e),acceptRequest:e=>this.acceptRequest(e),declineRequest:e=>this.declineRequest(e),desc_accept:kw("Click to accept the contact request from %1$s",e),desc_decline:kw("Click to decline the contact request from %1$s",e)}))}return YR(this)}openChat(e){e?.preventDefault?.(),this.model.openChat()}async removeContact(e){if(e?.preventDefault?.(),!Oh.settings.get("allow_contact_removal"))return;if(await Oh.confirm(kw("Are you sure you want to remove this contact?")))try{this.model.removeFromRoster(),this.model.collection&&this.model.destroy()}catch(e){bt.error(e),Oh.alert("error",kw("Error"),[kw("Sorry, there was an error while trying to remove %1$s as a contact.",this.model.getDisplayName())])}}async acceptRequest(e){e?.preventDefault?.(),await Iu.state.roster.sendContactAddIQ(this.model.get("jid"),this.model.getFullname(),[]),this.model.authorize().subscribe()}async declineRequest(e){e&&e.preventDefault&&e.preventDefault();return await Oh.confirm(kw("Are you sure you want to decline this contact request?"))&&this.model.unauthorize().destroy(),this}}Oh.elements.define("converse-roster-contact",XR);var KR=s(7702),ZR={};ZR.styleTagTransform=T(),ZR.setAttributes=E(),ZR.insert=S().bind(null,"head"),ZR.domAPI=w(),ZR.insertStyleElement=C();b()(KR.A,ZR);KR.A&&KR.A.locals&&KR.A.locals;qg.plugins.add("converse-rosterview",{dependencies:["converse-roster","converse-modal","converse-chatboxviews"],initialize(){Oh.settings.extend({autocomplete_add_contact:!0,allow_contact_removal:!0,hide_offline_users:!1,roster_groups:!0,xhr_user_search_url:null}),Oh.promises.add("rosterViewInitialized");const e={RosterFilter:Vb,RosterContactView:XR};Object.assign(Iu,e),Object.assign(Iu.exports,e),Oh.listen.on("chatBoxesInitialized",(()=>{Iu.state.chatboxes.on("destroy",(e=>JN(e))),Iu.state.chatboxes.on("change:hidden",(e=>JN(e)))}))}});var eD=s(8562),tD={};tD.styleTagTransform=T(),tD.setAttributes=E(),tD.insert=S().bind(null,"head"),tD.domAPI=w(),tD.insertStyleElement=C();b()(eD.A,tD);eD.A&&eD.A.locals&&eD.A.locals;qg.plugins.add("converse-singleton",{enabled:e=>e.api.settings.get("singleton"),initialize(){Oh.settings.extend({allow_logout:!1,allow_muc_invitations:!1,hide_muc_server:!0});const e=Oh.settings.get("auto_join_rooms"),t=Oh.settings.get("auto_join_private_chats");if(!Array.isArray(e)&&!Array.isArray(t))throw new Error("converse-singleton: auto_join_rooms must be an Array");if(0===e.length&&0===t.length)throw new Error("If you set singleton set to true, you need to specify auto_join_rooms or auto_join_private_chats");if(e.length>0&&t.length>0)throw new Error("It doesn't make sense to have singleton set to true and auto_join_rooms or auto_join_private_chats set to more then one, since only one chat room may be open at any time.")}});var sD=s(5431),nD={};nD.styleTagTransform=T(),nD.setAttributes=E(),nD.insert=S().bind(null,"head"),nD.domAPI=w(),nD.insertStyleElement=C();b()(sD.A,nD);sD.A&&sD.A.locals&&sD.A.locals;const{isUniView:iD}=Sm;let rD;qg.plugins.add("converse-fullscreen",{enabled:()=>iD(),initialize(){Oh.settings.extend({chatview_avatar_height:50,chatview_avatar_width:50,hide_open_bookmarks:!0,show_controlbox_by_default:!0,sticky_controlbox:!0})}}),qg.plugins.add("livechat-converse-size",{dependencies:[],initialize(){Object.assign(Oh,{livechat_size:{current:()=>rD,width_is:e=>(Array.isArray(e)||(e=[e]),!!rD&&e.includes(rD.width)),height_is:e=>(Array.isArray(e)||(e=[e]),!!rD&&e.includes(rD.height))}}),Iu.api.listen.on("connected",aD),Iu.api.listen.on("reconnected",aD),Iu.api.listen.on("disconnected",cD)}});const oD=new ResizeObserver((e=>{for(const t of e)lD(t.target)}));function aD(){const e=document.querySelector("converse-root");e&&(e.hasAttribute("livechat-converse-root-width")&&cD(),e.style.display="block",oD.observe(e),lD(e))}function cD(){rD=void 0,oD.disconnect();const e=document.querySelector("converse-root");e&&(e.removeAttribute("livechat-converse-root-width"),e.removeAttribute("livechat-converse-root-height"))}function lD(e){const t=e.getBoundingClientRect(),s=t.height>576?"high":t.height>250?"medium":"small",n=t.width>576?"large":t.width>250?"medium":"small",i=e.getAttribute("livechat-converse-root-height");n===e.getAttribute("livechat-converse-root-width")&&s===i||(e.setAttribute("livechat-converse-root-width",n),e.setAttribute("livechat-converse-root-height",s),rD={height:s,width:n},Oh.trigger("livechatSizeChanged",Object.assign({},rD)))}const dD="urn:xmpp:mam:2#x-search";function uD(e,t){const s=e.model;if(!Oh.settings.get("livechat_mam_search_app_enabled"))return t;if("groupchat"!==s.get("type"))return t;if(!s.occupant)return t;const n=s.collection?.chatbox;if(!n)return t;if(!n.features?.get?.(dD))return t;const i=n.getOwnOccupant();if(!i||!["admin","owner"].includes(i.get("affiliation")))return t;const r=kw("Search all messages");return t.push({i18n_text:r,handler:async e=>{e.preventDefault(),Oh.livechat_mam_search.showMessagesFrom(s.occupant)},button_class:"",icon_class:"fa fa-magnifying-glass",name:"muc-mam-search"}),t}function hD(e,t){if(!Oh.settings.get("livechat_mam_search_app_enabled"))return t;const s=e.collection?.chatroom;if(!s)return t;if(!s.features?.get?.(dD))return t;const n=s.getOwnOccupant();if(!n||!["admin","owner"].includes(n.get("affiliation")))return t;const i=kw("Search all messages");return t.push({i18n_text:i,handler:async t=>{t.preventDefault(),Oh.livechat_mam_search.showMessagesFrom(e)},button_class:"",icon_class:"fa fa-magnifying-glass",name:"muc-mam-search"}),t}const mD=qg.env,{$iq:fD,Strophe:gD,sizzle:pD,log:vD,TimeoutError:_D,__:bD,u:yD}=mD,wD=gD.NS;const AD={query:async function(e){if(!Oh.connection.connected())throw new Error("Can't call `api.livechat_mam_search.query` before having established an XMPP session");if(!e?.room)throw new Error("api.livechat_mam_search.query: Missing room parameter.");const t={type:"set",to:e.room},s=t.to;if(!await Oh.disco.supports(dD,s))return vD.warn(`Did not search MAM archive for ${s} because it doesn't support ${dD}`),{messages:[]};const n=yD.getUniqueId(),i=fD(t).c("query",{xmlns:dD,queryid:n});i.c("x",{xmlns:wD.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(dD).up().up(),e.from&&i.c("field",{var:"from"}).c("value").t(e.from).up().up(),e.occupant_id&&i.c("field",{var:"occupant_id"}).c("value").t(e.occupant_id).up().up(),i.up();const r=Oh.connection.get(),o=[],a=r.addHandler((e=>{const s=pD(`message > result[xmlns="${wD.MAM}"]`,e).pop();if(void 0===s||s.getAttribute("queryid")!==n)return!0;const i=e.getAttribute("from");return i!==t.to?(vD.warn(`Ignoring alleged groupchat MAM message from ${i}`),!0):(o.push(e),!0)}),wD.MAM);let c;const l=Oh.settings.get("message_archiving_timeout"),d=await Oh.sendIQ(i,l,!1);if(null===d){const e=bD("Timeout while trying to fetch archived messages.");return vD.error(e),c=new _D(e),{messages:o,error:c}}if(yD.isErrorStanza(d)){const e=bD("An error occurred while querying for archived messages.");return vD.error(e),vD.error(d),c=new Error(e),{messages:o,error:c}}return r.deleteHandler(a),{messages:o}},showMessagesFrom:async function(e){const t=document.querySelector("livechat-converse-muc-mam-search-app");if(!t)throw new Error("Cant find Search App Element");return t.searchFrom(e),await t.showApp(),await t.updateComplete,t}};var SD=s(3658),xD={};xD.styleTagTransform=T(),xD.setAttributes=E(),xD.insert=S().bind(null,"head"),xD.domAPI=w(),xD.insertStyleElement=C();b()(SD.A,xD);SD.A&&SD.A.locals&&SD.A.locals;class ED extends Nw{restoreSettingName=void 0;sessionStorageRestoreKey=void 0;static get properties(){return{model:{type:Object,attribute:!0},show:{type:Boolean,attribute:!1}}}async initialize(){this.classList.add("livechat-converse-muc-app"),this.show=this.restoreSettingName&&Oh.settings.get(this.restoreSettingName)&&this.sessionStorageRestoreKey&&"1"===window.sessionStorage?.getItem?.(this.sessionStorageRestoreKey),this.listenTo(Iu,"livechatSizeChanged",(()=>{if(this.show&&Oh.livechat_size?.width_is(["small","medium"]))for(const e of document.querySelectorAll(".livechat-converse-muc-app")){if(e===this)break;if(e.show){console.debug("The livechat size is small or medium, there is already an opened app, so closing myself",this),this.toggleApp();break}}}))}render(){return""}updated(){""===this.innerText.trim()?this.classList.add("hidden"):this.classList.remove("hidden"),super.updated()}toggleApp(){this.show=!this.show,this.sessionStorageRestoreKey&&window.sessionStorage?.setItem?.(this.sessionStorageRestoreKey,this.show?"1":""),this.show&&Oh.livechat_size?.width_is(["small","medium"])&&this._closeOtherApps()}showApp(){if(!this.show)return this.toggleApp()}hideApp(){if(this.show)return this.toggleApp()}_closeOtherApps(){document.querySelectorAll(".livechat-converse-muc-app").forEach((e=>{e!==this&&e.show&&(console.debug("Closing another app, because livechat width is small or medium",e),e.toggleApp())}))}}function $D(e){let t="https://livingston.frama.io/peertube-plugin-livechat/";return e.lang&&/^[a-zA-Z_-]+$/.test(e.lang)&&(t=t+e.lang+"/"),e.page&&/^[\w/-]+$/.test(e.page)&&(t=t+e.page+"/"),t}function CD(e){const t=function(){const e=kw("_livechat_language");return"_livechat_language"===e?"en":e}().toLowerCase();return $D("en"===t?e:Object.assign({},e,{lang:t}))}function kD(e,t,s,n,i){return Ag`<div class="livechat-converse-muc-app-header"><h5>${t}</h5><a href="${s}" target="_blank"><converse-icon class="fa fa-circle-question" size="1em" title="${n}"></converse-icon></a><button type="button" class="livechat-converse-muc-app-close" @click="${e.toggleApp}" title="${kw("Close")}"><converse-icon class="fa fa-times" size="1em"></converse-icon></button></div><div class="livechat-converse-muc-app-body">${i}</div>`}function TD(e,t,s){if(!t)return Ag``;if(!e.show)return Ag``;const n=kw("Message search"),i=kw("Online help");return kD(e,n,CD({page:"documentation/user/streamers/moderation"}),i,function(e,t,s){return Ag`${s?Ag`<livechat-converse-muc-mam-search-occupant .model="${s}"></livechat-converse-muc-mam-search-occupant>`:""}<hr>${e.results?hj(e.results,(e=>e.id),(e=>Ag`<livechat-converse-muc-mam-search-message .message="${e}" .mucModel="${t}" .searchOccupantModel="${s}"></livechat-converse-muc-mam-search-message>`)):Ag`<livechat-spinner></livechat-spinner>`}`}(e,t,s))}Oh.elements.define("livechat-converse-muc-mam-search-app",class extends ED{restoreSettingName=void 0;sessionStorageRestoreKey=void 0;static get properties(){return{model:{type:Object,attribute:!0},occupant:{type:Object,attribute:!0},results:{type:Object,attribute:!0}}}render(){return TD(this,this.model,this.occupant)}searchFrom(e){this.results=void 0,this.occupant=e;Oh.livechat_mam_search.query({room:this.model.get("jid"),from:e.get("from")||this.model.get("jid")+"/"+(e.get("nick")??""),occupant_id:e.get("occupant_id")}).then((async t=>{this.occupant=e;const s=await Promise.all(t.messages.map((e=>Cv(e,this.model))));this.results=s.reverse()}))}});var jD=s(2472),ND={};ND.styleTagTransform=T(),ND.setAttributes=E(),ND.insert=S().bind(null,"head"),ND.domAPI=w(),ND.insertStyleElement=C();b()(jD.A,ND);jD.A&&jD.A.locals&&jD.A.locals;Oh.elements.define("livechat-converse-muc-mam-search-occupant",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},message:{type:Object,attribute:!0}}}async initialize(){this.listenTo(this.model,"change",(()=>this.requestUpdate()))}render(){return function(e,t,s){const n=mO(t),i=t.get("jid"),r=t.get("occupant_id");return Ag`<a @click="${e=>{Oh.modal.show("converse-muc-occupant-modal",{model:t},e)}}"><converse-avatar .model="${t}" class="avatar chat-msg__avatar" name="${t.getDisplayName()}" nonce="${t.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><span style="${n}">${t.getDisplayName()}</span></a><ul aria-hidden="true">${s&&void 0!==s.nick&&s.nick!==t.get("nick")?Ag`<li title="${kw("Nickname of the participant when the message was sent")}">${s.nick}</li>`:""} ${i?Ag`<li title="${kw("XMPP Address")}">${i}</li>`:""} ${r?Ag`<li title="${kw("Occupant Id")}">${r}</li>`:""}</ul>`}(0,this.model,this.message)}});var OD=s(1390),ID={};ID.styleTagTransform=T(),ID.setAttributes=E(),ID.insert=S().bind(null,"head"),ID.domAPI=w(),ID.insertStyleElement=C();b()(OD.A,ID);OD.A&&OD.A.locals&&OD.A.locals;Oh.elements.define("livechat-converse-muc-mam-search-message",class extends Nw{static get properties(){return{message:{type:Object,attribute:!0},mucModel:{type:Object,attribute:!0},searchOccupantModel:{type:Object,attribute:!0}}}async initialize(){this.listenTo(this.mucModel,"change",(()=>this.requestUpdate())),this.listenTo(this.searchOccupantModel,"change",(()=>this.requestUpdate()))}render(){return function(e,t,s,n){const i=e.getMessageOccupant();return Ag`${i?Ag`<livechat-converse-muc-mam-search-occupant .model="${i}" .message="${n}"></livechat-converse-muc-mam-search-occupant>`:""}<converse-rich-text render_styling text="${n.body}"></converse-rich-text><div class="livechat-message-date">${e.getDateTime()}</div>`}(this,this.mucModel,this.searchOccupantModel,this.message)}getMessageOccupant(){const e=this.mucModel?.occupants;if(!e?.findOccupant)return;const t=this.message.nick,s=this.message.from,n=this.message.occupant_id;if(!t&&!s&&!n)return;if(n){const t=e.findOccupant({occupant_id:n});if(t)return t}if(s){const n=e.findOccupant({jid:s,nick:t});if(n)return n}return e.create({nick:t,occupant_id:n,jid:s})}getDateTime(){if(this.message.time)try{const e=new Date(this.message.time);return e.toLocaleDateString()+" - "+e.toLocaleTimeString()}catch(e){return void console.log(e)}}}),qg.plugins.add("livechat-converse-mam-search",{dependencies:["converse-muc","converse-muc-views"],async initialize(){const e=this._converse;Object.assign(Oh,{livechat_mam_search:AD}),e.api.settings.extend({livechat_mam_search_app_enabled:!1}),e.api.listen.on("getMessageActionButtons",uD),e.api.listen.on("getOccupantActionButtons",hD)}});const MD="urn:peertube-plugin-livechat:note";class RD extends cd{idAttribute="id";_aboutOccupantCache=null;_aboutOccupantCacheFor=null;async saveItem(){console.log("Saving note "+this.get("id")+"..."),await this.collection.chatroom.noteManager.saveItem(this),console.log("Note "+this.get("id")+" saved.")}async deleteItem(){return this.collection.chatroom.noteManager.deleteItems([this])}getAboutOccupant(){const e=this.collection.chatroom?.occupants;if(!e?.findOccupant)return;const t=this.get("about_nick"),s=this.get("about_jid"),n=this.get("about_occupant_id");if(!t&&!s&&!n)return this._aboutOccupantCache=null,void(this._aboutOccupantCacheFor=null);const i=`${n??""} ${s??""} ${t??""}`;if(this._aboutOccupantCacheFor===i&&this._aboutOccupantCache)return this._aboutOccupantCache;if(this._aboutOccupantCacheFor=i,n){const t=e.findOccupant({occupant_id:n});if(t)return this._aboutOccupantCache=t,t}if(s){const n=e.findOccupant({jid:s,nick:t});if(n)return this._aboutOccupantCache=n,n}return this._aboutOccupantCache=e.create({nick:t,occupant_id:n,jid:s}),this._aboutOccupantCache}}class DD extends Od{model=RD;initialize(e,t){this.model=RD,super.initialize(arguments),this.chatroom=t.chatroom;Hu(this,`converse-livechat-notes-${this.chatroom.get("jid")}`,"session"),this.on("change:order",(()=>this.sort()))}comparator(e,t){const s=e.get("order")??0,n=t.get("order")??0;return s<n?1:s>n?-1:0}async createNote(e){(e=Object.assign({},e)).order||(e.order=1+Math.max(0,...this.map((e=>e.get("order")??0)).filter((e=>!isNaN(e))))),console.log("Creating note..."),await this.chatroom.noteManager.createItem(this,e),console.log("Note created.")}}const{$build:LD,Strophe:zD,$iq:PD,sizzle:FD}=qg.env;class UD{roomJID;node;types;stanzaHandler;constructor(e,t,s){this.roomJID=e,this.node=t,this.types=s,this.stanzaHandler=void 0}async start(){this.stanzaHandler=Oh.connection.get().addHandler((e=>{try{this._handleMessage(e)}catch(e){console.log(e)}return!0}),null,"message","headline",null,this.roomJID,{matchBareFromJid:!0}),await this._subscribe(),await this._retrieveAllItems()}async stop(){this.stanzaHandler&&(Oh.connection.get().deleteHandler(this.stanzaHandler),this.stanzaHandler=void 0)}async createItem(e,t){const s=this._typeFromCollection(e);if(!s)throw new Error("Collection not found in manager");console.log("Creating item..."),await this._save(s,t),console.log(`Node ${this.node} created on ${this.roomJID}.`)}async saveItem(e){const t=e.get("id");if(!t)throw new Error("Can't delete an empty without ID");const s=this._typeFromCollection(e.collection);if(!s)throw new Error("Collection not found in manager");const n={};for(const t in s.attributes??[]){const i=e.get(t);void 0!==i&&((s.attributes[t]!==Boolean||i)&&(n[t]=i))}for(const t in s.fields??[]){const s=e.get(t);void 0!==s&&(n[t]=s)}this._additionalModelToData(e,n),console.log("Saving item..."),await this._save(s,n,t),console.log(`Node ${this.node} created on ${this.roomJID}.`)}async deleteItems(e){await Promise.all[e.map((e=>this.deleteItem(e)))]}async deleteItem(e){const t=e.get("id");if(!t)throw new Error("Can't delete an empty without ID");if(!this._typeFromCollection(e.collection))throw new Error("Can't get type definition from item collection");console.log("Deleting item "+t+" on node "+this.node+" for room "+this.roomJID+"...");const s=PD({from:Iu.bare_jid,type:"set",to:this.roomJID}).c("pubsub",{xmlns:zD.NS.PUBSUB}).c("retract",{node:this.node,notify:"1"}).c("item",{id:t});await Oh.sendIQ(s),console.log("Item deleted.")}async _save(e,t,s){const n={};s&&(n.id=s);const i={xmlns:e.xmlns};for(const s in e.attributes??[])s in t&&(i[s]=t[s]);const r=LD("item",n).c(e.itemTag,i);for(const s in e.fields??[])s in t&&r.c(s).t(t[s]).up();this._additionalDataToItemNode(t,r),await Oh.pubsub.publish(this.roomJID,this.node,r)}async _subscribe(){const e=PD({type:"set",from:Iu.jid,to:this.roomJID}).c("pubsub",{xmlns:zD.NS.PUBSUB}).c("subscribe",{node:this.node,jid:Iu.bare_jid});try{const t=await Oh.sendIQ(e);console.debug("subscribtion ok: ",t)}catch(e){throw console.error("Failed to subscribe to "+this.node,e),e}}async _retrieveAllItems(){const e=PD({type:"get",from:Iu.jid,to:this.roomJID}).c("pubsub",{xmlns:zD.NS.PUBSUB}).c("items",{node:this.node});try{const t=await Oh.sendIQ(e);this._handleIQ(t)}catch(e){if(null===e||!e?.querySelector)throw console.error("Failed to retrieve objects from "+this.node,e),e;if(!e.querySelector('error[type="cancel"] item-not-found'))throw console.error("Failed to retrieve objects from "+this.node+":",e),e;console.log("Not "+this.node+" node for now")}}_handleMessage(e){const t=FD(`event[xmlns="${zD.NS.PUBSUB}#event"] items[node="${this.node}"]`,e);if(t.length)for(const e of t)this._dispatchStanza(e)}_handleIQ(e){const t=FD(`pubsub items[node="${this.node}"]`,e);if(t.length)for(const e of t)this._dispatchStanza(e)}_dispatchStanza(e){console.debug("Dispatching items for node "+this.node+" from stanza items: ",e);for(const t in this.types){const s=this.types[t],n=`item ${s.itemTag}[xmlns="${s.xmlns}"]`,i=FD(n,e);if(i.length){console.log("Found "+i.length+" "+s.itemTag+" in stanza, dispatching...");for(const e of i){const t=e.parentNode?.getAttribute("id");if(!t){console.error("Missing id for this item",e);continue}const n=this._parseItem(e,s);if(null===n)continue;const i=s.collection.get(t);i?i.save(n):s.collection.create(Object.assign(n,{id:t}))}}}this._handleRetractations(e)}_handleRetractations(e){const t=FD("retract",e).map((e=>e.getAttribute("id")));for(const e of t)for(const t in this.types){const s=this.types[t],n=s.collection.get(e);n&&(console.log("Removing Item "+e+" that was found in collection "+t),s.collection.remove(n))}}_parseItem(e,t){const s={};if(t.fields)for(const n of e.children??[]){const e=n.tagName;e in t.fields&&(s[e]=this._readValue(n.textContent,t.fields[e]))}if(t.attributes)for(const n in t.attributes){const i=e.getAttribute(n);void 0!==n&&(s[n]=this._readValue(i,t.attributes[n]))}return this._additionalParseItemNode(e,t,s),s}_readValue(e,t){switch(t){case String:return(e??"").toString();case Number:return parseInt(e);case Boolean:return!!e;default:return e}}_typeFromCollection(e){return Object.values(this.types).find((t=>t.collection===e))}_additionalModelToData(e,t){}_additionalDataToItemNode(e,t){}_additionalParseItemNode(e,t,s){}}class BD extends UD{_additionalModelToData(e,t){super._additionalModelToData(e,t),t.about_jid=e.get("about_jid"),t.about_occupant_id=e.get("about_occupant_id"),t.about_nick=e.get("about_nick")}_additionalDataToItemNode(e,t){super._additionalDataToItemNode(e,t);const s={};void 0!==e.about_jid&&(s.jid=e.about_jid),void 0!==e.about_nick&&(s.nick=e.about_nick);const n=e.about_occupant_id;(void 0!==n||Object.values(s).length)&&(t.c("note-about",s),n&&t.c("occupant-id",{xmlns:"urn:xmpp:occupant-id:0",id:n}).up(),t.up())}_additionalParseItemNode(e,t,s){super._additionalParseItemNode(e,t,s);const n=e.querySelector("& > note-about");if(!n)return;s.about_jid=n.getAttribute("jid"),s.about_nick=n.getAttribute("nick");const i=n.querySelector("& > occupant-id");i&&(s.about_occupant_id=i.getAttribute("id"))}}function qD(e,t){const s=e.model;return s.get("type")!==Iu.constants.CHATROOMS_TYPE?t:s.notes?(t.unshift({i18n_text:kw("Moderation notes"),handler:async e=>{e.preventDefault();e.target.closest("converse-root").querySelector("livechat-converse-muc-note-app").toggleApp()},a_class:"",icon_class:"fa-note-sticky",name:"muc-notes"}),t):t}function HD(e,t){const s=e.model;if("groupchat"!==s.get("type"))return t;if(!s.occupant)return t;const n=s.collection?.chatbox;if(!n?.notes)return t;const i=kw("Create a new note"),r=kw("Search notes");return t.push({i18n_text:i,handler:async e=>{e.preventDefault(),await Oh.livechat_notes.openCreateNoteForm(s.occupant)},button_class:"",icon_class:"fa fa-note-sticky",name:"muc-note-create-for-occupant"}),t.push({i18n_text:r,handler:async e=>{e.preventDefault(),await Oh.livechat_notes.searchNotesAbout(s.occupant)},button_class:"",icon_class:"fa fa-magnifying-glass",name:"muc-note-search-for-occupant"}),t}function GD(e,t){const s=e.collection?.chatroom;if(!s?.notes)return t;const n=kw("Create a new note"),i=kw("Search notes");return t.push({i18n_text:n,handler:async t=>{t.preventDefault(),await Oh.livechat_notes.openCreateNoteForm(e)},button_class:"",icon_class:"fa fa-note-sticky",name:"muc-note-create-for-occupant"}),t.push({i18n_text:i,handler:async t=>{t.preventDefault(),await Oh.livechat_notes.searchNotesAbout(e)},button_class:"",icon_class:"fa fa-magnifying-glass",name:"muc-note-search-for-occupant"}),t}function WD(e){e.noteManager&&(e.noteManager.stop().catch((e=>console.log(e))),e.noteManager=void 0,e.notes=void 0,document.querySelectorAll("converse-message-actions").forEach((e=>e.requestUpdate())))}function VD(e){if(e.get("type")!==Iu.constants.CHATROOMS_TYPE)return WD(e);if(!Oh.settings.get("livechat_note_app_enabled"))return WD(e);if(e.session.get("connection_status")!==qg.ROOMSTATUS.ENTERED)return WD(e);if(!e.features?.get?.(MD))return WD(e);const t=e.getOwnOccupant();return t&&["admin","owner"].includes(t.get("affiliation"))?function(e){e.noteManager||(e.notes=new Iu.exports.ChatRoomNotes(void 0,{chatroom:e}),e.noteManager=new BD(e.get("jid"),"livechat-notes",{note:{itemTag:"note",xmlns:MD,collection:e.notes,fields:{description:String},attributes:{order:Number}}}),e.noteManager.start().catch((e=>console.log(e))),document.querySelectorAll("converse-message-actions").forEach((e=>e.requestUpdate())))}(e):WD(e)}async function QD(){const e=document.querySelector("livechat-converse-muc-note-app");if(!e)throw new Error("Cant find Note App Element");await e.showApp(),await e.updateComplete;const t=e.querySelector("livechat-converse-muc-notes");if(!t)throw new Error("Cant find Notes Element");return await t.updateComplete,t}const JD={openNotes:QD,openCreateNoteForm:async function(e){const t=await QD();await t.openCreateNoteForm(void 0,e)},searchNotesAbout:async function(e){const t=await QD();await t.filterNotes({occupant:e})}};function YD(e){const t=kw("Description");return Ag`<fieldset><textarea class="form-control" name="description" placeholder="${t}">${e?e.get("description"):""}</textarea></fieldset>`}function XD(e,t){const s=kw("Ok"),n=kw("Cancel");return Ag`<form class="notes-create-note converse-form" @submit="${e.submitCreateNote}">${t?Ag`${function(e){return e?Ag`<input type="hidden" name="about_nick" value="${e.get("nick")}"> <input type="hidden" name="about_jid" value="${e.get("jid")}"> <input type="hidden" name="about_occupant_id" value="${e.get("occupant_id")}">`:""}(t)}<livechat-converse-muc-note-occupant full_display="${!0}" .model="${t}"></livechat-converse-muc-note-occupant>`:""} ${YD(void 0)}<fieldset><input type="submit" class="btn btn-primary" value="${s}"> <input type="button" class="btn btn-secondary button-cancel" value="${n}" @click="${e.closeCreateNoteForm}"> ${e.create_note_error_message?Ag`<div class="invalid-feedback d-block">${e.create_note_error_message}</div>`:""}</fieldset></form>`}function KD(e,t){return t?Ag`${e.create_note_opened?XD(e,e.create_note_about_occupant):function(e){const t=kw("Create a new note");return Ag`<div class="notes-actions"><button type="button" class="notes-action" title="${t}" @click="${e.openCreateNoteForm}"><converse-icon class="fa fa-plus" size="1em"></converse-icon></button></div>`}(e)} ${function(e){const t=e.occupant_filter;if(!t)return"";const s=kw("Search filters");return Ag`<div class="notes-filters"><converse-icon class="fa fa-magnifying-glass" size="1em" title="${s}"></converse-icon>${t?Ag`<livechat-converse-muc-note-occupant full_display="${!0}" .model="${t}"></livechat-converse-muc-note-occupant>`:""} <button type="button" class="notes-action" @click="${t=>{t?.preventDefault(),e.filterNotes({})}}" title="${kw("Close")}"><converse-icon class="fa fa-times" size="1em"></converse-icon></button></div><hr>`}(e)} ${hj(t,(e=>e.get("id")),(t=>function(e,t){const s=e.occupant_filter;if(!s)return!1;const n=t.getAboutOccupant();return!n||n!==s&&(!s.get("nick")||s.get("nick")!==n.get("nick"))}(e,t)?"":Ag`<livechat-converse-muc-note .model="${t}" .is_ocupant_filter="${!!e.occupant_filter}"></livechat-converse-muc-note>`))}`:Ag``}Oh.elements.define("livechat-converse-muc-note-app",class extends ED{restoreSettingName="livechat_note_app_restore";sessionStorageRestoreKey="livechat-converse-note-app-show";render(){return function(e,t){if(!t)return Ag``;if(!t.notes)return Ag``;if(!e.show)return Ag``;const s=kw("Moderation notes"),n=kw("Online help");return kD(e,s,CD({page:"documentation/user/streamers/moderation_notes"}),n,Ag`<livechat-converse-muc-notes .model="${t.notes}"></livechat-converse-muc-notes>`)}(this,this.model)}});var ZD=s(4768),eL={};eL.styleTagTransform=T(),eL.setAttributes=E(),eL.insert=S().bind(null,"head"),eL.domAPI=w(),eL.insertStyleElement=C();b()(ZD.A,eL);ZD.A&&ZD.A.locals&&ZD.A.locals;class tL extends Nw{currentDragged=null;draggableTagName="invalid-tag-name";droppableTagNames=[];droppableAlwaysBottomTagNames=[];initialize(){return this._handleDragStartBinded=this._handleDragStart.bind(this),this._handleDragOverBinded=this._handleDragOver.bind(this),this._handleDragLeaveBinded=this._handleDragLeave.bind(this),this._handleDragEndBinded=this._handleDragEnd.bind(this),this._handleDropBinded=this._handleDrop.bind(this),super.initialize()}connectedCallback(){super.connectedCallback(),this.currentDragged=null,this.addEventListener("dragstart",this._handleDragStartBinded),this.addEventListener("dragover",this._handleDragOverBinded),this.addEventListener("dragleave",this._handleDragLeaveBinded),this.addEventListener("dragend",this._handleDragEndBinded),this.addEventListener("drop",this._handleDropBinded)}disconnectedCallback(){super.disconnectedCallback(),this.currentDragged=null,this.removeEventListener("dragstart",this._handleDragStartBinded),this.removeEventListener("dragover",this._handleDragOverBinded),this.removeEventListener("dragleave",this._handleDragLeaveBinded),this.removeEventListener("dragend",this._handleDragEndBinded),this.removeEventListener("drop",this._handleDropBinded)}_isADraggableEl(e){return e.nodeName?.toLowerCase()===this.draggableTagName}_getParentDroppableEl(e){return e.closest?.(this.droppableTagNames.join(","))}_isOnTopHalf(e,t){const s=e.clientY,n=t.getBoundingClientRect();return s<=n.y+n.height/2}_resetDropOver(){document.querySelectorAll(".livechat-drag-bottom-half, .livechat-drag-top-half").forEach((e=>e.classList.remove("livechat-drag-bottom-half","livechat-drag-top-half")))}_handleDragStart(e){const t=e.target.parentElement;this._isADraggableEl(t)&&(console.log("[livechat drag&drop] Starting to drag a "+this.draggableTagName+"..."),this.currentDragged=t,this._resetDropOver())}_handleDragOver(e){if(!this.currentDragged)return;const t=this._getParentDroppableEl(e.target);if(!t)return;e.preventDefault();let s=!1;this.droppableAlwaysBottomTagNames.includes(t.nodeName.toLowerCase())||(s=this._isOnTopHalf(e,t)),t.classList.add(s?"livechat-drag-top-half":"livechat-drag-bottom-half"),t.classList.remove(s?"livechat-drag-bottom-half":"livechat-drag-top-half")}_handleDragLeave(e){if(!this.currentDragged)return;const t=this._getParentDroppableEl(e.target);t&&t.classList.remove("livechat-drag-bottom-half","livechat-drag-top-half")}_handleDragEnd(e){this.currentDragged=null,this._resetDropOver()}_handleDrop(e){if(!this.currentDragged)return;let t=document.querySelector(".livechat-drag-bottom-half, .livechat-drag-top-half");if(t=this._getParentDroppableEl(t),t){console.log("[livechat drag&drop] "+this.draggableTagName+" dropped...");try{this._dropDone(this.currentDragged,t,t.classList.contains("livechat-drag-top-half"))}catch(e){console.error(e)}this._resetDropOver()}}_dropDone(e,t,s){console.debug("[livechat drag&drop] Drop done:",e,t,s)}_saveOrders(e,t,s){if("number"!=typeof s||isNaN(s))return void console.error("[livechat drag&drop] Computed new order is not a number, aborting.");console.log("[livechat drag&drop] Reordering models... Model new order will be "+s);let n=s+1;for(const i of e){if(i===t){console.log("[livechat drag&drop] Skipping the currently moved model");continue}let e=i.get("order")??0;if(("number"!=typeof e||isNaN(e))&&(console.error("[livechat drag&drop] Found a model with an invalid order, fixing it."),e=n),!(e<s)){if(n++,e>n){console.log(`Object "${i.get("id")}" as already on order greater than ${n.toString()}, stoping.`);break}console.log(`Changing order of model "${i.get("id")}" to ${n}`),i.set("order",n),i.saveItem()}}console.log("[livechat drag&drop] Setting new order on the moved model"),t.set("order",s),t.saveItem()}}var sL=s(7930),nL={};nL.styleTagTransform=T(),nL.setAttributes=E(),nL.insert=S().bind(null,"head"),nL.domAPI=w(),nL.insertStyleElement=C();b()(sL.A,nL);sL.A&&sL.A.locals&&sL.A.locals;Oh.elements.define("livechat-converse-muc-notes",class extends tL{static get properties(){return{model:{type:Object,attribute:!0},create_note_error_message:{type:String,attribute:!1},create_note_opened:{type:Boolean,attribute:!1},create_note_about_occupant:{type:Object,attribute:!1},occupant_filter:{type:Object,attribute:!1}}}async initialize(){this.create_note_error_message="",this.model&&(this.draggableTagName="livechat-converse-muc-note",this.droppableTagNames=["livechat-converse-muc-note"],this.droppableAlwaysBottomTagNames=[],this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"remove",(()=>this.requestUpdate())),this.listenTo(this.model,"sort",(()=>this.requestUpdate())),await super.initialize())}render(){return KD(this,this.model)}async openCreateNoteForm(e,t){e?.preventDefault?.(),this.create_note_opened=!0,this.create_note_about_occupant=t??void 0,void 0===this.create_note_about_occupant&&this.occupant_filter&&(this.create_note_about_occupant=this.occupant_filter),await this.updateComplete;const s=this.querySelector('.notes-create-note textarea[name="description"]');s&&s.focus()}closeCreateNoteForm(e){e?.preventDefault?.(),this.create_note_opened=!1,this.create_note_about_occupant=void 0}filterNotes(e){this.occupant_filter=e?.occupant||void 0}async submitCreateNote(e){e.preventDefault();const t=e.target.description.value;if(this.create_note_error_message&&(this.create_note_error_message=""),""!==(t??""))try{this.querySelectorAll("input[type=submit]").forEach((e=>{e.setAttribute("disabled",!0),e.classList.add("disabled")})),await this.model.createNote({description:t,about_jid:e.target.about_jid?.value||void 0,about_nick:e.target.about_nick?.value||void 0,about_occupant_id:e.target.about_occupant_id?.value||void 0}),this.closeCreateNoteForm()}catch(e){console.error(e),this.create_note_error_message=kw("Error when saving the note")}finally{this.querySelectorAll("input[type=submit]").forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("disabled")}))}}_dropDone(e,t,s){super._dropDone(...arguments),console.log("[livechat note drag&drop] Note dropped...");const n=e.model;if(!n)throw new Error("No model for the draggedEl");const i=t.model;if(!i)throw new Error("No model for the droppedOnEl");if(n===i)return void console.log("[livechat note drag&drop] Note dropped on itself, nothing to do");let r=i.get("order")??0;s&&(r=Math.max(0,r+1)),this._saveOrders(Array.from(this.model).reverse(),n,r)}});var iL=s(3177),rL={};rL.styleTagTransform=T(),rL.setAttributes=E(),rL.insert=S().bind(null,"head"),rL.domAPI=w(),rL.insertStyleElement=C();b()(iL.A,rL);iL.A&&iL.A.locals&&iL.A.locals;Oh.elements.define("livechat-converse-muc-note",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},edit:{type:Boolean,attribute:!1},is_ocupant_filter:{type:Boolean,attribute:!0}}}async initialize(){this.edit=!1,this.model&&this.listenTo(this.model,"change",(()=>this.requestUpdate()))}render(){return function(e,t){const s=kw("Delete note"),n=kw("Search notes"),i=t.getAboutOccupant();return e.edit?Ag`<div class="note-line draggables-line"><form class="converse-form" @submit="${e.saveNote}">${i?Ag`<livechat-converse-muc-note-occupant full_display="${!0}" .model="${i}" .note="${t}"></livechat-converse-muc-note-occupant>`:""} ${YD(t)}<fieldset><input type="submit" class="btn btn-primary" value="${kw("Ok")}"> <input type="button" class="btn btn-secondary button-cancel" value="${kw("Cancel")}" @click="${e.toggleEdit}"></fieldset></form></div>`:Ag`<div draggable="true" class="note-line draggables-line"><div class="note-content">${i?Ag`<livechat-converse-muc-note-occupant .full_display="${e.is_ocupant_filter}" .model="${i}" .note="${t}"></livechat-converse-muc-note-occupant>`:""}<div class="note-description">${t.get("description")??""}</div></div>${i&&e.is_ocupant_filter?"":Ag`<button type="button" class="note-action" @click="${e=>{e.preventDefault(),Oh.livechat_notes.searchNotesAbout(i)}}"><converse-icon class="fa fa-magnifying-glass" size="1em" title="${n}"></converse-icon></button>`} <button type="button" class="note-action" title="${kw("Edit")}" @click="${e.toggleEdit}"><converse-icon class="fa fa-edit" size="1em"></converse-icon></button> <button type="button" class="note-action" title="${s}" @click="${e.deleteNote}"><converse-icon class="fa fa-trash-alt" size="1em"></converse-icon></button></div>`}(this,this.model)}shouldUpdate(e){return!!super.shouldUpdate(...arguments)&&(!(this.edit&&!e.has("edit"))||(console.info("Canceling an update on note, because it is currently edited",this),!1))}async saveNote(e){e?.preventDefault?.();const t=e.target.description.value;if(""!==(t??""))try{this.querySelectorAll("input[type=submit]").forEach((e=>{e.setAttribute("disabled",!0),e.classList.add("disabled")}));const e=this.model;e.set("description",t),await e.saveItem(),this.edit=!1,this.requestUpdate()}catch(e){console.error(e)}finally{this.querySelectorAll("input[type=submit]").forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("disabled")}))}}async deleteNote(e){e?.preventDefault?.();const t=kw("Are you sure you want to delete this note?");if(await Oh.confirm(t))try{await this.model.deleteItem()}catch(e){Oh.alert("error",kw("Error"),[kw("Error")])}}async toggleEdit(){if(this.edit=!this.edit,this.edit){await this.updateComplete;const e=this.querySelector('textarea[name="description"]');e&&(e.focus(),e.selectionStart=e.value.length,e.selectionEnd=e.selectionStart)}}});var oL=s(8627),aL={};aL.styleTagTransform=T(),aL.setAttributes=E(),aL.insert=S().bind(null,"head"),aL.domAPI=w(),aL.insertStyleElement=C();b()(oL.A,aL);oL.A&&oL.A.locals&&oL.A.locals;Oh.elements.define("livechat-converse-muc-note-occupant",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},note:{type:Object,attribute:!0},full_display:{type:Boolean,attribute:!0}}}async initialize(){this.listenTo(this.model,"change",(()=>this.requestUpdate()))}render(){return function(e,t,s){const n=mO(t),i=t.get("jid"),r=t.get("occupant_id");return Ag`<a @click="${e=>{Oh.modal.show("converse-muc-occupant-modal",{model:t},e)}}"><converse-avatar .model="${t}" class="avatar chat-msg__avatar" name="${t.getDisplayName()}" nonce="${t.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><span style="${n}">${t.getDisplayName()}</span> </a>${e.full_display?Ag`<ul aria-hidden="true">${s&&s.get("about_nick")&&s.get("about_nick")!==t.get("nick")?Ag`<li title="${kw("Nickname of the participant at the time of the note creation")}">${s.get("about_nick")}</li>`:""} ${i?Ag`<li title="${kw("XMPP Address")}">${i}</li>`:""} ${r?Ag`<li title="${kw("Occupant Id")}">${r}</li>`:""}</ul>`:""}`}(this,this.model,this.note)}}),qg.plugins.add("livechat-converse-notes",{dependencies:["converse-muc","converse-disco","converse-pubsub"],initialize(){Object.assign(Iu.exports,{ChatRoomNotes:DD,ChatRoomNote:RD}),Iu.api.settings.extend({livechat_note_app_enabled:!1,livechat_note_app_restore:!1}),Object.assign(Iu.api,{livechat_notes:JD}),Iu.api.listen.on("chatRoomInitialized",(e=>{e.session.on("change:connection_status",(t=>{VD(e)})),e.occupants.on("change:affiliation",(t=>{t.get("jid")===Iu.bare_jid&&VD(e)})),e.features.on("change:"+MD,(()=>{VD(e)}))})),Iu.api.listen.on("getHeadingButtons",qD),Iu.api.listen.on("getMessageActionButtons",HD),Iu.api.listen.on("getOccupantActionButtons",GD)}});class cL extends cd{idAttribute="id";getTasks(){const e=this.get("id");return this.collection?.chatroom?.tasks?.filter({list:e})??[]}async saveItem(){console.log("Saving task list "+this.get("id")+"..."),await this.collection.chatroom.taskManager.saveItem(this),console.log("Task list "+this.get("id")+" saved.")}async deleteItem(){const e=this.getTasks();return this.collection.chatroom.taskManager.deleteItems([...e,this])}async createTask(e){e=Object.assign({},e);const t=e?.name;if(!t)throw new Error("Missing name");e.list=this.get("id"),e.order||(e.order=1+Math.max(0,...this.getTasks().map((e=>e.get("order")??0)).filter((e=>!isNaN(e))))),console.log("Creating task "+t+"...");const s=this.collection.chatroom,n=s.tasks;await s.taskManager.createItem(n,e),console.log("Task list "+t+" created.")}}class lL extends Od{model=cL;initialize(e,t){this.model=cL,super.initialize(arguments),this.chatroom=t.chatroom;Hu(this,`converse-livechat-tasks-lists-${this.chatroom.get("jid")}`,"session"),this.on("change:name",(()=>this.sort()))}comparator(e,t){const s=e.get("name").toLowerCase(),n=t.get("name").toLowerCase();return s<n?-1:s>n?1:0}async createTaskList(e){const t=e?.name;if(!t)throw new Error("Missing name");console.log("Creating task list "+t+"..."),await this.chatroom.taskManager.createItem(this,{name:t}),console.log("Task list "+t+" created.")}}class dL extends cd{idAttribute="id";async saveItem(){console.log("Saving task "+this.get("id")+"..."),await this.collection.chatroom.taskManager.saveItem(this),console.log("Task "+this.get("id")+" saved.")}async deleteItem(){return this.collection.chatroom.taskManager.deleteItem(this)}}class uL extends Od{model=dL;comparator="order";initialize(e,t){this.model=dL,super.initialize(arguments),this.chatroom=t.chatroom;Hu(this,`converse-livechat-tasks-${this.chatroom.get("jid")}`,"session"),this.on("change:order",(()=>this.sort()))}}const hL="urn:peertube-plugin-livechat:tasklist",mL="urn:peertube-plugin-livechat:task";function fL(e,t){const s=e.model;return s.get("type")!==Iu.constants.CHATROOMS_TYPE?t:s.tasklists?(t.unshift({i18n_text:kw("Tasks"),handler:async e=>{e.preventDefault();e.target.closest("converse-root").querySelector("livechat-converse-muc-task-app").toggleApp()},a_class:"",icon_class:"fa-list-check",name:"muc-tasks"}),t):t}function gL(e,t){const s=e.model;if("groupchat"!==s.get("type"))return t;const n=s.collection?.chatbox;if(!n?.tasklists)return t;const i=kw("Create a new task");return t.push({i18n_text:i,handler:async e=>{e.preventDefault(),Oh.modal.show("livechat-converse-pick-task-list-modal",{muc:n,message:s},e)},button_class:"",icon_class:"fa fa-list-check",name:"muc-task-create-from-message"}),t}function pL(e){e.taskManager&&(e.taskManager.stop().catch((e=>console.log(e))),e.taskManager=void 0,e.tasklists=void 0,e.tasks=void 0,document.querySelectorAll("converse-message-actions").forEach((e=>e.requestUpdate())))}function vL(e){if(e.get("type")!==Iu.constants.CHATROOMS_TYPE)return pL(e);if(!Oh.settings.get("livechat_task_app_enabled"))return pL(e);if(e.session.get("connection_status")!==qg.ROOMSTATUS.ENTERED)return pL(e);if(!e.features?.get?.(hL)||!e.features?.get?.(mL))return pL(e);const t=e.getOwnOccupant();return t&&["admin","owner"].includes(t.get("affiliation"))?function(e){e.taskManager||(e.tasklists=new Iu.exports.ChatRoomTaskLists(void 0,{chatroom:e}),e.tasks=new Iu.exports.ChatRoomTasks(void 0,{chatroom:e}),e.taskManager=new UD(e.get("jid"),"livechat-tasks",{tasklist:{itemTag:"tasklist",xmlns:hL,collection:e.tasklists,fields:{name:String}},task:{itemTag:"task",xmlns:mL,collection:e.tasks,fields:{name:String,description:String},attributes:{done:Boolean,list:String,order:Number}}}),e.taskManager.start().catch((e=>console.log(e))),document.querySelectorAll("converse-message-actions").forEach((e=>e.requestUpdate())))}(e):pL(e)}function _L(e){const t=kw("Task name"),s=kw("Description");return Ag`<fieldset><input type="text" name="name" class="form-control" value="${e?e.get("name"):""}" placeholder="${t}"> <textarea class="form-control" name="description" placeholder="${s}">${e?e.get("description"):""}</textarea></fieldset>`}var bL=s(2156),yL={};yL.styleTagTransform=T(),yL.setAttributes=E(),yL.insert=S().bind(null,"head"),yL.domAPI=w(),yL.insertStyleElement=C();b()(bL.A,yL);bL.A&&bL.A.locals&&bL.A.locals;function wL(e,t){const s=t.getTasks(),n=kw("Delete task list"),i=kw("Create a new task"),r=kw("Task list name");return Ag`<div class="task-list-line draggables-line">${e.collapsed?Ag`<button type="button" @click="${e.toggleTasks}" class="task-list-toggle-tasks"><converse-icon color="var(--muc-toolbar-btn-color)" class="fa fa-angle-right" size="1em"></converse-icon></button>`:Ag`<button type="button" @click="${e.toggleTasks}" class="task-list-toggle-tasks"><converse-icon color="var(--muc-toolbar-btn-color)" class="fa fa-angle-down" size="1em"></converse-icon></button>`} ${e.edit?Ag`<div class="task-list-name"><form @submit="${e.saveTaskList}" class="converse-form"><input type="text" name="name" placeholder="${kw(r)}" class="form-control" value="${t.get("name")}"> <input type="submit" class="btn btn-primary" value="${kw("Ok")}"> <input type="button" class="btn btn-secondary button-cancel" value="${kw("Cancel")}" @click="${e.toggleEdit}"></form></div>`:Ag`<div class="task-list-name"><a @click="${e.toggleTasks}"><label>${t.get("name")}</label></a></div><button type="button" class="task-list-action" title="${i}" @click="${e.openAddTaskForm}"><converse-icon class="fa fa-plus" size="1em"></converse-icon></button> <button type="button" class="task-list-action" title="${kw("Edit")}" @click="${e.toggleEdit}"><converse-icon class="fa fa-edit" size="1em"></converse-icon></button> <button type="button" class="task-list-action" title="${n}" @click="${e.deleteTaskList}"><converse-icon class="fa fa-trash-alt" size="1em"></converse-icon></button>`}</div><div class="task-list-tasks">${e.collapsed?"":hj(s,(e=>e.get("id")),(e=>Ag`<livechat-converse-muc-task .model="${e}"></livechat-converse-muc-task>`))}</div>${e.add_task_form_opened?function(e,t){const s=kw("Ok"),n=kw("Cancel");return Ag`<form class="task-list-add-task converse-form" @submit="${e.submitAddTask}">${_L(void 0)}<fieldset><input type="submit" class="btn btn-primary" value="${s}"> <input type="button" class="btn btn-secondary button-cancel" value="${n}" @click="${e.closeAddTaskForm}"></fieldset></form>`}(e):""}`}Oh.elements.define("livechat-converse-muc-task",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},edit:{type:Boolean,attribute:!1}}}async initialize(){this.edit=!1,this.model&&this.listenTo(this.model,"change",(()=>this.requestUpdate()))}render(){return function(e,t){const s=t.get("done"),n=kw("Delete task"),i="livechat-task-done-id-"+t.get("id");return e.edit?Ag`<div class="task-line draggables-line"><form class="converse-form" @submit="${e.saveTask}">${_L(t)}<fieldset><input type="submit" class="btn btn-primary" value="${kw("Ok")}"> <input type="button" class="btn btn-secondary button-cancel" value="${kw("Cancel")}" @click="${e.toggleEdit}"></fieldset></form></div>`:Ag`<div draggable="true" class="task-line draggables-line" ?task-is-done="${s}"><div class="form-check"><input id="${i}" type="checkbox" class="form-check-input" .checked="${!0===s}" @click="${e=>{e?.preventDefault(),t.set("done",!s),t.saveItem()}}"> <label class="form-check-label task-name" for="${i}">${t.get("name")}</label></div><div class="task-description">${t.get("description")??""}</div><button type="button" class="task-action" title="${kw("Edit")}" @click="${e.toggleEdit}"><converse-icon class="fa fa-edit" size="1em"></converse-icon></button> <button type="button" class="task-action" title="${n}" @click="${e.deleteTask}"><converse-icon class="fa fa-trash-alt" size="1em"></converse-icon></button></div>`}(this,this.model)}shouldUpdate(e){return!!super.shouldUpdate(...arguments)&&(!(this.edit&&!e.has("edit"))||(console.info("Canceling an update on task, because it is currently edited",this),!1))}async saveTask(e){e?.preventDefault?.();const t=e.target.name.value.trim();if(""!==(t??""))try{this.querySelectorAll("input[type=submit]").forEach((e=>{e.setAttribute("disabled",!0),e.classList.add("disabled")}));const s=this.model;s.set("name",t),s.set("description",e.target.description.value.trim()),await s.saveItem(),this.edit=!1,this.requestUpdate()}catch(e){console.error(e)}finally{this.querySelectorAll("input[type=submit]").forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("disabled")}))}}async deleteTask(e){e?.preventDefault?.();const t=kw("Are you sure you want to delete this task?");if(await Oh.confirm(t))try{await this.model.deleteItem()}catch(e){Oh.alert("error",kw("Error"),[kw("Error")])}}async toggleEdit(){if(this.edit=!this.edit,this.edit){await this.updateComplete;const e=this.querySelector('.task-name input[name="name"]');e&&(e.focus(),e.selectionStart=e.value.length,e.selectionEnd=e.selectionStart)}}});Oh.elements.define("livechat-converse-muc-task-list",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},collapsed:{type:Boolean,attribute:!1},edit:{type:Boolean,attribute:!1},add_task_form_opened:{type:Boolean,attribute:!1}}}async initialize(){this.collapsed=!1,this.edit=!1,this.add_task_form_opened=!1,this.model&&(this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.collection.chatroom.tasks,"add",(()=>this.requestUpdate())),this.listenTo(this.model.collection.chatroom.tasks,"remove",(()=>this.requestUpdate())),this.listenTo(this.model.collection.chatroom.tasks,"sort",(()=>this.requestUpdate())),this.listenTo(this.model.collection.chatroom.tasks,"change:list",(()=>this.requestUpdate())))}render(){return wL(this,this.model)}async saveTaskList(e){e?.preventDefault?.();const t=e.target.name.value.trim();if(""!==(t??""))try{this.querySelectorAll("input[type=submit]").forEach((e=>{e.setAttribute("disabled",!0),e.classList.add("disabled")}));const e=this.model;e.set("name",t),await e.saveItem(),this.edit=!1}catch(e){console.error(e)}finally{this.querySelectorAll("input[type=submit]").forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("disabled")}))}}async deleteTaskList(e){e?.preventDefault?.();const t=kw("Are you sure you want to delete this task list?");if(await Oh.confirm(t))try{await this.model.deleteItem()}catch(e){Oh.alert("error",kw("Error"),[kw("Error")])}}toggleTasks(){this.collapsed=!this.collapsed}async toggleEdit(){if(this.edit=!this.edit,this.edit){await this.updateComplete;const e=this.querySelector('.task-list-name input[name="name"]');e&&(e.focus(),e.selectionStart=e.value.length,e.selectionEnd=e.selectionStart)}}async openAddTaskForm(){this.add_task_form_opened=!0,await this.updateComplete;const e=this.querySelector('.task-list-add-task input[name="name"]');e&&e.focus()}closeAddTaskForm(){this.add_task_form_opened=!1}async submitAddTask(e){e.preventDefault();const t=e.target.name.value.trim();if(""!==(t??""))try{this.querySelectorAll("input[type=submit]").forEach((e=>{e.setAttribute("disabled",!0),e.classList.add("disabled")})),await this.model.createTask({name:t,description:e.target.description.value.trim()}),this.closeAddTaskForm(),this.collapsed&&(this.collapsed=!1)}catch(e){console.error(e)}finally{this.querySelectorAll("input[type=submit]").forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("disabled")}))}}});var AL=s(6935),SL={};SL.styleTagTransform=T(),SL.setAttributes=E(),SL.insert=S().bind(null,"head"),SL.domAPI=w(),SL.insertStyleElement=C();b()(AL.A,SL);AL.A&&AL.A.locals&&AL.A.locals;Oh.elements.define("livechat-converse-muc-task-lists",class extends tL{static get properties(){return{model:{type:Object,attribute:!0},create_tasklist_error_message:{type:String,attribute:!1}}}async initialize(){if(this.create_tasklist_error_message="",this.model)return this.draggableTagName="livechat-converse-muc-task",this.droppableTagNames=["livechat-converse-muc-task","livechat-converse-muc-task-list"],this.droppableAlwaysBottomTagNames=["livechat-converse-muc-task-list"],this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"remove",(()=>this.requestUpdate())),this.listenTo(this.model,"sort",(()=>this.requestUpdate())),super.initialize()}render(){return function(e,t){if(!t)return Ag``;const s=kw("Add"),n=kw("Create new task list:"),i=kw("Task list name");return Ag`${hj(t,(e=>e.get("id")),(e=>Ag`<livechat-converse-muc-task-list .model="${e}"></livechat-converse-muc-task-list>`))}<form class="converse-form" @submit="${e.submitCreateTaskList}"><fieldset><label>${n} <input type="text" class="form-control" name="name" placeholder="${i}"></label> <input type="submit" value="${s}" class="btn btn-primary"> ${e.create_tasklist_error_message?Ag`<div class="invalid-feedback d-block">${e.create_tasklist_error_message}</div>`:""}</fieldset></form>`}(this,this.model)}async submitCreateTaskList(e){e.preventDefault();const t=e.target.name.value.trim();if(this.create_tasklist_error_message&&(this.create_tasklist_error_message=""),""!==(t??""))try{this.querySelectorAll("input[type=submit]").forEach((e=>{e.setAttribute("disabled",!0),e.classList.add("disabled")})),await this.model.createTaskList({name:t}),this.querySelector("input[name=name]").value=""}catch(e){console.error(e),this.create_tasklist_error_message=kw("Error when saving the task list")}finally{this.querySelectorAll("input[type=submit]").forEach((e=>{e.removeAttribute("disabled"),e.classList.remove("disabled")}))}}isATaskEl(e){return"livechat-converse-muc-task"===e.nodeName?.toLowerCase()}isATaskListEl(e){return"livechat-converse-muc-task-list"===e.nodeName?.toLowerCase()}_dropDone(e,t,s){super._dropDone(...arguments),console.log("[livechat task drag&drop] Task dropped...");const n=e.model;let i,r;if(this.isATaskListEl(t)){if(i=0,r=t.model,n.get("list")!==r.get("id"))console.log("[livechat task drag&drop] Changing task list..."),n.set("list",r.get("id"));else if(n.get("order")===i)return void console.log("[livechat task drag&drop] Task dropped on tasklist, but already first item, nothing to do")}else{if(!this.isATaskEl(t))return void console.error("[livechat task drag&drop] Dropped on something that is not valid, aborting");{const e=t.model;if(n===e)return void console.log("[livechat task drag&drop] Task dropped on itself, nothing to do");n.get("list")!==e.get("list")&&(console.log("[livechat task drag&drop] Changing task list..."),n.set("list",e.get("list"))),i=e.get("order")??0,s||(i=Math.max(0,i+1)),("number"!=typeof i||isNaN(i))&&(console.error("Dropped on a task that has not valid order.  Setting order to 0, that will refresh all tasks order, but the user will not have the expected result."),i=0),r=this.model.get(e.get("list"))}}this._saveOrders(r.getTasks(),n,i)}});Oh.elements.define("livechat-converse-muc-task-app",class extends ED{restoreSettingName="livechat_task_app_restore";sessionStorageRestoreKey="livechat-converse-task-app-show";render(){return function(e,t){if(!t)return Ag``;if(!t.tasklists)return Ag``;if(!e.show)return Ag``;const s=kw("Tasks"),n=kw("Online help");return kD(e,s,CD({page:"documentation/user/streamers/tasks"}),n,Ag`<livechat-converse-muc-task-lists .model="${t.tasklists}"></livechat-converse-muc-task-lists>`)}(this,this.model)}});Oh.elements.define("livechat-converse-pick-task-list-modal",class extends JC{constructor(e){super(e),this.muc=e.muc,this.message=e.message}initialize(){super.initialize(...arguments),this.addEventListener("shown.bs.modal",(()=>{this.querySelector('select[name="tasklist"]').focus()}))}getModalTitle(){return kw("Please choose a task list")}renderModal(){return function(e){const t=e.muc;if(!t?.tasklists?.length){const e=kw("There is no task list for now, please first create one");return Ag`<p class="error">${e}</p>`}const s=kw("Once you have chosen a task list, a new task will be created. To see the task, open the task application using the top menu. More information in the livechat plugin documentation.");return Ag`<form class="converse-form converse-form--modal confirm" action="#" @submit="${t=>e.onPick(t)}"><fieldset><select class="form-control" name="tasklist">${hj(t.tasklists,(e=>e.get("id")),(e=>Ag`<option value="${e.get("id")}">${e.get("name")}</option>`))}</select> <small class="form-text text-muted">${s}</small></fieldset><fieldset><button type="submit" class="btn btn-primary">${kw("OK")}</button> <input type="button" class="btn btn-secondary" data-dismiss="modal" value="${kw("Cancel")}"></fieldset></form>`}(this)}onPick(e){e.preventDefault();const t=e.target?.tasklist?.value;if(!t)return;const s=this.muc.tasklists;if(!s)return;const n=s.get(t);if(!n)return;const i=this.message;n.createTask({name:i.get("nick"),description:i.get("body")}).then((()=>this.modal.hide()),console.error)}}),qg.plugins.add("livechat-converse-tasks",{dependencies:["converse-muc","converse-disco","converse-pubsub"],initialize(){Object.assign(Iu.exports,{ChatRoomTaskLists:lL,ChatRoomTaskList:cL,ChatRoomTasks:uL}),Iu.api.settings.extend({livechat_task_app_enabled:!1,livechat_task_app_restore:!1}),Iu.api.listen.on("chatRoomInitialized",(e=>{e.session.on("change:connection_status",(t=>{vL(e)})),e.occupants.on("change:affiliation",(t=>{t.get("jid")===Iu.bare_jid&&vL(e)})),e.features.on("change:"+mL,(()=>{vL(e)})),e.features.on("change:"+hL,(()=>{vL(e)}))})),Iu.api.listen.on("getHeadingButtons",fL),Iu.api.listen.on("getMessageActionButtons",gL)}});var xL=s(6318),EL={};EL.styleTagTransform=T(),EL.setAttributes=E(),EL.insert=S().bind(null,"head"),EL.domAPI=w(),EL.insertStyleElement=C();b()(xL.A,EL);xL.A&&xL.A.locals&&xL.A.locals;Oh.elements.define("livechat-converse-muc-terms",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},termstype:{type:String,attribute:!0}}}async initialize(){this.model&&this.listenTo(this.model,"change:x_livechat_terms_"+this.termstype,(()=>this.requestUpdate()))}render(){const e=this.model?.get("x_livechat_terms_"+this.termstype);return Ag`${e&&e.body&&!this._hideInfoBox(e.body)?Ag`<div><converse-rich-text text="${e.body}" render_styling></converse-rich-text><i class="livechat-hide-terms-info-box" @click="${this.closeInfoBox}" title="${kw("Close")}"><converse-icon class="fa fa-times" size="1em"></converse-icon></i></div>`:""}`}closeInfoBox(e){e.preventDefault();const t=this.model?.get("x_livechat_terms_"+this.termstype);t&&localStorage?.setItem("x_livechat_terms_"+this.termstype+"_hidden",t.body),this.requestUpdate()}_hideInfoBox(e){const t=localStorage?.getItem("x_livechat_terms_"+this.termstype+"_hidden");return t===e}});const{sizzle:$L}=qg.env;qg.plugins.add("livechat-converse-terms",{dependencies:["converse-muc"],initialize(){Oh.listen.on("parseMUCMessage",((e,t)=>{const s=$L("x-livechat-terms",e);return s.length?Object.assign(t,{x_livechat_terms:s[0].getAttribute("type")}):t}))},overrides:{ChatRoom:{onMessage:function(e){if(!e.x_livechat_terms)return this.__super__.onMessage(e);const t=e.x_livechat_terms;if("global"!==t&&"muc"!==t)return void console.error("Invalid x-livechat-terms type: ",t);if(e.is_archived)return void console.info("Dropping an archived x-livechat-terms message");const s={};s["x_livechat_terms_"+t]=e,this.set(s)}}}});const CL="http://jabber.org/protocol/muc#x-poll";function kL(e,t){const s=e.model;if(s.get("type")!==Iu.constants.CHATROOMS_TYPE)return t;if(!s.features?.get?.(CL))return t;const n=s.getOwnOccupant();return n&&["admin","owner"].includes(n.get("affiliation"))?(t.unshift({i18n_text:kw("Create a new poll"),handler:async e=>{e.preventDefault(),Oh.modal.show("livechat-converse-poll-form-modal",{model:s})},a_class:"",icon_class:"fa-square-poll-horizontal",name:"muc-create-poll"}),t):t}function TL(e,t,s){return t?Ag`<div class="${t.over?"livechat-poll-over":""}"><p class="livechat-poll-question">${t.over?Ag`<button type="button" class="livechat-poll-close" @click="${e.closePoll}" title="${kw("Close")}"><converse-icon class="fa fa-times" size="1em"></converse-icon></button>`:""} ${e.collapsed?Ag`<button type="button" @click="${e.toggle}" class="livechat-poll-toggle"><converse-icon color="var(--muc-toolbar-btn-color)" class="fa fa-angle-right" size="1em"></converse-icon></button>`:Ag`<button type="button" @click="${e.toggle}" class="livechat-poll-toggle"><converse-icon color="var(--muc-toolbar-btn-color)" class="fa fa-angle-down" size="1em"></converse-icon></button>`} <span @click="${e.toggle}">${t.question}</span></p>${e.collapsed?"":Ag`<table><tbody>${hj(t.choices??[],(e=>e.choice),(n=>function(e,t,s,n){const i=s.choice+":",r=s.votes,o=t.votes,a=o?(100*r/o).toFixed(2):"0.00";return Ag`<tr><td>${t.over||!n?Ag`${i}`:Ag`<button type="button" class="btn btn-primary btn-sm" @click="${t=>{t.preventDefault(),e.voteFor(s)}}" ?disabled="${e.buttonDisabled}">${i}</button>`}</td><td class="livechat-poll-choice-label">${s.label}</td><td><div class="livechat-progress-bar"><div role="progressbar" style="${"width: "+a+"%;"}" aria-valuenow="${a}" aria-valuemin="0" aria-valuemax="100"></div><p>${r}/${o} (${a}%)</p></div></td></tr>`}(e,t,n,s)))}</tbody></table>${function(e,t,s){if(t.over||!s)return Ag``;const n=kw("To vote, click on your choice or send a message with an exclamation mark followed by your choice number (Example: !1).");return Ag`<p class="livechat-poll-instructions">${n}</p>`}(0,t,s)} ${function(e,t){if(!t.endDate)return Ag``;const s=kw("Poll ends at:");return Ag`<p class="livechat-poll-end">${s} ${t.endDate.toLocaleString()}</p>`}(0,t)}`}</div>`:Ag``}Oh.elements.define("livechat-converse-poll-form-modal",class extends JC{initialize(){super.initialize()}close(){super.close(),Oh.modal.remove("livechat-converse-poll-form-modal")}renderModal(){return Ag`<livechat-converse-poll-form .model="${this.model}" .modal="${this}"></livechat-converse-poll-form>`}getModalTitle(){return kw("Create a new poll")}renderModalFooter(){return Ag`<div class="modal-footer">${HC} <button type="submit" class="btn btn-primary" @click="${e=>{e.preventDefault(),this.querySelector("livechat-converse-poll-form form")?.requestSubmit()}}">${kw("Ok")}</button></div>`}});var jL=s(5250),NL={};NL.styleTagTransform=T(),NL.setAttributes=E(),NL.insert=S().bind(null,"head"),NL.domAPI=w(),NL.insertStyleElement=C();b()(jL.A,NL);jL.A&&jL.A.locals&&jL.A.locals;Oh.elements.define("livechat-converse-muc-poll",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},collapsed:{type:Boolean,attribute:!1},buttonDisabled:{type:Boolean,attribute:!1}}}async initialize(){this.collapsed=!1,this.buttonDisabled=!1,this.model&&(this.listenTo(this.model,"change:current_poll",(()=>{this.buttonDisabled=!1,this.requestUpdate()})),this.listenTo(this.model.occupants,"change:role",(e=>{e.get("jid")===Iu.bare_jid&&this.requestUpdate()})))}render(){const e=this.model?.get("current_poll");return TL(this,e,this.model.session.get("connection_status")===qg.ROOMSTATUS.ENTERED&&"visitor"!==this.model.getOwnRole())}toggle(e){e.preventDefault(),this.collapsed=!this.collapsed}async voteFor(e){if(this.buttonDisabled)return;const t=this.model?.get("current_poll");if(!t)return;if(t.over)return;console.info("User has voted for choice: ",e),this.buttonDisabled=!0,this.requestUpdate(),await this.model.sendMessage({body:"!"+e.choice});const s=new Event("livechat-poll-vote",{bubbles:!0});this.dispatchEvent(s)}closePoll(e){e.preventDefault(),this.model.set("current_poll",void 0)}});const OL=qg.env.utils;var IL=s(695),ML={};ML.styleTagTransform=T(),ML.setAttributes=E(),ML.insert=S().bind(null,"head"),ML.domAPI=w(),ML.insertStyleElement=C();b()(IL.A,ML);IL.A&&IL.A.locals&&IL.A.locals;const RL=qg.env.$iq,DL=qg.env.utils,LL=qg.env.sizzle,zL=qg.env.Strophe;Oh.elements.define("livechat-converse-poll-form",class extends Nw{static get properties(){return{model:{type:Object,attribute:!0},modal:{type:Object,attribute:!0},alert_message:{type:Object,attribute:!1},title:{type:String,attribute:!1},instructions:{type:String,attribute:!1}}}_fieldTranslationMap=new Map;xform=void 0;async initialize(){if(this.alert_message=void 0,this.model)try{this._initFieldTranslations();const e=fp(await this._fetchPollForm());if(!e)throw Error("Missing xform in stanza");e.fields?.map((e=>this._translateField(e))),this.xform=e,this.title=kw("New poll"),this.instructions=kw("Complete and submit this form to create a new poll. This will end and replace any existing poll.")}catch(e){console.error(e),this.alert_message=kw("Error")}else this.alert_message=kw("Error")}render(){return function(e){const t=kw("Ok"),s=kw("Online help"),n=CD({page:"documentation/user/streamers/polls"});let i;e.xform&&(i=e.xform.fields.map((e=>OL.xFormField2TemplateResult(e))));return Ag`${e.alert_message?Ag`<div class="error">${e.alert_message}</div>`:""} ${i?Ag`<form class="converse-form" @submit="${t=>e.formSubmit(t)}"><p class="title">${e.title} <a href="${n}" target="_blank"><converse-icon class="fa fa-circle-question" size="1em" title="${s}"></converse-icon></a></p><p class="form-help instructions">${e.instructions}</p><div class="form-errors hidden"></div>${i}<fieldset class="buttons"><input type="submit" class="btn btn-primary" value="${t}"></fieldset></form>`:""}`}(this)}_fetchPollForm(){return Oh.sendIQ(RL({to:this.model.get("jid"),type:"get"}).c("query",{xmlns:CL}))}_initFieldTranslations(){this._fieldTranslationMap.set("muc#roompoll_question",kw("Question")),this._fieldTranslationMap.set("muc#roompoll_duration",kw("Poll duration (in minutes)")),this._fieldTranslationMap.set("muc#roompoll_anonymous_results",kw("Anonymous results"));for(let e=1;e<=10;e++)this._fieldTranslationMap.set("muc#roompoll_choice"+e.toString(),kw("Choice {{N}}:").replace("{{N}}",e.toString()))}_translateField(e){const t=e.var,s=this._fieldTranslationMap.get(t);s&&(e.label=s)}async formSubmit(e){e.preventDefault();try{this.alert_message=void 0;const t=e.target,s=LL(":input:not([type=button]):not([type=submit])",t),n=RL({type:"set",to:this.model.get("jid"),id:DL.getUniqueId()}).c("query",{xmlns:CL});n.c("x",{xmlns:zL.NS.XFORM,type:"submit"});const i=s.map((e=>Wh(e))).filter((e=>e));i.forEach((e=>n.cnode(e).up())),await Oh.sendIQ(n),this.modal&&this.modal.close()}catch(e){if(DL.isErrorStanza(e)&&LL("error bad-request",e).length){const t=LL("error text",e);if(t.length)return void(this.alert_message=kw("Error")+": "+t[0].textContent)}console.error(e),this.alert_message=kw("Error")}}});const{sizzle:PL}=qg.env;qg.plugins.add("livechat-converse-poll",{dependencies:["converse-muc","converse-disco"],initialize(){Iu.api.listen.on("getHeadingButtons",kL),Iu.api.listen.on("parseMUCMessage",((e,t)=>{t.is_error&&("This poll is now over."===t.error_text?t.error_text=kw("This poll is now over."):"This choice is not valid."===t.error_text?t.error_text=kw("This choice is not valid."):"Your vote is taken into account. Votes are anonymous, they will not be shown to other participants."===t.error_text&&(t.error_text=kw("Your vote is taken into account. Votes are anonymous, they will not be shown to other participants.")));const s=PL("x-poll",e)?.[0];if(!s)return t;const n=PL("x-poll-question",s)?.[0],i=PL("x-poll-choice",s);if(!n||!i.length)return t;const r=s.hasAttribute("end")?new Date(1e3*parseInt(s.getAttribute("end"))):null,o={question:n.textContent,id:s.getAttribute("id"),votes:parseInt(s.getAttribute("votes")??0),over:s.hasAttribute("over"),endDate:r,time:t.time,choices:i.map((e=>({label:e.textContent,choice:e.getAttribute("choice"),votes:parseInt(e.getAttribute("votes")??0)})))},a=(t.body??"").replace("This poll is now over.",kw("This poll is now over.")).replace("Send a message with an exclamation mark followed by your choice number to vote. Example: !1",kw("To vote, click on your choice or send a message with an exclamation mark followed by your choice number (Example: !1)."));return Object.assign(t,{current_poll:o,body:a})}))},overrides:{ChatRoom:{onMessage:function(e){if(!e.current_poll)return this.__super__.onMessage(e);if(e.is_archived)return this.__super__.onMessage(e);if(e.is_delayed){console.debug("Got a delayed poll message, checking if old or not");const t=new Date;if(t.setMinutes(t.getMinutes()-2),e.time<t.toISOString())return console.debug(`Poll message was delayed fore more than 2 minutes (${e.time} < ${t.toISOString()}).`),this.__super__.onMessage(e)}return console.info("Got a poll message, setting it as the current_poll"),this.set("current_poll",e.current_poll),this.__super__.onMessage(e)}}}});const FL=Iu.pluggable.plugins["converse-vcard"],UL=FL.initialize;FL.initialize=function(){const e=Iu._events.chatRoomInitialized??[];UL.apply(this),Iu.api.settings.extend({livechat_load_all_vcards:!1});const t=[];for(const s of Iu._events.chatRoomInitialized??[])s.callback&&!e.includes(s.callback)&&t.push(s.callback);for(const e of t)console.debug("Livechat patching vcard: we must remove this listener",e),Oh.listen.not("chatRoomInitialized",e);Oh.listen.on("chatRoomInitialized",(e=>{console.debug("Patched version of the vcard chatRoomInitialized event."),dw(e);const t=!0===Oh.settings.get("livechat_load_all_vcards");let s=e.get("hidden_occupants");(!0!==s||t)&&e.occupants.forEach(uw),e.listenTo(e.occupants,"add",(e=>{(!0!==s||t)&&uw(e)})),e.on("change:hidden_occupants",(()=>{s=e.get("hidden_occupants"),(!0!==s||t)&&e.occupants.forEach(uw)})),e.listenTo(e.occupants,"change:image_hash",(e=>lw(e)))}))},xu.push("livechat-converse-size"),xu.push("livechat-converse-tasks"),xu.push("livechat-converse-terms"),xu.push("livechat-converse-poll"),xu.push("livechat-converse-notes"),xu.push("livechat-converse-mam-search"),_v.push("x_peertubelivechat_mute_anonymous"),_v.push("x_peertubelivechat_emoji_only_mode"),Iu.exports.CustomElement=Nw;const BL=qg.initialize;qg.initialize=function(e,t){return Array.isArray(e.whitelisted_plugins)?e.whitelisted_plugins=e.whitelisted_plugins.concat(Ow):e.whitelisted_plugins=Ow,BL(e,t)};const qL=qg},1390:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2472:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8627:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3177:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7930:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},695:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5250:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6935:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2156:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6318:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4768:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3658:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6342:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1205:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3403:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1089:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2995:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2852:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6264:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7190:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5832:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5431:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6524:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3363:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},304:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8610:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},998:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4659:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1946:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6215:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8011:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8185:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},33:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4734:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9847:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4842:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5190:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7702:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8562:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},593:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7983:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6120:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9440:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7187:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3796:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4563:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5501:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1070:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3557:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1218:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1353:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1709:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9495:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4926:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},719:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8945:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2470:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9499:(e,t,s)=>{var n={"./af.js":[734,5628],"./am.js":[5763,8489],"./ar-dz.js":[4121,3741],"./ar-iq.js":[9725,6605],"./ar-kw.js":[4985,861],"./ar-ly.js":[8280,1696],"./ar-ma.js":[4057,7385],"./ar-sa.js":[1643,131],"./ar-tn.js":[4645,7801],"./ar.js":[8994,8880],"./az.js":[8010,9080],"./be.js":[6604,2366],"./bg.js":[3046,1072],"./bi.js":[5704,1938],"./bm.js":[3204,6486],"./bn-bd.js":[6560,6124],"./bn.js":[5053,9423],"./bo.js":[7662,1464],"./br.js":[7817,2643],"./bs.js":[5290,1116],"./ca.js":[1065,9395],"./cs.js":[1175,5825],"./cv.js":[6204,2766],"./cy.js":[4049,7003],"./da.js":[2869,6208],"./de-at.js":[6846,5534],"./de-ch.js":[7160,6064],"./de.js":[9310,5036],"./dv.js":[9419,2993],"./el.js":[9144,9782],"./en-au.js":[8681,6121],"./en-ca.js":[4379,5611],"./en-gb.js":[2410,4094],"./en-ie.js":[817,1665],"./en-il.js":[8074,8178],"./en-in.js":[8224,7028],"./en-nz.js":[9059,8343],"./en-sg.js":[7745,3341],"./en-tt.js":[9355,7627],"./en.js":[5586,6824],"./eo.js":[3473,8031],"./es-do.js":[1603,9271],"./es-mx.js":[9871,591],"./es-pr.js":[6156,2856],"./es-us.js":[7570,4182],"./es.js":[7845,1827],"./et.js":[4048,385],"./eu.js":[5351,933],"./fa.js":[1636,598],"./fi.js":[8860,3166],"./fo.js":[4906,7596],"./fr-ca.js":[4658,9870],"./fr-ch.js":[6921,9101],"./fr.js":[573,8431],"./fy.js":[3244,9710],"./ga.js":[3821,7743],"./gd.js":[5074,5284],"./gl.js":[4090,5724],"./gom-latn.js":[8948,8630],"./gu.js":[6305,8443],"./he.js":[9242,2384],"./hi.js":[7902,4852],"./hr.js":[5571,2241],"./ht.js":[3881,6007],"./hu.js":[5178,1712],"./hy-am.js":[226,9589],"./id.js":[7180,4770],"./is.js":[5273,3359],"./it-ch.js":[1206,4718],"./it.js":[6444,4034],"./ja.js":[680,4434],"./jv.js":[7469,9007],"./ka.js":[9313,4523],"./kk.js":[7239,6641],"./km.js":[3045,3287],"./kn.js":[2268,4974],"./ko.js":[3555,8789],"./ku.js":[493,687],"./ky.js":[6713,7491],"./lb.js":[8567,1373],"./lo.js":[516,6042],"./lt.js":[5013,4859],"./lv.js":[6419,9593],"./me.js":[3167,4333],"./mi.js":[9971,3729],"./mk.js":[4245,5059],"./ml.js":[2032,5998],"./mn.js":[2458,1056],"./mr.js":[4830,4260],"./ms-my.js":[9072,4512],"./ms.js":[2221,2091],"./mt.js":[2872,3014],"./my.js":[4035,561],"./nb.js":[9749,7],"./ne.js":[832,5946],"./nl-be.js":[8961,9109],"./nl.js":[4495,7497],"./nn.js":[6481,1275],"./oc-lnc.js":[8033,1719],"./pa-in.js":[5092,2664],"./pl.js":[7001,6343],"./pt-br.js":[8954,2014],"./pt.js":[2129,6191],"./rn.js":[4237,3519],"./ro.js":[8222,4584],"./ru.js":[6684,7806],"./rw.js":[5142,8176],"./sd.js":[2982,3664],"./se.js":[1941,9975],"./si.js":[590,9547],"./sk.js":[7375,6537],"./sl.js":[5070,8232],"./sq.js":[1049,9411],"./sr-cyrl.js":[2863,9331],"./sr.js":[5568,4858],"./ss.js":[6071,2769],"./sv-fi.js":[1800,6660],"./sv.js":[1100,1982],"./sw.js":[2739,2389],"./ta.js":[7730,832],"./te.js":[2478,4636],"./tet.js":[192,8592],"./tg.js":[2244,7962],"./th.js":[2153,6655],"./tk.js":[9200,422],"./tl-ph.js":[5406,8022],"./tlh.js":[3297,8945],"./tr.js":[4655,9557],"./tzl.js":[5027,3683],"./tzm-latn.js":[5300,138],"./tzm.js":[4764,9052],"./ug-cn.js":[9191,3731],"./uk.js":[4413,4107],"./ur.js":[9894,1388],"./uz-latn.js":[9398,5970],"./uz.js":[4974,948],"./vi.js":[4988,3774],"./x-pseudo.js":[2112,5790],"./yo.js":[477,6803],"./zh-cn.js":[1105,4385],"./zh-hk.js":[4013,7013],"./zh-tw.js":[437,7981],"./zh.js":[3239,4497]};function i(e){if(!s.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return s.e(t[1]).then((()=>s.t(i,23)))}i.keys=()=>Object.keys(n),i.id=9499,e.exports=i},2665:(e,t,s)=>{"use strict";const n=s(4505),i=s(4007);e.exports={atob:n,btoa:i}},4505:e=>{"use strict";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function s(e){const s=t.indexOf(e);return s<0?void 0:s}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let t="",n=0,i=0;for(let r=0;r<e.length;r++)n<<=6,n|=s(e[r]),i+=6,24===i&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=i=0);return 12===i?(n>>=4,t+=String.fromCharCode(n)):18===i&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t}},4007:e=>{"use strict";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function s(e){if(e>=0&&e<64)return t[e]}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");let t;for(e=`${e}`,t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;let n="";for(t=0;t<e.length;t+=3){const i=[void 0,void 0,void 0,void 0];i[0]=e.charCodeAt(t)>>2,i[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(i[1]|=e.charCodeAt(t+1)>>4,i[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(i[2]|=e.charCodeAt(t+2)>>6,i[3]=63&e.charCodeAt(t+2));for(let e=0;e<i.length;e++)void 0===i[e]?n+="=":n+=s(i[e])}return n}},4026:e=>{window,e.exports=function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=7)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImageElement=function(e,t){return new Promise((function(s,n){e.addEventListener("load",(function(){s(e)}),!1),e.addEventListener("error",(function(e){n(e)}),!1),e.src=t}))},t.resize=function(e,t,s,n){if(!s&&!n)return{currentWidth:e,currentHeight:t};var i=e/t,r=void 0,o=void 0;return i>s/n?o=(r=Math.min(e,s))/i:r=(o=Math.min(t,n))*i,{width:r,height:o}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64ToFile=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",s=window.atob(e),n=[],i=0;i<s.length;i++)n[i]=s.charCodeAt(i);return new window.Blob([new Uint8Array(n)],{type:t})},t.imageToCanvas=function(e,t,s,n){var i=document.createElement("canvas"),r=i.getContext("2d");if(i.width=t,i.height=s,!n||n>8)return r.drawImage(e,0,0,i.width,i.height),i;switch(n>4&&(i.width=s,i.height=t),n){case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,s),r.rotate(Math.PI);break;case 4:r.translate(0,s),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-s);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-s),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}return n>4?r.drawImage(e,0,0,i.height,i.width):r.drawImage(e,0,0,i.width,i.height),i},t.canvasToBlob=function(e,t){return new Promise((function(s,n){e.toBlob((function(e){s(e)}),"image/jpeg",t)}))},t.size=function(e){return{kB:.001*e,MB:1e-6*e}},t.blobToBase64=function(e){return new Promise((function(t,s){var n=new window.FileReader;n.addEventListener("load",(function(e){t(e.target.result)}),!1),n.addEventListener("error",(function(e){s(e)}),!1),n.readAsDataURL(e)}))}},function(e,t,s){e.exports=s(6)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractOrientation=function(e){return new Promise((function(t,s){var n=new window.FileReader;n.onload=function(e){var s=new DataView(e.target.result);65496!==s.getUint16(0,!1)&&t(-2);for(var n=s.byteLength,i=2;i<n;){var r=s.getUint16(i,!1);if(i+=2,65505===r){1165519206!==s.getUint32(i+=2,!1)&&t(-1);var o=18761===s.getUint16(i+=6,!1);i+=s.getUint32(i+4,o);var a=s.getUint16(i,o);i+=2;for(var c=0;c<a;c++)274===s.getUint16(i+12*c,o)&&t(s.getUint16(i+12*c+8,o))}else{if(65280&~r)break;i+=s.getUint16(i,!1)}}t(-1)},n.readAsArrayBuffer(e.slice(0,65536))}))}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=s(2))&&n.__esModule?n:{default:n},r=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),o=s(3),a=s(0),c=s(1);function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,s){return function n(i,r){try{var o=t[i](r),a=o.value}catch(e){return void s(e)}if(!o.done)return Promise.resolve(a).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(a)}("next")}))}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.name=t.name,this.type=t.type,this.size=t.size}return r(e,[{key:"setData",value:function(e){this.data=e,this.size=e.size,this.type=e.type}},{key:"_calculateOrientation",value:function(){var e=l(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.extractOrientation)(this.data);case 2:t=e.sent,this.orientation=t;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=l(i.default.mark((function e(){var t,s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._calculateOrientation();case 2:return t=URL.createObjectURL(this.data),s=new window.Image,e.next=6,(0,a.loadImageElement)(s,t);case 6:URL.revokeObjectURL(t),this._img=s,this.width=s.naturalWidth,this.height=s.naturalHeight;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCanvas",value:function(e,t,s){return void 0!==s?(0,c.imageToCanvas)(this._img,e,t,s):(0,c.imageToCanvas)(this._img,e,t,this.orientation)}}]),e}();t.default=d,e.exports=t.default},function(e,t){!function(t){"use strict";var s,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag",l="object"==typeof e,d=t.regeneratorRuntime;if(d)l&&(e.exports=d);else{(d=t.regeneratorRuntime=l?e.exports:{}).wrap=y;var u="suspendedStart",h="suspendedYield",m="executing",f="completed",g={},p={};p[o]=function(){return this};var v=Object.getPrototypeOf,_=v&&v(v(N([])));_&&_!==n&&i.call(_,o)&&(p=_);var b=x.prototype=A.prototype=Object.create(p);S.prototype=b.constructor=x,x.constructor=S,x[c]=S.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},d.awrap=function(e){return{__await:e}},E($.prototype),$.prototype[a]=function(){return this},d.AsyncIterator=$,d.async=function(e,t,s,n){var i=new $(y(e,t,s,n));return d.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(b),b[c]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var s in e)t.push(s);return t.reverse(),function s(){for(;t.length;){var n=t.pop();if(n in e)return s.value=n,s.done=!1,s}return s.done=!0,s}},d.values=N,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=s)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=s),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),T(s),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var n=s.completion;if("throw"===n.type){var i=n.arg;T(s)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:N(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=s),g}}}function y(e,t,s,n){var i=t&&t.prototype instanceof A?t:A,r=Object.create(i.prototype),o=new j(n||[]);return r._invoke=function(e,t,s){var n=u;return function(i,r){if(n===m)throw new Error("Generator is already running");if(n===f){if("throw"===i)throw r;return O()}for(s.method=i,s.arg=r;;){var o=s.delegate;if(o){var a=C(o,s);if(a){if(a===g)continue;return a}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(n===u)throw n=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);n=m;var c=w(e,t,s);if("normal"===c.type){if(n=s.done?f:h,c.arg===g)continue;return{value:c.arg,done:s.done}}"throw"===c.type&&(n=f,s.method="throw",s.arg=c.arg)}}}(e,s,o),r}function w(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(e){return{type:"throw",arg:e}}}function A(){}function S(){}function x(){}function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function $(e){var t;this._invoke=function(s,n){function r(){return new Promise((function(t,r){!function t(s,n,r,o){var a=w(e[s],e,n);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,r,o)}),(function(e){t("throw",e,r,o)})):Promise.resolve(l).then((function(e){c.value=e,r(c)}),o)}o(a.arg)}(s,n,t,r)}))}return t=t?t.then(r,r):r()}}function C(e,t){var n=e.iterator[t.method];if(n===s){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=s,C(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=w(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,g;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=s),t.delegate=null,g):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function N(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=s,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:s,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,s){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,r=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=s(5),i)n.regeneratorRuntime=r;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(s(2)),i=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}(s(1)),o=s(0),a=c(s(4));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,s){return function n(i,r){try{var o=t[i](r),a=o.value}catch(e){return void s(e)}if(!o.done)return Promise.resolve(a).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(a)}("next")}))}}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setOptions(t)}return i(e,[{key:"setOptions",value:function(e){var t={targetSize:1/0,quality:.75,minQuality:.5,qualityStepSize:.1,maxWidth:1920,maxHeight:1920,resize:!0,throwIfSizeNotReached:!1,autoRotate:!0},s=new Proxy(e,{get:function(e,s){return s in e?e[s]:t[s]}});this.options=s}},{key:"_compressFile",value:function(){var e=l(n.default.mark((function e(t){var s,i;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new a.default(t),(i={}).start=window.performance.now(),i.quality=this.options.quality,i.startType=s.type,e.next=7,s.load();case 7:return e.next=9,this._compressImage(s,i);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_compressImage",value:function(){var e=l(n.default.mark((function e(t,s){var i,a,c,l,d;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.startWidth=t.width,s.startHeight=t.height,i=void 0,a=void 0,this.options.resize?(c=(0,o.resize)(t.width,t.height,this.options.maxWidth,this.options.maxHeight),i=c.width,a=c.height):(i=t.width,a=t.height),s.endWidth=i,s.endHeight=a,l=this.doAutoRotation?void 0:1,d=t.getCanvas(i,a,l),s.iterations=0,s.startSizeMB=r.size(t.size).MB,e.next=12,this._loopCompression(d,t,s);case 12:return s.endSizeMB=r.size(t.size).MB,s.sizeReducedInPercent=(s.startSizeMB-s.endSizeMB)/s.startSizeMB*100,s.end=window.performance.now(),s.elapsedTimeInSeconds=(s.end-s.start)/1e3,s.endType=t.type,e.abrupt("return",{photo:t,info:s});case 18:case"end":return e.stop()}}),e,this)})));return function(t,s){return e.apply(this,arguments)}}()},{key:"_loopCompression",value:function(){var e=l(n.default.mark((function e(t,s,i){var o;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.iterations++,e.t0=s,e.next=4,r.canvasToBlob(t,i.quality);case 4:if(e.t1=e.sent,e.t0.setData.call(e.t0,e.t1),1==i.iterations&&(s.width=i.endWidth,s.height=i.endHeight),!(r.size(s.size).MB>this.options.targetSize)){e.next=24;break}if(!(i.quality.toFixed(10)-.1<this.options.minQuality)){e.next=18;break}if(o="Couldn't compress image to target size while maintaining quality.\n        Target size: "+this.options.targetSize+"\n        Actual size: "+r.size(s.size).MB,this.options.throwIfSizeNotReached){e.next=14;break}console.error(o),e.next=15;break;case 14:throw new Error(o);case 15:case 24:return e.abrupt("return");case 18:return i.quality-=this.options.qualityStepSize,e.next=21,this._loopCompression(t,s,i);case 21:return e.abrupt("return",e.sent);case 22:e.next=25;break;case 25:case"end":return e.stop()}}),e,this)})));return function(t,s,n){return e.apply(this,arguments)}}()},{key:"setAutoRotate",value:function(){var t=l(n.default.mark((function t(){var s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.automaticRotationFeatureTest();case 2:s=t.sent,this.doAutoRotation=this.options.autoRotate&&!s;case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"compress",value:function(){var e=l(n.default.mark((function e(t){var s=this;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setAutoRotate();case 2:return e.abrupt("return",Promise.all(t.map((function(e){return s._compressFile(e)}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"blobToBase64",value:function(){var e=l(n.default.mark((function e(){var t=arguments;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.blobToBase64.apply(r,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadImageElement",value:function(){var e=l(n.default.mark((function e(){var t=arguments;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.loadImageElement.apply(void 0,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"automaticRotationFeatureTest",value:function(){return new Promise((function(e){var t=new Image;t.onload=function(){var s=1===t.width&&2===t.height;e(s)},t.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="}))}}]),e}();t.default=d,e.exports=t.default}])},7370:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",n=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),n&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),n&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,n,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);n&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),s&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=s):d[2]=s),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},698:e=>{"use strict";e.exports=function(e){var t=e[1],s=e[3];if(!s)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),r="/*# ".concat(i," */");return[t].concat([r]).join("\n")}return[t].join("\n")}},5569:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,s=36e5,n="millisecond",i="second",r="minute",o="hour",a="day",c="week",l="month",d="quarter",u="year",h="date",m="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],s=e%100;return"["+e+(t[(s-20)%10]||t[s]||t[0])+"]"}},v=function(e,t,s){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(s)+e},_={s:v,z:function(e){var t=-e.utcOffset(),s=Math.abs(t),n=Math.floor(s/60),i=s%60;return(t<=0?"+":"-")+v(n,2,"0")+":"+v(i,2,"0")},m:function e(t,s){if(t.date()<s.date())return-e(s,t);var n=12*(s.year()-t.year())+(s.month()-t.month()),i=t.clone().add(n,l),r=s-i<0,o=t.clone().add(n+(r?-1:1),l);return+(-(n+(s-i)/(r?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:u,w:c,d:a,D:h,h:o,m:r,s:i,ms:n,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",y={};y[b]=p;var w="$isDayjsObject",A=function(e){return e instanceof $||!(!e||!e[w])},S=function e(t,s,n){var i;if(!t)return b;if("string"==typeof t){var r=t.toLowerCase();y[r]&&(i=r),s&&(y[r]=s,i=r);var o=t.split("-");if(!i&&o.length>1)return e(o[0])}else{var a=t.name;y[a]=t,i=a}return!n&&i&&(b=i),i||!n&&b},x=function(e,t){if(A(e))return e.clone();var s="object"==typeof t?t:{};return s.date=e,s.args=arguments,new $(s)},E=_;E.l=S,E.i=A,E.w=function(e,t){return x(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var $=function(){function p(e){this.$L=S(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var v=p.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,s=e.utc;if(null===t)return new Date(NaN);if(E.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(f);if(n){var i=n[2]-1||0,r=(n[7]||"0").substring(0,3);return s?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,r)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,r)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return E},v.isValid=function(){return!(this.$d.toString()===m)},v.isSame=function(e,t){var s=x(e);return this.startOf(t)<=s&&s<=this.endOf(t)},v.isAfter=function(e,t){return x(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<x(e)},v.$g=function(e,t,s){return E.u(e)?this[t]:this.set(s,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var s=this,n=!!E.u(t)||t,d=E.p(e),m=function(e,t){var i=E.w(s.$u?Date.UTC(s.$y,t,e):new Date(s.$y,t,e),s);return n?i:i.endOf(a)},f=function(e,t){return E.w(s.toDate()[e].apply(s.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),s)},g=this.$W,p=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case u:return n?m(1,0):m(31,11);case l:return n?m(1,p):m(0,p+1);case c:var b=this.$locale().weekStart||0,y=(g<b?g+7:g)-b;return m(n?v-y:v+(6-y),p);case a:case h:return f(_+"Hours",0);case o:return f(_+"Minutes",1);case r:return f(_+"Seconds",2);case i:return f(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var s,c=E.p(e),d="set"+(this.$u?"UTC":""),m=(s={},s[a]=d+"Date",s[h]=d+"Date",s[l]=d+"Month",s[u]=d+"FullYear",s[o]=d+"Hours",s[r]=d+"Minutes",s[i]=d+"Seconds",s[n]=d+"Milliseconds",s)[c],f=c===a?this.$D+(t-this.$W):t;if(c===l||c===u){var g=this.clone().set(h,1);g.$d[m](f),g.init(),this.$d=g.set(h,Math.min(this.$D,g.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[E.p(e)]()},v.add=function(n,d){var h,m=this;n=Number(n);var f=E.p(d),g=function(e){var t=x(m);return E.w(t.date(t.date()+Math.round(e*n)),m)};if(f===l)return this.set(l,this.$M+n);if(f===u)return this.set(u,this.$y+n);if(f===a)return g(1);if(f===c)return g(7);var p=(h={},h[r]=t,h[o]=s,h[i]=e,h)[f]||1,v=this.$d.getTime()+n*p;return E.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,s=this.$locale();if(!this.isValid())return s.invalidDate||m;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=E.z(this),r=this.$H,o=this.$m,a=this.$M,c=s.weekdays,l=s.months,d=s.meridiem,u=function(e,s,i,r){return e&&(e[s]||e(t,n))||i[s].slice(0,r)},h=function(e){return E.s(r%12||12,e,"0")},f=d||function(e,t,s){var n=e<12?"AM":"PM";return s?n.toLowerCase():n};return n.replace(g,(function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return E.s(t.$y,4,"0");case"M":return a+1;case"MM":return E.s(a+1,2,"0");case"MMM":return u(s.monthsShort,a,l,3);case"MMMM":return u(l,a);case"D":return t.$D;case"DD":return E.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(s.weekdaysMin,t.$W,c,2);case"ddd":return u(s.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(r);case"HH":return E.s(r,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return f(r,o,!0);case"A":return f(r,o,!1);case"m":return String(o);case"mm":return E.s(o,2,"0");case"s":return String(t.$s);case"ss":return E.s(t.$s,2,"0");case"SSS":return E.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(n,h,m){var f,g=this,p=E.p(h),v=x(n),_=(v.utcOffset()-this.utcOffset())*t,b=this-v,y=function(){return E.m(g,v)};switch(p){case u:f=y()/12;break;case l:f=y();break;case d:f=y()/3;break;case c:f=(b-_)/6048e5;break;case a:f=(b-_)/864e5;break;case o:f=b/s;break;case r:f=b/t;break;case i:f=b/e;break;default:f=b}return m?f:E.a(f)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return y[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var s=this.clone(),n=S(e,t,!0);return n&&(s.$L=n),s},v.clone=function(){return E.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},p}(),C=$.prototype;return x.prototype=C,[["$ms",n],["$s",i],["$m",r],["$H",o],["$W",a],["$M",l],["$y",u],["$D",h]].forEach((function(e){C[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),x.extend=function(e,t){return e.$i||(e(t,$,x),e.$i=!0),x},x.locale=S,x.isDayjs=A,x.unix=function(e){return x(1e3*e)},x.en=y[b],x.Ls=y,x.p={},x}()},9807:function(e){e.exports=function(){"use strict";return function(e,t){var s=t.prototype,n=s.format;s.format=function(e){var t=this,s=this.$locale();if(!this.isValid())return n.bind(this)(e);var i=this.$utils(),r=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return s.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return s.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return n.bind(this)(r)}}}()},8870:function(e){e.exports=function(){"use strict";const{entries:e,setPrototypeOf:t,isFrozen:s,getPrototypeOf:n,getOwnPropertyDescriptor:i}=Object;let{freeze:r,seal:o,create:a}=Object,{apply:c,construct:l}="undefined"!=typeof Reflect&&Reflect;r||(r=function(e){return e}),o||(o=function(e){return e}),c||(c=function(e,t,s){return e.apply(t,s)}),l||(l=function(e,t){return new e(...t)});const d=A(Array.prototype.forEach),u=A(Array.prototype.pop),h=A(Array.prototype.push),m=A(String.prototype.toLowerCase),f=A(String.prototype.toString),g=A(String.prototype.match),p=A(String.prototype.replace),v=A(String.prototype.indexOf),_=A(String.prototype.trim),b=A(Object.prototype.hasOwnProperty),y=A(RegExp.prototype.test),w=S(TypeError);function A(e){return function(t){for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];return c(e,t,n)}}function S(e){return function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return l(e,s)}}function x(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;t&&t(e,null);let r=n.length;for(;r--;){let t=n[r];if("string"==typeof t){const e=i(t);e!==t&&(s(n)||(n[r]=e),t=e)}e[t]=!0}return e}function E(e){for(let t=0;t<e.length;t++)b(e,t)||(e[t]=null);return e}function $(t){const s=a(null);for(const[n,i]of e(t))b(t,n)&&(Array.isArray(i)?s[n]=E(i):i&&"object"==typeof i&&i.constructor===Object?s[n]=$(i):s[n]=i);return s}function C(e,t){for(;null!==e;){const s=i(e,t);if(s){if(s.get)return A(s.get);if("function"==typeof s.value)return A(s.value)}e=n(e)}function s(){return null}return s}const k=r(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),T=r(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),j=r(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),N=r(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),O=r(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),I=r(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),M=r(["#text"]),R=r(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),D=r(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),L=r(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),z=r(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),P=o(/\{\{[\w\W]*|[\w\W]*\}\}/gm),F=o(/<%[\w\W]*|[\w\W]*%>/gm),U=o(/\${[\w\W]*}/gm),B=o(/^data-[\-\w.\u00B7-\uFFFF]/),q=o(/^aria-[\-\w]+$/),H=o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),G=o(/^(?:\w+script|data):/i),W=o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),V=o(/^html$/i),Q=o(/^[a-z][.\w]*(-[.\w]+)+$/i);var J=Object.freeze({__proto__:null,MUSTACHE_EXPR:P,ERB_EXPR:F,TMPLIT_EXPR:U,DATA_ATTR:B,ARIA_ATTR:q,IS_ALLOWED_URI:H,IS_SCRIPT_OR_DATA:G,ATTR_WHITESPACE:W,DOCTYPE_NAME:V,CUSTOM_ELEMENT:Q});const Y={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},X=function(){return"undefined"==typeof window?null:window},K=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let s=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(s=t.getAttribute(n));const i="dompurify"+(s?"#"+s:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function Z(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X();const s=e=>Z(e);if(s.version="3.1.5",s.removed=[],!t||!t.document||t.document.nodeType!==Y.document)return s.isSupported=!1,s;let{document:n}=t;const i=n,o=i.currentScript,{DocumentFragment:c,HTMLTemplateElement:l,Node:A,Element:S,NodeFilter:E,NamedNodeMap:P=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:F,DOMParser:U,trustedTypes:B}=t,q=S.prototype,G=C(q,"cloneNode"),W=C(q,"nextSibling"),Q=C(q,"childNodes"),ee=C(q,"parentNode");if("function"==typeof l){const e=n.createElement("template");e.content&&e.content.ownerDocument&&(n=e.content.ownerDocument)}let te,se="";const{implementation:ne,createNodeIterator:ie,createDocumentFragment:re,getElementsByTagName:oe}=n,{importNode:ae}=i;let ce={};s.isSupported="function"==typeof e&&"function"==typeof ee&&ne&&void 0!==ne.createHTMLDocument;const{MUSTACHE_EXPR:le,ERB_EXPR:de,TMPLIT_EXPR:ue,DATA_ATTR:he,ARIA_ATTR:me,IS_SCRIPT_OR_DATA:fe,ATTR_WHITESPACE:ge,CUSTOM_ELEMENT:pe}=J;let{IS_ALLOWED_URI:ve}=J,_e=null;const be=x({},[...k,...T,...j,...O,...M]);let ye=null;const we=x({},[...R,...D,...L,...z]);let Ae=Object.seal(a(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Se=null,xe=null,Ee=!0,$e=!0,Ce=!1,ke=!0,Te=!1,je=!0,Ne=!1,Oe=!1,Ie=!1,Me=!1,Re=!1,De=!1,Le=!0,ze=!1;const Pe="user-content-";let Fe=!0,Ue=!1,Be={},qe=null;const He=x({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ge=null;const We=x({},["audio","video","img","source","image","track"]);let Ve=null;const Qe=x({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Je="http://www.w3.org/1998/Math/MathML",Ye="http://www.w3.org/2000/svg",Xe="http://www.w3.org/1999/xhtml";let Ke=Xe,Ze=!1,et=null;const tt=x({},[Je,Ye,Xe],f);let st=null;const nt=["application/xhtml+xml","text/html"],it="text/html";let rt=null,ot=null;const at=n.createElement("form"),ct=function(e){return e instanceof RegExp||e instanceof Function},lt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ot||ot!==e){if(e&&"object"==typeof e||(e={}),e=$(e),st=-1===nt.indexOf(e.PARSER_MEDIA_TYPE)?it:e.PARSER_MEDIA_TYPE,rt="application/xhtml+xml"===st?f:m,_e=b(e,"ALLOWED_TAGS")?x({},e.ALLOWED_TAGS,rt):be,ye=b(e,"ALLOWED_ATTR")?x({},e.ALLOWED_ATTR,rt):we,et=b(e,"ALLOWED_NAMESPACES")?x({},e.ALLOWED_NAMESPACES,f):tt,Ve=b(e,"ADD_URI_SAFE_ATTR")?x($(Qe),e.ADD_URI_SAFE_ATTR,rt):Qe,Ge=b(e,"ADD_DATA_URI_TAGS")?x($(We),e.ADD_DATA_URI_TAGS,rt):We,qe=b(e,"FORBID_CONTENTS")?x({},e.FORBID_CONTENTS,rt):He,Se=b(e,"FORBID_TAGS")?x({},e.FORBID_TAGS,rt):{},xe=b(e,"FORBID_ATTR")?x({},e.FORBID_ATTR,rt):{},Be=!!b(e,"USE_PROFILES")&&e.USE_PROFILES,Ee=!1!==e.ALLOW_ARIA_ATTR,$e=!1!==e.ALLOW_DATA_ATTR,Ce=e.ALLOW_UNKNOWN_PROTOCOLS||!1,ke=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Te=e.SAFE_FOR_TEMPLATES||!1,je=!1!==e.SAFE_FOR_XML,Ne=e.WHOLE_DOCUMENT||!1,Me=e.RETURN_DOM||!1,Re=e.RETURN_DOM_FRAGMENT||!1,De=e.RETURN_TRUSTED_TYPE||!1,Ie=e.FORCE_BODY||!1,Le=!1!==e.SANITIZE_DOM,ze=e.SANITIZE_NAMED_PROPS||!1,Fe=!1!==e.KEEP_CONTENT,Ue=e.IN_PLACE||!1,ve=e.ALLOWED_URI_REGEXP||H,Ke=e.NAMESPACE||Xe,Ae=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ae.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ae.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Ae.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&($e=!1),Re&&(Me=!0),Be&&(_e=x({},M),ye=[],!0===Be.html&&(x(_e,k),x(ye,R)),!0===Be.svg&&(x(_e,T),x(ye,D),x(ye,z)),!0===Be.svgFilters&&(x(_e,j),x(ye,D),x(ye,z)),!0===Be.mathMl&&(x(_e,O),x(ye,L),x(ye,z))),e.ADD_TAGS&&(_e===be&&(_e=$(_e)),x(_e,e.ADD_TAGS,rt)),e.ADD_ATTR&&(ye===we&&(ye=$(ye)),x(ye,e.ADD_ATTR,rt)),e.ADD_URI_SAFE_ATTR&&x(Ve,e.ADD_URI_SAFE_ATTR,rt),e.FORBID_CONTENTS&&(qe===He&&(qe=$(qe)),x(qe,e.FORBID_CONTENTS,rt)),Fe&&(_e["#text"]=!0),Ne&&x(_e,["html","head","body"]),_e.table&&(x(_e,["tbody"]),delete Se.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw w('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw w('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');te=e.TRUSTED_TYPES_POLICY,se=te.createHTML("")}else void 0===te&&(te=K(B,o)),null!==te&&"string"==typeof se&&(se=te.createHTML(""));r&&r(e),ot=e}},dt=x({},["mi","mo","mn","ms","mtext"]),ut=x({},["foreignobject","annotation-xml"]),ht=x({},["title","style","font","a","script"]),mt=x({},[...T,...j,...N]),ft=x({},[...O,...I]),gt=function(e){let t=ee(e);t&&t.tagName||(t={namespaceURI:Ke,tagName:"template"});const s=m(e.tagName),n=m(t.tagName);return!!et[e.namespaceURI]&&(e.namespaceURI===Ye?t.namespaceURI===Xe?"svg"===s:t.namespaceURI===Je?"svg"===s&&("annotation-xml"===n||dt[n]):Boolean(mt[s]):e.namespaceURI===Je?t.namespaceURI===Xe?"math"===s:t.namespaceURI===Ye?"math"===s&&ut[n]:Boolean(ft[s]):e.namespaceURI===Xe?!(t.namespaceURI===Ye&&!ut[n])&&!(t.namespaceURI===Je&&!dt[n])&&!ft[s]&&(ht[s]||!mt[s]):!("application/xhtml+xml"!==st||!et[e.namespaceURI]))},pt=function(e){h(s.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.remove()}},vt=function(e,t){try{h(s.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){h(s.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!ye[e])if(Me||Re)try{pt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},_t=function(e){let t=null,s=null;if(Ie)e="<remove></remove>"+e;else{const t=g(e,/^[\r\n\t ]+/);s=t&&t[0]}"application/xhtml+xml"===st&&Ke===Xe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const i=te?te.createHTML(e):e;if(Ke===Xe)try{t=(new U).parseFromString(i,st)}catch(e){}if(!t||!t.documentElement){t=ne.createDocument(Ke,"template",null);try{t.documentElement.innerHTML=Ze?se:i}catch(e){}}const r=t.body||t.documentElement;return e&&s&&r.insertBefore(n.createTextNode(s),r.childNodes[0]||null),Ke===Xe?oe.call(t,Ne?"html":"body")[0]:Ne?t.documentElement:r},bt=function(e){return ie.call(e.ownerDocument||e,e,E.SHOW_ELEMENT|E.SHOW_COMMENT|E.SHOW_TEXT|E.SHOW_PROCESSING_INSTRUCTION|E.SHOW_CDATA_SECTION,null)},yt=function(e){return e instanceof F&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof P)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},wt=function(e){return"function"==typeof A&&e instanceof A},At=function(e,t,n){ce[e]&&d(ce[e],(e=>{e.call(s,t,n,ot)}))},St=function(e){let t=null;if(At("beforeSanitizeElements",e,null),yt(e))return pt(e),!0;const n=rt(e.nodeName);if(At("uponSanitizeElement",e,{tagName:n,allowedTags:_e}),e.hasChildNodes()&&!wt(e.firstElementChild)&&y(/<[/\w]/g,e.innerHTML)&&y(/<[/\w]/g,e.textContent))return pt(e),!0;if(e.nodeType===Y.progressingInstruction)return pt(e),!0;if(je&&e.nodeType===Y.comment&&y(/<[/\w]/g,e.data))return pt(e),!0;if(!_e[n]||Se[n]){if(!Se[n]&&Et(n)){if(Ae.tagNameCheck instanceof RegExp&&y(Ae.tagNameCheck,n))return!1;if(Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(n))return!1}if(Fe&&!qe[n]){const t=ee(e)||e.parentNode,s=Q(e)||e.childNodes;if(s&&t)for(let n=s.length-1;n>=0;--n){const i=G(s[n],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,W(e))}}return pt(e),!0}return e instanceof S&&!gt(e)?(pt(e),!0):"noscript"!==n&&"noembed"!==n&&"noframes"!==n||!y(/<\/no(script|embed|frames)/i,e.innerHTML)?(Te&&e.nodeType===Y.text&&(t=e.textContent,d([le,de,ue],(e=>{t=p(t,e," ")})),e.textContent!==t&&(h(s.removed,{element:e.cloneNode()}),e.textContent=t)),At("afterSanitizeElements",e,null),!1):(pt(e),!0)},xt=function(e,t,s){if(Le&&("id"===t||"name"===t)&&(s in n||s in at))return!1;if($e&&!xe[t]&&y(he,t));else if(Ee&&y(me,t));else if(!ye[t]||xe[t]){if(!(Et(e)&&(Ae.tagNameCheck instanceof RegExp&&y(Ae.tagNameCheck,e)||Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(e))&&(Ae.attributeNameCheck instanceof RegExp&&y(Ae.attributeNameCheck,t)||Ae.attributeNameCheck instanceof Function&&Ae.attributeNameCheck(t))||"is"===t&&Ae.allowCustomizedBuiltInElements&&(Ae.tagNameCheck instanceof RegExp&&y(Ae.tagNameCheck,s)||Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(s))))return!1}else if(Ve[t]);else if(y(ve,p(s,ge,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==v(s,"data:")||!Ge[e])if(Ce&&!y(fe,p(s,ge,"")));else if(s)return!1;return!0},Et=function(e){return"annotation-xml"!==e&&g(e,pe)},$t=function(e){At("beforeSanitizeAttributes",e,null);const{attributes:t}=e;if(!t)return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ye};let i=t.length;for(;i--;){const r=t[i],{name:o,namespaceURI:a,value:c}=r,l=rt(o);let h="value"===o?c:_(c);if(n.attrName=l,n.attrValue=h,n.keepAttr=!0,n.forceKeepAttr=void 0,At("uponSanitizeAttribute",e,n),h=n.attrValue,n.forceKeepAttr)continue;if(vt(o,e),!n.keepAttr)continue;if(!ke&&y(/\/>/i,h)){vt(o,e);continue}if(je&&y(/((--!?|])>)|<\/(style|title)/i,h)){vt(o,e);continue}Te&&d([le,de,ue],(e=>{h=p(h,e," ")}));const m=rt(e.nodeName);if(xt(m,l,h)){if(!ze||"id"!==l&&"name"!==l||(vt(o,e),h=Pe+h),te&&"object"==typeof B&&"function"==typeof B.getAttributeType)if(a);else switch(B.getAttributeType(m,l)){case"TrustedHTML":h=te.createHTML(h);break;case"TrustedScriptURL":h=te.createScriptURL(h)}try{a?e.setAttributeNS(a,o,h):e.setAttribute(o,h),yt(e)?pt(e):u(s.removed)}catch(e){}}}At("afterSanitizeAttributes",e,null)},Ct=function e(t){let s=null;const n=bt(t);for(At("beforeSanitizeShadowDOM",t,null);s=n.nextNode();)At("uponSanitizeShadowNode",s,null),St(s)||(s.content instanceof c&&e(s.content),$t(s));At("afterSanitizeShadowDOM",t,null)};return s.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null,o=null,a=null;if(Ze=!e,Ze&&(e="\x3c!--\x3e"),"string"!=typeof e&&!wt(e)){if("function"!=typeof e.toString)throw w("toString is not a function");if("string"!=typeof(e=e.toString()))throw w("dirty is not a string, aborting")}if(!s.isSupported)return e;if(Oe||lt(t),s.removed=[],"string"==typeof e&&(Ue=!1),Ue){if(e.nodeName){const t=rt(e.nodeName);if(!_e[t]||Se[t])throw w("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof A)n=_t("\x3c!----\x3e"),r=n.ownerDocument.importNode(e,!0),r.nodeType===Y.element&&"BODY"===r.nodeName||"HTML"===r.nodeName?n=r:n.appendChild(r);else{if(!Me&&!Te&&!Ne&&-1===e.indexOf("<"))return te&&De?te.createHTML(e):e;if(n=_t(e),!n)return Me?null:De?se:""}n&&Ie&&pt(n.firstChild);const l=bt(Ue?e:n);for(;o=l.nextNode();)St(o)||(o.content instanceof c&&Ct(o.content),$t(o));if(Ue)return e;if(Me){if(Re)for(a=re.call(n.ownerDocument);n.firstChild;)a.appendChild(n.firstChild);else a=n;return(ye.shadowroot||ye.shadowrootmode)&&(a=ae.call(i,a,!0)),a}let u=Ne?n.outerHTML:n.innerHTML;return Ne&&_e["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&y(V,n.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+u),Te&&d([le,de,ue],(e=>{u=p(u,e," ")})),te&&De?te.createHTML(u):u},s.setConfig=function(){lt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Oe=!0},s.clearConfig=function(){ot=null,Oe=!1},s.isValidAttribute=function(e,t,s){ot||lt({});const n=rt(e),i=rt(t);return xt(n,i,s)},s.addHook=function(e,t){"function"==typeof t&&(ce[e]=ce[e]||[],h(ce[e],t))},s.removeHook=function(e){if(ce[e])return u(ce[e])},s.removeHooks=function(e){ce[e]&&(ce[e]=[])},s.removeAllHooks=function(){ce={}},s}return Z()}()},3077:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinterlace=void 0;t.deinterlace=function(e,t){for(var s=new Array(e.length),n=e.length/t,i=function(n,i){var r=e.slice(i*t,(i+1)*t);s.splice.apply(s,[n*t,t].concat(r))},r=[0,4,2,1],o=[8,8,4,2],a=0,c=0;c<4;c++)for(var l=r[c];l<n;l+=o[c])i(l,a),a++;return s}},9641:(e,t,s)=>{"use strict";t.Ud=t.O5=void 0;var n,i=(n=s(4857))&&n.__esModule?n:{default:n},r=s(4088),o=s(3715),a=s(3077),c=s(7158);t.O5=function(e){var t=new Uint8Array(e);return(0,r.parse)((0,o.buildStream)(t),i.default)};var l=function(e,t,s){if(e.image){var n=e.image,i=n.descriptor.width*n.descriptor.height,r=(0,c.lzw)(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(r=(0,a.deinterlace)(r,n.descriptor.width));var o={pixels:r,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?o.colorTable=n.lct:o.colorTable=t,e.gce&&(o.delay=10*(e.gce.delay||10),o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),s&&(o.patch=function(e){for(var t=e.pixels.length,s=new Uint8ClampedArray(4*t),n=0;n<t;n++){var i=4*n,r=e.pixels[n],o=e.colorTable[r]||[0,0,0];s[i]=o[0],s[i+1]=o[1],s[i+2]=o[2],s[i+3]=r!==e.transparentIndex?255:0}return s}(o)),o}console.warn("gif frame does not have associated image.")};t.Ud=function(e,t){return e.frames.filter((function(e){return e.image})).map((function(s){return l(s,e.gct,t)}))}},7158:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lzw=void 0;t.lzw=function(e,t,s){var n,i,r,o,a,c,l,d,u,h,m,f,g,p,v,_,b=4096,y=s,w=new Array(s),A=new Array(b),S=new Array(b),x=new Array(4097);for(a=(i=1<<(h=e))+1,n=i+2,l=-1,r=(1<<(o=h+1))-1,d=0;d<i;d++)A[d]=0,S[d]=d;for(m=f=g=p=v=_=0,u=0;u<y;){if(0===p){if(f<o){m+=t[_]<<f,f+=8,_++;continue}if(d=m&r,m>>=o,f-=o,d>n||d==a)break;if(d==i){r=(1<<(o=h+1))-1,n=i+2,l=-1;continue}if(-1==l){x[p++]=S[d],l=d,g=d;continue}for(c=d,d==n&&(x[p++]=g,d=l);d>i;)x[p++]=S[d],d=A[d];g=255&S[d],x[p++]=g,n<b&&(A[n]=l,S[n]=g,!(++n&r)&&n<b&&(o++,r+=n)),l=c}p--,w[v++]=x[p],u++}for(u=v;u<y;u++)w[u]=0;return w}},1066:(e,t,s)=>{"use strict";var n,i,r=s.g.MutationObserver||s.g.WebKitMutationObserver;if(r){var o=0,a=new r(u),c=s.g.document.createTextNode("");a.observe(c,{characterData:!0}),n=function(){c.data=o=++o%2}}else if(s.g.setImmediate||void 0===s.g.MessageChannel)n="document"in s.g&&"onreadystatechange"in s.g.document.createElement("script")?function(){var e=s.g.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},s.g.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new s.g.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var d=[];function u(){var e,t;i=!0;for(var s=d.length;s;){for(t=d,d=[],e=-1;++e<s;)t[e]();s=d.length}i=!1}e.exports=function(e){1!==d.push(e)||i||n()}},1615:function(e,t){!function(s,n){var i=Array.prototype,r=Object.prototype,o=i.slice,a=r.hasOwnProperty,c=i.forEach,l={},d={forEach:function(e,t,s){var n,i,r;if(null!==e)if(c&&e.forEach===c)e.forEach(t,s);else if(e.length===+e.length){for(n=0,i=e.length;n<i;n++)if(n in e&&t.call(s,e[n],n,e)===l)return}else for(r in e)if(a.call(e,r)&&t.call(s,e[r],r,e)===l)return},extend:function(e){return this.forEach(o.call(arguments,1),(function(t){for(var s in t)e[s]=t[s]})),e}},u=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=d.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return u.PF.compile(e||"nplurals=2; plural=(n != 1);")}function m(e,t){this._key=e,this._i18n=t}u.context_delimiter=String.fromCharCode(4),d.extend(m.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?u.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),d.extend(u.prototype,{translate:function(e){return new m(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,n,n,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,n,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,n,t)},ngettext:function(e,t,s){return this.dcnpgettext.call(this,n,n,e,t,s)},dngettext:function(e,t,s,i){return this.dcnpgettext.call(this,e,n,t,s,i)},dcngettext:function(e,t,s,i){return this.dcnpgettext.call(this,e,n,t,s,i)},pgettext:function(e,t){return this.dcnpgettext.call(this,n,e,t)},dpgettext:function(e,t,s){return this.dcnpgettext.call(this,e,t,s)},dcpgettext:function(e,t,s){return this.dcnpgettext.call(this,e,t,s)},npgettext:function(e,t,s,i){return this.dcnpgettext.call(this,n,e,t,s,i)},dnpgettext:function(e,t,s,n,i){return this.dcnpgettext.call(this,e,t,s,n,i)},dcnpgettext:function(e,t,s,n,i){var r;if(n=n||s,e=e||this._textdomain,!this.options)return(r=new u).dcnpgettext.call(r,void 0,void 0,s,n,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!s)throw new Error("No translation key found.");var o,a,c,l=t?t+u.context_delimiter+s:s,d=this.options.locale_data,m=d[e],f=(d.messages||this.defaults.locale_data.messages)[""],g=m[""].plural_forms||m[""]["Plural-Forms"]||m[""]["plural-forms"]||f.plural_forms||f["Plural-Forms"]||f["plural-forms"];if(void 0===i)c=0;else{if("number"!=typeof i&&(i=parseInt(i,10),isNaN(i)))throw new Error("The number that was passed in is not a number.");c=h(g)(i)}if(!m)throw new Error("No domain named `"+e+"` could be found.");return!(o=m[l])||c>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(l,e),a=[s,n],!0===this.options.debug&&console.log(a[h(g)(i)]),a[h()(i)]):(a=o[c])||(a=[s,n])[h()(i)]}});var f,g,p=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var s=[];t>0;s[--t]=e);return s.join("")}var s=function(){return s.cache.hasOwnProperty(arguments[0])||(s.cache[arguments[0]]=s.parse(arguments[0])),s.format.call(null,s.cache[arguments[0]],arguments)};return s.format=function(s,n){var i,r,o,a,c,l,d,u=1,h=s.length,m="",f=[];for(r=0;r<h;r++)if("string"===(m=e(s[r])))f.push(s[r]);else if("array"===m){if((a=s[r])[2])for(i=n[u],o=0;o<a[2].length;o++){if(!i.hasOwnProperty(a[2][o]))throw p('[sprintf] property "%s" does not exist',a[2][o]);i=i[a[2][o]]}else i=a[1]?n[a[1]]:n[u++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw p("[sprintf] expecting number but found %s",e(i));switch(null==i&&(i=""),a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,l=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",d=a[6]-String(i).length,c=a[6]?t(l,d):"",f.push(a[5]?i+c:c+i)}return f.join("")},s.cache={},s.parse=function(e){for(var t=e,s=[],n=[],i=0;t;){if(null!==(s=/^[^\x25]+/.exec(t)))n.push(s[0]);else if(null!==(s=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(s=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(s[2]){i|=1;var r=[],o=s[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(r.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";r.push(a[1])}s[2]=r}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(s)}t=t.substring(s[0].length)}return n},s}();u.parse_plural=function(e,t){return e=e.replace(/n/g,t),u.parse_expression(e)},u.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?function(e,t){return t.unshift(e),p.apply(null,t)}(e,[].slice.call(t)):p.apply(this,[].slice.call(arguments))},u.prototype.sprintf=function(){return u.sprintf.apply(this,arguments)},(u.PF={}).parse=function(e){var t=u.PF.extractPluralExpr(e);return u.PF.parser.parse.call(u.PF.parser,t)},u.PF.compile=function(e){var t=u.PF.parse(e);return function(e){return!0===(s=u.PF.interpreter(t)(e))?1:s||0;var s}},u.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return u.PF.interpreter(e.expr)(t);case"TERNARY":return u.PF.interpreter(e.expr)(t)?u.PF.interpreter(e.truthy)(t):u.PF.interpreter(e.falsey)(t);case"OR":return u.PF.interpreter(e.left)(t)||u.PF.interpreter(e.right)(t);case"AND":return u.PF.interpreter(e.left)(t)&&u.PF.interpreter(e.right)(t);case"LT":return u.PF.interpreter(e.left)(t)<u.PF.interpreter(e.right)(t);case"GT":return u.PF.interpreter(e.left)(t)>u.PF.interpreter(e.right)(t);case"LTE":return u.PF.interpreter(e.left)(t)<=u.PF.interpreter(e.right)(t);case"GTE":return u.PF.interpreter(e.left)(t)>=u.PF.interpreter(e.right)(t);case"EQ":return u.PF.interpreter(e.left)(t)==u.PF.interpreter(e.right)(t);case"NEQ":return u.PF.interpreter(e.left)(t)!=u.PF.interpreter(e.right)(t);case"MOD":return u.PF.interpreter(e.left)(t)%u.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},u.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,s=/nplurals\=(\d+);/,n=e.match(s);if(!(n.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(n[1],!((t=(e=e.replace(s,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},u.PF.parser=(f={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,s,n,i,r,o){var a=r.length-1;switch(i){case 1:return{type:"GROUP",expr:r[a-1]};case 2:this.$={type:"TERNARY",expr:r[a-4],truthy:r[a-2],falsey:r[a]};break;case 3:this.$={type:"OR",left:r[a-2],right:r[a]};break;case 4:this.$={type:"AND",left:r[a-2],right:r[a]};break;case 5:this.$={type:"LT",left:r[a-2],right:r[a]};break;case 6:this.$={type:"LTE",left:r[a-2],right:r[a]};break;case 7:this.$={type:"GT",left:r[a-2],right:r[a]};break;case 8:this.$={type:"GTE",left:r[a-2],right:r[a]};break;case 9:this.$={type:"NEQ",left:r[a-2],right:r[a]};break;case 10:this.$={type:"EQ",left:r[a-2],right:r[a]};break;case 11:this.$={type:"MOD",left:r[a-2],right:r[a]};break;case 12:this.$={type:"GROUP",expr:r[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,s=[0],n=[null],i=[],r=this.table,o="",a=0,c=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;function u(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}i.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,m,f,g,p,v,_,b,y,w,A={};;){if(f=s[s.length-1],this.defaultActions[f]?g=this.defaultActions[f]:(null==h&&(h=u()),g=r[f]&&r[f][h]),void 0===g||!g.length||!g[0]){if(!l){for(v in y=[],r[f])this.terminals_[v]&&v>2&&y.push("'"+this.terminals_[v]+"'");var S="";S=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+y.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:y})}if(3==l){if(1==h)throw new Error(S||"Parsing halted.");c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,h=u()}for(;!(2..toString()in r[f]);){if(0==f)throw new Error(S||"Parsing halted.");w=1,s.length=s.length-2*w,n.length=n.length-w,i.length=i.length-w,f=s[s.length-1]}m=h,h=2,g=r[f=s[s.length-1]]&&r[f][2],l=3}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(g[0]){case 1:s.push(h),n.push(this.lexer.yytext),i.push(this.lexer.yylloc),s.push(g[1]),h=null,m?(h=m,m=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,l>0&&l--);break;case 2:if(_=this.productions_[g[1]][1],A.$=n[n.length-_],A._$={first_line:i[i.length-(_||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(_||1)].first_column,last_column:i[i.length-1].last_column},void 0!==(p=this.performAction.call(A,o,c,a,this.yy,g[1],n,i)))return p;_&&(s=s.slice(0,-1*_*2),n=n.slice(0,-1*_),i=i.slice(0,-1*_)),s.push(this.productions_[g[1]][0]),n.push(A.$),i.push(A._$),b=r[s[s.length-2]][s[s.length-1]],s.push(b);break;case 3:return!0}}return!0}},g=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),n=0;n<s.length;n++)if(e=this._input.match(this.rules[s[n]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,s[n],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,s,n){switch(s){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}};return e}(),f.lexer=g,f),e.exports&&(t=e.exports=u),t.Jed=u}()},4088:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loop=t.conditional=t.parse=void 0;t.parse=function e(t,s){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(s))s.forEach((function(s){return e(t,s,n,i)}));else if("function"==typeof s)s(t,n,i,e);else{var r=Object.keys(s)[0];Array.isArray(s[r])?(i[r]={},e(t,s[r],n,i[r])):i[r]=s[r](t,n,i,e)}return n};t.conditional=function(e,t){return function(s,n,i,r){t(s,n,i)&&r(s,e,n,i)}};t.loop=function(e,t){return function(s,n,i,r){for(var o=[],a=s.pos;t(s,n,i);){var c={};if(r(s,e,n,c),s.pos===a)break;a=s.pos,o.push(c)}return o}}},3715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readBits=t.readArray=t.readUnsigned=t.readString=t.peekBytes=t.readBytes=t.peekByte=t.readByte=t.buildStream=void 0;t.buildStream=function(e){return{data:e,pos:0}};var s=function(){return function(e){return e.data[e.pos++]}};t.readByte=s;t.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){return t.data[t.pos+e]}};var n=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};t.readBytes=n;t.peekBytes=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}};t.readString=function(e){return function(t){return Array.from(n(e)(t)).map((function(e){return String.fromCharCode(e)})).join("")}};t.readUnsigned=function(e){return function(t){var s=n(2)(t);return e?(s[1]<<8)+s[0]:(s[0]<<8)+s[1]}};t.readArray=function(e,t){return function(s,i,r){for(var o="function"==typeof t?t(s,i,r):t,a=n(e),c=new Array(o),l=0;l<o;l++)c[l]=a(s);return c}};t.readBits=function(e){return function(t){for(var s=function(e){return e.data[e.pos++]}(t),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(s&1<<i);return Object.keys(e).reduce((function(t,s){var i=e[s];return i.length?t[s]=function(e,t,s){for(var n=0,i=0;i<s;i++)n+=e[t+i]&&Math.pow(2,s-i-1);return n}(n,i.index,i.length):t[s]=n[i.index],t}),{})}}},4857:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(4088),i=s(3715),r={blocks:function(e){for(var t=[],s=e.data.length,n=0,r=(0,i.readByte)()(e);0!==r&&r;r=(0,i.readByte)()(e)){if(e.pos+r>=s){var o=s-e.pos;t.push((0,i.readBytes)(o)(e)),n+=o;break}t.push((0,i.readBytes)(r)(e)),n+=r}for(var a=new Uint8Array(n),c=0,l=0;l<t.length;l++)a.set(t[l],c),c+=t[l].length;return a}},o=(0,n.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&249===t[1]})),a=(0,n.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,n.conditional)({lct:(0,i.readArray)(3,(function(e,t,s){return Math.pow(2,s.descriptor.lct.size+1)}))},(function(e,t,s){return s.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},r]}]},(function(e){return 44===(0,i.peekByte)()(e)})),c=(0,n.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(e,t,s){return(0,i.readBytes)(s.text.blockSize)(e)}},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&1===t[1]})),l=(0,n.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(e,t,s){return(0,i.readString)(s.blockSize)(e)}},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&255===t[1]})),d=(0,n.conditional)({comment:[{codes:(0,i.readBytes)(2)},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&254===t[1]})),u=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,n.conditional)({gct:(0,i.readArray)(3,(function(e,t){return Math.pow(2,t.lsd.gct.size+1)}))},(function(e,t){return t.lsd.gct.exists})),{frames:(0,n.loop)([o,l,d,a,c],(function(e){var t=(0,i.peekByte)()(e);return 33===t||44===t}))}];t.default=u},5641:(e,t,s)=>{"use strict";var n=s(1066);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&m(this,e)}function d(e,t,s){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof s&&(this.onRejected=s,this.callRejected=this.otherCallRejected)}function u(e,t,s){n((function(){var n;try{n=t(s)}catch(t){return r.reject(e,t)}n===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function m(e,t){var s=!1;function n(t){s||(s=!0,r.reject(e,t))}function i(t){s||(s=!0,r.resolve(e,t))}var o=f((function(){t(i,n)}));"error"===o.status&&n(o.value)}function f(e,t){var s={};try{s.value=e(t),s.status="success"}catch(e){s.status="error",s.value=e}return s}e.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var s=new this.constructor(i);this.state!==c?u(s,this.state===a?e:t,this.outcome):this.queue.push(new d(s,e,t));return s},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var s=f(h,t);if("error"===s.status)return r.reject(e,s.value);var n=s.value;if(n)m(e,n);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var s=-1,n=e.queue.length;++s<n;)e.queue[s].callRejected(t);return e},l.resolve=function(e){if(e instanceof this)return e;return r.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return r.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);var o=new Array(s),a=0,c=-1,l=new this(i);for(;++c<s;)d(e[c],c);return l;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==s||n||(n=!0,r.resolve(l,o))}),(function(e){n||(n=!0,r.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);var o=-1,a=new this(i);for(;++o<s;)c=e[o],t.resolve(c).then((function(e){n||(n=!0,r.resolve(a,e))}),(function(e){n||(n=!0,r.reject(a,e))}));var c;return a}},1078:(e,t,s)=>{"use strict";"function"!=typeof s.g.Promise&&(s.g.Promise=s(5641))},8781:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t="localforage-driver-memory";function s(e){var t="function"==typeof Symbol&&e[Symbol.iterator],s=0;return t?t.call(e):{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}}}function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var s=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)s.append(e[n]);return s.getBlob(t.type)}}var i=/^~~local_forage_type~([^~]+)~/,r=9,o=r+4,a=Object.prototype.toString;function c(e){var t=.75*e.length,s=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var n=new ArrayBuffer(t),i=new Uint8Array(n),r=0,o=0;r<s;r+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|l>>2,i[o++]=(3&l)<<6|63&d}return n}function l(e){for(var t=new Uint8Array(e),s="",n=0;n<t.length;n+=3)s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[n]>>2],s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[n])<<4|t[n+1]>>4],s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[n+1])<<2|t[n+2]>>6],s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[n+2]];return t.length%3==2?s=s.substring(0,s.length-1)+"=":t.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}function d(e,t){var s="";if(e&&(s=a.call(e)),e&&("[object ArrayBuffer]"===s||e.buffer&&"[object ArrayBuffer]"===a.call(e.buffer))){var n=void 0,i="__lfsc__:";e instanceof ArrayBuffer?(n=e,i+="arbf"):(n=e.buffer,"[object Int8Array]"===s?i+="si08":"[object Uint8Array]"===s?i+="ui08":"[object Uint8ClampedArray]"===s?i+="uic8":"[object Int16Array]"===s?i+="si16":"[object Uint16Array]"===s?i+="ur16":"[object Int32Array]"===s?i+="si32":"[object Uint32Array]"===s?i+="ui32":"[object Float32Array]"===s?i+="fl32":"[object Float64Array]"===s?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+l(n))}else if("[object Blob]"===s){var r=new FileReader;r.onload=function(){var s="~~local_forage_type~"+e.type+"~"+l(this.result);t("__lfsc__:blob"+s)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(s){console.error("Couldn't convert value into a JSON string: ",e),t(null,s)}}function u(e){if("__lfsc__:"!==e.substring(0,r))return JSON.parse(e);var t,s=e.substring(o),a=e.substring(r,o);if("blob"===a&&i.test(s)){var l=s.match(i);t=l[1],s=s.substring(l[0].length)}var d=c(s);switch(a){case"arbf":return d;case"blob":return n([d],{type:t});case"si08":return new Int8Array(d);case"ui08":return new Uint8Array(d);case"uic8":return new Uint8ClampedArray(d);case"si16":return new Int16Array(d);case"ur16":return new Uint16Array(d);case"si32":return new Int32Array(d);case"ui32":return new Uint32Array(d);case"fl32":return new Float32Array(d);case"fl64":return new Float64Array(d);default:throw new Error("Unkown type: "+a)}}function h(e){var t,n;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var i=e instanceof Date?new Date(e):e.constructor();try{for(var r=s(Object.keys(e)),o=r.next();!o.done;o=r.next()){var a=o.value;Object.prototype.hasOwnProperty.call(e,a)&&(e.isActiveClone=null,i[a]=h(e[a]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return i}function m(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function f(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function g(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function p(e,t){var s=this;if(t=g.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(m(e,s._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function v(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var _={bufferToString:l,deserialize:u,serialize:d,stringToBuffer:c},b={},y=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return b[t]||(b[t]=new e(t)),b[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete b[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function w(e){var t=e?h(e):{},s=m(t,this._defaultConfig),n=y.resolve(s);return this._dbInfo=t,this._dbInfo.serializer=_,this._dbInfo.keyPrefix=s,this._dbInfo.mStore=n,Promise.resolve()}function A(e){var t=this,s=this.ready().then((function(){t._dbInfo.mStore.clear()}));return f(s,e),s}function S(e,t){var s=p.apply(this,arguments),n=s.promise,i=s.callback;return f(n.then((function(e){y.resolve(e).drop()})),i),n}function x(e,t){var s=this;e=v(e);var n=this.ready().then((function(){var t=s._dbInfo.mStore.get(e);return null==t?null:s._dbInfo.serializer.deserialize(t)}));return f(n,t),n}function E(e,t){var s=this,n=this.ready().then((function(){for(var t=s._dbInfo.mStore,n=t.keys(),i=0;i<n.length;i++){var r=t.get(n[i]);if(r&&(r=s._dbInfo.serializer.deserialize(r)),void 0!==(r=e(r,n[i],i+1)))return r}}));return f(n,t),n}function $(e,t){var s=this,n=this.ready().then((function(){var t;try{void 0===(t=s._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return f(n,t),n}function C(e){var t=this,s=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return f(s,e),s}function k(e){var t=this.keys().then((function(e){return e.length}));return f(t,e),t}function T(e,t){var s=this;e=v(e);var n=this.ready().then((function(){s._dbInfo.mStore.rm(e)}));return f(n,t),n}function j(e,t,s){var n=this;e=v(e);var i=this.ready().then((function(){void 0===t&&(t=null);var s=t;return new Promise((function(i,r){n._dbInfo.serializer.serialize(t,(function(t,o){if(o)r(o);else try{n._dbInfo.mStore.set(e,t),i(s)}catch(e){r(e)}}))}))}));return f(i,s),i}var N=!0;e._support=N,e._driver=t,e._initStorage=w,e.clear=A,e.dropInstance=S,e.getItem=x,e.iterate=E,e.key=$,e.keys=C,e.length=k,e.removeItem=T,e.setItem=j,Object.defineProperty(e,"__esModule",{value:!0})}(t)},9212:function(e,t,s){!function(e,t){"use strict";function s(e){return s.result?s.result:e&&"function"==typeof e.getSerializer?(s.result=e.getSerializer(),s.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function n(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,s,n){function i(e,t){var s=e||t;return e&&"function"==typeof e||"string"!=typeof s||(e=function(e){return e[s]}),e}var r=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),s=i(s,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];r.push(n(t(c),s(c)))}}else for(var l in e)e.hasOwnProperty(l)&&r.push(n(l,e[l]));return r}function r(e,t,s,r){var o=this,a=o.ready().then((function(){return new Promise((function(n,r){var a,c=o._dbInfo,l=c.db.transaction(c.storeName,"readwrite"),d=l.objectStore(c.storeName);function u(e){var t=e.target||this;a=t.error||t.transaction.error,r(a)}l.oncomplete=function(){n(e)},l.onabort=l.onerror=function(e){r(a||e.target)},i(e,t,s,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=u}))}))}));return n(a,r),a}function o(e,t,r,o){var a=this,c=new Promise((function(n,o){a.ready().then((function(){return s(a)})).then((function(s){var c=a._dbInfo;c.db.transaction((function(a){var l="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=i(e,t,r,(function(e,t){return new Promise((function(n,i){s.serialize(t,(function(t,s){s?i(s):a.executeSql(l,[e,t],(function(){n()}),(function(e,t){i(t)}))}))}))}));Promise.all(d).then((function(){n(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return n(c,o),c}function a(e,t,s,r){var o=this,a=i(e,t,s,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return n(c,r),c}function c(e,t,s,n){var i=this,c=i.driver();return c===i.INDEXEDDB?r.call(i,e,t,s,n):c===i.WEBSQL?o.call(i,e,t,s,n):a.call(i,e,t,s,n)}function l(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return r.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=l(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=l,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}(t,s(9214))},8372:(e,t,s)=>{"use strict";var n=s(4602);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var s=(0,a.getStorage)(),n=!(!s||!s[t]),c=n?s[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},l=c.clear.bind(c),d=c.get.bind(c),u=c.remove.bind(c),h=c.set.bind(c);return{_driver:e,_support:n,_initStorage:function(){return Promise.resolve()},clear:function(e){return(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l(),e&&e();case 2:case"end":return t.stop()}}),t)})))()},iterate:function(e,t){return(0,o.default)(i.default.mark((function s(){var n;return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.usePromise)(d,null);case 2:n=s.sent,Object.keys(n).forEach((function(t,s){return e(n[t],t,s)})),t&&t();case 6:case"end":return s.stop()}}),s)})))()},getItem:function(e,t){return(0,o.default)(i.default.mark((function s(){var n;return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,a.usePromise)(d,e);case 3:return n=s.sent,n=void 0===(n="string"==typeof e?n[e]:n)?null:n,t&&t(null,n),s.abrupt("return",n);case 10:throw s.prev=10,s.t0=s.catch(0),t&&t(s.t0),s.t0;case 14:case"end":return s.stop()}}),s,null,[[0,10]])})))()},key:function(e,t){return(0,o.default)(i.default.mark((function s(){var n,r;return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.usePromise)(d,null);case 2:return n=s.sent,r=Object.keys(n)[e],t&&t(r),s.abrupt("return",r);case 6:case"end":return s.stop()}}),s)})))()},keys:function(e){return(0,o.default)(i.default.mark((function t(){var s,n;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return s=t.sent,n=Object.keys(s),e&&e(n),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))()},length:function(e){return(0,o.default)(i.default.mark((function t(){var s,n,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return s=t.sent,n=Object.keys(s),r=n.length,e&&e(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},removeItem:function(e,t){return(0,o.default)(i.default.mark((function s(){return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.usePromise)(u,e);case 2:t&&t();case 3:case"end":return s.stop()}}),s)})))()},setItem:function(e,t,s){return(0,o.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(h,(0,r.default)({},e,t));case 2:s&&s();case 3:case"end":return n.stop()}}),n)})))()}}};var i=n(s(460)),r=n(s(2485)),o=n(s(6597)),a=s(9513)},4103:(e,t,s)=>{"use strict";var n=s(4602);t.A=void 0;var i=(0,n(s(8372)).default)("webExtensionLocalStorage","local");t.A=i},6245:(e,t,s)=>{"use strict";var n=s(4602);t.A=void 0;var i=(0,n(s(8372)).default)("webExtensionSyncStorage","sync");t.A=i},9513:(e,t)=>{"use strict";function s(){return"undefined"!=typeof browser&&browser.storage||"undefined"!=typeof chrome&&chrome.storage}Object.defineProperty(t,"__esModule",{value:!0}),t.getStorage=s,t.usePromise=function(e,t){if(function(){var e=s();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}())return e(t);return new Promise((function(s){e(t,(function(){s.apply(void 0,arguments)}))}))}},9214:(e,t,s)=>{e.exports=function e(t,s,n){function i(o,a){if(!s[o]){if(!t[o]){if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=s[o]={exports:{}};t[o][0].call(l.exports,(function(e){var s=t[o][1][e];return i(s||e)}),l,l.exports,e,t,s,n)}return s[o].exports}for(var r=void 0,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){(function(e){"use strict";var s,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var r=0,o=new i(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),s=function(){a.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)s="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,s=function(){c.port2.postMessage(0)}}var l=[];function d(){var e,t;n=!0;for(var s=l.length;s;){for(t=l,l=[],e=-1;++e<s;)t[e]();s=l.length}n=!1}function u(e){1!==l.push(e)||n||s()}t.exports=u}).call(this,void 0!==s.g?s.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,s){"use strict";var n=e(1);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&m(this,e)}function d(e,t,s){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof s&&(this.onRejected=s,this.callRejected=this.otherCallRejected)}function u(e,t,s){n((function(){var n;try{n=t(s)}catch(t){return r.reject(e,t)}n===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function m(e,t){var s=!1;function n(t){s||(s=!0,r.reject(e,t))}function i(t){s||(s=!0,r.resolve(e,t))}function o(){t(i,n)}var a=f(o);"error"===a.status&&n(a.value)}function f(e,t){var s={};try{s.value=e(t),s.status="success"}catch(e){s.status="error",s.value=e}return s}function g(e){return e instanceof this?e:r.resolve(new this(i),e)}function p(e){var t=new this(i);return r.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);for(var o=new Array(s),a=0,c=-1,l=new this(i);++c<s;)d(e[c],c);return l;function d(e,i){function c(e){o[i]=e,++a!==s||n||(n=!0,r.resolve(l,o))}t.resolve(e).then(c,(function(e){n||(n=!0,r.reject(l,e))}))}}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);for(var o=-1,a=new this(i);++o<s;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){n||(n=!0,r.resolve(a,e))}),(function(e){n||(n=!0,r.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var s=new this.constructor(i);return this.state!==c?u(s,this.state===a?e:t,this.outcome):this.queue.push(new d(s,e,t)),s},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var s=f(h,t);if("error"===s.status)return r.reject(e,s.value);var n=s.value;if(n)m(e,n);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var s=-1,n=e.queue.length;++s<n;)e.queue[s].callRejected(t);return e},l.resolve=g,l.reject=p,l.all=v,l.race=_},{1:1}],3:[function(e,t,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==s.g?s.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,s){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=r();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var s=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)s.append(e[n]);return s.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function d(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,s){"function"==typeof t&&e.then(t),"function"==typeof s&&e.catch(s)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function m(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",g=void 0,p={},v=Object.prototype.toString,_="readonly",b="readwrite";function y(e){for(var t=e.length,s=new ArrayBuffer(t),n=new Uint8Array(s),i=0;i<t;i++)n[i]=e.charCodeAt(i);return s}function w(e){return new l((function(t){var s=e.transaction(f,b),n=c([""]);s.objectStore(f).put(n,"key"),s.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},s.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),s=navigator.userAgent.match(/Edge\//);t(s||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function A(e){return"boolean"==typeof g?l.resolve(g):w(e).then((function(e){return g=e}))}function S(e){var t=p[e.name],s={};s.promise=new l((function(e,t){s.resolve=e,s.reject=t})),t.deferredOperations.push(s),t.dbReady?t.dbReady=t.dbReady.then((function(){return s.promise})):t.dbReady=s.promise}function x(e){var t=p[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function E(e,t){var s=p[e.name].deferredOperations.pop();if(s)return s.reject(t),s.promise}function $(e,t){return new l((function(s,n){if(p[e.name]=p[e.name]||D(),e.db){if(!t)return s(e.db);S(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=o.open.apply(o,i);t&&(r.onupgradeneeded=function(t){var s=r.result;try{s.createObjectStore(e.storeName),t.oldVersion<=1&&s.createObjectStore(f)}catch(s){if("ConstraintError"!==s.name)throw s;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),n(r.error)},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close()},s(t),x(e)}}))}function C(e){return $(e,!1)}function k(e){return $(e,!0)}function T(e,t){if(!e.db)return!0;var s=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||s){if(s){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function j(e){return new l((function(t,s){var n=new FileReader;n.onerror=s,n.onloadend=function(s){var n=btoa(s.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)}))}function N(e){return c([y(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function I(e){var t=this,s=t._initReady().then((function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(s,e,e),s}function M(e){S(e);for(var t=p[e.name],s=t.forages,n=0;n<s.length;n++){var i=s[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,C(e).then((function(t){return e.db=t,T(e)?k(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=n})).catch((function(t){throw E(e,t),t}))}function R(e,t,s,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);s(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),k(e)})).then((function(){return M(e).then((function(){R(e,t,s,n-1)}))})).catch(s);s(i)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function L(e){var t=this,s={db:null};if(e)for(var n in e)s[n]=e[n];var i=p[s.name];i||(i=D(),p[s.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=I);var r=[];function o(){return l.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&r.push(c._initReady().catch(o))}var d=i.forages.slice(0);return l.all(r).then((function(){return s.db=i.db,C(s)})).then((function(e){return s.db=e,T(s,t._defaultConfig.version)?k(s):e})).then((function(e){s.db=i.db=e,t._dbInfo=s;for(var n=0;n<d.length;n++){var r=d[n];r!==t&&(r._dbInfo.db=s.db,r._dbInfo.version=s.version)}}))}function z(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){R(s._dbInfo,_,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),O(e)&&(e=N(e)),t(e)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function P(e,t){var s=this,n=new l((function(t,n){s.ready().then((function(){R(s._dbInfo,_,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var s=o.result;if(s){var n=s.value;O(n)&&(n=N(n));var i=e(n,s.key,a++);void 0!==i?t(i):s.continue()}else t()},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function F(e,t,s){var n=this;e=h(e);var i=new l((function(s,i){var r;n.ready().then((function(){return r=n._dbInfo,"[object Blob]"===v.call(t)?A(r.db).then((function(e){return e?t:j(t)})):t})).then((function(t){R(n._dbInfo,b,(function(r,o){if(r)return i(r);try{var a=o.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),s(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return d(i,s),i}function U(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){R(s._dbInfo,b,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){n(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function B(e){var t=this,s=new l((function(e,s){t.ready().then((function(){R(t._dbInfo,b,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return d(s,e),s}function q(e){var t=this,s=new l((function(e,s){t.ready().then((function(){R(t._dbInfo,_,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,e),s}function H(e,t){var s=this,n=new l((function(t,n){e<0?t(null):s.ready().then((function(){R(s._dbInfo,_,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var s=c.result;s?0===e||a?t(s.key):(a=!0,s.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function G(e){var t=this,s=new l((function(e,s){t.ready().then((function(){R(t._dbInfo,_,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,e),s}function W(e,t){t=m.apply(this,arguments);var s=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName);var n,i=this;if(e.name){var r=e.name===s.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):C(e).then((function(t){var s=p[e.name],n=s.forages;s.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}));n=e.storeName?r.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var s=t.version+1;S(e);var n=p[e.name],i=n.forages;t.close();for(var r=0;r<i.length;r++){var a=i[r];a._dbInfo.db=null,a._dbInfo.version=s}var c=new l((function(t,n){var i=o.open(e.name,s);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){n.db=e;for(var t=0;t<i.length;t++){var s=i[t];s._dbInfo.db=e,x(s._dbInfo)}})).catch((function(t){throw(E(e,t)||l.resolve()).catch((function(){})),t}))}})):r.then((function(t){S(e);var s=p[e.name],n=s.forages;t.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;var r=new l((function(t,s){var n=o.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),s(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}));return r.then((function(e){s.db=e;for(var t=0;t<n.length;t++)x(n[t]._dbInfo)})).catch((function(t){throw(E(e,t)||l.resolve()).catch((function(){})),t}))}))}else n=l.reject("Invalid arguments");return d(n,t),n}var V={_driver:"asyncStorage",_initStorage:L,_support:a(),iterate:P,getItem:z,setItem:F,removeItem:U,clear:B,length:q,key:H,keys:G,dropInstance:W};function Q(){return"function"==typeof openDatabase}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y="~~local_forage_type~",X=/^~~local_forage_type~([^~]+)~/,K="__lfsc__:",Z=K.length,ee="arbf",te="blob",se="si08",ne="ui08",ie="uic8",re="si16",oe="si32",ae="ur16",ce="ui32",le="fl32",de="fl64",ue=Z+ee.length,he=Object.prototype.toString;function me(e){var t,s,n,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)s=J.indexOf(e[t]),n=J.indexOf(e[t+1]),i=J.indexOf(e[t+2]),r=J.indexOf(e[t+3]),d[c++]=s<<2|n>>4,d[c++]=(15&n)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function fe(e){var t,s=new Uint8Array(e),n="";for(t=0;t<s.length;t+=3)n+=J[s[t]>>2],n+=J[(3&s[t])<<4|s[t+1]>>4],n+=J[(15&s[t+1])<<2|s[t+2]>>6],n+=J[63&s[t+2]];return s.length%3==2?n=n.substring(0,n.length-1)+"=":s.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function ge(e,t){var s="";if(e&&(s=he.call(e)),e&&("[object ArrayBuffer]"===s||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var n,i=K;e instanceof ArrayBuffer?(n=e,i+=ee):(n=e.buffer,"[object Int8Array]"===s?i+=se:"[object Uint8Array]"===s?i+=ne:"[object Uint8ClampedArray]"===s?i+=ie:"[object Int16Array]"===s?i+=re:"[object Uint16Array]"===s?i+=ae:"[object Int32Array]"===s?i+=oe:"[object Uint32Array]"===s?i+=ce:"[object Float32Array]"===s?i+=le:"[object Float64Array]"===s?i+=de:t(new Error("Failed to get type for BinaryArray"))),t(i+fe(n))}else if("[object Blob]"===s){var r=new FileReader;r.onload=function(){var s=Y+e.type+"~"+fe(this.result);t(K+te+s)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(s){console.error("Couldn't convert value into a JSON string: ",e),t(null,s)}}function pe(e){if(e.substring(0,Z)!==K)return JSON.parse(e);var t,s=e.substring(ue),n=e.substring(Z,ue);if(n===te&&X.test(s)){var i=s.match(X);t=i[1],s=s.substring(i[0].length)}var r=me(s);switch(n){case ee:return r;case te:return c([r],{type:t});case se:return new Int8Array(r);case ne:return new Uint8Array(r);case ie:return new Uint8ClampedArray(r);case re:return new Int16Array(r);case ae:return new Uint16Array(r);case oe:return new Int32Array(r);case ce:return new Uint32Array(r);case le:return new Float32Array(r);case de:return new Float64Array(r);default:throw new Error("Unkown type: "+n)}}var ve={serialize:ge,deserialize:pe,stringToBuffer:me,bufferToString:fe};function _e(e,t,s,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],s,n)}function be(e){var t=this,s={db:null};if(e)for(var n in e)s[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new l((function(e,n){try{s.db=openDatabase(s.name,String(s.version),s.description,s.size)}catch(e){return n(e)}s.db.transaction((function(i){_e(i,s,(function(){t._dbInfo=s,e()}),(function(e,t){n(t)}))}),n)}));return s.serializer=ve,i}function ye(e,t,s,n,i,r){e.executeSql(s,n,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):_e(e,t,(function(){e.executeSql(s,n,i,r)}),r)}),r):r(e,o)}),r)}function we(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,s){var n=s.rows.length?s.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function Ae(e,t){var s=this,n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"SELECT * FROM "+i.storeName,[],(function(s,n){for(var r=n.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function Se(e,t,s,n){var i=this;e=h(e);var r=new l((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(s){ye(s,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void r(Se.apply(i,[e,a,s,n-1]));o(t)}}))}))})).catch(o)}));return d(r,s),r}function xe(e,t,s){return Se.apply(this,[e,t,s,1])}function Ee(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function $e(e){var t=this,s=new l((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ye(t,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,e),s}function Ce(e){var t=this,s=new l((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ye(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(t,s){var n=s.rows.item(0).c;e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,e),s}function ke(e,t){var s=this,n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,s){var n=s.rows.length?s.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function Te(e){var t=this,s=new l((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ye(t,n,"SELECT key FROM "+n.storeName,[],(function(t,s){for(var n=[],i=0;i<s.rows.length;i++)n.push(s.rows.item(i).key);e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,e),s}function je(e){return new l((function(t,s){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(s,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){s(t)}))}),(function(e){s(e)}))}))}function Ne(e,t){t=m.apply(this,arguments);var s=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName);var n,i=this;return d(n=e.name?new l((function(t){var n;n=e.name===s.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(je(n))})).then((function(e){return new l((function(t,s){e.db.transaction((function(n){function i(e){return new l((function(t,s){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){s(t)}))}))}for(var r=[],o=0,a=e.storeNames.length;o<a;o++)r.push(i(e.storeNames[o]));l.all(r).then((function(){t()})).catch((function(e){s(e)}))}),(function(e){s(e)}))}))})):l.reject("Invalid arguments"),t),n}var Oe={_driver:"webSQLStorage",_initStorage:be,_support:Q(),iterate:Ae,getItem:we,setItem:xe,removeItem:Ee,clear:$e,length:Ce,key:ke,keys:Te,dropInstance:Ne};function Ie(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Me(e,t){var s=e.name+"/";return e.storeName!==t.storeName&&(s+=e.storeName+"/"),s}function Re(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function De(){return!Re()||localStorage.length>0}function Le(e){var t=this,s={};if(e)for(var n in e)s[n]=e[n];return s.keyPrefix=Me(e,t._defaultConfig),De()?(t._dbInfo=s,s.serializer=ve,l.resolve()):l.reject()}function ze(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,s=localStorage.length-1;s>=0;s--){var n=localStorage.key(s);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return d(s,e),s}function Pe(e,t){var s=this;e=h(e);var n=s.ready().then((function(){var t=s._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return d(n,t),n}function Fe(e,t){var s=this,n=s.ready().then((function(){for(var t=s._dbInfo,n=t.keyPrefix,i=n.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(n)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return d(n,t),n}function Ue(e,t){var s=this,n=s.ready().then((function(){var t,n=s._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return d(n,t),n}function Be(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo,s=localStorage.length,n=[],i=0;i<s;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n}));return d(s,e),s}function qe(e){var t=this.keys().then((function(e){return e.length}));return d(t,e),t}function He(e,t){var s=this;e=h(e);var n=s.ready().then((function(){var t=s._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return d(n,t),n}function Ge(e,t,s){var n=this;e=h(e);var i=n.ready().then((function(){void 0===t&&(t=null);var s=t;return new l((function(i,r){var o=n._dbInfo;o.serializer.serialize(t,(function(t,n){if(n)r(n);else try{localStorage.setItem(o.keyPrefix+e,t),i(s)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return d(i,s),i}function We(e,t){if(t=m.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var s=this.config();e.name=e.name||s.name,e.storeName=e.storeName||s.storeName}var n,i=this;return n=e.name?new l((function(t){e.storeName?t(Me(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var s=localStorage.key(t);0===s.indexOf(e)&&localStorage.removeItem(s)}})):l.reject("Invalid arguments"),d(n,t),n}var Ve={_driver:"localStorageWrapper",_initStorage:Le,_support:Ie(),iterate:Fe,getItem:Pe,setItem:Ge,removeItem:He,clear:ze,length:qe,key:Ue,keys:Be,dropInstance:We},Qe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Je=function(e,t){for(var s=e.length,n=0;n<s;){if(Qe(e[n],t))return!0;n++}return!1},Ye=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Ke={},Ze={INDEXEDDB:V,WEBSQL:Oe,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],st=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),nt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var s=arguments;return e.ready().then((function(){return e[t].apply(e,s)}))}}function rt(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var s in t)t.hasOwnProperty(s)&&(Ye(t[s])?arguments[0][s]=t[s].slice():arguments[0][s]=t[s])}return arguments[0]}var ot=function(){function e(t){for(var s in i(this,e),Ze)if(Ze.hasOwnProperty(s)){var n=Ze[s],r=n._driver;this[s]=r,Xe[r]||this.defineDriver(n)}this._defaultConfig=rt({},nt),this._config=rt({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,s){var n=new l((function(t,s){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void s(i);for(var r=st.concat("_initStorage"),o=0,a=r.length;o<a;o++){var c=r[o];if((!Je(tt,c)||e[c])&&"function"!=typeof e[c])return void s(i)}var u=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),s=l.reject(t);return d(s,arguments[arguments.length-1]),s}},s=0,n=tt.length;s<n;s++){var i=tt[s];e[i]||(e[i]=t(i))}};u();var h=function(s){Xe[n]&&console.info("Redefining LocalForage driver: "+n),Xe[n]=e,Ke[n]=s,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,s):h(!!e._support):h(!0)}catch(e){s(e)}}));return u(n,t,s),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,s){var n=Xe[e]?l.resolve(Xe[e]):l.reject(new Error("Driver not found."));return u(n,t,s),n},e.prototype.getSerializer=function(e){var t=l.resolve(ve);return u(t,e),t},e.prototype.ready=function(e){var t=this,s=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(s,e,e),s},e.prototype.setDriver=function(e,t,s){var n=this;Ye(e)||(e=[e]);var i=this._getSupportedDrivers(e);function r(){n._config.driver=n.driver()}function o(e){return n._extend(e),r(),n._ready=n._initStorage(n._config),n._ready}function a(e){return function(){var t=0;function s(){for(;t<e.length;){var i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(o).catch(s)}r();var a=new Error("No available storage method found.");return n._driverSet=l.reject(a),n._driverSet}return s()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=c.then((function(){var e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((function(e){n._driver=e._driver,r(),n._wrapLibraryMethodsWithReady(),n._initDriver=a(i)}))})).catch((function(){r();var e=new Error("No available storage method found.");return n._driverSet=l.reject(e),n._driverSet})),u(this._driverSet,t,s),this._driverSet},e.prototype.supports=function(e){return!!Ke[e]},e.prototype._extend=function(e){rt(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],s=0,n=e.length;s<n;s++){var i=e[s];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=st.length;e<t;e++)it(this,st[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)},4360:(e,t,s)=>{var n;!function(i){var r,o,a,c,l,d,u,h,m,f,g,p,v,_,b,y,w,A,S,x="sizzle"+1*new Date,E=i.document,$=0,C=0,k=he(),T=he(),j=he(),N=he(),O=function(e,t){return e===t&&(g=!0),0},I={}.hasOwnProperty,M=[],R=M.pop,D=M.push,L=M.push,z=M.slice,P=function(e,t){for(var s=0,n=e.length;s<n;s++)if(e[s]===t)return s;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\["+U+"*("+B+")(?:"+U+"*([*^$|!~]?=)"+U+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+U+"*\\]",H=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",G=new RegExp(U+"+","g"),W=new RegExp("^"+U+"+|((?:^|[^\\\\])(?:\\\\.)*)"+U+"+$","g"),V=new RegExp("^"+U+"*,"+U+"*"),Q=new RegExp("^"+U+"*([>+~]|"+U+")"+U+"*"),J=new RegExp(U+"|>"),Y=new RegExp(H),X=new RegExp("^"+B+"$"),K={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+U+"*(even|odd|(([+-]|)(\\d*)n|)"+U+"*(?:([+-]|)"+U+"*(\\d+)|))"+U+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+U+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+U+"*((?:-\\d)?\\d*)"+U+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,se=/^[^{]+\{\s*\[native \w/,ne=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ie=/[+~]/,re=new RegExp("\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var s="0x"+e.slice(1)-65536;return t||(s<0?String.fromCharCode(s+65536):String.fromCharCode(s>>10|55296,1023&s|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},le=function(){p()},de=xe((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{L.apply(M=z.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType}catch(e){L={apply:M.length?function(e,t){D.apply(e,z.call(t))}:function(e,t){for(var s=e.length,n=0;e[s++]=t[n++];);e.length=s-1}}}function ue(e,t,s,n){var i,r,a,c,l,u,m,f=t&&t.ownerDocument,g=t?t.nodeType:9;if(s=s||[],"string"!=typeof e||!e||1!==g&&9!==g&&11!==g)return s;if(!n&&(p(t),t=t||v,b)){if(11!==g&&(l=ne.exec(e)))if(i=l[1]){if(9===g){if(!(a=t.getElementById(i)))return s;if(a.id===i)return s.push(a),s}else if(f&&(a=f.getElementById(i))&&S(t,a)&&a.id===i)return s.push(a),s}else{if(l[2])return L.apply(s,t.getElementsByTagName(e)),s;if((i=l[3])&&o.getElementsByClassName&&t.getElementsByClassName)return L.apply(s,t.getElementsByClassName(i)),s}if(o.qsa&&!N[e+" "]&&(!y||!y.test(e))&&(1!==g||"object"!==t.nodeName.toLowerCase())){if(m=e,f=t,1===g&&(J.test(e)||Q.test(e))){for((f=ie.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=x)),r=(u=d(e)).length;r--;)u[r]=(c?"#"+c:":scope")+" "+Se(u[r]);m=u.join(",")}try{return L.apply(s,f.querySelectorAll(m)),s}catch(t){N(e,!0)}finally{c===x&&t.removeAttribute("id")}}}return h(e.replace(W,"$1"),t,s,n)}function he(){var e=[];return function t(s,n){return e.push(s+" ")>a.cacheLength&&delete t[e.shift()],t[s+" "]=n}}function me(e){return e[x]=!0,e}function fe(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ge(e,t){for(var s=e.split("|"),n=s.length;n--;)a.attrHandle[s[n]]=t}function pe(e,t){var s=t&&e,n=s&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(s)for(;s=s.nextSibling;)if(s===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function _e(e){return function(t){var s=t.nodeName.toLowerCase();return("input"===s||"button"===s)&&t.type===e}}function be(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&de(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ye(e){return me((function(t){return t=+t,me((function(s,n){for(var i,r=e([],s.length,t),o=r.length;o--;)s[i=r[o]]&&(s[i]=!(n[i]=s[i]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(r in o=ue.support={},l=ue.isXML=function(e){var t=e&&e.namespaceURI,s=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||s&&s.nodeName||"HTML")},p=ue.setDocument=function(e){var t,s,n=e?e.ownerDocument||e:E;return n!=v&&9===n.nodeType&&n.documentElement?(_=(v=n).documentElement,b=!l(v),E!=v&&(s=v.defaultView)&&s.top!==s&&(s.addEventListener?s.addEventListener("unload",le,!1):s.attachEvent&&s.attachEvent("onunload",le)),o.scope=fe((function(e){return _.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.cssHas=fe((function(){try{return v.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),o.attributes=fe((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=fe((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=se.test(v.getElementsByClassName),o.getById=fe((function(e){return _.appendChild(e).id=x,!v.getElementsByName||!v.getElementsByName(x).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var s=t.getElementById(e);return s?[s]:[]}}):(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){var s=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return s&&s.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var s,n,i,r=t.getElementById(e);if(r){if((s=r.getAttributeNode("id"))&&s.value===e)return[r];for(i=t.getElementsByName(e),n=0;r=i[n++];)if((s=r.getAttributeNode("id"))&&s.value===e)return[r]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var s,n=[],i=0,r=t.getElementsByTagName(e);if("*"===e){for(;s=r[i++];)1===s.nodeType&&n.push(s);return n}return r},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&b)return t.getElementsByClassName(e)},w=[],y=[],(o.qsa=se.test(v.querySelectorAll))&&(fe((function(e){var t;_.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+U+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+U+"*(?:value|"+F+")"),e.querySelectorAll("[id~="+x+"-]").length||y.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||y.push("\\["+U+"*name"+U+"*="+U+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||y.push(".#.+[+~]"),e.querySelectorAll("\\\f"),y.push("[\\r\\n\\f]")})),fe((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+U+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),_.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")}))),(o.matchesSelector=se.test(A=_.matches||_.webkitMatchesSelector||_.mozMatchesSelector||_.oMatchesSelector||_.msMatchesSelector))&&fe((function(e){o.disconnectedMatch=A.call(e,"*"),A.call(e,"[s!='']:x"),w.push("!=",H)})),o.cssHas||y.push(":has"),y=y.length&&new RegExp(y.join("|")),w=w.length&&new RegExp(w.join("|")),t=se.test(_.compareDocumentPosition),S=t||se.test(_.contains)?function(e,t){var s=9===e.nodeType&&e.documentElement||e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(s.contains?s.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},O=t?function(e,t){if(e===t)return g=!0,0;var s=!e.compareDocumentPosition-!t.compareDocumentPosition;return s||(1&(s=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===s?e==v||e.ownerDocument==E&&S(E,e)?-1:t==v||t.ownerDocument==E&&S(E,t)?1:f?P(f,e)-P(f,t):0:4&s?-1:1)}:function(e,t){if(e===t)return g=!0,0;var s,n=0,i=e.parentNode,r=t.parentNode,o=[e],a=[t];if(!i||!r)return e==v?-1:t==v?1:i?-1:r?1:f?P(f,e)-P(f,t):0;if(i===r)return pe(e,t);for(s=e;s=s.parentNode;)o.unshift(s);for(s=t;s=s.parentNode;)a.unshift(s);for(;o[n]===a[n];)n++;return n?pe(o[n],a[n]):o[n]==E?-1:a[n]==E?1:0},v):v},ue.matches=function(e,t){return ue(e,null,null,t)},ue.matchesSelector=function(e,t){if(p(e),o.matchesSelector&&b&&!N[t+" "]&&(!w||!w.test(t))&&(!y||!y.test(t)))try{var s=A.call(e,t);if(s||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return s}catch(e){N(t,!0)}return ue(t,v,null,[e]).length>0},ue.contains=function(e,t){return(e.ownerDocument||e)!=v&&p(e),S(e,t)},ue.attr=function(e,t){(e.ownerDocument||e)!=v&&p(e);var s=a.attrHandle[t.toLowerCase()],n=s&&I.call(a.attrHandle,t.toLowerCase())?s(e,t,!b):void 0;return void 0!==n?n:o.attributes||!b?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},ue.escape=function(e){return(e+"").replace(ae,ce)},ue.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ue.uniqueSort=function(e){var t,s=[],n=0,i=0;if(g=!o.detectDuplicates,f=!o.sortStable&&e.slice(0),e.sort(O),g){for(;t=e[i++];)t===e[i]&&(n=s.push(i));for(;n--;)e.splice(s[n],1)}return f=null,e},c=ue.getText=function(e){var t,s="",n=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)s+=c(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[n++];)s+=c(t);return s},a=ue.selectors={cacheLength:50,createPseudo:me,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(re,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(re,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ue.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ue.error(e[0]),e},PSEUDO:function(e){var t,s=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":s&&Y.test(s)&&(t=d(s,!0))&&(t=s.indexOf(")",s.length-t)-s.length)&&(e[0]=e[0].slice(0,t),e[2]=s.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(re,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=k[e+" "];return t||(t=new RegExp("(^|"+U+")"+e+"("+U+"|$)"))&&k(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,s){return function(n){var i=ue.attr(n,e);return null==i?"!="===t:!t||(i+="","="===t?i===s:"!="===t?i!==s:"^="===t?s&&0===i.indexOf(s):"*="===t?s&&i.indexOf(s)>-1:"$="===t?s&&i.slice(-s.length)===s:"~="===t?(" "+i.replace(G," ")+" ").indexOf(s)>-1:"|="===t&&(i===s||i.slice(0,s.length+1)===s+"-"))}},CHILD:function(e,t,s,n,i){var r="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===i?function(e){return!!e.parentNode}:function(t,s,c){var l,d,u,h,m,f,g=r!==o?"nextSibling":"previousSibling",p=t.parentNode,v=a&&t.nodeName.toLowerCase(),_=!c&&!a,b=!1;if(p){if(r){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[o?p.firstChild:p.lastChild],o&&_){for(b=(m=(l=(d=(u=(h=p)[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===$&&l[1])&&l[2],h=m&&p.childNodes[m];h=++m&&h&&h[g]||(b=m=0)||f.pop();)if(1===h.nodeType&&++b&&h===t){d[e]=[$,m,b];break}}else if(_&&(b=m=(l=(d=(u=(h=t)[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===$&&l[1]),!1===b)for(;(h=++m&&h&&h[g]||(b=m=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++b||(_&&((d=(u=h[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[$,b]),h!==t)););return(b-=i)===n||b%n==0&&b/n>=0}}},PSEUDO:function(e,t){var s,n=a.pseudos[e]||a.setFilters[e.toLowerCase()]||ue.error("unsupported pseudo: "+e);return n[x]?n(t):n.length>1?(s=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?me((function(e,s){for(var i,r=n(e,t),o=r.length;o--;)e[i=P(e,r[o])]=!(s[i]=r[o])})):function(e){return n(e,0,s)}):n}},pseudos:{not:me((function(e){var t=[],s=[],n=u(e.replace(W,"$1"));return n[x]?me((function(e,t,s,i){for(var r,o=n(e,null,i,[]),a=e.length;a--;)(r=o[a])&&(e[a]=!(t[a]=r))})):function(e,i,r){return t[0]=e,n(t,null,r,s),t[0]=null,!s.pop()}})),has:me((function(e){return function(t){return ue(e,t).length>0}})),contains:me((function(e){return e=e.replace(re,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:me((function(e){return X.test(e||"")||ue.error("unsupported lang: "+e),e=e.replace(re,oe).toLowerCase(),function(t){var s;do{if(s=b?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(s=s.toLowerCase())===e||0===s.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===_},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:be(!1),disabled:be(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ye((function(){return[0]})),last:ye((function(e,t){return[t-1]})),eq:ye((function(e,t,s){return[s<0?s+t:s]})),even:ye((function(e,t){for(var s=0;s<t;s+=2)e.push(s);return e})),odd:ye((function(e,t){for(var s=1;s<t;s+=2)e.push(s);return e})),lt:ye((function(e,t,s){for(var n=s<0?s+t:s>t?t:s;--n>=0;)e.push(n);return e})),gt:ye((function(e,t,s){for(var n=s<0?s+t:s;++n<t;)e.push(n);return e}))}},a.pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[r]=ve(r);for(r in{submit:!0,reset:!0})a.pseudos[r]=_e(r);function Ae(){}function Se(e){for(var t=0,s=e.length,n="";t<s;t++)n+=e[t].value;return n}function xe(e,t,s){var n=t.dir,i=t.next,r=i||n,o=s&&"parentNode"===r,a=C++;return t.first?function(t,s,i){for(;t=t[n];)if(1===t.nodeType||o)return e(t,s,i);return!1}:function(t,s,c){var l,d,u,h=[$,a];if(c){for(;t=t[n];)if((1===t.nodeType||o)&&e(t,s,c))return!0}else for(;t=t[n];)if(1===t.nodeType||o)if(d=(u=t[x]||(t[x]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[n]||t;else{if((l=d[r])&&l[0]===$&&l[1]===a)return h[2]=l[2];if(d[r]=h,h[2]=e(t,s,c))return!0}return!1}}function Ee(e){return e.length>1?function(t,s,n){for(var i=e.length;i--;)if(!e[i](t,s,n))return!1;return!0}:e[0]}function $e(e,t,s,n,i){for(var r,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(r=e[a])&&(s&&!s(r,n,i)||(o.push(r),l&&t.push(a)));return o}function Ce(e,t,s,n,i,r){return n&&!n[x]&&(n=Ce(n)),i&&!i[x]&&(i=Ce(i,r)),me((function(r,o,a,c){var l,d,u,h=[],m=[],f=o.length,g=r||function(e,t,s){for(var n=0,i=t.length;n<i;n++)ue(e,t[n],s);return s}(t||"*",a.nodeType?[a]:a,[]),p=!e||!r&&t?g:$e(g,h,e,a,c),v=s?i||(r?e:f||n)?[]:o:p;if(s&&s(p,v,a,c),n)for(l=$e(v,m),n(l,[],a,c),d=l.length;d--;)(u=l[d])&&(v[m[d]]=!(p[m[d]]=u));if(r){if(i||e){if(i){for(l=[],d=v.length;d--;)(u=v[d])&&l.push(p[d]=u);i(null,v=[],l,c)}for(d=v.length;d--;)(u=v[d])&&(l=i?P(r,u):h[d])>-1&&(r[l]=!(o[l]=u))}}else v=$e(v===o?v.splice(f,v.length):v),i?i(null,o,v,c):L.apply(o,v)}))}function ke(e){for(var t,s,n,i=e.length,r=a.relative[e[0].type],o=r||a.relative[" "],c=r?1:0,l=xe((function(e){return e===t}),o,!0),d=xe((function(e){return P(t,e)>-1}),o,!0),u=[function(e,s,n){var i=!r&&(n||s!==m)||((t=s).nodeType?l(e,s,n):d(e,s,n));return t=null,i}];c<i;c++)if(s=a.relative[e[c].type])u=[xe(Ee(u),s)];else{if((s=a.filter[e[c].type].apply(null,e[c].matches))[x]){for(n=++c;n<i&&!a.relative[e[n].type];n++);return Ce(c>1&&Ee(u),c>1&&Se(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(W,"$1"),s,c<n&&ke(e.slice(c,n)),n<i&&ke(e=e.slice(n)),n<i&&Se(e))}u.push(s)}return Ee(u)}Ae.prototype=a.filters=a.pseudos,a.setFilters=new Ae,d=ue.tokenize=function(e,t){var s,n,i,r,o,c,l,d=T[e+" "];if(d)return t?0:d.slice(0);for(o=e,c=[],l=a.preFilter;o;){for(r in s&&!(n=V.exec(o))||(n&&(o=o.slice(n[0].length)||o),c.push(i=[])),s=!1,(n=Q.exec(o))&&(s=n.shift(),i.push({value:s,type:n[0].replace(W," ")}),o=o.slice(s.length)),a.filter)!(n=K[r].exec(o))||l[r]&&!(n=l[r](n))||(s=n.shift(),i.push({value:s,type:r,matches:n}),o=o.slice(s.length));if(!s)break}return t?o.length:o?ue.error(e):T(e,c).slice(0)},u=ue.compile=function(e,t){var s,n=[],i=[],r=j[e+" "];if(!r){for(t||(t=d(e)),s=t.length;s--;)(r=ke(t[s]))[x]?n.push(r):i.push(r);r=j(e,function(e,t){var s=t.length>0,n=e.length>0,i=function(i,r,o,c,l){var d,u,h,f=0,g="0",_=i&&[],y=[],w=m,A=i||n&&a.find.TAG("*",l),S=$+=null==w?1:Math.random()||.1,x=A.length;for(l&&(m=r==v||r||l);g!==x&&null!=(d=A[g]);g++){if(n&&d){for(u=0,r||d.ownerDocument==v||(p(d),o=!b);h=e[u++];)if(h(d,r||v,o)){c.push(d);break}l&&($=S)}s&&((d=!h&&d)&&f--,i&&_.push(d))}if(f+=g,s&&g!==f){for(u=0;h=t[u++];)h(_,y,r,o);if(i){if(f>0)for(;g--;)_[g]||y[g]||(y[g]=R.call(c));y=$e(y)}L.apply(c,y),l&&!i&&y.length>0&&f+t.length>1&&ue.uniqueSort(c)}return l&&($=S,m=w),_};return s?me(i):i}(i,n)),r.selector=e}return r},h=ue.select=function(e,t,s,n){var i,r,o,c,l,h="function"==typeof e&&e,m=!n&&d(e=h.selector||e);if(s=s||[],1===m.length){if((r=m[0]=m[0].slice(0)).length>2&&"ID"===(o=r[0]).type&&9===t.nodeType&&b&&a.relative[r[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(re,oe),t)||[])[0]))return s;h&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(i=K.needsContext.test(e)?0:r.length;i--&&(o=r[i],!a.relative[c=o.type]);)if((l=a.find[c])&&(n=l(o.matches[0].replace(re,oe),ie.test(r[0].type)&&we(t.parentNode)||t))){if(r.splice(i,1),!(e=n.length&&Se(r)))return L.apply(s,n),s;break}}return(h||u(e,m))(n,t,!b,s,!t||ie.test(e)&&we(t.parentNode)||t),s},o.sortStable=x.split("").sort(O).join("")===x,o.detectDuplicates=!!g,p(),o.sortDetached=fe((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),fe((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ge("type|href|height|width",(function(e,t,s){if(!s)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&fe((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ge("value",(function(e,t,s){if(!s&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),fe((function(e){return null==e.getAttribute("disabled")}))||ge(F,(function(e,t,s){var n;if(!s)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}));var Te=i.Sizzle;ue.noConflict=function(){return i.Sizzle===ue&&(i.Sizzle=Te),ue},void 0===(n=function(){return ue}.call(t,s,t,e))||(e.exports=n)}(window)},5072:e=>{"use strict";var t=[];function s(e){for(var s=-1,n=0;n<t.length;n++)if(t[n].identifier===e){s=n;break}return s}function n(e,n){for(var r={},o=[],a=0;a<e.length;a++){var c=e[a],l=n.base?c[0]+n.base:c[0],d=r[l]||0,u="".concat(l," ").concat(d);r[l]=d+1;var h=s(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)t[h].references++,t[h].updater(m);else{var f=i(m,n);n.byIndex=a,t.splice(a,0,{identifier:u,updater:f,references:1})}o.push(u)}return o}function i(e,t){var s=t.domAPI(t);s.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,i){var r=n(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=s(r[o]);t[a].references--}for(var c=n(e,i),l=0;l<r.length;l++){var d=s(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},7659:e=>{"use strict";var t={};e.exports=function(e,s){var n=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(e,t,s)=>{"use strict";e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var i=void 0!==s.layer;i&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,i&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},3883:(e,t,s)=>{var n={"./af/LC_MESSAGES/converse.po":[5544,4267],"./ar/LC_MESSAGES/converse.po":[788,5743],"./be/LC_MESSAGES/converse.po":[9174,1437],"./bg/LC_MESSAGES/converse.po":[9088,6179],"./ca/LC_MESSAGES/converse.po":[6929,962],"./cs/LC_MESSAGES/converse.po":[4359,8252],"./da/LC_MESSAGES/converse.po":[1712,6963],"./de/LC_MESSAGES/converse.po":[7532,6311],"./el/LC_MESSAGES/converse.po":[6202,345],"./eo/LC_MESSAGES/converse.po":[7653,7494],"./es/LC_MESSAGES/converse.po":[8209,4202],"./eu/LC_MESSAGES/converse.po":[4147,2168],"./fa/LC_MESSAGES/converse.po":[4750,453],"./fi/LC_MESSAGES/converse.po":[6742,3613],"./fr/LC_MESSAGES/converse.po":[2889,3698],"./gl/LC_MESSAGES/converse.po":[2504,2787],"./he/LC_MESSAGES/converse.po":[5424,8227],"./hi/LC_MESSAGES/converse.po":[7140,799],"./hu/LC_MESSAGES/converse.po":[1520,9139],"./id/LC_MESSAGES/converse.po":[4326,4749],"./it/LC_MESSAGES/converse.po":[8854,6109],"./ja/LC_MESSAGES/converse.po":[762,3881],"./ko/LC_MESSAGES/converse.po":[6227,528],"./lt/LC_MESSAGES/converse.po":[8261,1462],"./mr/LC_MESSAGES/converse.po":[4632,507],"./nb/LC_MESSAGES/converse.po":[6529,9562],"./nl/LC_MESSAGES/converse.po":[347,4336],"./nl_BE/LC_MESSAGES/converse.po":[2361,290],"./oc/LC_MESSAGES/converse.po":[107,7576],"./pl/LC_MESSAGES/converse.po":[2993,7370],"./pt/LC_MESSAGES/converse.po":[3385,2546],"./pt_BR/LC_MESSAGES/converse.po":[3096,4315],"./ro/LC_MESSAGES/converse.po":[9576,1963],"./ru/LC_MESSAGES/converse.po":[6166,6733],"./si/LC_MESSAGES/converse.po":[8553,8714],"./sq/LC_MESSAGES/converse.po":[8785,4146],"./sv/LC_MESSAGES/converse.po":[6850,6345],"./th/LC_MESSAGES/converse.po":[3161,3330],"./tr/LC_MESSAGES/converse.po":[9815,548],"./ug/LC_MESSAGES/converse.po":[1661,2894],"./uk/LC_MESSAGES/converse.po":[3689,8898],"./vi/LC_MESSAGES/converse.po":[358,221],"./zh_CN/LC_MESSAGES/converse.po":[5645,6550],"./zh_TW/LC_MESSAGES/converse.po":[5097,8986]};function i(e){if(!s.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return s.e(t[1]).then((()=>s.t(i,19)))}i.keys=()=>Object.keys(n),i.id=3883,e.exports=i},6597:e=>{function t(e,t,s,n,i,r,o){try{var a=e[r](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var s=this,n=arguments;return new Promise((function(i,r){var o=e.apply(s,n);function a(e){t(o,i,r,a,c,"next",e)}function c(e){t(o,i,r,a,c,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},2485:(e,t,s)=>{var n=s(1344);e.exports=function(e,t,s){return(t=n(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e},e.exports.__esModule=!0,e.exports.default=e.exports},4602:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},2081:(e,t,s)=>{var n=s(5410).default;function i(){"use strict";e.exports=i=function(){return s},e.exports.__esModule=!0,e.exports.default=e.exports;var t,s={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,s){e[t]=s.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function h(e,t,s){return Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(t){h=function(e,t,s){return e[t]=s}}function m(e,t,s,n){var i=t&&t.prototype instanceof y?t:y,r=Object.create(i.prototype),o=new I(n||[]);return a(r,"_invoke",{value:T(e,s,o)}),r}function f(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(e){return{type:"throw",arg:e}}}s.wrap=m;var g="suspendedStart",p="suspendedYield",v="executing",_="completed",b={};function y(){}function w(){}function A(){}var S={};h(S,l,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(M([])));E&&E!==r&&o.call(E,l)&&(S=E);var $=A.prototype=y.prototype=Object.create(S);function C(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function s(i,r,a,c){var l=f(e[i],e,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==n(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){s("next",e,a,c)}),(function(e){s("throw",e,a,c)})):t.resolve(u).then((function(e){d.value=e,a(d)}),(function(e){return s("throw",e,a,c)}))}c(l.arg)}var i;a(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,i){s(e,n,t,i)}))}return i=i?i.then(r,r):r()}})}function T(e,s,n){var i=g;return function(r,o){if(i===v)throw Error("Generator is already running");if(i===_){if("throw"===r)throw o;return{value:t,done:!0}}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var c=j(a,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===g)throw i=_,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var l=f(e,s,n);if("normal"===l.type){if(i=n.done?_:p,l.arg===b)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=_,n.method="throw",n.arg=l.arg)}}}function j(e,s){var n=s.method,i=e.iterator[n];if(i===t)return s.delegate=null,"throw"===n&&e.iterator.return&&(s.method="return",s.arg=t,j(e,s),"throw"===s.method)||"return"!==n&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var r=f(i,e.iterator,s.arg);if("throw"===r.type)return s.method="throw",s.arg=r.arg,s.delegate=null,b;var o=r.arg;return o?o.done?(s[e.resultName]=o.value,s.next=e.nextLoc,"return"!==s.method&&(s.method="next",s.arg=t),s.delegate=null,b):o:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,b)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function M(e){if(e||""===e){var s=e[l];if(s)return s.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function s(){for(;++i<e.length;)if(o.call(e,i))return s.value=e[i],s.done=!1,s;return s.value=t,s.done=!0,s};return r.next=r}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=A,a($,"constructor",{value:A,configurable:!0}),a(A,"constructor",{value:w,configurable:!0}),w.displayName=h(A,u,"GeneratorFunction"),s.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,A):(e.__proto__=A,h(e,u,"GeneratorFunction")),e.prototype=Object.create($),e},s.awrap=function(e){return{__await:e}},C(k.prototype),h(k.prototype,d,(function(){return this})),s.AsyncIterator=k,s.async=function(e,t,n,i,r){void 0===r&&(r=Promise);var o=new k(m(e,t,n,i),r);return s.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C($),h($,u,"Generator"),h($,l,(function(){return this})),h($,"toString",(function(){return"[object Generator]"})),s.keys=function(e){var t=Object(e),s=[];for(var n in t)s.push(n);return s.reverse(),function e(){for(;s.length;){var n=s.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},s.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var s in this)"t"===s.charAt(0)&&o.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var s=this;function n(n,i){return a.type="throw",a.arg=e,s.next=n,i&&(s.method="next",s.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var c=o.call(r,"catchLoc"),l=o.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),O(s),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var n=s.completion;if("throw"===n.type){var i=n.arg;O(s)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,s,n){return this.delegate={iterator:M(e),resultName:s,nextLoc:n},"next"===this.method&&(this.arg=t),b}},s}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3517:(e,t,s)=>{var n=s(5410).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},1344:(e,t,s)=>{var n=s(5410).default,i=s(3517);e.exports=function(e){var t=i(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},5410:e=>{function t(s){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(s)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},460:(e,t,s)=>{var n=s(2081)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={id:e,loaded:!1,exports:{}};return i[e].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(s,n){if(1&n&&(s=this(s)),8&n)return s;if("object"==typeof s&&s){if(4&n&&s.__esModule)return s;if(16&n&&"function"==typeof s.then)return s}var i=Object.create(null);o.r(i);var r={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&s;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>s[e]));return r.default=()=>s,o.d(i,r),i},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,s)=>(o.f[s](e,t),t)),[])),o.u=e=>({7:"locales/dayjs/nb-js",131:"locales/dayjs/ar-sa-js",138:"locales/dayjs/tzm-latn-js",221:"locales/vi-LC_MESSAGES-converse-po",290:"locales/nl_BE-LC_MESSAGES-converse-po",345:"locales/el-LC_MESSAGES-converse-po",385:"locales/dayjs/et-js",422:"locales/dayjs/tk-js",453:"locales/fa-LC_MESSAGES-converse-po",507:"locales/mr-LC_MESSAGES-converse-po",528:"locales/ko-LC_MESSAGES-converse-po",548:"locales/tr-LC_MESSAGES-converse-po",561:"locales/dayjs/my-js",591:"locales/dayjs/es-mx-js",598:"locales/dayjs/fa-js",687:"locales/dayjs/ku-js",799:"locales/hi-LC_MESSAGES-converse-po",832:"locales/dayjs/ta-js",861:"locales/dayjs/ar-kw-js",933:"locales/dayjs/eu-js",948:"locales/dayjs/uz-js",962:"locales/ca-LC_MESSAGES-converse-po",1056:"locales/dayjs/mn-js",1072:"locales/dayjs/bg-js",1116:"locales/dayjs/bs-js",1275:"locales/dayjs/nn-js",1373:"locales/dayjs/lb-js",1388:"locales/dayjs/ur-js",1437:"locales/be-LC_MESSAGES-converse-po",1462:"locales/lt-LC_MESSAGES-converse-po",1464:"locales/dayjs/bo-js",1665:"locales/dayjs/en-ie-js",1696:"locales/dayjs/ar-ly-js",1712:"locales/dayjs/hu-js",1719:"locales/dayjs/oc-lnc-js",1827:"locales/dayjs/es-js",1938:"locales/dayjs/bi-js",1963:"locales/ro-LC_MESSAGES-converse-po",1982:"locales/dayjs/sv-js",2014:"locales/dayjs/pt-br-js",2091:"locales/dayjs/ms-js",2168:"locales/eu-LC_MESSAGES-converse-po",2241:"locales/dayjs/hr-js",2366:"locales/dayjs/be-js",2384:"locales/dayjs/he-js",2389:"locales/dayjs/sw-js",2546:"locales/pt-LC_MESSAGES-converse-po",2643:"locales/dayjs/br-js",2664:"locales/dayjs/pa-in-js",2766:"locales/dayjs/cv-js",2769:"locales/dayjs/ss-js",2787:"locales/gl-LC_MESSAGES-converse-po",2856:"locales/dayjs/es-pr-js",2894:"locales/ug-LC_MESSAGES-converse-po",2974:"emojis",2993:"locales/dayjs/dv-js",3014:"locales/dayjs/mt-js",3166:"locales/dayjs/fi-js",3287:"locales/dayjs/km-js",3330:"locales/th-LC_MESSAGES-converse-po",3341:"locales/dayjs/en-sg-js",3359:"locales/dayjs/is-js",3519:"locales/dayjs/rn-js",3613:"locales/fi-LC_MESSAGES-converse-po",3664:"locales/dayjs/sd-js",3683:"locales/dayjs/tzl-js",3698:"locales/fr-LC_MESSAGES-converse-po",3729:"locales/dayjs/mi-js",3731:"locales/dayjs/ug-cn-js",3741:"locales/dayjs/ar-dz-js",3774:"locales/dayjs/vi-js",3881:"locales/ja-LC_MESSAGES-converse-po",4034:"locales/dayjs/it-js",4094:"locales/dayjs/en-gb-js",4107:"locales/dayjs/uk-js",4146:"locales/sq-LC_MESSAGES-converse-po",4182:"locales/dayjs/es-us-js",4202:"locales/es-LC_MESSAGES-converse-po",4260:"locales/dayjs/mr-js",4267:"locales/af-LC_MESSAGES-converse-po",4315:"locales/pt_BR-LC_MESSAGES-converse-po",4333:"locales/dayjs/me-js",4336:"locales/nl-LC_MESSAGES-converse-po",4385:"locales/dayjs/zh-cn-js",4434:"locales/dayjs/ja-js",4497:"locales/dayjs/zh-js",4512:"locales/dayjs/ms-my-js",4523:"locales/dayjs/ka-js",4584:"locales/dayjs/ro-js",4636:"locales/dayjs/te-js",4718:"locales/dayjs/it-ch-js",4749:"locales/id-LC_MESSAGES-converse-po",4770:"locales/dayjs/id-js",4852:"locales/dayjs/hi-js",4858:"locales/dayjs/sr-js",4859:"locales/dayjs/lt-js",4974:"locales/dayjs/kn-js",5036:"locales/dayjs/de-js",5059:"locales/dayjs/mk-js",5284:"locales/dayjs/gd-js",5534:"locales/dayjs/de-at-js",5611:"locales/dayjs/en-ca-js",5628:"locales/dayjs/af-js",5724:"locales/dayjs/gl-js",5743:"locales/ar-LC_MESSAGES-converse-po",5790:"locales/dayjs/x-pseudo-js",5825:"locales/dayjs/cs-js",5946:"locales/dayjs/ne-js",5970:"locales/dayjs/uz-latn-js",5998:"locales/dayjs/ml-js",6007:"locales/dayjs/ht-js",6042:"locales/dayjs/lo-js",6064:"locales/dayjs/de-ch-js",6109:"locales/it-LC_MESSAGES-converse-po",6121:"locales/dayjs/en-au-js",6124:"locales/dayjs/bn-bd-js",6179:"locales/bg-LC_MESSAGES-converse-po",6191:"locales/dayjs/pt-js",6208:"locales/dayjs/da-js",6311:"locales/de-LC_MESSAGES-converse-po",6343:"locales/dayjs/pl-js",6345:"locales/sv-LC_MESSAGES-converse-po",6486:"locales/dayjs/bm-js",6537:"locales/dayjs/sk-js",6550:"locales/zh_CN-LC_MESSAGES-converse-po",6605:"locales/dayjs/ar-iq-js",6641:"locales/dayjs/kk-js",6655:"locales/dayjs/th-js",6660:"locales/dayjs/sv-fi-js",6733:"locales/ru-LC_MESSAGES-converse-po",6803:"locales/dayjs/yo-js",6824:"locales/dayjs/en-js",6963:"locales/da-LC_MESSAGES-converse-po",7003:"locales/dayjs/cy-js",7013:"locales/dayjs/zh-hk-js",7028:"locales/dayjs/en-in-js",7370:"locales/pl-LC_MESSAGES-converse-po",7385:"locales/dayjs/ar-ma-js",7491:"locales/dayjs/ky-js",7494:"locales/eo-LC_MESSAGES-converse-po",7497:"locales/dayjs/nl-js",7576:"locales/oc-LC_MESSAGES-converse-po",7596:"locales/dayjs/fo-js",7627:"locales/dayjs/en-tt-js",7743:"locales/dayjs/ga-js",7801:"locales/dayjs/ar-tn-js",7806:"locales/dayjs/ru-js",7962:"locales/dayjs/tg-js",7981:"locales/dayjs/zh-tw-js",8022:"locales/dayjs/tl-ph-js",8031:"locales/dayjs/eo-js",8176:"locales/dayjs/rw-js",8178:"locales/dayjs/en-il-js",8227:"locales/he-LC_MESSAGES-converse-po",8232:"locales/dayjs/sl-js",8252:"locales/cs-LC_MESSAGES-converse-po",8343:"locales/dayjs/en-nz-js",8431:"locales/dayjs/fr-js",8443:"locales/dayjs/gu-js",8489:"locales/dayjs/am-js",8592:"locales/dayjs/tet-js",8630:"locales/dayjs/gom-latn-js",8714:"locales/si-LC_MESSAGES-converse-po",8789:"locales/dayjs/ko-js",8880:"locales/dayjs/ar-js",8898:"locales/uk-LC_MESSAGES-converse-po",8945:"locales/dayjs/tlh-js",8986:"locales/zh_TW-LC_MESSAGES-converse-po",9007:"locales/dayjs/jv-js",9052:"locales/dayjs/tzm-js",9080:"locales/dayjs/az-js",9101:"locales/dayjs/fr-ch-js",9109:"locales/dayjs/nl-be-js",9139:"locales/hu-LC_MESSAGES-converse-po",9271:"locales/dayjs/es-do-js",9331:"locales/dayjs/sr-cyrl-js",9395:"locales/dayjs/ca-js",9411:"locales/dayjs/sq-js",9423:"locales/dayjs/bn-js",9547:"locales/dayjs/si-js",9557:"locales/dayjs/tr-js",9562:"locales/nb-LC_MESSAGES-converse-po",9589:"locales/dayjs/hy-am-js",9593:"locales/dayjs/lv-js",9710:"locales/dayjs/fy-js",9782:"locales/dayjs/el-js",9870:"locales/dayjs/fr-ca-js",9975:"locales/dayjs/se-js"}[e]+".js"),o.miniCssF=e=>{},o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s={},n="converse.js:",o.l=(e,t,i,r)=>{if(s[e])s[e].push(t);else{var a,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+i){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",n+i),a.src=e),s[e]=[t];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(m);var i=s[e];if(delete s[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="/dist/",(()=>{var e={8792:0};o.f.j=(t,s)=>{var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var i=new Promise(((s,i)=>n=e[t]=[s,i]));s.push(n[2]=i);var r=o.p+o.u(t),a=new Error;o.l(r,(s=>{if(o.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",a.name="ChunkLoadError",a.type=i,a.request=r,n[1](a)}}),"chunk-"+t,t)}};var t=(t,s)=>{var n,i,[r,a,c]=s,l=0;if(r.some((t=>0!==e[t]))){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(c)c(o)}for(t&&t(s);l<r.length;l++)i=r[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0},s=self.webpackChunkconverse_js=self.webpackChunkconverse_js||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),o.nc=void 0,(()=>{"use strict";const e={},t={plugins:{add(t,s){if(void 0!==e[t])throw new TypeError(`Error: plugin with name "${t}" has already been registered!`);e[t]=s}},initialize:(e={})=>t.load(e).initialize(e),load:(s={})=>(s.assets_path&&(o.p=s.assets_path),o(6820),Object.keys(e).forEach((s=>t.plugins.add(s,e[s]))),t)};window.converse=t;const s=new CustomEvent("converse-loaded",{detail:{converse:t}});window.dispatchEvent(s)})()})();
//# sourceMappingURL=converse.min.js.map